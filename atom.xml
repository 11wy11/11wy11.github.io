<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>WeiYuan&#39;s Blog</title>
  
  <subtitle>学习随记</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://11wy11.github.io/"/>
  <updated>2021-03-12T08:09:48.365Z</updated>
  <id>http://11wy11.github.io/</id>
  
  <author>
    <name>11wy11</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>QGIS的插件开发（C++&amp;python）</title>
    <link href="http://11wy11.github.io/2021/03/12/qgis-develop-plugin/"/>
    <id>http://11wy11.github.io/2021/03/12/qgis-develop-plugin/</id>
    <published>2021-03-12T07:13:25.000Z</published>
    <updated>2021-03-12T08:09:48.365Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><h1 id="QGIS的插件开发（C-amp-Python）"><a href="#QGIS的插件开发（C-amp-Python）" class="headerlink" title="QGIS的插件开发（C++&amp;Python）"></a>QGIS的插件开发（C++&amp;Python）</h1><h2 id="基于C"><a href="#基于C" class="headerlink" title="基于C++"></a>基于C++</h2><p>C++插件一般以Dll文件的形式，存放在工程下。当我们使用对应的插件时，会动态加载它。<br>和Python良好的可移植性不同，Dll文件及其附属一系列的链接库不可以直接加入现有工程。所以，我们采用重新编译的方法来生成对应的Dll文件。</p><h2 id="研究思路"><a href="#研究思路" class="headerlink" title="研究思路"></a>研究思路</h2><p>QGIS是基于QT开发的开源项目。其中自带有Plugin Builder的插件，利用Plugin Builder，可以直接建立一个插件模板。</p><p>然而，Plugin Builder生成的插件模板是Python格式，为了让它能够成为我们希望的Dll格式。<br>我们将利用Plugin Builder的功能，先生成插件模板源码。再将其加入qgis源码中，重新用C++编译整个qgis工程来生成它。<br>（本文中将用大小写来区分QGIS Desktop桌面应用和qgis源码）</p><h2 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h2><p>【Plugin Builder源码】</p><p><a href="https://github.com/g-sherman/Qgis-Plugin-Builder" target="_blank" rel="noopener">https://github.com/g-sherman/Qgis-Plugin-Builder</a></p><p>Plugin Builder是一个同QGIS版本变化同步更新的一个插件。</p><p>如果你有下载安装过QGIS Desktop，你会发现他的Plugin Builder插件有所更改，名为Plugin Builder 3<br>同时在3版本以上的qgis源码中，我们找不到Plugin Builder的源码。<br>（本文中将用Plugin Builder和Plugin Builder 3分别表示不同版本的PluginBuilder插件）</p><p>而目前提供的Plugin Builder（包含CMakeList）源码，还使用早期QT4和Python2的编译规则。<br>所以，如果你下载的源码版本是较新的（3版本以上），你还需要下载qgis-ltr（稳定维护版本2.18.25）的源码。<br>qgis-latest-ltr</p><p>在这个版本里，你可以在src/plugins下找到我们需要的Plugin Builder源码</p><p><strong>我找不到，单独下载了plugin builder的源码，按照教程放置，提示</strong>找不到resouce</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Traceback (most recent call last):</span><br><span class="line">  File &quot;plugin_builder.py&quot;, line 47, in &lt;module&gt;</span><br><span class="line">    from .resources import *  #pylint: disable=W0401,W0614</span><br><span class="line">ModuleNotFoundError: No module named &apos;__main__.resources&apos;; &apos;__main__&apos; is not a package</span><br></pre></td></tr></table></figure><h3 id="生成插件模板"><a href="#生成插件模板" class="headerlink" title="生成插件模板"></a>生成插件模板</h3><p>生成插件指令<br>在plugin_builder.py所在位置运行cmd</p><p>PS D:\QGIS\qgis-3.2.2\src\plugins&gt; python3 plugin_builder.py<br>它和MFC类似，是一个简单的向导。<br>会依次输出要求指令，输入合适的内容即可直接构造。</p><p>您的插件MyTool已在my_plugin中创建，CMakeLists.txt已被修改。<br>一旦您的插件成功构建，请查看my_plugin/readme关于如何开始的提示</p><h4 id="生成vs工程"><a href="#生成vs工程" class="headerlink" title="生成vs工程"></a>生成vs工程</h4><p>将处理好的源码，利用cmake生成对应的工程文件。<br>并对其编译，使其成功生成。</p><p>在资源管理器中找到以你的插件为命名的项目<br>如，我的是——mytoolplugin<br>对这个项目的添加有关.h和.cpp文件，对其编辑，最后生成解决方案中的<br>即为你的C++插件<br>你可以在新建项目的目录中找到他们。</p><p>出错补充<br>在加入自定义的插件后，这个插件项目，可能会出现以下错误<br>C1083 无法打开包括文件: “qgis_core.h”: No such file or directory<br>C1083 无法打开包括文件: “qgis_gui.h”: No such file or directory<br>C1083 无法打开包括文件: “qgisexpression.h”: No such file or directory<br>解决方法——<br>在这个项目属性，C++常规，附加包含目录中添加<br>源码路径\src\core<br>源码路径\src\gui<br>源码路径\core\expression<br>即可</p><h4 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h4><p><a href="https://blog.csdn.net/qq_39506222/article/details/83579888?utm_medium=distribute.pc_aggpage_search_result.none-task-blog-2~aggregatepage~first_rank_v2~rank_aggregation-3-83579888.pc_agg_rank_aggregation&amp;utm_term=c%2B%2B%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91+qgis&amp;spm=1000.2123.3001.4430" target="_blank" rel="noopener">https://blog.csdn.net/qq_39506222/article/details/83579888?utm_medium=distribute.pc_aggpage_search_result.none-task-blog-2~aggregatepage~first_rank_v2~rank_aggregation-3-83579888.pc_agg_rank_aggregation&amp;utm_term=c%2B%2B%E6%8F%92%E4%BB%B6%E5%BC%80%E5%8F%91+qgis&amp;spm=1000.2123.3001.4430</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h1 id=&quot;QGIS的插件开发（C-amp-Python）&quot;&gt;&lt;a href=&quot;#QGIS的插件开发（C-amp-Python）&quot; class=&quot;headerlink&quot; title=&quot;QGIS的插件开发（C++&amp;amp;Python）&quot;&gt;&lt;
      
    
    </summary>
    
      <category term="QGIS" scheme="http://11wy11.github.io/categories/QGIS/"/>
    
    
      <category term="QGIS" scheme="http://11wy11.github.io/tags/QGIS/"/>
    
  </entry>
  
  <entry>
    <title>使用SVG制作icon</title>
    <link href="http://11wy11.github.io/2021/03/10/svg-learn/"/>
    <id>http://11wy11.github.io/2021/03/10/svg-learn/</id>
    <published>2021-03-10T12:18:24.000Z</published>
    <updated>2021-03-10T12:29:20.335Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><h2 id="SVG优势"><a href="#SVG优势" class="headerlink" title="SVG优势"></a>SVG优势</h2><p>随着高清屏幕的普及，相比使用png等位图而言，使用SVG等矢量图形是一种全新的设计方式。更重要的是相比位图而言，SVG有着无可比拟的优势。这里我总结一下SVG具体的一些优势：</p><ol><li>SVG是矢量图形文件，可以随意改变大小，而不影响图标质量。</li><li>可以用CSS样式来自由定义图标颜色，比如颜色/尺寸等效果。</li><li>所有的SVG可以全部在一个文件中，节省HTTP请求 。</li><li>使用SMIL、CSS或者是javascript可以制作充满灵性的交互动画效果。</li><li>由于SVG也是一种XML节点的文件，所以可以使用gzip的方式把文件压缩到很小。</li></ol><h2 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h2><p>在web开发中，SVG主要有下面几种使用方法：</p><ol><li>使用img和object标签直接引用svg。这种方法的缺点主要在于要求每个图标都单独保存成一个SVG文件，使用时也是单独请求的，增加了HTTP请求。</li><li>Inline SVG，直接把SVG写入 HTML 中，这种方法简单直接，而且具有非常好的可调性。Inline SVG 作为HTML文档的一部分，不需要单独请求。临时需要修改某个图标的形状也比较方便。但是Inline SVG使用上比较繁琐，需要在页面中插入一大块SVG代码不适合手写，图标复用起来也比较麻烦。</li><li>SVG Sprite。这里所说的Sprite技术，没错，类似于CSS中的Sprite技术。图标图形整合在一起，实际呈现的时候准确显示特定图标。其实基础的SVG Sprite也只是将原来的位图改成了SVG而已。</li><li>最后就是本文的主角啦。使用svg中的<symbol>元素来制作icon。</symbol></li></ol><p>现在，我们着重介绍的是使用svg中的<symbol>元素来制作icon，在上面说到的SVG Sprite中，我们需要使用相对位置来控制哪个图标被显示出来，但是SVG本身的定义是允许你可以使用<use></use>的方式直接引用SVG中的某一部分。</symbol></p><p>那么<symbol>元素是什么呢？按字面意思的话是符号的意思，如果把一个SVG文件比喻成一个书柜的话，那么<symbol>则就表示书柜中一本本不同类别的书籍。这些一本本不同类别的书本就是我们要使用的<symbol>图标。</symbol></symbol></symbol></p><p>下面的代码就是将多个SVG图标整合成一个SVG文件之后的样子，可以看到代码中有不同类别的<symbol>元素，它们就是我们要引用的图标：</symbol></p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2021/03/10/svg-learn/6941baebgw1elrutl1gycj20ge0f2juj.jpg" alt="img" title>                </div>                <div class="image-caption">img</div>            </figure><p>每个Symbol设置一个id作为引用时的名字。使用id引用这个SVG中的Icon有两种方法。</p><p>第一种，将上述SVG作为body的第一个元素插入在HTML中， 此后，在需要显示某个 Icon 的地方插入下面的代码即可：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2021/03/10/svg-learn/6941baebgw1elrutkq504j20bw01uwee.jpg" alt="img" title>                </div>                <div class="image-caption">img</div>            </figure><p>第二种是，是使用完整路径引用Icon。 也就是：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2021/03/10/svg-learn/6941baebgw1elrutk1rpmj20g3069mxs.jpg" alt="img" title>                </div>                <div class="image-caption">img</div>            </figure><p>这种方法不需要像Sprite那样繁琐的设置图片的位移。使用id命名图标并使用时直接使用id引用既直观又简单。</p><h2 id="自动化合并工具"><a href="#自动化合并工具" class="headerlink" title="自动化合并工具"></a>自动化合并工具</h2><p>问题来啦，如果碰到很多的图标，难道我们都要手动去合并为一个SVG吗？当然不用。</p><p>这里介绍一个专门用于处理SVG Symbols用的glup插件<a href="https://github.com/Hiswe/gulp-svg-symbols" target="_blank" rel="noopener">gulp-svg-symbols</a>。</p><p>下面我们就来以一个实例一步一步来使用下这个插件。</p><p>首先新建一个文件夹，目录结构如下图所示：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2021/03/10/svg-learn/6941baebgw1elrutjo1fuj209a04xq2v.jpg" alt="img" title>                </div>                <div class="image-caption">img</div>            </figure><p>svg文件夹是用来存放svg格式文件的。</p><p>当然首先是你得有glup环境，至于glup环境的安装这里就不再阐述了，详细的安装使用教程可以去<a href="http://blog.segmentfault.com/laopopo/1190000000372547" target="_blank" rel="noopener">这篇文章</a>看看。</p><p>然后在你的项目目录下运行下面的命令安装插件：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2021/03/10/svg-learn/6941baebgw1elrutjdw2ej20aj01twed.jpg" alt="img" title>                </div>                <div class="image-caption">img</div>            </figure><p>最后在你的项目目录新建一个<strong>gulpfile.js</strong>文件，写入下面的代码：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2021/03/10/svg-learn/6941baebgw1elrutikr25j20dq05d74r.jpg" alt="img" title>                </div>                <div class="image-caption">img</div>            </figure><p>ok。基本的环境搭好啦，正所谓，巧妇难为无米之炊。上哪找svg图标去呢？ 这里推荐去<a href="https://icomoon.io/app/#/select" target="_blank" rel="noopener">icomoon.io</a> 这个专门提供矢量图标网站下载矢量图像，重要的是它提供SVG格式的图形下载。</p><p>我们这里就以icomoon.io为例，首先是点击你需要下载的图形，选中它，然后点击下载按钮：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2021/03/10/svg-learn/6941baebgw1elruthzvcdj20ge056mxf.jpg" alt="img" title>                </div>                <div class="image-caption">img</div>            </figure><p>点击下载svg：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2021/03/10/svg-learn/6941baebgw1elruthm8eij20ag02imx4.jpg" alt="img" title>                </div>                <div class="image-caption">img</div>            </figure><p>然后按照我们上面的配置文件，我们把下载好的svg图标放到svg文件夹中。</p><p>一切准备就绪，在你的项目目录中，运行gulp sprites命令：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2021/03/10/svg-learn/6941baebgw1elruth9mx0j20cu02dmxa.jpg" alt="img" title>                </div>                <div class="image-caption">img</div>            </figure><p>运行命令之后，它会在你的目录中生成一个svg文件，用你常用的代码编辑器打开svg文件，可以看到svg图标都被合并到一个文件中。并且根据对应SVG文件的名称生成了ID，如下图所示：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2021/03/10/svg-learn/6941baebgw1elrutgn8voj20ge06fmy1.jpg" alt="img" title>                </div>                <div class="image-caption">img</div>            </figure><p>那怎么使用呢它们呢？直接在html文件中使用，并且可以直接使用css来定义宽高、填充颜色等属性。如下代码所示：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2021/03/10/svg-learn/6941baebgw1elrutfes02j20hd0fxabe.jpg" alt="img" title>                </div>                <div class="image-caption">img</div>            </figure><p>不过由于浏览器安全策略限制的原因，我们不能在本地直接打开html文件来预览我们引用的svg文件，需要以服务器的形式来打开，用gulp也很容易搞定一个简单的服务器环境。首先我们需要安装gulp-connect这个模块，运行下面的命令：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2021/03/10/svg-learn/6941baebgw1elrutennhqj20am018wec.jpg" alt="img" title>                </div>                <div class="image-caption">img</div>            </figure><p>然后修改下gulpfile.js文件中的配置项：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2021/03/10/svg-learn/6941baebgw1elrute9s49j20e907ygme.jpg" alt="img" title>                </div>                <div class="image-caption">img</div>            </figure><p>运行gulp webserver命令，打开localhost:8080，就可以看到我们引入的svg图标了：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2021/03/10/svg-learn/6941baebgw1elrutdik3bj20e005zq2x.jpg" alt="img" title>                </div>                <div class="image-caption">img</div>            </figure><p>转自:<a href="https://www.cnblogs.com/wusl123/p/14278359.html" target="_blank" rel="noopener">https://www.cnblogs.com/wusl123/p/14278359.html</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;SVG优势&quot;&gt;&lt;a href=&quot;#SVG优势&quot; class=&quot;headerlink&quot; title=&quot;SVG优势&quot;&gt;&lt;/a&gt;SVG优势&lt;/h2&gt;&lt;p&gt;随着高清屏幕的普及，相比使用png等位图而言，使用SVG等矢量图形是一种全新的设
      
    
    </summary>
    
      <category term="前端" scheme="http://11wy11.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="可视化" scheme="http://11wy11.github.io/categories/%E5%89%8D%E7%AB%AF/%E5%8F%AF%E8%A7%86%E5%8C%96/"/>
    
    
      <category term="SVG" scheme="http://11wy11.github.io/tags/SVG/"/>
    
  </entry>
  
  <entry>
    <title>QGIS相关资料整理</title>
    <link href="http://11wy11.github.io/2021/03/03/qgis-develop-custom-symbollib/"/>
    <id>http://11wy11.github.io/2021/03/03/qgis-develop-custom-symbollib/</id>
    <published>2021-03-03T14:05:10.000Z</published>
    <updated>2021-03-11T11:32:11.123Z</updated>
    
    <content type="html"><![CDATA[<p>QGIS 资料收集总结</p><a id="more"></a><h1 id="1-qgis自定义符号库"><a href="#1-qgis自定义符号库" class="headerlink" title="1.qgis自定义符号库"></a>1.qgis自定义符号库</h1><p>转载:<a href="https://blog.csdn.net/wywywywywywy123456/article/details/66971218" target="_blank" rel="noopener">https://blog.csdn.net/wywywywywywy123456/article/details/66971218</a></p><p>地图符号作为地图语言；抽象描述的客观世界并用直观、生动视觉的手段向我们传递地理信息。每款GIS软件都会自带一些常见的地图符号，也可以自定义地图符号。一般做专题地图那些常规符号库就不能满足我们。</p><p>在使用qgis时候发现自带地图符号少的可怜而且又不美观。于是我引进第三方地图符号；由于qgis自定义允许svg格式我去mapbox官网下载一套svg格式。svg网上资源还是蛮丰富的；加载qgis里只要设置一下路径可以。</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2021/03/03/qgis-develop-custom-symbollib/20170327151252041" alt="img" title>                </div>                <div class="image-caption">img</div>            </figure><p>右击Properties选择样式类型SVG。</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2021/03/03/qgis-develop-custom-symbollib/20170327151429451" alt="img" title>                </div>                <div class="image-caption">img</div>            </figure><p>当然可以通过lnkscape软件来做符号，然后在保存SVG格式。</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2021/03/03/qgis-develop-custom-symbollib/20170327152341462" alt="img" title>                </div>                <div class="image-caption">img</div>            </figure><p>也可以写XML文件来添加地图符号。<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2021/03/03/qgis-develop-custom-symbollib/20170327152759185" alt="img" title>                </div>                <div class="image-caption">img</div>            </figure></p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2021/03/03/qgis-develop-custom-symbollib/20170327153028412" alt="img" title>                </div>                <div class="image-caption">img</div>            </figure><p>参考资料</p><p><a href="http://docs.qgis.org/2.14/en/docs/training_manual/basic_map/symbology.html" target="_blank" rel="noopener">http://docs.qgis.org/2.14/en/docs/training_manual/basic_map/symbology.html</a></p><p><a href="https://www.mapbox.com/maki-icons/" target="_blank" rel="noopener">https://www.mapbox.com/maki-icons/</a><br><a href="https://thenounproject.com/" target="_blank" rel="noopener">https://thenounproject.com/</a></p><p><a href="https://mapicons.mapsmarker.com/" target="_blank" rel="noopener">https://mapicons.mapsmarker.com/</a></p><h1 id="2-QGIS切换在线地图服务的地图样式"><a href="#2-QGIS切换在线地图服务的地图样式" class="headerlink" title="2.QGIS切换在线地图服务的地图样式"></a>2.QGIS切换在线地图服务的地图样式</h1><p>转载：<a href="https://blog.csdn.net/weixin_29002209/article/details/112558162" target="_blank" rel="noopener">https://blog.csdn.net/weixin_29002209/article/details/112558162</a></p><p>底图是栅格瓦片服务，所以我们不能对其内容进行控制，更不能对其标注进行修改。不过这一切，在最新的QGIS中，借助一个插件，就可以实现底图效果的自定义了，不仅可以修改不同图层的样式，还可以直接将不想要的图层、标注直接关掉。</p><p><strong>插件MapTiler</strong></p><p>默认提供了7种地图样式，你可以在这些基础上进行改造。我使用最多的是Basic、Streets和Toner。</p><p>需要你输入一个Key才行。点击面板中的地址自己申请一个就可以啦。</p><p>申请完毕填上后，数据就可以加载到工程中啦。</p><p>此时，我们在图层树上选择所加载的图层，右侧就会出现其对应的设置面板。新添加的底图服务面板中，都是每一个可以设置的图层，可以对其进行开关勾选，更可以对其进行样式设置。然，不仅可以对图层效果进行设置，对图层标注也是可以修改的。</p><h1 id="3-QGIS自定义符号"><a href="#3-QGIS自定义符号" class="headerlink" title="3.QGIS自定义符号"></a>3.QGIS自定义符号</h1><p><a href="https://www.cnblogs.com/freeza/p/7799227.html" target="_blank" rel="noopener">QGIS开发之自定义符号</a></p><p>在程序里添加了编辑矢量图层符号的功能，右键LayerTree的矢量图层，选择“Edit Symbol”，便可以选择或编辑图层的渲染符号。</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2021/03/03/qgis-develop-custom-symbollib/1092574-20171107144044106-443485294.png" alt="img" title>                </div>                <div class="image-caption">img</div>            </figure><p>实现方法很简单，首先参照<a href="http://blog.csdn.net/deirjie/article/details/50428179，实现自定义的右键菜单类，具体代码可参考源码中的**QgsAppLayerTreeViewMenuProvider**类。源码里有一个**editVectorSymbol()**方法，原封不动地copy到自己的代码里就行了。" target="_blank" rel="noopener">http://blog.csdn.net/deirjie/article/details/50428179，实现自定义的右键菜单类，具体代码可参考源码中的**QgsAppLayerTreeViewMenuProvider**类。源码里有一个**editVectorSymbol()**方法，原封不动地copy到自己的代码里就行了。</a></p><p>[<figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2021/03/03/qgis-develop-custom-symbollib/javascript:void(0);" alt="复制代码](https://common.cnblogs.com/images/copycode.gif)" title>                </div>                <div class="image-caption">复制代码](https://common.cnblogs.com/images/copycode.gif)</div>            </figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"> 1 void QgsAppLayerTreeViewMenuProvider::editVectorSymbol()</span><br><span class="line"> 2 &#123;</span><br><span class="line"> 3   QAction* action = qobject_cast&lt; QAction*&gt;( sender() );</span><br><span class="line"> 4   if ( !action )</span><br><span class="line"> 5     return;</span><br><span class="line"> 6 </span><br><span class="line"> 7   QString layerId = action-&gt;property( &quot;layerId&quot; ).toString();</span><br><span class="line"> 8   QgsVectorLayer* layer = dynamic_cast&lt;QgsVectorLayer*&gt;( QgsMapLayerRegistry::instance()-&gt;mapLayer( layerId ) );</span><br><span class="line"> 9   if ( !layer )</span><br><span class="line">10     return;</span><br><span class="line">11 </span><br><span class="line">12   QgsSingleSymbolRendererV2* singleRenderer = dynamic_cast&lt; QgsSingleSymbolRendererV2* &gt;( layer-&gt;rendererV2() );</span><br><span class="line">13   if ( !singleRenderer )</span><br><span class="line">14     return;</span><br><span class="line">15 </span><br><span class="line">16   QScopedPointer&lt; QgsSymbolV2 &gt; symbol( singleRenderer-&gt;symbol() ? singleRenderer-&gt;symbol()-&gt;clone() : nullptr );</span><br><span class="line">17   QgsSymbolV2SelectorDialog dlg( symbol.data(), QgsStyleV2::defaultStyle(), layer, mView-&gt;window() );</span><br><span class="line">18   dlg.setMapCanvas( mCanvas );</span><br><span class="line">19   if ( dlg.exec() )</span><br><span class="line">20   &#123;</span><br><span class="line">21     singleRenderer-&gt;setSymbol( symbol.take() );</span><br><span class="line">22     layer-&gt;triggerRepaint();</span><br><span class="line">23     mView-&gt;refreshLayerSymbology( layer-&gt;id() );</span><br><span class="line">24   &#125;</span><br><span class="line">25 &#125;</span><br></pre></td></tr></table></figure><p>[<figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2021/03/03/qgis-develop-custom-symbollib/javascript:void(0);" alt="复制代码](https://common.cnblogs.com/images/copycode.gif)" title>                </div>                <div class="image-caption">复制代码](https://common.cnblogs.com/images/copycode.gif)</div>            </figure></p><p>以下为点状的Symbol Selector实现效果：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2021/03/03/qgis-develop-custom-symbollib/1092574-20171107145223653-49426581.png" alt="img" title>                </div>                <div class="image-caption">img</div>            </figure><p>由于QGIS线状符号库里没有箭头符号，中午时使用QGIS桌面版自定义了一个带箭头的线状符号。线型为Marker Line，Marker placement为“on last vertex only”；Marker的类型为SVG marker，使用的箭头svg图标路径是开发包路径下的/svg/arrows/Arrow_05.svg；在设置一下点和线的尺寸、偏移、角度等参数便可以得到了。</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2021/03/03/qgis-develop-custom-symbollib/1092574-20171107145937638-2055373815.png" alt="img" title>                </div>                <div class="image-caption">img</div>            </figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2021/03/03/qgis-develop-custom-symbollib/1092574-20171107150717138-2078904463.png" alt="img" title>                </div>                <div class="image-caption">img</div>            </figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2021/03/03/qgis-develop-custom-symbollib/1092574-20171107150849950-1809473349.png" alt="img" title>                </div>                <div class="image-caption">img</div>            </figure><p>跟ArcGIS中的箭头符号对比一下：</p><p> <img src="/2021/03/03/qgis-develop-custom-symbollib/1092574-20171107151000559-1200382917.png" alt="img"></p><p>出乎我意料的是，在运行自己的代码时，发现程序的Symbol Selector跟桌面版的一样，也多了这个新定义的“GPS Arrow”符号。也就是说，这个符号设置应该是配置到了一个QGIS的类似环境变量的地方，经过一番探索发现，用户文件夹下有一个.qgis2的文件夹（我的是C:\Users\FangZhe.qgis2）里面存放的应该是QGIS的配置数据。文件夹下有一个<strong>symbology-ng-style.db</strong>二进制文件。测试了一下，将此文件移走，再次打开符号编辑对话框，里面的符号样式就只剩默认符号了，此时.qgis2文件夹下又生成了一个新的<strong>symbology-ng-style.db</strong>文件。由此看来，此文件确实就是QGIS的符号库文件。日后发布程序时，应该只需要设置将此文件预先添加到配置文件夹之中就可以了，如此便可以省去用代码自定义符号的工作。</p><p>C:\Users\Administrator\AppData\Roaming\QGIS\QGIS3\profiles\default</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2021/03/03/qgis-develop-custom-symbollib/1092574-20171107152250341-1723983819.png" alt="img" title>                </div>                <div class="image-caption">img</div>            </figure><p>现在对.qgis2文件夹还是不甚了解，不过暂时不想多花力气研究它，日后用到时再说吧。</p><p>感谢博主Jacory_Gao的博客，对我的开发工作帮助巨大。关于如何使用代码自定义符号样式，可参考这篇文章：<a href="http://blog.csdn.net/deirjie/article/details/50464768" target="_blank" rel="noopener">http://blog.csdn.net/deirjie/article/details/50464768</a></p><h1 id="使用第三方SVG符号库导入QGIS"><a href="#使用第三方SVG符号库导入QGIS" class="headerlink" title="使用第三方SVG符号库导入QGIS"></a>使用第三方SVG符号库导入QGIS</h1><p>1、下载地址：</p><p>mapbox官网github</p><p>mapbox\mapbox-gl-styles-master\mapbox-gl-styles-master\sprites</p><p>maki:<a href="https://labs.mapbox.com/maki-icons/" target="_blank" rel="noopener">https://labs.mapbox.com/maki-icons/</a></p><p>一种方法是将下载的SVG文件夹路径在以下位置添加其路径：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Settings-&gt;Options-&gt;System-&gt;SVG Path</span><br></pre></td></tr></table></figure><p>这样，您在QGIS样式器中将SVG符号作为组找到（“图层属性”-&gt;“样式…”。）</p><p>第二种方式：将符号复制到默认文件夹下，通常路径为：</p><p>C:\Users\Administrator\AppData\Roaming\QGIS\QGIS3\profiles\default</p><p>第三种、使用qgis中共享的SVG</p><p>安装插件Resource Sharing ，搜索maki,可以下载mapbox 的maki符号库</p><h1 id="一款插件SLYR-ESRI到QGIS兼容插件"><a href="#一款插件SLYR-ESRI到QGIS兼容插件" class="headerlink" title="一款插件SLYR ESRI到QGIS兼容插件"></a>一款插件SLYR ESRI到QGIS兼容插件</h1><p><a href="https://north-road.com/slyr/" target="_blank" rel="noopener">https://north-road.com/slyr/</a></p><ul><li>支持将MXD，MXT和PMF文档自动转换为QGIS项目，包括：<ul><li>支持转换<strong>矢量和栅格图层</strong>，与原始ArcMap外观非常精确地匹配</li><li>支持转换层联接和关系</li><li>页面布局转换为QGIS打印布局，完全支持使用多个数据框的多地图页面布局</li><li>将数据驱动页面转换为QGIS打印图集</li><li>MXD文档元数据</li></ul></li><li>将ESRI <strong>LYR</strong>文件转换为等效的QGIS（包括符号系统！）</li><li>读取和转换ESRI <strong>.style</strong>数据库</li><li>在QGIS中<strong>无缝</strong>，集成地处理MXD，LYR和其他ArcMap文档（例如，通过QGIS浏览器面板以及通过拖放操作）</li><li>一套<strong>功能强大的</strong>处理算法，可将ArcMap文档批量转换为QGIS格式</li><li>支持<strong>将</strong>图层直接从ArcMap或ArcCatalog<strong>拖放</strong>到QGIS窗口，并遵守所有图层样式。</li><li>支持<strong>将</strong>ArcMap页面布局元素直接<strong>复制和粘贴</strong>到QGIS打印布局中</li><li>支持AVL样式转换</li><li>对ArcMap .dat书签文件的集成支持</li><li>支持将ArcScene SXD文档转换为二维QGIS地图</li></ul><p>SLYR可以将多种ESRI符号类型转换为等效的QGIS符号体系：</p><ul><li>标记符号：简单标记，箭头标记，字符标记，图片标记，3d标记符号</li><li>线符号：简单线，制图线，标记线，哈希线和简单3d线</li><li>填充符号：简单填充，线条填充，标记填充，随机标记填充，图片填充和渐变填充</li></ul><h1 id="获取空气质量数据在QGIS进行可视化"><a href="#获取空气质量数据在QGIS进行可视化" class="headerlink" title="获取空气质量数据在QGIS进行可视化"></a>获取空气质量数据在QGIS进行可视化</h1><h2 id="数据收集和预处理"><a href="#数据收集和预处理" class="headerlink" title="数据收集和预处理"></a>数据收集和预处理</h2><p>城市点数据来自天地图的1：100万地形数据（2017版），WFS服务地址为：<a href="http://gisserver.tianditu.gov.cn/TDTService/wfs" target="_blank" rel="noopener">http://gisserver.tianditu.gov.cn/TDTService/wfs</a></p><p>空气质量指数来自中华人民共和国生态环境部官网：<a href="https://www.mee.gov.cn/" target="_blank" rel="noopener">https://www.mee.gov.cn/</a></p><ol><li><p>首先，收集和整理空气质量指数。从生态环境部将所需要的数据下载，整理为三个字段：AQI、空气质量、城市，保存为CSV分隔文本文件。其中AQI为整型字段，用于制作空气质量指数分级专题图；空气质量是对应AQI分级的中文描述；城市名称将作为连接字段与矢量数据挂接。</p></li><li><p>其次，利用QGIS提取和处理天地图1：100万地形数据（2017版）居民点数据。打开QGIS，在【浏览】面板找到“WFS/OGC API-Features”节点，右键-&gt;【新建连接】，在弹出的对话框，名称填写“tianditu”，URL输入：“<a href="http://gisserver.tianditu.gov.cn/TDTService/wfs”，点击【OK】完成WFS连接。" target="_blank" rel="noopener">http://gisserver.tianditu.gov.cn/TDTService/wfs”，点击【OK】完成WFS连接。</a></p></li><li><p>展开【浏览器】面板-&gt;【WFS/OGC API-Features】-&gt;【tianditu】，可以看到该数据服务下共有AANP、AGNP、BOUA、BOUL等十个图层，对应居民点、行政区划界线、水系、道路等要素，其中AGNP为带名称的居民点，将其拖拽到地图窗口，同时打开对应的属性表，观察数据情况：可以看到，AGNP图层共包含OBJECTID、CLASS、NAME、PINYIN、GNID、XZNAME六个字段，其中CLASS表示居民点分类，通过分析可知，当CLASS取值为“AD”时，可提取到城市点。</p></li><li><p>点击属性表窗口左下角的下拉菜单，选择【高级过滤（表达式）】，打开表达式字符串过滤器，输入下列表达式筛选出城市点：”CLASS”  =  ‘AD’点击【OK】完成表达式筛选，返回属性表窗口，共过滤出415个要素，点击表格左上角，选中所有过滤结果：切换到QGIS地图主窗口，右键点击【图层】面板-&gt;【AGNP】-&gt;【导出】-&gt;【另存选中的要素为…】，弹出【矢量图层另存为】对话框，设置如下参数：格式：GeoPackage；文件名：任意存储路径\city.gpkg；其他参数保持默认，点击【OK】将筛选到的城市点保存为单独的图层。</p></li><li><p>最后，建立空气质量指数与城市点数据的连接。在【浏览器】面板找到上一步骤保存的城市点图层和空气质量指数，拖拽到地图窗口。右键点击城市点图层-&gt;【属性】-&gt;【连接】： 击左下角的 按钮，打开新建连接对话框，设置如下参数：</p><p>​    连接图层：AQI20210128；</p><p>​    连接字段：城市；</p><p>​    目标字段：NAME。</p><p><img src="/2021/03/03/qgis-develop-custom-symbollib/a1dd5c2703fa6e4f6a13c9c7a2860a5e.png" alt="img"></p><p>点击【OK】完成连接设置。</p></li><li><p>关闭图层属性对话框，返回QGIS主窗口，打开城市点图层的属性表窗口，可以看到属性字段增加了AQI、空气质量和城市，说明AQI数据已经连接到城市点图层，至此，数据预处理工作完成，开始空气质量指数地图可视化设置。</p></li></ol><h2 id="2、空气质量指数分级"><a href="#2、空气质量指数分级" class="headerlink" title="2、空气质量指数分级"></a>2、空气质量指数分级</h2><p>根据我国生态环境部科技标准司于2012年发布的《环境空气质量指数（AQI）技术规定（试行）（HJ 633—2012）》，我国的空气质量指数可以分为六个等级，具体分级标准如下：</p><p> <img src="/2021/03/03/qgis-develop-custom-symbollib/fbd61c00e048d602e60d433820779379.png" alt="img"></p><p>使用QGIS的“渐进”渲染，可以将上述标准表达在地图上。 </p><p>选中城市点图层，点击【图层】面板上方的 按钮，打开【图层样式】面板，点击渲染器下拉框，选择“渐进”渲染：设置“渐进”渲染的参数如下： </p><p>值：AQI20210128_AQI；</p><p>图例格式：精度-2，勾选“裁剪”；</p><p>模式：等数量（分位数）；</p><p>类：6。</p><p>点击【分类】按钮，将城市的AQI分为6个等级，如下图：默认的分级断点和样式与我国的标准并不一致，需要手工调整。首先，修改一级AQI的符号颜色为标准规定的绿色，RGB值为（72, 228, 0）：双击分类第一行中的【符号】， 在符号图层选中【标记】-&gt;【简单标记】-&gt;【填充颜色】-&gt;【选择颜色】，分别填入颜色的R、G、B分量：72, 228, 0。</p><p> 第二步，修改分级的上下限。双击第一行的【值】，弹出上下限设置对话框，输入【下界值】为0；【上界值】为50：</p><p> 最后，修改图例的文字，双击第一行的【图例】，进入编辑状态，输入文字“优”：</p><p> 按同样步骤完成其他AQI级别的符号、上下限、图例的修改，完成后效果如下图：</p><h2 id="3-添加文字标注"><a href="#3-添加文字标注" class="headerlink" title="3.添加文字标注"></a>3.添加文字标注</h2><p>在【图层样式】面板，切换到 标注标签页，选择“单一标注”，点击【值】右侧的 按钮，打开【表达式对话框】，输入如下表达式作为标注的内容：</p><p>“NAME”  ||  ‘\n’  || “AQI20210128_AQI”</p><p>接下来设置标签的背景颜色。切换到 背景，勾选“绘制背景”，设置【大小 横坐标】为2，【纵向大小】为0.5，点击【填充颜色】右侧的 按钮，打开【表达式字符串构造器】对话框，输入如下表达式设置标注的背景色：</p><p>@symbol_color</p><p>此时可以看到，有些标注压盖了城市点，需要设置标注的位置以解决压盖问题。切换到 位置，将【模式】设置为“离点偏移量”，【横、纵坐标偏移】分别输入0.0000，-6.0000。</p><p>为了明确标注与城市的对应关系，可以绘制引出线，即标注牵引线。切换到 引出线，勾选“绘制引出线”，将【从要素偏移】设置为1毫米。</p><p>最后，为地图选择一个比较素净的网络地图作为背景图，本文选择使用OpenStreetMap monochrome作为底图，其XYZ连接URL为：<a href="http://a.tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png。也可以使用国内的天地图、高德地图等（关于如何加载网络地图，请参考：浅谈XYZTiles" target="_blank" rel="noopener">http://a.tiles.wmflabs.org/bw-mapnik/{z}/{x}/{y}.png。也可以使用国内的天地图、高德地图等（关于如何加载网络地图，请参考：浅谈XYZTiles</a> 和 通过QGIS XYZ Tiles访问国内四大图商地图服务）。最终效果如下：</p><p>转载原文链接：<a href="https://blog.csdn.net/QGISClass/article/details/113360573" target="_blank" rel="noopener">https://blog.csdn.net/QGISClass/article/details/113360573</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;QGIS 资料收集总结&lt;/p&gt;
    
    </summary>
    
      <category term="QGIS" scheme="http://11wy11.github.io/categories/QGIS/"/>
    
    
      <category term="QGIS" scheme="http://11wy11.github.io/tags/QGIS/"/>
    
  </entry>
  
  <entry>
    <title>QGIS改造源代码</title>
    <link href="http://11wy11.github.io/2021/03/02/qis-develop-7-addition-qgis/"/>
    <id>http://11wy11.github.io/2021/03/02/qis-develop-7-addition-qgis/</id>
    <published>2021-03-02T14:24:51.000Z</published>
    <updated>2021-03-12T07:50:53.608Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><p>1、利用uic.exe 手动生成ui头文件</p><p>配置过环境变量QTDIR之后，可以在命令行中使用uic命令</p><p>uic “src\ui\qgisapp.ui” -o “.\ms-windows\osgeo4w\build-qgis-test-x86_64\src\ui\ui_qgisapp.h”</p><p>2.利用moc.exe 编译出cpp文件</p><p><strong>moc.exe” “自定义的.h” -o “moc_xxx.cpp”</strong></p><p><strong>每次改动界面，需要全部重新编译工程</strong></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;1、利用uic.exe 手动生成ui头文件&lt;/p&gt;
&lt;p&gt;配置过环境变量QTDIR之后，可以在命令行中使用uic命令&lt;/p&gt;
&lt;p&gt;uic “src\ui\qgisapp.ui” -o “.\ms-windows\osgeo4w\buil
      
    
    </summary>
    
      <category term="QGIS" scheme="http://11wy11.github.io/categories/QGIS/"/>
    
    
      <category term="QGIS" scheme="http://11wy11.github.io/tags/QGIS/"/>
    
  </entry>
  
  <entry>
    <title>pycharm2020.1破解激活</title>
    <link href="http://11wy11.github.io/2021/03/02/pycharm-install/"/>
    <id>http://11wy11.github.io/2021/03/02/pycharm-install/</id>
    <published>2021-03-02T14:08:06.000Z</published>
    <updated>2021-03-13T11:47:04.949Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><p>记录：破解激活文档：<a href="https://www.cnblogs.com/xuexianqi/p/12767075.html" target="_blank" rel="noopener">https://www.cnblogs.com/xuexianqi/p/12767075.html</a></p><h1 id="【Python】在PyCharm的菜单栏中配置Python2代码转换Python3的工具"><a href="#【Python】在PyCharm的菜单栏中配置Python2代码转换Python3的工具" class="headerlink" title="【Python】在PyCharm的菜单栏中配置Python2代码转换Python3的工具"></a>【Python】在PyCharm的菜单栏中配置Python2代码转换Python3的工具</h1><p>概述<br>本文介绍如何在PyCharm环境配置2to3.py工具到菜单栏。</p><p>测试环境<br>Windows 10 64位<br>PyCharm Community Edition 2016.3<br>Python 3.5.1</p><h3 id="2to3-py"><a href="#2to3-py" class="headerlink" title="2to3.py"></a>2to3.py</h3><p>如果要把python2编译器下的代码转换升级到python3编译器，可以使用Python自带的2to3.py工具进行转化。</p><p>你可以在Python安装路径下的Tools\scripts目录下找到2to3.py文件。</p><p>命令行使用方式：</p><p>python C:\Python35\Tools\scripts\2to3.py -w [filename]</p><p>可以加-h查看帮助：</p><p>python C:\Python35\Tools\scripts\2to3.py -h</p><h3 id="配置步骤"><a href="#配置步骤" class="headerlink" title="配置步骤"></a>配置步骤</h3><p>第一步：<br>pyCharm菜单栏–&gt;「File」–&gt;「Settings」–&gt;「Tools」–&gt;「External Tools」–&gt;点击加号添加工具。</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2021/03/02/pycharm-install/image-20210313194349723.png" alt="image-20210313194349723" title>                </div>                <div class="image-caption">image-20210313194349723</div>            </figure><p>第二步：<br>工具配置如下：</p><p>Program：\$ModuleSdkPath\$<br>Parameters：C:\Python35\Tools\scripts\2to3.py -w “\$FilePath\$”<br>Working directory：\$FileDir\$</p><p>第三步：<br>之后一路「OK」即可，完成后可以在「菜单栏」–&gt;「Tool」–&gt;「Extern Tools」下使用。</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2021/03/02/pycharm-install/image-20210313194650582.png" alt="image-20210313194650582" title>                </div>                <div class="image-caption">image-20210313194650582</div>            </figure><p>注意事项<br>由于Markdown编辑器的原因，参数以图片为准。<br>2to3.py存放路径最好不要有空格，或者尝试给执行路径加英文双引号，例如：<br>“C:\Python37\Tools\scripts\2to3.py” -w “\$FilePath\$”</p><h4 id="参考：https-blog-csdn-net-yannanxiu-article-details-54601075"><a href="#参考：https-blog-csdn-net-yannanxiu-article-details-54601075" class="headerlink" title="参考：https://blog.csdn.net/yannanxiu/article/details/54601075"></a>参考：<a href="https://blog.csdn.net/yannanxiu/article/details/54601075" target="_blank" rel="noopener">https://blog.csdn.net/yannanxiu/article/details/54601075</a></h4>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;记录：破解激活文档：&lt;a href=&quot;https://www.cnblogs.com/xuexianqi/p/12767075.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://www.cnblog
      
    
    </summary>
    
      <category term="软件" scheme="http://11wy11.github.io/categories/%E8%BD%AF%E4%BB%B6/"/>
    
    
      <category term="软件" scheme="http://11wy11.github.io/tags/%E8%BD%AF%E4%BB%B6/"/>
    
  </entry>
  
  <entry>
    <title>QGIS二次开发-QT Designer使用技巧点</title>
    <link href="http://11wy11.github.io/2021/01/15/qt-develop-skill-1/"/>
    <id>http://11wy11.github.io/2021/01/15/qt-develop-skill-1/</id>
    <published>2021-01-15T08:06:24.000Z</published>
    <updated>2021-01-15T13:42:59.356Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><h3 id="Qt-Designer-加入资源文件"><a href="#Qt-Designer-加入资源文件" class="headerlink" title="Qt Designer 加入资源文件"></a>Qt Designer 加入资源文件</h3><p>Qt Designer中如果在设计UI界面的时候要加入一些图素，图标等资源的时候是不能直接添加进去的，需要在Qt开发目录下编写QRC文件</p><p>qrc文件格式如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;RCC&gt;</span><br><span class="line">  &lt;qresource prefix=&quot;/images&quot;&gt;</span><br><span class="line">    &lt;file&gt;mActionPan.png&lt;/file&gt;</span><br><span class="line">    &lt;file&gt;Themes/mActionPanSelected.svg&lt;/file&gt;</span><br><span class="line">  &lt;/qresource&gt;</span><br><span class="line">&lt;/RCC&gt;</span><br></pre></td></tr></table></figure><p><strong>第一步：</strong></p><p>选择  “资源浏览器”</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2021/01/15/qt-develop-skill-1/062035575787434.png" alt="img" title>                </div>                <div class="image-caption">img</div>            </figure><p>点击类似铅笔的button</p><p><strong>第二步：</strong></p><p>从编辑资源选择击鼠标右键，</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2021/01/15/qt-develop-skill-1/062037098596953.png" alt="img" title>                </div>                <div class="image-caption">img</div>            </figure><p>新建一个image.qrc文件，</p><p><strong>第三步：</strong></p><p>添加资源，先选择一个新前缀，然后添加文件</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2021/01/15/qt-develop-skill-1/062041515783485.png" alt="img" title>                </div>                <div class="image-caption">img</div>            </figure><p><img src="/2021/01/15/qt-develop-skill-1/062044548431664.png" alt="img"></p><p>确定之后就可以在需要资源的地方引用资源浏览器的图片或文件了！</p><h3 id="QGIS工程添加qrc文件"><a href="#QGIS工程添加qrc文件" class="headerlink" title="QGIS工程添加qrc文件"></a>QGIS工程添加qrc文件</h3><p>在创建的QT工程中，引入qgis，在使用qgis的图标时，在QtDesigner中能够看到图标，运行后，看不到，需要在Resource Files 下添加 images 文件夹下的image.qrc</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h3 id=&quot;Qt-Designer-加入资源文件&quot;&gt;&lt;a href=&quot;#Qt-Designer-加入资源文件&quot; class=&quot;headerlink&quot; title=&quot;Qt Designer 加入资源文件&quot;&gt;&lt;/a&gt;Qt Designer 加入
      
    
    </summary>
    
      <category term="QGIS" scheme="http://11wy11.github.io/categories/QGIS/"/>
    
      <category term="QT" scheme="http://11wy11.github.io/categories/QGIS/QT/"/>
    
    
      <category term="QGIS" scheme="http://11wy11.github.io/tags/QGIS/"/>
    
      <category term="QT" scheme="http://11wy11.github.io/tags/QT/"/>
    
  </entry>
  
  <entry>
    <title>资料整理裂变</title>
    <link href="http://11wy11.github.io/2021/01/09/resource-collection/"/>
    <id>http://11wy11.github.io/2021/01/09/resource-collection/</id>
    <published>2021-01-09T05:02:13.000Z</published>
    <updated>2021-01-09T05:03:41.123Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><ol><li>DXF文件格式详解：<a href="https://wenku.baidu.com/view/45beee5886c24028915f804d2b160b4e767f81cc.html" target="_blank" rel="noopener">https://wenku.baidu.com/view/45beee5886c24028915f804d2b160b4e767f81cc.html</a></li><li></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;ol&gt;
&lt;li&gt;DXF文件格式详解：&lt;a href=&quot;https://wenku.baidu.com/view/45beee5886c24028915f804d2b160b4e767f81cc.html&quot; target=&quot;_blank&quot; re
      
    
    </summary>
    
      <category term="资料" scheme="http://11wy11.github.io/categories/%E8%B5%84%E6%96%99/"/>
    
    
      <category term="其他" scheme="http://11wy11.github.io/tags/%E5%85%B6%E4%BB%96/"/>
    
  </entry>
  
  <entry>
    <title>QGIS 文件结构解析及符号化类结构解析</title>
    <link href="http://11wy11.github.io/2021/01/02/qgis-develop-filestruct/"/>
    <id>http://11wy11.github.io/2021/01/02/qgis-develop-filestruct/</id>
    <published>2021-01-02T03:43:08.000Z</published>
    <updated>2021-01-04T08:54:47.714Z</updated>
    
    <content type="html"><![CDATA[<p>分析QGS文件格式及符号及注记组织结构</p><a id="more"></a><h3 id="QGS-文件结构"><a href="#QGS-文件结构" class="headerlink" title="QGS 文件结构"></a>QGS 文件结构</h3><h4 id="QGS-xml结构"><a href="#QGS-xml结构" class="headerlink" title="QGS xml结构"></a>QGS xml结构</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2021/01/02/qgis-develop-filestruct/qgstoplevel.png" alt title>                </div>                <div class="image-caption"></div>            </figure><h4 id="ProjectLayers-结构"><a href="#ProjectLayers-结构" class="headerlink" title="ProjectLayers 结构"></a>ProjectLayers 结构</h4><p>包括图层属性，符号规则，注记规则</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2021/01/02/qgis-develop-filestruct/qgsprojectlayers.png" alt title>                </div>                <div class="image-caption"></div>            </figure><h4 id="QLR-图层定义文件"><a href="#QLR-图层定义文件" class="headerlink" title="QLR 图层定义文件"></a>QLR 图层定义文件</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2021/01/02/qgis-develop-filestruct/qlr.png" alt="qlr" title>                </div>                <div class="image-caption">qlr</div>            </figure><h4 id="QML文件"><a href="#QML文件" class="headerlink" title="QML文件"></a>QML文件</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2021/01/02/qgis-develop-filestruct/qml.png" alt="qml" title>                </div>                <div class="image-caption">qml</div>            </figure><h3 id="MapLayer"><a href="#MapLayer" class="headerlink" title="MapLayer"></a>MapLayer</h3><p>StyleCategory</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2021/01/02/qgis-develop-filestruct/image-20210103220709620.png" alt="image-20210103220709620" title>                </div>                <div class="image-caption">image-20210103220709620</div>            </figure><p>QgsMapLayerStyleManager</p><p>管理与一个地图层一起使用的样式。</p><p>存储的样式由其名称标识。管理器始终跟踪当前处于活动状态的已存储样式。更改当前样式后，新样式将应用于关联的图层。</p><p>QgsMapLayerStyleManagerWidget</p><h4 id="QgsSymbolLayer"><a href="#QgsSymbolLayer" class="headerlink" title="QgsSymbolLayer"></a>QgsSymbolLayer</h4><p>property</p><table><thead><tr><th>PropertySize</th><th>符号大小。</th></tr></thead><tbody><tr><td>PropertyAngle</td><td>符号角度。</td></tr><tr><td>PropertyName</td><td>名称，例如简单标记的形状名称。</td></tr><tr><td>PropertyFillColor</td><td>填色。</td></tr><tr><td>PropertyStrokeColor</td><td>描边颜色。</td></tr><tr><td>PropertyStrokeWidth</td><td>行程宽度。</td></tr><tr><td>PropertyStrokeStyle</td><td>笔触样式（例如，实线，虚线）</td></tr><tr><td>PropertyOffset</td><td>符号偏移量。</td></tr><tr><td>PropertyCharacter</td><td>字符，例如用于字体标记符号层。</td></tr><tr><td>PropertyWidth</td><td>符号宽度。</td></tr><tr><td>PropertyHeight</td><td>符号高度。</td></tr><tr><td>PropertyPreserveAspectRatio</td><td>保留宽度和高度之间的长宽比。</td></tr><tr><td>PropertyFillStyle</td><td>填充样式（例如，实心，点）</td></tr><tr><td>PropertyJoinStyle</td><td>线联接样式。</td></tr><tr><td>PropertySecondaryColor</td><td>次要颜色（例如用于渐变填充）</td></tr><tr><td>PropertyLineAngle</td><td>线角或哈希线符号的哈希线角度。</td></tr><tr><td>PropertyLineDistance</td><td>行之间的距离，或散列线符号的行长。</td></tr><tr><td>PropertyGradientType</td><td>渐变填充类型。</td></tr><tr><td>PropertyCoordinateMode</td><td>渐变坐标模式。</td></tr><tr><td>PropertyGradientSpread</td><td>梯度扩散模式。</td></tr><tr><td>PropertyGradientReference1X</td><td>渐变参考点1 x。</td></tr><tr><td>PropertyGradientReference1Y</td><td>梯度参考点1 y。</td></tr><tr><td>PropertyGradientReference2X</td><td>渐变参考点2 x。</td></tr><tr><td>PropertyGradientReference2Y</td><td>梯度参考点2 y。</td></tr><tr><td>PropertyGradientReference1IsCentroid</td><td>渐变参考点1是质心。</td></tr><tr><td>PropertyGradientReference2IsCentroid</td><td>渐变参考点2为质心。</td></tr><tr><td>PropertyBlurRadius</td><td>Shapeburst模糊半径。</td></tr><tr><td>PropertyShapeburstUseWholeShape</td><td>Shapeburst使用整个形状。</td></tr><tr><td>PropertyShapeburstMaxDistance</td><td>边缘距离处的Shapeburst填充。</td></tr><tr><td>PropertyShapeburstIgnoreRings</td><td>Shapeburst忽略环。</td></tr><tr><td>PropertyFile</td><td>文件名，例如svg文件。</td></tr><tr><td>PropertyDistanceX</td><td>点之间的水平距离。</td></tr><tr><td>PropertyDistanceY</td><td>点之间的垂直距离。</td></tr><tr><td>PropertyDisplacementX</td><td>水平位移。</td></tr><tr><td>PropertyDisplacementY</td><td>垂直位移。</td></tr><tr><td>PropertyOpacity</td><td>不透明度。</td></tr><tr><td>PropertyCustomDash</td><td>自定义破折号模式。</td></tr><tr><td>PropertyCapStyle</td><td>线帽样式。</td></tr><tr><td>PropertyPlacement</td><td>线标记放置。</td></tr><tr><td>PropertyInterval</td><td>行标记间隔。</td></tr><tr><td>PropertyOffsetAlongLine</td><td>沿线偏移。</td></tr><tr><td>PropertyAverageAngleLength</td><td>长度到平均符号角度。</td></tr><tr><td>PropertyHorizontalAnchor</td><td>水平锚点。</td></tr><tr><td>PropertyVerticalAnchor</td><td>垂直锚点。</td></tr><tr><td>PropertyLayerEnabled</td><td>是否启用符号层。</td></tr><tr><td>PropertyArrowWidth</td><td>箭头尾巴宽度。</td></tr><tr><td>PropertyArrowStartWidth</td><td>箭头尾部开始宽度。</td></tr><tr><td>PropertyArrowHeadLength</td><td>箭头长度。</td></tr><tr><td>PropertyArrowHeadThickness</td><td>箭头的厚度。</td></tr><tr><td>PropertyArrowHeadType</td><td>箭头类型。</td></tr><tr><td>PropertyArrowType</td><td>箭头类型。</td></tr><tr><td>PropertyOffsetX</td><td>水平偏移。</td></tr><tr><td>PropertyOffsetY</td><td>垂直偏移。</td></tr><tr><td>PropertyPointCount</td><td>点数。</td></tr><tr><td>PropertyRandomSeed</td><td>随机数种子。</td></tr><tr><td>PropertyClipPoints</td><td>标记是否应修剪到多边形边界。</td></tr><tr><td>PropertyDensityArea</td><td>密度区域。</td></tr><tr><td>PropertyFontFamily</td><td>字体系列。</td></tr><tr><td>PropertyFontStyle</td><td>字体样式。</td></tr><tr><td>PropertyDashPatternOffset</td><td>虚线图案偏移量。</td></tr></tbody></table><h4 id="QgsSymbol"><a href="#QgsSymbol" class="headerlink" title="QgsSymbol"></a>QgsSymbol</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2021/01/02/qgis-develop-filestruct/dir_66f89767e42cf8b00ce6054c6b00ac7c_dep.png" alt="dir_66f89767e42cf8b00ce6054c6b00ac7c_dep" title>                </div>                <div class="image-caption">dir_66f89767e42cf8b00ce6054c6b00ac7c_dep</div>            </figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2021/01/02/qgis-develop-filestruct/qgssymbol_8h__incl.png" alt="qgssymbol_8h__incl" title>                </div>                <div class="image-caption">qgssymbol_8h__incl</div>            </figure><h4 id="整体功能结构"><a href="#整体功能结构" class="headerlink" title="整体功能结构"></a>整体功能结构</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2021/01/02/qgis-develop-filestruct/dir_aebb8dcc11953d78e620bbef0b9e2183_dep.png" alt="dir_aebb8dcc11953d78e620bbef0b9e2183_dep" title>                </div>                <div class="image-caption">dir_aebb8dcc11953d78e620bbef0b9e2183_dep</div>            </figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;分析QGS文件格式及符号及注记组织结构&lt;/p&gt;
    
    </summary>
    
      <category term="GIS" scheme="http://11wy11.github.io/categories/GIS/"/>
    
    
      <category term="QGIS" scheme="http://11wy11.github.io/tags/QGIS/"/>
    
  </entry>
  
  <entry>
    <title>QGIS插件开发学习</title>
    <link href="http://11wy11.github.io/2020/12/26/qgis-develop-6/"/>
    <id>http://11wy11.github.io/2020/12/26/qgis-develop-6/</id>
    <published>2020-12-26T15:09:17.000Z</published>
    <updated>2021-01-20T13:36:28.079Z</updated>
    
    <content type="html"><![CDATA[<p>python PyQGIS插件开发代码学习片段</p><a id="more"></a><h4 id="QGIS设置支持mdb"><a href="#QGIS设置支持mdb" class="headerlink" title="QGIS设置支持mdb"></a>QGIS设置支持mdb</h4><p>点击设置》选项》系统，在环境，勾选使用自定义变量，添加两个环境：</p><p>OGR_SKIP ODBC，</p><p>PGEO_DRIVER_TEMPLATE DRIVER=Microsoft Access Driver (<em>.mdb, </em>.accdb);DBQ=%s</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/12/26/qgis-develop-6/image-20201226231641904.png" alt="image-20201226231641904" title>                </div>                <div class="image-caption">image-20201226231641904</div>            </figure><p>D:\OSGeo4W64\include;D:\OSGeo4W64\apps\Qt5\include\QtXml;D:\OSGeo4W64\apps\Qt5\include\QtWidgets;D:\OSGeo4W64\apps\Qt5\include\QtQml;D:\OSGeo4W64\apps\Qt5\include\QtGui;D:\OSGeo4W64\apps\Qt5\include\QtPrintSupport;D:\OSGeo4W64\apps\Qt5\include\QtQmlDebug;.\;.\qgslib\ui;D:\OSGeo4W64\apps\gdal-dev\include;D:\OSGeo4W64\apps\Qt5\include\qt5keychain;D:\OSGeo4W64\apps\Qt5\include\QtCrypto;D:\OSGeo4W64\apps\Qt5\include\QtSql;D:\OSGeo4W64\apps\Qt5\include\QtCore;.\qgslib\core;.\qgslib\app\layout;.\qgslib\gui;.\qgslib\app;D:\OSGeo4W64\apps\qgis\include;%(AdditionalIncludeDirectories)</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;python PyQGIS插件开发代码学习片段&lt;/p&gt;
    
    </summary>
    
    
      <category term="QGIS" scheme="http://11wy11.github.io/tags/QGIS/"/>
    
  </entry>
  
  <entry>
    <title>QGIS 按照官方指南编译源码</title>
    <link href="http://11wy11.github.io/2020/12/22/qgis-develop-5/"/>
    <id>http://11wy11.github.io/2020/12/22/qgis-develop-5/</id>
    <published>2020-12-22T06:35:20.000Z</published>
    <updated>2021-03-13T11:05:46.045Z</updated>
    
    <content type="html"><![CDATA[<p>最终成功编译QGIS的详细步骤，可以不用来cmake-gui界面，就可以配置</p><a id="more"></a><h2 id="软件环境准备"><a href="#软件环境准备" class="headerlink" title="软件环境准备"></a>软件环境准备</h2><h3 id="VS2015需要安装的开发工具"><a href="#VS2015需要安装的开发工具" class="headerlink" title="VS2015需要安装的开发工具"></a>VS2015需要安装的开发工具</h3><p>Select “Custom” install and add the following packages:</p><ul><li><p>“Common Tools for Visual C++ 2015” under “Visual C++”</p></li><li><p>“Tools (1.4.1) and Windows 10 SDK (10.0.14393)” under “Universal Windows App Development Tools”.</p><p><img src="/2020/12/22/qgis-develop-5/image-20201206195049105.png" alt="image-20201206195049105"></p></li></ul><h3 id="下载软件包"><a href="#下载软件包" class="headerlink" title="下载软件包"></a>下载软件包</h3><table><thead><tr><th>Tool</th><th>Website</th></tr></thead><tbody><tr><td>CMake</td><td><a href="https://cmake.org/files/v3.7/cmake-3.7.2-win64-x64.msi" target="_blank" rel="noopener">https://cmake.org/files/v3.7/cmake-3.7.2-win64-x64.msi</a></td></tr><tr><td>cygwin</td><td><a href="http://cygwin.com/setup-x86.exe" target="_blank" rel="noopener">http://cygwin.com/setup-x86.exe</a> (32bit) or <a href="http://cygwin.com/setup-x86_64.exe" target="_blank" rel="noopener">http://cygwin.com/setup-x86_64.exe</a> (64bit)</td></tr><tr><td>OSGeo4W</td><td><a href="http://download.osgeo.org/osgeo4w/osgeo4w-setup-x86.exe" target="_blank" rel="noopener">http://download.osgeo.org/osgeo4w/osgeo4w-setup-x86.exe</a> (32bit) or <a href="http://download.osgeo.org/osgeo4w/osgeo4w-setup-x86_64.exe" target="_blank" rel="noopener">http://download.osgeo.org/osgeo4w/osgeo4w-setup-x86_64.exe</a> (64bit)</td></tr><tr><td>ninja</td><td><a href="https://github.com/ninja-build/ninja/releases/download/v1.7.2/ninja-win.zip" target="_blank" rel="noopener">https://github.com/ninja-build/ninja/releases/download/v1.7.2/ninja-win.zip</a></td></tr></tbody></table><p>对于cygwin和OSGeo4W，下载完后都是选择高级安装。</p><p>在选包界面的搜索栏输入文档中给出的包名，目前官方文档给出的是：</p><h4 id="1-cygwin"><a href="#1-cygwin" class="headerlink" title="1.cygwin"></a>1.cygwin</h4><p>- bison<br>- flex</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/12/22/qgis-develop-5/18.png" alt="image-20201122191237032" title>                </div>                <div class="image-caption">image-20201122191237032</div>            </figure><p><strong>设置环境变量：Path中添加C:\cygwin64\bin</strong></p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/12/22/qgis-develop-5/19.png" alt="image-20201122191332862" title>                </div>                <div class="image-caption">image-20201122191332862</div>            </figure><p><strong>检查是否安装成功flex和bison</strong>,见下图</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/12/22/qgis-develop-5/20.png" alt="image-20201122191537468" title>                </div>                <div class="image-caption">image-20201122191537468</div>            </figure><p><strong>2.OSGeo4W:</strong></p><p>下载地址：  <a href="http://download.osgeo.org/osgeo4w/osgeo4w-setup-x86.exe" target="_blank" rel="noopener">http://download.osgeo.org/osgeo4w/osgeo4w-setup-x86.exe</a> (32bit) or <a href="http://download.osgeo.org/osgeo4w/osgeo4w-setup-x86_64.exe" target="_blank" rel="noopener">http://download.osgeo.org/osgeo4w/osgeo4w-setup-x86_64.exe</a> (64bit)</p><p>选择Advance Install ,在线下载时，使用镜像<a href="http://gwmodel.whu.edu.cn/mirrors/osgeo4w，不然会下载特别缓慢" target="_blank" rel="noopener">http://gwmodel.whu.edu.cn/mirrors/osgeo4w，不然会下载特别缓慢</a></p><p>另外之后编译的过程中如果发现有缺失的包也是可以重新在这里补充下载的。</p><p><strong>搜索qgis-dev-deps</strong></p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/12/22/qgis-develop-5/70.png" alt="img" title>                </div>                <div class="image-caption">img</div>            </figure><p>直接下一步完成安装即可。</p><h4 id="3-安装CMake"><a href="#3-安装CMake" class="headerlink" title="3.安装CMake"></a>3.安装CMake</h4><p><a href="https://cmake.org/download/" target="_blank" rel="noopener">https://cmake.org/download/</a></p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/12/22/qgis-develop-5/16.png" alt="image-20201122184022077" title>                </div>                <div class="image-caption">image-20201122184022077</div>            </figure><h4 id="4-ninja-https-github-com-ninja-build-ninja-releases-download-v1-7-2-ninja-win-zip"><a href="#4-ninja-https-github-com-ninja-build-ninja-releases-download-v1-7-2-ninja-win-zip" class="headerlink" title="4.ninja(https://github.com/ninja-build/ninja/releases/download/v1.7.2/ninja-win.zip)"></a>4.ninja(<a href="https://github.com/ninja-build/ninja/releases/download/v1.7.2/ninja-win.zip" target="_blank" rel="noopener">https://github.com/ninja-build/ninja/releases/download/v1.7.2/ninja-win.zip</a>)</h4><p>下载后解压，将ninja.exe 拷贝到</p><h3 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h3><h4 id="1-path中添加cmake-osgeo4W64等环境变量"><a href="#1-path中添加cmake-osgeo4W64等环境变量" class="headerlink" title="1.path中添加cmake,osgeo4W64等环境变量"></a>1.path中添加cmake,osgeo4W64等环境变量</h4><p>C:\OSGeo4W64\bin</p><p>D:\cygwin64\bin</p><p>D:\cmake-3.19.0-win64-x64\bin</p><p><img src="/2020/12/22/qgis-develop-5/image-20201225191938744.png" alt="image-20201225191938744"></p><h4 id="2-开发python插件所需要的环境变量配置"><a href="#2-开发python插件所需要的环境变量配置" class="headerlink" title="2.开发python插件所需要的环境变量配置"></a>2.开发python插件所需要的环境变量配置</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/12/22/qgis-develop-5/image-20201225191859911.png" alt="image-20201225191859911" title>                </div>                <div class="image-caption">image-20201225191859911</div>            </figure><h2 id="QGIS源码编译"><a href="#QGIS源码编译" class="headerlink" title="QGIS源码编译"></a>QGIS源码编译</h2><h3 id="1-克隆或者下载源代码"><a href="#1-克隆或者下载源代码" class="headerlink" title="1. 克隆或者下载源代码"></a>1. 克隆或者下载源代码</h3><p>官方例子放在了OSGeo4W下，</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd C:\OSGeo4W64</span><br><span class="line">git clone git://github.com/qgis/QGIS.git</span><br></pre></td></tr></table></figure><h3 id="2-在OSGeo4W64下，创建OSGeo4W-dev-bat文件"><a href="#2-在OSGeo4W64下，创建OSGeo4W-dev-bat文件" class="headerlink" title="2. 在OSGeo4W64下，创建OSGeo4W-dev.bat文件"></a>2. 在OSGeo4W64下，创建OSGeo4W-dev.bat文件</h3><p>首先运行OSGeo4W64下的bat,设置qt等环境变量，然后保存并运行该批处理文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> @echo off</span><br><span class="line">    call C:\OSGeo4W64\QGIS\ms-windows\osgeo4w\msvc-env.bat x86_64</span><br><span class="line">@cmd</span><br></pre></td></tr></table></figure><h3 id="3-使用configonly-bat创建VS工程"><a href="#3-使用configonly-bat创建VS工程" class="headerlink" title="3.使用configonly.bat创建VS工程"></a>3.使用configonly.bat创建VS工程</h3><p><strong>如果遇到提示cmake 非法命令，可以修改msvc-env.bat中path的设置，</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd C:\OSGeo4W64\QGIS\ms-windows\osgeo4w</span><br><span class="line">configonly.bat</span><br></pre></td></tr></table></figure><p><strong>如果提示Flex报错等，可以检查msvc-env.bat中的设置默认是c:\cygwin64\bin,如果不是，注意修改路径</strong></p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/12/22/qgis-develop-5/image-20201225192436078.png" alt="image-20201225192436078" title>                </div>                <div class="image-caption">image-20201225192436078</div>            </figure><h4 id="4-编译QGIS"><a href="#4-编译QGIS" class="headerlink" title="4.编译QGIS"></a>4.编译QGIS</h4><p>在运行了<strong>OSGeo4W-dev.bat</strong>文件之后，在创建编译的工程，确保所有的环境变量被正确设置</p><p><strong>运行 call gdal-dev-env.bat 来添加gdal和proj库路径</strong></p><p><strong>输入 devenv打开VS</strong></p><h3 id="4-编译过程报错解决"><a href="#4-编译过程报错解决" class="headerlink" title="4.编译过程报错解决"></a>4.编译过程报错解决</h3><h4 id="1-error-LNK2019"><a href="#1-error-LNK2019" class="headerlink" title="1.error LNK2019"></a>1.error LNK2019</h4><p> error LNK2019: 无法解析的外部符号 “<strong>declspec(dllimport) public: static class QString </strong>cdecl QgsOpenClUtils::deviceInfo(enum QgsOpenClUtils::Info,class cl::Device)” (_<em>imp</em>?deviceInfo@QgsOpenClUtils@@SA?AVQString@@W4Info@1@VDevice@cl@@@Z)，该符号在函数 </p><p>解决方案1：由于项目字符集设置问题，根据提示将指定项目的字符集设置为与DLL一致，具体设置如下：项目属性-&gt;配置属性–&gt;常规-&gt;项目默认值-&gt;字符集中设置字符集（测试没有用）</p><p><strong>最终解决：再解决了问题2中的重定义问题后，问题1也修复</strong></p><h4 id="2-PJ-CONTEXT重定义"><a href="#2-PJ-CONTEXT重定义" class="headerlink" title="2.PJ_CONTEXT重定义"></a>2.PJ_CONTEXT重定义</h4><p>比较坑的地方是OSGeo4W64/include 以及OSGeo4W64/app/proj-dev/include 均有proj.h，需要看你工程里配置的proj库是哪个路径，我的需要修改的是OSGeo4W64/include 下的proj.h设置#pragma once，注意看include 的引入顺序，默认生成的引用顺序为先定义了proj-dev/include 后定义了OSGeo4W64/include，调整顺序为下图所示：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/12/22/qgis-develop-5/image-20201229172653562.png" alt="image-20201229172653562" title>                </div>                <div class="image-caption">image-20201229172653562</div>            </figure><p><strong>总结：</strong></p><p><strong>1. 修改OSGeo4W64/include 下的proj.h，在文件开头 添加代码：#pragma once</strong></p><p><strong>2. 调整c++/常规，附加包含目录，include顺序，先根目录C:\OSGeo4W64\include，再C:\OSGeo4W64\apps\proj-dev\include</strong></p><p>3.步骤2需要设置的工程包括：qgis_core,qgis_gui,qgis_app,qgis_process</p><h4 id="3-如果编译过程中提示找不到PyQT5的module等错误"><a href="#3-如果编译过程中提示找不到PyQT5的module等错误" class="headerlink" title="3.如果编译过程中提示找不到PyQT5的module等错误"></a>3.如果编译过程中提示找不到PyQT5的module等错误</h4><p>运行OSGeo4W-dev.bat，执行call gdal-dev-env.bat,使用devenv命令启动vs2015,再打开工程</p><h4 id="成功之后，设置qgis为启动项，运行，就可以看到QGIS界面了"><a href="#成功之后，设置qgis为启动项，运行，就可以看到QGIS界面了" class="headerlink" title="成功之后，设置qgis为启动项，运行，就可以看到QGIS界面了"></a>成功之后，设置qgis为启动项，运行，就可以看到QGIS界面了</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/12/22/qgis-develop-5/image-20201229184038694.png" alt="image-20201229184038694" title>                </div>                <div class="image-caption">image-20201229184038694</div>            </figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/12/22/qgis-develop-5/image-20201229185257473.png" alt="image-20201229185257473" title>                </div>                <div class="image-caption">image-20201229185257473</div>            </figure><h4 id="参考文档"><a href="#参考文档" class="headerlink" title="参考文档"></a>参考文档</h4><p>官方github下的install.md</p><h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><p>如果没有将软件vs、osgeo4w64安装在默认的C盘，需要修改configonly.bat中相关环境变量的地址</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;最终成功编译QGIS的详细步骤，可以不用来cmake-gui界面，就可以配置&lt;/p&gt;
    
    </summary>
    
      <category term="QGIS" scheme="http://11wy11.github.io/categories/QGIS/"/>
    
    
      <category term="QGIS" scheme="http://11wy11.github.io/tags/QGIS/"/>
    
  </entry>
  
  <entry>
    <title>QGIS二次开发-配置python环境</title>
    <link href="http://11wy11.github.io/2020/12/07/qgis-develop-5-python-env/"/>
    <id>http://11wy11.github.io/2020/12/07/qgis-develop-5-python-env/</id>
    <published>2020-12-07T06:42:14.000Z</published>
    <updated>2021-01-01T14:16:02.963Z</updated>
    
    <content type="html"><![CDATA[<p>使用QGIS PluginBuilder 来创建Python模板的qgis 插件</p><a id="more"></a><h2 id="Plugin-Builder-创建插件"><a href="#Plugin-Builder-创建插件" class="headerlink" title="Plugin Builder 创建插件"></a>Plugin Builder 创建插件</h2><p>创建完成后，如果提示没有pyrcc5，</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pyuic5 -o WYFirstPlugin_dialog.py WYFirstPlugin_dialog_base.ui</span><br><span class="line">pyrcc5 -o resources.py resources.qrc</span><br></pre></td></tr></table></figure><h4 id="使用QGIS控制台脚本-python查看application"><a href="#使用QGIS控制台脚本-python查看application" class="headerlink" title="使用QGIS控制台脚本 python查看application"></a>使用QGIS控制台脚本 python查看application</h4><p>查看安装路径</p><p>QgsApplication.prefixPath()</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;使用QGIS PluginBuilder 来创建Python模板的qgis 插件&lt;/p&gt;
    
    </summary>
    
      <category term="GIS" scheme="http://11wy11.github.io/categories/GIS/"/>
    
    
      <category term="QGIS" scheme="http://11wy11.github.io/tags/QGIS/"/>
    
  </entry>
  
  <entry>
    <title>QGIS编译可能遇到的问题</title>
    <link href="http://11wy11.github.io/2020/12/04/qgis-development-problem/"/>
    <id>http://11wy11.github.io/2020/12/04/qgis-development-problem/</id>
    <published>2020-12-04T11:21:13.000Z</published>
    <updated>2020-12-19T14:50:01.909Z</updated>
    
    <content type="html"><![CDATA[<p>QGIS编译源码可能遇到的问题</p><a id="more"></a><p>[TOC]</p><h3 id="1-修改不识别的符号"><a href="#1-修改不识别的符号" class="headerlink" title="1. 修改不识别的符号"></a>1. 修改不识别的符号</h3><p>先在资源管理器中找到qgis项目，右击该项目，选择“设为启动项目”<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/12/04/qgis-development-problem/1" alt title>                </div>                <div class="image-caption"></div>            </figure><br>接着，你可以先试着第一次生成解决方案，以排除所有页面不识别的错误</p><p>你应会遇到大量报错，请等待生成完毕。<br>在错误中会出现例如<br>“错误 C2143 语法错误: 缺少“)”(在“;”的前面) ”<br>“错误 C2001 常量中有换行符 ”<br>……<br>这些错误的原因是因为页面不支持(“′”)(“″”)的符号</p><p>在错误列表关闭错误，仅查看警告，并点击“说明”让其聚类。大体上将出现会三种警告类型。<br>对于以下这两种，我们忽视掉——<br>“警告 C4718 “QMapNode&lt;int,QgsRasterIterator::RasterPartInfo&gt;::doDestroySubTree”: 递归调用无副作用，正在删除 ”<br>“警告 C4702 无法访问的代码 ”<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/12/04/qgis-development-problem/2" alt title>                </div>                <div class="image-caption"></div>            </figure><br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/12/04/qgis-development-problem/24.png" alt title>                </div>                <div class="image-caption"></div>            </figure></p><p>而对于——<br>“警告 C4819 该文件包含不能在当前代码页(936)中表示的字符。请将该文件保存为 Unicode 格式以防止数据丢失 ”<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/12/04/qgis-development-problem/3" alt title>                </div>                <div class="image-caption"></div>            </figure><br>我们点双击其文件一栏的文件名，进入对应的.cpp或.h文件<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/12/04/qgis-development-problem/25.png" alt title>                </div>                <div class="image-caption"></div>            </figure><br>Ctrl+A 全选文件内容，点击上方“文件”，找到“高级保存设置”<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/12/04/qgis-development-problem/4.png" alt title>                </div>                <div class="image-caption"></div>            </figure><br>将其从无签名改为带签名<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/12/04/qgis-development-problem/5.png" alt title>                </div>                <div class="image-caption"></div>            </figure><br>修改后——<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://www.pianshen.com/images/329/6e63813b4370e61f705143eae8928629.png" alt title>                </div>                <div class="image-caption"></div>            </figure><br>修改所有出现此类警告的.cpp和.h文件，再次生成“qgis”项目，大部分报错将会消失。（也有可能直接编译通过）</p><h3 id="2-可能报错的其他问题"><a href="#2-可能报错的其他问题" class="headerlink" title="2. 可能报错的其他问题"></a>2. 可能报错的其他问题</h3><h4 id="2-1与qtmain-lib有关的未初始化的定义"><a href="#2-1与qtmain-lib有关的未初始化的定义" class="headerlink" title="2.1与qtmain.lib有关的未初始化的定义"></a><strong>2.1与qtmain.lib有关的未初始化的定义</strong></h4><p>解决方法：<br>找到例如此的警告信息<br>LNK4099 未找到 PDB“qtmain.pdb”(使用“qtmain.lib(qtmain_win.obj)正在链接对象，如同没有调试信息一样<br>得到该警告来源的项目名，如“qgiscrashhandle”</p><p>右击“qgiscrashhandle项目”-&gt;“属性”-&gt;“连接器”-&gt;“输入”附加依赖项中修改添加<br>D:\QGIS\OSGeo4W64\apps\Qt5\lib\qtmain.lib <figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/12/04/qgis-development-problem/7.png" alt title>                </div>                <div class="image-caption"></div>            </figure></p><h4 id="2-2-qgis-gui项目中出现未定义的标识符-“QWebElement”"><a href="#2-2-qgis-gui项目中出现未定义的标识符-“QWebElement”" class="headerlink" title="2.2 qgis_gui项目中出现未定义的标识符 “QWebElement”"></a><strong>2.2 qgis_gui项目中出现未定义的标识符 “QWebElement”</strong></h4><p>解决方法：<br>“qgis_gui项目”-&gt;“属性”-&gt;“C/C++”-&gt;“常规”附加包含目录中修改添加<br>D:\QGIS\OSGeo4W64\apps\Qt5\include\QtWebKit<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/12/04/qgis-development-problem/8.png" alt title>                </div>                <div class="image-caption"></div>            </figure><br>注释掉报错函数关于QWebElemen类的内容，并在qgismaptip.cpp文件开头注释掉——<br>//#if WITH_QTWEBKIT<br>//#endif<br>（因为原代码中WITH_QTWEBKIT未定义，头文件 不可被识别；又因WITH_QTWEBKIT未定义，QWebElemen类中部分函数无法被调用，故也注释掉）<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/12/04/qgis-development-problem/27.png" alt title>                </div>                <div class="image-caption"></div>            </figure><br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/12/04/qgis-development-problem/10.png" alt title>                </div>                <div class="image-caption"></div>            </figure></p><h4 id="2-3-qgis-gui项目中出现CORE-EXPORT显式实例化声明无效"><a href="#2-3-qgis-gui项目中出现CORE-EXPORT显式实例化声明无效" class="headerlink" title="2.3 qgis_gui项目中出现CORE_EXPORT显式实例化声明无效"></a><strong>2.3 qgis_gui项目中出现CORE_EXPORT显式实例化声明无效</strong></h4><p>解决方法：<br>对于报错的位置——qgsoptionalexpression.h文件中，在template后添加class<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/12/04/qgis-development-problem/11.png" alt title>                </div>                <div class="image-caption"></div>            </figure><br>重新生成解决方案。<br>如果完整的下载了链接库并正确引入路径，此时，不会再遇到其他问题。<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://www.pianshen.com/images/887/43a30ea24c790127b5d8b1be2050184f.png" alt title>                </div>                <div class="image-caption"></div>            </figure><br>我们可以在输出路径下发现生成的qgis.exe文件<br>（路径：D:\QGIS\qgis-3.2.2-build\output\bin\RelWithDebInfo）</p><h4 id="2-4-C1083-keychain-h无法打开包含文件"><a href="#2-4-C1083-keychain-h无法打开包含文件" class="headerlink" title="2.4 C1083 keychain.h无法打开包含文件"></a>2.4 C1083 keychain.h无法打开包含文件</h4><p>检查qgis_core中链接器，输入中添加附加包含目录Qt5Keychain.lib</p><h3 id="3-其他可能的问题（来源于网络统计）"><a href="#3-其他可能的问题（来源于网络统计）" class="headerlink" title="3. 其他可能的问题（来源于网络统计）"></a>3. 其他可能的问题（来源于网络统计）</h3><p>如果出现问题，优先选择从gis_core项目、qgis_analysis项目、qgis_gui项目依次调试（其他项目均依赖于他们）<br>此时仍然有可能出现：</p><h4 id="3-1-error-MSB6006-“rc-exe”已退出，代码为-5"><a href="#3-1-error-MSB6006-“rc-exe”已退出，代码为-5" class="headerlink" title="3.1 error MSB6006: “rc.exe”已退出，代码为 5"></a><strong>3.1 error MSB6006: “rc.exe”已退出，代码为 5</strong></h4><p>在C盘下直接搜索该应用，将其路径配置到项目中即可。</p><h4 id="3-2-MSVCRT-lib-exe-winmain-obj-error-LNK2019-无法解析的外部符号-WinMain"><a href="#3-2-MSVCRT-lib-exe-winmain-obj-error-LNK2019-无法解析的外部符号-WinMain" class="headerlink" title="3.2 MSVCRT.lib(exe_winmain.obj) : error LNK2019: 无法解析的外部符号 WinMain"></a><strong>3.2 MSVCRT.lib(exe_winmain.obj) : error LNK2019: 无法解析的外部符号 WinMain</strong></h4><p>这是因为——<br>新建项目是控制台应用程序，而程序通过的是WinMian（及windows入口函数）<br>可以在“qgis_core项目”-&gt;“属性”-&gt;“连接器”-&gt;“输入”附加依赖项中修改添加<br>D:\QGIS\OSGeo4W64\apps\Qt5\lib\qtmain.lib<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/12/04/qgis-development-problem/13.png" alt title>                </div>                <div class="image-caption"></div>            </figure><br>重新生成即可。</p><h4 id="3-4-链接错误或者缺少有关附加库问题"><a href="#3-4-链接错误或者缺少有关附加库问题" class="headerlink" title="3.4 链接错误或者缺少有关附加库问题"></a><strong>3.4 链接错误或者缺少有关附加库问题</strong></h4><p>通常表现为——无法解析的外部符号；找不到、打不开.lib文件等<br>这与个人的主机环境有关，可以在“项目”-&gt;“属性”-&gt;“连接器”-&gt;“输入”附加依赖项中修改。<br>附上我的部分属性情况</p><p>Lib问题，检查附加依赖项<br>可以在“项目”-&gt;“属性”-&gt;“连接器”-&gt;“输入”附加依赖项中查看修改；</p><p>对于Release或者RelWithDebInfo版本，Lib路径基本如下图列举<br>对于Debug版本，部分Lib库名后有d标识<br>如下图的Qt5Cored即为Debug版本<br>（Debug版本与Release（RelWithDebInfo）版本的Lib名称不同，但路径一致。在工程修改版本环境时会自动更新链接，更改库名。无需手动更改。）</p><h4 id="3-5-缺少可执行文件或者环境路径问题"><a href="#3-5-缺少可执行文件或者环境路径问题" class="headerlink" title="3.5 缺少可执行文件或者环境路径问题"></a><strong>3.5 缺少可执行文件或者环境路径问题</strong></h4><p>Dll问题，检查可执行文件目录，即检查环境路径<br>可以在“项目”-&gt;“属性”-&gt;“VC++目录”-&gt;“可执行文件目录”中编辑查看<br>主要检查有无以下路径：<br>D:\QGIS\OSGeo4W64\apps\qt5\bin<br>D:\QGIS\OSGeo4W64\apps\Python37<br>D:\QGIS\OSGeo4W64\apps\Python37\Scripts<br>D:\QGIS\OSGeo4W64\bin<br>D:\Program Files\CMake\bin<br>D:\QGIS\cygwin64\bin<br>C:\WINDOWS\system32<br>C:\WINDOWS<br>C:\WINDOWS\system32\WBem</p><hr><hr><h4 id="3-6-error-MSB6006-cmd-exe已退出，代码为1"><a href="#3-6-error-MSB6006-cmd-exe已退出，代码为1" class="headerlink" title="3.6 error MSB6006 cmd.exe已退出，代码为1"></a>3.6 error MSB6006 cmd.exe已退出，代码为1</h4><p>查看输出，主要是在构建qtpython中报错</p><h4 id="3-7-error-MSB23073"><a href="#3-7-error-MSB23073" class="headerlink" title="3.7 error MSB23073"></a>3.7 error MSB23073</h4><p>编译过程中找不到一些模块</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">严重性代码说明项目文件行禁止显示状态</span><br><span class="line">错误MSB3073命令“setlocal</span><br><span class="line">C:\cmake-3.19.0-win64-x64\bin\cmake.exe -P J:/QGISDEV/QGISBuild1/python/plugins/db_manager/stageinstall.cmake</span><br><span class="line">if %errorlevel% neq 0 goto :cmEnd</span><br><span class="line">:cmEnd</span><br><span class="line">endlocal &amp; call :cmErrorLevel %errorlevel% &amp; goto :cmDone</span><br><span class="line">:cmErrorLevel</span><br><span class="line">exit /b %1</span><br><span class="line">:cmDone</span><br><span class="line">if %errorlevel% neq 0 goto :VCEnd</span><br><span class="line">:VCEnd”已退出，代码为 1。zzz-db_manager-stageinstallC:\Program Files (x86)\MSBuild\Microsoft.Cpp\v4.0\V140\Microsoft.CppCommon.targets133</span><br></pre></td></tr></table></figure><p> QQmlComponent: Component is not ready<br>79&gt;  file:///J:/QGISDEV/QGISBuild1/src/quickgui/plugin/typelist.qml:2:1: plugin cannot be loaded for module “QgsQuick”: Cannot load library J:\QGISDEV\QGISBuild1\src\quickgui\plugin\QgsQuick\qgis_quick_plugin.dll: 找不到指定的模块。</p><h3 id="4-python相关"><a href="#4-python相关" class="headerlink" title="4. python相关"></a>4. python相关</h3><p>Debug方式编译生成解决方案时，提示缺少python37_d.lib，需要安装python debug版本，如果没有，可以修改已经安装的python，如下图所示</p><p>勾选最后一项，然后install，安装后可以在附加依赖项中添加python37_d.lib</p><h4 id="4-1-在python中执行from-PyQt5-QtCore-import-提示引入模块找不到"><a href="#4-1-在python中执行from-PyQt5-QtCore-import-提示引入模块找不到" class="headerlink" title="4.1 在python中执行from PyQt5.QtCore import * 提示引入模块找不到"></a>4.1 在python中执行from PyQt5.QtCore import * 提示引入模块找不到</h4><p> from qgis._core import *<br>ImportError: DLL load failed: 找不到指定的程序。</p><p>【解决方案】:使用镜像安装sip,pyqt5,pyqt5-tools</p><p><code>pip install pyqt5 pyqt5-tools -i http://pypi.douban.com/simple/ --trusted-host pypi.douban.com</code></p><h4 id="4-2-在python中执行from-PyQt5-Qsci-import-提示引入模块找不到"><a href="#4-2-在python中执行from-PyQt5-Qsci-import-提示引入模块找不到" class="headerlink" title="4.2 在python中执行from PyQt5.Qsci import * 提示引入模块找不到"></a>4.2 在python中执行from PyQt5.Qsci import * 提示引入模块找不到</h4><p>【解决方案】:使用镜像安装QScintilla</p><h4 id="4-3-Python-ImportError：DLL-load-failed：-1不是有效的win32应用程序"><a href="#4-3-Python-ImportError：DLL-load-failed：-1不是有效的win32应用程序" class="headerlink" title="4.3 Python ImportError：DLL load failed： %1不是有效的win32应用程序"></a>4.3 Python ImportError：DLL load failed： %1不是有效的win32应用程序</h4><p>错误本身是因为python版本位数 pywin32版本不一致，网上说是因为需要下载安装对应版本pywin32</p><p>我遇到的问题是，在编译qgis的时候，同时通过exe的方式安装了其他版本的qt,在查找使用包的时候使用了另一个qgis版本下的</p><p><a href="https://github.com/mhammond/pywin32/releases" target="_blank" rel="noopener">https://github.com/mhammond/pywin32/releases</a></p><p>可以下载安装试试，我目前还没尝试</p><h4 id="4-4-qgis-quick-plugin"><a href="#4-4-qgis-quick-plugin" class="headerlink" title="4.4 qgis_quick_plugin"></a>4.4 qgis_quick_plugin</h4><h4 id="4-5-C2248-python-module-qgis-core-sip-corepart6-cpp-QgsAuthManager-无法访问protected-成员"><a href="#4-5-C2248-python-module-qgis-core-sip-corepart6-cpp-QgsAuthManager-无法访问protected-成员" class="headerlink" title="4.5 C2248 python_module_qgis_core sip_corepart6.cpp QgsAuthManager 无法访问protected 成员"></a>4.5 C2248 python_module_qgis_core sip_corepart6.cpp QgsAuthManager 无法访问protected 成员</h4><h2 id="运行成果"><a href="#运行成果" class="headerlink" title="运行成果"></a>运行成果</h2><hr><h3 id="配置运行环境"><a href="#配置运行环境" class="headerlink" title="配置运行环境"></a>配置运行环境</h3><p>编译好的qgis.exe会在目录D:\QGIS\qgis-3.2.2-build\output\bin\RelWithDebInfo下</p><p>但打开qgis.exe时会出现报错<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/12/04/qgis-development-problem/22.png" alt title>                </div>                <div class="image-caption"></div>            </figure><br>此时，把OSGeo4W64\apps\Qt5\bin和OSGeo4W64\bin下的dll文件全部拷贝到exe文件同目录下即可</p><p>同时，把OSGeo4W64\apps\Qt5\plugins文件下的platforms文件夹也拷贝到exe文件同目录下<br>当程序运行时，找不到正确支持图标格式（svg）的库文件。这里需要把OSGeo4W64\apps\Qt5\plugins文件下的imageformats文件夹也拷贝到exe文件同目录下<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/12/04/qgis-development-problem/23.png" alt title>                </div>                <div class="image-caption"></div>            </figure><br>再次打开运行qgis.exe</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;QGIS编译源码可能遇到的问题&lt;/p&gt;
    
    </summary>
    
      <category term="GIS" scheme="http://11wy11.github.io/categories/GIS/"/>
    
    
      <category term="QGIS" scheme="http://11wy11.github.io/tags/QGIS/"/>
    
  </entry>
  
  <entry>
    <title>QT5.11.2+vs2015+qgis 搭建qgis二次开发环境</title>
    <link href="http://11wy11.github.io/2020/11/20/qgis-develop-4/"/>
    <id>http://11wy11.github.io/2020/11/20/qgis-develop-4/</id>
    <published>2020-11-20T09:51:05.000Z</published>
    <updated>2021-01-19T02:44:46.143Z</updated>
    
    <content type="html"><![CDATA[<p>结合网上资料以及自己的尝试，整理一个搭建环境的详细步骤</p><a id="more"></a><h3 id="基本软件下载"><a href="#基本软件下载" class="headerlink" title="基本软件下载"></a>基本软件下载</h3><h4 id="1-OSGeo4W下载"><a href="#1-OSGeo4W下载" class="headerlink" title="1.OSGeo4W下载"></a>1.OSGeo4W下载</h4><p>OSGeo4W  <a href="http://download.osgeo.org/osgeo4w/osgeo4w-setup-x86.exe" target="_blank" rel="noopener">http://download.osgeo.org/osgeo4w/osgeo4w-setup-x86.exe</a> (32bit) or <a href="http://download.osgeo.org/osgeo4w/osgeo4w-setup-x86_64.exe" target="_blank" rel="noopener">http://download.osgeo.org/osgeo4w/osgeo4w-setup-x86_64.exe</a> (64bit)</p><p>选择Advance Install ,在线下载时，使用镜像<a href="http://gwmodel.whu.edu.cn/mirrors/osgeo4w，不然会下载特别缓慢" target="_blank" rel="noopener">http://gwmodel.whu.edu.cn/mirrors/osgeo4w，不然会下载特别缓慢</a></p><h4 id="2-QT5"><a href="#2-QT5" class="headerlink" title="2. QT5"></a>2. QT5</h4><p>会在安装qgis的时候，同时下载QT5.11.2，默认安装路径为：C:\OSGeo4W64\apps\Qt5</p><h4 id="3-VS2015安装QT插件"><a href="#3-VS2015安装QT插件" class="headerlink" title="3.VS2015安装QT插件"></a>3.VS2015安装QT插件</h4><h5 id="方式一：通过工具》扩展与更新》联机，搜索QT，但在新建QT工程时，只有QTWidgetsApplication-没有QTGUIApplication，想使用QT-GUI-Application模板创建，则卸载方式一安装的插件"><a href="#方式一：通过工具》扩展与更新》联机，搜索QT，但在新建QT工程时，只有QTWidgetsApplication-没有QTGUIApplication，想使用QT-GUI-Application模板创建，则卸载方式一安装的插件" class="headerlink" title="方式一：通过工具》扩展与更新》联机，搜索QT，但在新建QT工程时，只有QTWidgetsApplication,没有QTGUIApplication，想使用QT GUI Application模板创建，则卸载方式一安装的插件"></a>方式一：通过工具》扩展与更新》联机，搜索QT，但在新建QT工程时，只有QTWidgetsApplication,没有QTGUIApplication，想使用QT GUI Application模板创建，则卸载方式一安装的插件</h5><h5 id="方式二："><a href="#方式二：" class="headerlink" title="方式二："></a>方式二：</h5><p>进入下边网站下载，点击安装即可。（本次下载的是2.4.3）</p><p><a href="https://download.qt.io/official_releases/vsaddin/2.4.3/" target="_blank" rel="noopener">https://download.qt.io/official_releases/vsaddin/2.4.3/</a></p><h4 id="VS-创建QT工程"><a href="#VS-创建QT工程" class="headerlink" title="VS 创建QT工程"></a>VS 创建QT工程</h4><p>新建项目，C++下QT,使用QT GUI Application模板创建，勾选XML。，经过测试，直接使用方式一安装的插件，创建QT WidgetsApplication也可以</p><h4 id="配置项目属性"><a href="#配置项目属性" class="headerlink" title="配置项目属性"></a>配置项目属性</h4><p>1.<strong>C/C++下，附加包含目录</strong>，设置qt相关的include，以及OSGeo4W，QGIS的include目录</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\OSGeo4W64\include;C:\OSGeo4W64\apps\Qt5\include\QtXml;C:\OSGeo4W64\apps\Qt5\include\QtWidgets;C:\OSGeo4W64\apps\Qt5\include\QtGui;C:\OSGeo4W64\apps\qgis\include;%(AdditionalIncludeDirectories)</span><br></pre></td></tr></table></figure><p>2.链接器，设置附加库目录</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\OSGeo4W64\apps\Qt5\lib;C:\OSGeo4W64\apps\qgis\lib;%(AdditionalLibraryDirectories)</span><br></pre></td></tr></table></figure><p>3.链接器下，输入，设置附加依赖项</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">qgis_core.lib;qgis_app.lib;qgis_gui.lib;Qt5Widgets.lib;Qt5Xml.lib;%(AdditionalDependencies)</span><br></pre></td></tr></table></figure><p>4.在项目工程目录下，与EXE同级目录下，<strong>将OSGeo4W的bin,apps/qgis/bin,apps/QT5/bin下的所有dll拷贝到exe同级目录。</strong></p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/11/20/qgis-develop-4/1" alt="image-20201121132810671" title>                </div>                <div class="image-caption">image-20201121132810671</div>            </figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/11/20/qgis-develop-4/2" alt="image-20201121132901385" title>                </div>                <div class="image-caption">image-20201121132901385</div>            </figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/11/20/qgis-develop-4/5" alt="image-20201121133711149" title>                </div>                <div class="image-caption">image-20201121133711149</div>            </figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/11/20/qgis-develop-4/6" alt="image-20201121133749867" title>                </div>                <div class="image-caption">image-20201121133749867</div>            </figure><p>5.将qt中plugins拷贝到4所述的路径下，否则编译会报错，提示no QT Platform的错误，如果不知道，就都拷，考虑到项目大小，使用<strong>其他QT工程自动拷贝dll的方法</strong>，自动添加qt拷贝</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/11/20/qgis-develop-4/3" alt="image-20201121133113855" title>                </div>                <div class="image-caption">image-20201121133113855</div>            </figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/11/20/qgis-develop-4/4" alt="image-20201121133135496" title>                </div>                <div class="image-caption">image-20201121133135496</div>            </figure> <h4 id="其他QT工程自动拷贝dll的方法"><a href="#其他QT工程自动拷贝dll的方法" class="headerlink" title="其他QT工程自动拷贝dll的方法"></a>其他QT工程自动拷贝dll的方法</h4><p>在当前工程的exe目录下，<strong>可以在按住shift,右键Release目录，选择在powershell窗口打开</strong>,执行以下命令：QtGuiApplication1为创建的qt工程项目</p><p><code>C:\OSGeo4W64\apps\Qt5\bin\windeployqt.exe QtGuiApplication1.exe</code></p><h4 id="运行第一个QGIS项目找不到M-PI"><a href="#运行第一个QGIS项目找不到M-PI" class="headerlink" title="运行第一个QGIS项目找不到M_PI"></a>运行第一个QGIS项目找不到M_PI</h4><p>主要是C++默认不包含科学库，需要设置预处理器，、、、、</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/11/20/qgis-develop-4/8" alt="image-20201121143633512" title>                </div>                <div class="image-caption">image-20201121143633512</div>            </figure><h3 id="第一个qgis项目"><a href="#第一个qgis项目" class="headerlink" title="第一个qgis项目"></a>第一个qgis项目</h3><p>1.在main.app中改QtApplication的主函数为QgisApplication</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"QtGuiApplication1.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QtWidgets/QApplication&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;qgsapplication.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="comment">/*QApplication a(argc, argv);</span></span><br><span class="line"><span class="comment">QtGuiApplication1 w;</span></span><br><span class="line"><span class="comment">w.show();</span></span><br><span class="line"><span class="comment">return a.exec();*/</span></span><br><span class="line"><span class="function">QgsApplication <span class="title">a</span><span class="params">(argc, argv, <span class="literal">true</span>)</span></span>;</span><br><span class="line">QgsApplication::setPrefixPath(<span class="string">"C:/OSGeo4W/apps/qgis"</span>, <span class="literal">true</span>);</span><br><span class="line">QgsApplication::initQgis();    <span class="comment">//初始化QGIS应用</span></span><br><span class="line">QtGuiApplication1 w;</span><br><span class="line">w.show();</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> a.exec();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2.在窗体主文件中，头文件，定义mapcanvas，以及图层</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> once</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QtWidgets/QMainWindow&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"ui_QtGuiApplication1.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;qmenu.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;qaction.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;qgsmapcanvas.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">QtGuiApplication1</span> :</span> <span class="keyword">public</span> QMainWindow</span><br><span class="line">&#123;</span><br><span class="line">Q_OBJECT</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">QtGuiApplication1(QWidget *parent = Q_NULLPTR);</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">Ui::QtGuiApplication1Class ui;</span><br><span class="line"><span class="comment">// create the menus and then add the actions to them.</span></span><br><span class="line">QMenu *fileMenu;</span><br><span class="line">QAction *openFileAction;</span><br><span class="line"></span><br><span class="line"><span class="comment">//map canvas</span></span><br><span class="line">QgsMapCanvas *mapCanvas;</span><br><span class="line">QList&lt;QgsMapLayer *&gt; layers;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> slots:</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">on_openFileAction_triggered</span><span class="params">()</span></span>;</span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addVectorLayer</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>3.cpp文件中</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"QtGuiApplication1.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;qmenubar.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;qmessagebox.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;qfiledialog.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;qgsvectorlayer.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">QtGuiApplication1::QtGuiApplication1(QWidget *parent)</span><br><span class="line">: QMainWindow(parent)</span><br><span class="line">&#123;</span><br><span class="line">ui.setupUi(<span class="keyword">this</span>);</span><br><span class="line"><span class="keyword">this</span>-&gt;resize(<span class="number">600</span>, <span class="number">400</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// create the menus and then add the actions to them.</span></span><br><span class="line">fileMenu = <span class="keyword">this</span>-&gt;menuBar()-&gt;addMenu(<span class="string">"File"</span>);</span><br><span class="line">openFileAction = <span class="keyword">new</span> QAction(<span class="string">"Open"</span>, <span class="keyword">this</span>);</span><br><span class="line"><span class="keyword">this</span>-&gt;connect(openFileAction, SIGNAL(triggered(<span class="keyword">bool</span>)), <span class="keyword">this</span>, SLOT(on_openFileAction_triggered()));</span><br><span class="line">fileMenu-&gt;addAction(openFileAction);</span><br><span class="line"></span><br><span class="line"><span class="comment">// initialize the map canvas</span></span><br><span class="line">mapCanvas = <span class="keyword">new</span> QgsMapCanvas();</span><br><span class="line"><span class="keyword">this</span>-&gt;setCentralWidget(mapCanvas);</span><br><span class="line"></span><br><span class="line">mapCanvas-&gt;setCanvasColor(QColor(<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>));</span><br><span class="line">mapCanvas-&gt;setVisible(<span class="literal">true</span>);</span><br><span class="line">mapCanvas-&gt;enableAntiAliasing(<span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">void</span> QtGuiApplication1::on_openFileAction_triggered() &#123;</span><br><span class="line">addVectorLayer();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> QtGuiApplication1::addVectorLayer()</span><br><span class="line">&#123;</span><br><span class="line">QString fileName = QFileDialog::getOpenFileName(<span class="keyword">this</span>, tr(<span class="string">"Open shape file"</span>), <span class="string">""</span>, <span class="string">"*.shp"</span>);</span><br><span class="line">QStringList temp = fileName.split(<span class="string">'/'</span>);</span><br><span class="line">QString basename = temp.at(temp.size() - <span class="number">1</span>);</span><br><span class="line">QgsVectorLayer* vecLayer = <span class="keyword">new</span> QgsVectorLayer(fileName, basename, <span class="string">"ogr"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!vecLayer-&gt;isValid())</span><br><span class="line">&#123;</span><br><span class="line">QMessageBox::critical(<span class="keyword">this</span>, <span class="string">"error"</span>, QString(<span class="string">"layer is invalid: \n"</span>) + fileName);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">mapCanvas-&gt;setExtent(vecLayer-&gt;extent());</span><br><span class="line">layers.append(vecLayer);</span><br><span class="line">mapCanvas-&gt;setLayers(layers);</span><br><span class="line">mapCanvas-&gt;refresh();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="可能遇到的错误及解决"><a href="#可能遇到的错误及解决" class="headerlink" title="可能遇到的错误及解决"></a>可能遇到的错误及解决</h3><h4 id="1、提示qgis相关库找不到，"><a href="#1、提示qgis相关库找不到，" class="headerlink" title="1、提示qgis相关库找不到，"></a>1、提示qgis相关库找不到，</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/11/20/qgis-develop-4/7" alt="image-20201121141305726" title>                </div>                <div class="image-caption">image-20201121141305726</div>            </figure><p><strong>解决方案：</strong>,将qgis/bin下dll拷贝到项目编译后exe所在目录</p><p>同理，可能会提示找不到OSGeo4W下例如gdal,sqlite3等库dll,将OSGeo4W/bin下dll拷贝到项目编译后exe所在目录</p><h4 id="2-Release版本可以运行，但在Debug模式，新建地图画布mapcanvas报错"><a href="#2-Release版本可以运行，但在Debug模式，新建地图画布mapcanvas报错" class="headerlink" title="2.Release版本可以运行，但在Debug模式，新建地图画布mapcanvas报错"></a>2.Release版本可以运行，但在Debug模式，新建地图画布mapcanvas报错</h4><p>将include和lib,使用qgis-dev路径下的文件</p><p>其次，如果在debug模式下编译提示无法找到某个dll,也可以在网上下载提示的dll，像gdal303.dll，在app/gdal-dev中，proj_8_0.dll，在proj-dev里</p><h4 id="3-warning-C4003-引入头文件顺序错误"><a href="#3-warning-C4003-引入头文件顺序错误" class="headerlink" title="3.warning C4003 引入头文件顺序错误"></a>3.warning C4003 引入头文件顺序错误</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&gt;d:\osgeo4w64\apps\qgis\include\qgsdatetimestatisticalsummary.h(148): warning C4003: “min”宏的实参不足 (编译源文件 MapRepApp.cpp)</span><br></pre></td></tr></table></figure><p>c/c++ <strong>附加包含目录中定义的目录顺序有关，尝试调整相关库顺序</strong></p><p><strong>&lt;windows.h&gt;头文件中的宏 min(或者max)与QT的类QTimer 中的宏min(或者max)冲突</strong></p><h4 id="4-error-C3646未知重写说明符"><a href="#4-error-C3646未知重写说明符" class="headerlink" title="4.error C3646未知重写说明符"></a>4.error C3646未知重写说明符</h4><p>1.h 1.cpp</p><p>2.h 2.cpp</p><p>在1.h 中#include了 2.h ，然后在2.h 中又#include了 1.h ，然后这个错误就出现了</p><p><strong>出现这个提示，一般情况是：①本错误所在文档加载的某个头文件中，文件的最后缺失了一个分号。②缺少定义，未包含相应的头文件；③类的定义的先后顺序有误</strong></p><h4 id="5-dll链接不一致不允许定义dllimport静态数据成员"><a href="#5-dll链接不一致不允许定义dllimport静态数据成员" class="headerlink" title="5.dll链接不一致不允许定义dllimport静态数据成员"></a>5.dll链接不一致不允许定义dllimport静态数据成员</h4><h3 id="QGIS-二次开发在Release模式开发使用断点"><a href="#QGIS-二次开发在Release模式开发使用断点" class="headerlink" title="QGIS 二次开发在Release模式开发使用断点"></a>QGIS 二次开发在Release模式开发使用断点</h3><ol><li><p>链接器》调试，设置生成调试信息，生成完整程序数据库文件，生成映射文件，即时导出，如下图所示</p><p><img src="/2020/11/20/qgis-develop-4/image-20210116223028356.png" alt="image-20210116223028356"></p></li><li><p>设置C/C++常规调试信息格式：用于“编辑并继续”的程序数据库</p><p><img src="/2020/11/20/qgis-develop-4/image-20210116223135189.png" alt="image-20210116223135189"></p></li><li><p>设置C/C++ 优化：已禁用</p></li></ol><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/11/20/qgis-develop-4/image-20210116223206885.png" alt="image-20210116223206885" title>                </div>                <div class="image-caption">image-20210116223206885</div>            </figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;结合网上资料以及自己的尝试，整理一个搭建环境的详细步骤&lt;/p&gt;
    
    </summary>
    
      <category term="GIS" scheme="http://11wy11.github.io/categories/GIS/"/>
    
    
      <category term="QGIS" scheme="http://11wy11.github.io/tags/QGIS/"/>
    
  </entry>
  
  <entry>
    <title>QGIS二次开发学习（二）-测试demo</title>
    <link href="http://11wy11.github.io/2020/11/18/qgis-develop-3/"/>
    <id>http://11wy11.github.io/2020/11/18/qgis-develop-3/</id>
    <published>2020-11-18T13:37:21.000Z</published>
    <updated>2020-11-21T05:50:42.453Z</updated>
    
    <content type="html"><![CDATA[<p>收集的QGIS Demo代码</p><a id="more"></a><h2 id="测试Demo"><a href="#测试Demo" class="headerlink" title="测试Demo"></a>测试Demo</h2><h3 id="Demo1"><a href="#Demo1" class="headerlink" title="Demo1"></a>Demo1</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;qgis.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"MainWindow.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QApplication&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;qgis_core.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;qgis_gui.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;qgsdatasourceuri.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;qgsproviderregistry.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QDebug&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QSqlDatabase&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QSqlError&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;QSqlQuery&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;qgssinglesymbolrenderer.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;qgsapplication.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pluginsPath <span class="meta-string">"F:\\OSGeo4W64\\apps\\qgis-dev\\plugins"</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//using namespace QgsGuiUtils;</span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="function">QgsApplication <span class="title">myApp</span><span class="params">(argc, argv, <span class="literal">true</span>)</span></span>;</span><br><span class="line">myApp.setPrefixPath(<span class="string">"F:\\OSGeo4W64\\apps\\qgis"</span>,<span class="literal">true</span>);</span><br><span class="line">QgsProviderRegistry::instance(<span class="string">"F:\\OSGeo4W64\\apps\\qgis\\plugins"</span>);</span><br><span class="line"><span class="function">QString <span class="title">file</span><span class="params">(<span class="string">"E:\\Beijing.osm.shp\\Beijing-shp\\shape\\roads.shp"</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">QList&lt;QgsMapLayer*&gt; listVecLayer;</span><br><span class="line"> </span><br><span class="line">QgsVectorLayer Vectorlayer;</span><br><span class="line">Vectorlayer.setProviderEncoding(<span class="string">"GBK2312"</span>);</span><br><span class="line">Vectorlayer.setMinimumScale(<span class="number">1.0</span>);</span><br><span class="line">Vectorlayer.setDataSource(file,QFileInfo(file).completeBaseName(),<span class="string">"ogr"</span>,<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//QgsFeature feature();</span></span><br><span class="line"><span class="comment">//QgsFeatureList FeatureList;</span></span><br><span class="line"><span class="comment">//FeatureList.append();</span></span><br><span class="line"><span class="comment">//QgsVectorLayer usetLayer;</span></span><br><span class="line"><span class="comment">//usetLayer.addFeatures();</span></span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">listVecLayer.append(&amp;Vectorlayer);</span><br><span class="line"> </span><br><span class="line">qDebug()&lt;&lt;Vectorlayer.featureCount();</span><br><span class="line">QgsProject::instance()-&gt;addMapLayers(listVecLayer);</span><br><span class="line"> </span><br><span class="line">QgsMapCanvas QGSMC;</span><br><span class="line">QGSMC.setLayers(listVecLayer);</span><br><span class="line">QGSMC.setExtent(Vectorlayer.extent());</span><br><span class="line">QGSMC.enableAntiAliasing(<span class="literal">true</span>);</span><br><span class="line">QGSMC.freeze(<span class="literal">false</span>);</span><br><span class="line">QGSMC.setDragMode(QGraphicsView::RubberBandDrag);</span><br><span class="line">QGSMC.setVisible(<span class="literal">true</span>);</span><br><span class="line">QGSMC.zoomToFullExtent();</span><br><span class="line">QGSMC.refresh();</span><br><span class="line">QGSMC.show();</span><br><span class="line"><span class="comment">//QgsMapLayer* testlayer = new QgsMapLayer();</span></span><br><span class="line">testlayer.show();</span><br><span class="line"> </span><br><span class="line"><span class="comment">//QgsDataSourceUri GS_DATASURL;</span></span><br><span class="line"><span class="comment">// setConnection（const QString＆aHost，const QString＆aPort，const QString＆aDatabase，const QString＆aUsername，const QString＆aPassword，SslMode sslmode = SslPrefer，const QString＆authConfigId = QString（））</span></span><br><span class="line"><span class="comment">//GS_DATASURL.setConnection("192.168.2.205","3306", "beijin_map", "root", "root", QgsDataSourceUri::SslMode::SslDisable);</span></span><br><span class="line"><span class="comment">//GS_DATASURL.setDriver("Mysql");</span></span><br><span class="line"><span class="comment">//qDebug() &lt;&lt; "exit" &lt;&lt; GS_DATASURL.table();</span></span><br><span class="line"> </span><br><span class="line">QSqlDatabase db = QSqlDatabase::addDatabase(<span class="string">"QMYSQL"</span>);</span><br><span class="line">db.setHostName(<span class="string">"192.168.2.205"</span>);</span><br><span class="line">db.setDatabaseName(<span class="string">"beijing_map"</span>);</span><br><span class="line">db.setUserName(<span class="string">"root"</span>);</span><br><span class="line">db.setPassword(<span class="string">"root"</span>);</span><br><span class="line"><span class="keyword">if</span> (db.open()) </span><br><span class="line">&#123;</span><br><span class="line">QSqlQuery qsql = QSqlQuery(db);</span><br><span class="line"><span class="keyword">if</span>(qsql.exec(<span class="string">"select COLUMN_NAME from information_schema.COLUMNS where table_name = 'testmap'"</span>))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">while</span> (qsql.next()) &#123;</span><br><span class="line">qDebug() &lt;&lt; qsql.value(<span class="number">0</span>).toString();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">qDebug() &lt;&lt; db.lastError();</span><br><span class="line"> </span><br><span class="line"><span class="comment">//MainWindow MW;</span></span><br><span class="line"><span class="comment">//MW.show();</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//QgsMapLayoutConfigWidget QMLCW;</span></span><br><span class="line"><span class="comment">//QMLCW.show();</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">return</span> myApp.exec();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="Demo2"><a href="#Demo2" class="headerlink" title="Demo2"></a>Demo2</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">//</span><br><span class="line">// QGIS Includes</span><br><span class="line">//</span><br><span class="line">#include &lt;qgsapplication.h&gt;</span><br><span class="line">#include &lt;qgsproviderregistry.h&gt;</span><br><span class="line">#include &lt;qgssinglesymbolrenderer.h&gt;</span><br><span class="line">#include &lt;qgsmaplayerregistry.h&gt;</span><br><span class="line">#include &lt;qgsvectorlayer.h&gt;</span><br><span class="line">#include &lt;qgsmapcanvas.h&gt;</span><br><span class="line">//</span><br><span class="line">// Qt Includes</span><br><span class="line">//</span><br><span class="line">#include &lt;QString&gt;</span><br><span class="line">#include &lt;QApplication&gt;</span><br><span class="line">#include &lt;QWidget&gt;</span><br></pre></td></tr></table></figure><p>我们用QgsApplication代替Qt中的QApplication来创建应用程序，这样可以方便地调用QGIS中的许多静态方法，比如得到库文件所在的路径等等。</p><p>各种数据的提供商plugins通过提供商注册表(QgsProviderRegistry)来管理，它会根据提供商自动加载相应的plugins，我们所需要做的就是指定plugins所存放的目录，让应用程序实例化这样的提供商注册表。</p><p>QgsSingleSymbolRenderer是最基本的符号类，它用一种颜色表示点、线、多边形对象。默认情况下颜色是随机选取的，当然，你也可以自己设定希望显示的颜色。每一个矢量图层都有一个对应的符号。</p><p>地图图层注册表（QgsMapLayerRegistry）用来管理现在正在使用的图层。QgsVectorLayer 继承自QgsMapLayer，添加了矢量数据特有的功能。</p><p>最后，地图画布（QgsMapCanvas）才是问题的关键，我们的地图将被绘制在这个工具上。</p><p>现在，我们开始初始化我们的应用程序：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">int main(int argc, char ** argv)</span><br><span class="line">&#123;</span><br><span class="line">  // Start the Application</span><br><span class="line">  QgsApplication app(argc, argv, true);</span><br><span class="line"></span><br><span class="line">  QString myPluginsDir        = &quot;/home/timlinux/apps/lib/qgis&quot;;</span><br><span class="line">  QString myLayerPath         = &quot;/home/timlinux/gisdata/brazil/BR_Cidades/&quot;;</span><br><span class="line">  QString myLayerBaseName     = &quot;Brasil_Cap&quot;;</span><br><span class="line">  QString myProviderName      = &quot;ogr&quot;;</span><br></pre></td></tr></table></figure><p>这样我们就得到了一个qgsapplication。</p><p>变量myLayerPath指定了plugins所在的目录。</p><p>变量myLayerPath和myLayerBaseName指向要使用的shape文件。</p><p>变量myProviderName很重要，它告诉qgis加载数据文件需要使用哪个数据提供商。一般为”ogr”或”postgres”。</p><p>现在我们可以开始创建图层了：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1 // Instantiate Provider Registry</span><br><span class="line">2   QgsProviderRegistry::instance(myPluginsDir);</span><br></pre></td></tr></table></figure><p>首先我们需要初始化提供商注册表。QgsMapLayerRegistry是一个单类（singleton class），因此我们使用它的静态函数instance()传递供应商插件库的路径，在此之后它将在这个路径下查找提供商的插件。</p><p>接下来我们继续创建图层：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">QgsVectorLayer * mypLayer =</span><br><span class="line">      new QgsVectorLayer(myLayerPath, myLayerBaseName, myProviderName);</span><br><span class="line">  QgsSingleSymbolRenderer *mypRenderer = new QgsSingleSymbolRenderer(mypLayer-&gt;geometryType());</span><br><span class="line">  QList &lt;QgsMapCanvasLayer&gt; myLayerSet;</span><br><span class="line"></span><br><span class="line">  mypLayer-&gt;setRenderer(mypRenderer);</span><br><span class="line">  if (mypLayer-&gt;isValid())</span><br><span class="line">  &#123;</span><br><span class="line">    qDebug(&quot;Layer is valid&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">  else</span><br><span class="line">  &#123;</span><br><span class="line">    qDebug(&quot;Layer is NOT valid&quot;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // Add the Vector Layer to the Layer Registry</span><br><span class="line">  QgsMapLayerRegistry::instance()-&gt;addMapLayer(mypLayer, TRUE);</span><br><span class="line">  // Add the Layer to the Layer Set</span><br><span class="line">  myLayerSet.append(QgsMapCanvasLayer(mypLayer, TRUE));</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// Create the Map Canvas</span><br><span class="line">  QgsMapCanvas * mypMapCanvas = new QgsMapCanvas(0, 0);</span><br><span class="line">  mypMapCanvas-&gt;setExtent(mypLayer-&gt;extent());</span><br><span class="line">  mypMapCanvas-&gt;enableAntiAliasing(true);</span><br><span class="line">  mypMapCanvas-&gt;setCanvasColor(QColor(255, 255, 255));</span><br><span class="line">  mypMapCanvas-&gt;freeze(false);</span><br><span class="line">  // Set the Map Canvas Layer Set</span><br><span class="line">  mypMapCanvas-&gt;setLayerSet(myLayerSet);</span><br><span class="line">  mypMapCanvas-&gt;setVisible(true);</span><br><span class="line">  mypMapCanvas-&gt;refresh();</span><br><span class="line">  return app.exec();</span><br></pre></td></tr></table></figure><h3 id="Demo3"><a href="#Demo3" class="headerlink" title="Demo3"></a>Demo3</h3><p> 首先，main.cpp</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;gisTest2.h&quot;</span><br><span class="line">#include &lt;qgsapplication.h&gt;</span><br><span class="line"></span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">   QgsApplication a(argc, argv, true);</span><br><span class="line">   QgsApplication::setPrefixPath(&quot;C:/OSGeo4W/apps/qgis&quot;, true);</span><br><span class="line">   QgsApplication::initQgis();   //初始化QGIS应用</span><br><span class="line">   gisTest2 w;   //创建一个窗体，类似于Qt</span><br><span class="line">   w.show();</span><br><span class="line"></span><br><span class="line">   return a.exec();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>gisTest2.cpp代码如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;gisTest2.h&quot;</span><br><span class="line">#include &lt;qmenubar.h&gt;</span><br><span class="line">#include &lt;qmessagebox.h&gt;</span><br><span class="line">#include &lt;qfiledialog.h&gt;</span><br><span class="line">#include &lt;qgsvectorlayer.h&gt;</span><br><span class="line"></span><br><span class="line">gisTest2::gisTest2(QWidget *parent)</span><br><span class="line">   : QMainWindow(parent)</span><br><span class="line">&#123;</span><br><span class="line">   this-&gt;resize(600, 400);</span><br><span class="line"></span><br><span class="line">   // create the menus and then add the actions to them.</span><br><span class="line">   fileMenu = this-&gt;menuBar()-&gt;addMenu(&quot;File&quot;);</span><br><span class="line">   openFileAction = new QAction(&quot;Open&quot;, this);</span><br><span class="line">   this-&gt;connect(openFileAction, SIGNAL(triggered(bool)), this, SLOT(on_openFileAction_triggered()));</span><br><span class="line">   fileMenu-&gt;addAction(openFileAction);</span><br><span class="line"></span><br><span class="line">   // initialize the map canvas</span><br><span class="line">   mapCanvas = new QgsMapCanvas();</span><br><span class="line">   this-&gt;setCentralWidget(mapCanvas);</span><br><span class="line"></span><br><span class="line">   mapCanvas-&gt;setCanvasColor(QColor(255, 255, 255));</span><br><span class="line">   mapCanvas-&gt;setVisible(true);</span><br><span class="line">   mapCanvas-&gt;enableAntiAliasing(true);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void gisTest2::on_openFileAction_triggered() &#123;</span><br><span class="line">   addVectorLayer();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void gisTest2::addVectorLayer()</span><br><span class="line">&#123;</span><br><span class="line">   QString fileName = QFileDialog::getOpenFileName(this, tr(&quot;Open shape file&quot;), &quot;&quot;, &quot;*.shp&quot;);</span><br><span class="line">   QStringList temp = fileName.split(&apos;/&apos;);</span><br><span class="line">   QString basename = temp.at(temp.size() - 1);</span><br><span class="line">   QgsVectorLayer* vecLayer = new QgsVectorLayer(fileName, basename, &quot;ogr&quot;);</span><br><span class="line"></span><br><span class="line">   if (!vecLayer-&gt;isValid())</span><br><span class="line">   &#123;</span><br><span class="line">     QMessageBox::critical(this, &quot;error&quot;, QString(&quot;layer is invalid: \n&quot;) + fileName);</span><br><span class="line">     return;</span><br><span class="line">   &#125;</span><br><span class="line">   mapCanvas-&gt;setExtent(vecLayer-&gt;extent());</span><br><span class="line">   layers.append(vecLayer);</span><br><span class="line">   mapCanvas-&gt;setLayers(layers);</span><br><span class="line">   mapCanvas-&gt;refresh();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>gisTest2.h代码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">#pragma once</span><br><span class="line"></span><br><span class="line">#include &lt;QtWidgets/QMainWindow&gt;</span><br><span class="line">#include &quot;ui_gisTest2.h&quot;</span><br><span class="line">#include &lt;qmenu.h&gt;</span><br><span class="line">#include &lt;qaction.h&gt;</span><br><span class="line">#include &lt;qgsmapcanvas.h&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class gisTest2 : public QMainWindow</span><br><span class="line">&#123;</span><br><span class="line">   Q_OBJECT</span><br><span class="line"></span><br><span class="line">public:</span><br><span class="line">   gisTest2(QWidget *parent = Q_NULLPTR);</span><br><span class="line"></span><br><span class="line">private:</span><br><span class="line">   // create the menus and then add the actions to them.</span><br><span class="line">   QMenu *fileMenu;</span><br><span class="line">   QAction *openFileAction;</span><br><span class="line"></span><br><span class="line">   //map canvas</span><br><span class="line">   QgsMapCanvas *mapCanvas;</span><br><span class="line">   QList&lt;QgsMapLayer *&gt; layers;</span><br><span class="line"></span><br><span class="line">   public slots:</span><br><span class="line">   void on_openFileAction_triggered();</span><br><span class="line">   //</span><br><span class="line"></span><br><span class="line">public:</span><br><span class="line">   void addVectorLayer();</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h4 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h4><p><a href="https://www.cnblogs.com/loongfee/archive/2012/05/25/2518483.html" target="_blank" rel="noopener">https://www.cnblogs.com/loongfee/archive/2012/05/25/2518483.html</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;收集的QGIS Demo代码&lt;/p&gt;
    
    </summary>
    
      <category term="GIS" scheme="http://11wy11.github.io/categories/GIS/"/>
    
    
      <category term="QGIS" scheme="http://11wy11.github.io/tags/QGIS/"/>
    
  </entry>
  
  <entry>
    <title>QGIS源码编译</title>
    <link href="http://11wy11.github.io/2020/11/18/qgis-develop-2/"/>
    <id>http://11wy11.github.io/2020/11/18/qgis-develop-2/</id>
    <published>2020-11-18T13:14:18.000Z</published>
    <updated>2021-01-19T08:48:37.007Z</updated>
    
    <content type="html"><![CDATA[<p>QGIS 源码编译，为学习开源软件以及二次开发做准备</p><p>资料收集于网络资源，后经测试，通过官方自带的批处理能够方便的编译出qgis工程</p><a id="more"></a><p>使用老的方式，通过cmake-gui配置环境变量编译qgis 源码，很麻烦，会有各种各样的错</p><h3 id="VS2015需要安装的开发工具"><a href="#VS2015需要安装的开发工具" class="headerlink" title="VS2015需要安装的开发工具"></a>VS2015需要安装的开发工具</h3><p>Select “Custom” install and add the following packages:</p><ul><li><p>“Common Tools for Visual C++ 2015” under “Visual C++”</p></li><li><p>“Tools (1.4.1) and Windows 10 SDK (10.0.14393)” under “Universal Windows App Development Tools”.</p><p><img src="/2020/11/18/qgis-develop-2/image-20201206195049105.png" alt="image-20201206195049105"></p></li></ul><h3 id="下载软件包"><a href="#下载软件包" class="headerlink" title="下载软件包"></a>下载软件包</h3><table><thead><tr><th>Tool</th><th>Website</th></tr></thead><tbody><tr><td>CMake</td><td><a href="https://cmake.org/files/v3.7/cmake-3.7.2-win64-x64.msi" target="_blank" rel="noopener">https://cmake.org/files/v3.7/cmake-3.7.2-win64-x64.msi</a></td></tr><tr><td>cygwin</td><td><a href="http://cygwin.com/setup-x86.exe" target="_blank" rel="noopener">http://cygwin.com/setup-x86.exe</a> (32bit) or <a href="http://cygwin.com/setup-x86_64.exe" target="_blank" rel="noopener">http://cygwin.com/setup-x86_64.exe</a> (64bit)</td></tr><tr><td>OSGeo4W</td><td><a href="http://download.osgeo.org/osgeo4w/osgeo4w-setup-x86.exe" target="_blank" rel="noopener">http://download.osgeo.org/osgeo4w/osgeo4w-setup-x86.exe</a> (32bit) or <a href="http://download.osgeo.org/osgeo4w/osgeo4w-setup-x86_64.exe" target="_blank" rel="noopener">http://download.osgeo.org/osgeo4w/osgeo4w-setup-x86_64.exe</a> (64bit)</td></tr><tr><td>ninja</td><td><a href="https://github.com/ninja-build/ninja/releases/download/v1.7.2/ninja-win.zip" target="_blank" rel="noopener">https://github.com/ninja-build/ninja/releases/download/v1.7.2/ninja-win.zip</a></td></tr></tbody></table><p>对于cygwin和OSGeo4W，下载完后都是选择高级安装。</p><p>在选包界面的搜索栏输入文档中给出的包名，目前官方文档给出的是：</p><h4 id="1-cygwin"><a href="#1-cygwin" class="headerlink" title="1.cygwin"></a>1.cygwin</h4><p>- bison<br>- flex</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/11/18/qgis-develop-2/18" alt="image-20201122191237032" title>                </div>                <div class="image-caption">image-20201122191237032</div>            </figure><p><strong>设置环境变量：Path中添加C:\cygwin64\bin</strong></p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/11/18/qgis-develop-2/19" alt="image-20201122191332862" title>                </div>                <div class="image-caption">image-20201122191332862</div>            </figure><p><strong>检查是否安装成功flex和bison</strong>,见下图</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/11/18/qgis-develop-2/20" alt="image-20201122191537468" title>                </div>                <div class="image-caption">image-20201122191537468</div>            </figure><p><strong>2.OSGeo4W:</strong></p><p>下载地址：  <a href="http://download.osgeo.org/osgeo4w/osgeo4w-setup-x86.exe" target="_blank" rel="noopener">http://download.osgeo.org/osgeo4w/osgeo4w-setup-x86.exe</a> (32bit) or <a href="http://download.osgeo.org/osgeo4w/osgeo4w-setup-x86_64.exe" target="_blank" rel="noopener">http://download.osgeo.org/osgeo4w/osgeo4w-setup-x86_64.exe</a> (64bit)</p><p>选择Advance Install ,在线下载时，使用镜像<a href="http://gwmodel.whu.edu.cn/mirrors/osgeo4w，不然会下载特别缓慢" target="_blank" rel="noopener">http://gwmodel.whu.edu.cn/mirrors/osgeo4w，不然会下载特别缓慢</a></p><p>另外之后编译的过程中如果发现有缺失的包也是可以重新在这里补充下载的。</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/11/18/qgis-develop-2/70" alt="img" title>                </div>                <div class="image-caption">img</div>            </figure><p>直接下一步完成安装即可。</p><p>注:如果不需要编译源码，只需要下载qgis相关即可，后续如果还需要编译源码，需要下载一些编译依赖库：</p><p>Qt &gt;= 4.5.0（QT5随OSGeo4W自动安装，在OSGeo4W目录下apps中）</p><p>Proj &gt;= 4.4.x（随OSGeo4W自动安装，在OSGeo4W目录下apps中）</p><p>GEOS &gt;= 3.0，</p><p>Sqlite3 &gt;= 3.0.0(暂没用到)</p><p>GDAL/OGR &gt;= 1.4.x（随OSGeo4W自动安装，在OSGeo4W目录下apps中）</p><p>Qwt &gt;= 5.0 &amp; (&lt; 6.1 with internalQwtPolar)(随OSGeo4W自动安装，在OSGeo4W目录下)</p><p>expat &gt;= 1.95(随OSGeo4W自动安装，在OSGeo4W目录下)</p><p>- QScintilla2<br>- QCA<br>- qtkeychain (&gt;= 0.5)</p><p>可选依赖库：<br>- GRASS驱动和插件支持 - GRASS &gt;= 6.0.0. QGIS可以和GRASS6或者GRASS7共同编译. 它也可以同时支持这两个版本的GRASS如果安装了rpath的话，具体使用的版本是由LD_LIBRARY_PATH或者PATH变量在运行时决定。<br>- georeferencer - GSL &gt;= 1.8<br>- postgis数据库支持 - PostgreSQL &gt;= 8.0.x<br>- gps插件 - gpsbabel<br>- mapserver导出以及PyQGIS - Python &gt;= 3.3<br>- python支持 - SIP &gt;= 4.12, PyQt &gt;= 5.3 并且要与Qt版本吻合, Qscintilla2<br>- qgis mapserver - FastCGI<br>- oracle驱动 - Oracle OCI library</p><p>安装完cygwin和OSGeo4W后，<strong>将ninja.exe复制到之前安装OSGeo4W目录的OSGeo4W64\bin\下</strong>。、</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/11/18/qgis-develop-2/22" alt="img" title>                </div>                <div class="image-caption">img</div>            </figure><h4 id="安装CMake"><a href="#安装CMake" class="headerlink" title="安装CMake"></a>安装CMake</h4><p><a href="https://cmake.org/download/" target="_blank" rel="noopener">https://cmake.org/download/</a></p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/11/18/qgis-develop-2/16" alt="image-20201122184022077" title>                </div>                <div class="image-caption">image-20201122184022077</div>            </figure><p><strong>新建CMAKE_ROOT的环境变量</strong></p><p>打开CMakeGUI程序，选择QGIS源码（<a href="https://github.com/qgis/QGIS），以及存放编译生成的工程的文件夹路径" target="_blank" rel="noopener">https://github.com/qgis/QGIS），以及存放编译生成的工程的文件夹路径</a></p><h3 id="编译源码"><a href="#编译源码" class="headerlink" title="编译源码"></a>编译源码</h3><p>官方提供了两种方法，使用Trugonly.cmd创建MSVC解决方案文件或者使用cmake-gui</p><p>由于各种路径设置的原因，笔者建议还是使用传统的cmake进行编译。</p><h5 id="1-运行-C-OSGeo4W64-bin下的o4w-env-bat文件，安装好环境变量"><a href="#1-运行-C-OSGeo4W64-bin下的o4w-env-bat文件，安装好环境变量" class="headerlink" title="1.运行 C:\OSGeo4W64\bin下的o4w_env.bat文件，安装好环境变量"></a><strong>1.运行 C:\OSGeo4W64\bin下的o4w_env.bat文件，安装好环境变量</strong></h5><p>不难发现，其中涉及到的重要的环境变量主要有：</p><p>OSGEO4W_ROOT（OSGeo4W的根目录）</p><p>PF86（软件默认安装目录）</p><p>VS140COMNTOOLS（调用VS的vcvarsall.bat批处理文件）</p><p>GRASS7（这个的路径中是【/】而不是【\】，要注意）</p><p>PYTHONPATH（SIP包所在路径）</p><p>LIB（OSGeo4W依赖库头文件）</p><p>INCLUDE（OSGeo4W静态库文件）</p><p>如果之前更改了路径，修改相应的环境变量即可。</p><p>其中，VS140COMNTOOLS是VS2015的变量名，</p><h5 id="打开cmake-gui，设置好源码路径和要输出的路径，然后点击Configure"><a href="#打开cmake-gui，设置好源码路径和要输出的路径，然后点击Configure" class="headerlink" title="打开cmake-gui，设置好源码路径和要输出的路径，然后点击Configure"></a>打开cmake-gui，设置好源码路径和要输出的路径，然后点击Configure</h5><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/11/18/qgis-develop-2/17" alt="image-20201122185955306" title>                </div>                <div class="image-caption">image-20201122185955306</div>            </figure><p>另外在CMAKE卡中设置项目要安装的路径，推荐设置在一个新的空目录中，避免导致混乱</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/11/18/qgis-develop-2/3" alt="img" title>                </div>                <div class="image-caption">img</div>            </figure><p>出现错误也是正常的，关键还是路径的问题，所以说前面环境变量的设置十分重要</p><h5 id="配置环境变量"><a href="#配置环境变量" class="headerlink" title="配置环境变量"></a>配置环境变量</h5><p>一步一步的指定缺失的路径，首先是flex和bison<strong>，这一步，主要在安装cygwin并下载flex和bision后，将cygwin/bin路径添加到Path中即可</strong></p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/11/18/qgis-develop-2/6" alt="img" title>                </div>                <div class="image-caption">img</div>            </figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdn.net/20180801151521772?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM0MzU3NzE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="img" title>                </div>                <div class="image-caption">img</div>            </figure><p>然后是各个库</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/11/18/qgis-develop-2/21" alt="image-20201122192309206" title>                </div>                <div class="image-caption">image-20201122192309206</div>            </figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/11/18/qgis-develop-2/7" alt="img" title>                </div>                <div class="image-caption">img</div>            </figure><p>这个基本在安装OSGeo4W64时已经全部安装过了，设置路径即可</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/11/18/qgis-develop-2/24" alt="image-20201122205035392" title>                </div>                <div class="image-caption">image-20201122205035392</div>            </figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/11/18/qgis-develop-2/25" alt="image-20201122211026744" title>                </div>                <div class="image-caption">image-20201122211026744</div>            </figure><p>设置完成后继续点Configure，有错误则设置好需要的路径直到出现</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/11/18/qgis-develop-2/11" alt="img" title>                </div>                <div class="image-caption">img</div>            </figure><p>然后点击Generate，其实这三个按钮点依次点过去，没问题的话就OK了，成功的话可以在指定的文件夹中看到编译成功的项目，用VS打开项目并且重新生成就可以了，当然这可能需要比较长的一段时间。</p><p><img src="/2020/11/18/qgis-develop-2/12" alt="img"><img src="/2020/11/18/qgis-develop-2/13" alt="img"></p><p>将活动解决方案设置为RelWithDebInfo，带有调试信息的Release版本。</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/11/18/qgis-develop-2/14" alt="img" title>                </div>                <div class="image-caption">img</div>            </figure><p>将启动项目设置成【qgis】，选择核心的项目生成即可，这里我参考了<a href="https://blog.csdn.net/quinta_2018_01_09/article/details/79084001这篇博客。但通过查看看依赖项我发现【qgis】还需要依赖【qgis_native】这个项目，因此也把它加上去了。" target="_blank" rel="noopener">https://blog.csdn.net/quinta_2018_01_09/article/details/79084001这篇博客。但通过查看看依赖项我发现【qgis】还需要依赖【qgis_native】这个项目，因此也把它加上去了。</a></p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/11/18/qgis-develop-2/15" alt="img" title>                </div>                <div class="image-caption">img</div>            </figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdnimg.cn/2018122716553618.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM0MzU3NzE3,size_16,color_FFFFFF,t_70" alt="img" title>                </div>                <div class="image-caption">img</div>            </figure><p>然后单独编译生成【qgis_core】,如果出现以下问题，定位到出问题的cpp文件，利用记事本对其进行编辑（其他方法亦可），将其编码改为【Unicode】，虽然错误看起来很多，但是实际上几条错误都是在同一个文件中的，实际上需要修改的文件并不多，逐一修改即可。成功生成【qgis_core】后，生成其它项目，出现语法错误处理方式同上，最后生成【qgis】项目。</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdnimg.cn/20181227175610298.png" alt="img" title>                </div>                <div class="image-caption">img</div>            </figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdnimg.cn/20181227175756127.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM0MzU3NzE3,size_16,color_FFFFFF,t_70" alt="img" title>                </div>                <div class="image-caption">img</div>            </figure><h3 id="其他问题"><a href="#其他问题" class="headerlink" title="其他问题"></a>其他问题</h3><p>尤其是确保<strong>不要</strong>安装msinttypes软件包，它会安装stdint.h文件到OSGeo4W[64]/include目录下，进而导致与Visual Studio本身的stdint.h文件冲突，致使编译某些模块失败。</p><p>编译的时候，遇到缺少一些python包，需要通过pip安装一下</p><p>遇到安装了PyQT5</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;QGIS 源码编译，为学习开源软件以及二次开发做准备&lt;/p&gt;
&lt;p&gt;资料收集于网络资源，后经测试，通过官方自带的批处理能够方便的编译出qgis工程&lt;/p&gt;
    
    </summary>
    
      <category term="GIS" scheme="http://11wy11.github.io/categories/GIS/"/>
    
    
      <category term="QGIS" scheme="http://11wy11.github.io/tags/QGIS/"/>
    
  </entry>
  
  <entry>
    <title>QGIS二次开发学习（一）</title>
    <link href="http://11wy11.github.io/2020/11/18/qgis-develop-1/"/>
    <id>http://11wy11.github.io/2020/11/18/qgis-develop-1/</id>
    <published>2020-11-18T12:59:11.000Z</published>
    <updated>2021-03-12T08:02:25.218Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><p>QGIS git  <a href="https://github.com/qgis" target="_blank" rel="noopener">https://github.com/qgis</a></p><p>QGIS 快速指南 </p><p>用户手册 <a href="https://docs.qgis.org/3.16/en/docs/user_manual/index.html" target="_blank" rel="noopener">https://docs.qgis.org/3.16/en/docs/user_manual/index.html</a></p><p>教程 <a href="https://docs.qgis.org/3.16/en/docs/training_manual/index.html" target="_blank" rel="noopener">https://docs.qgis.org/3.16/en/docs/training_manual/index.html</a></p><p>QGIS Python 开发手册</p><p><a href="https://docs.qgis.org/3.16/en/docs/pyqgis_developer_cookbook/index.html" target="_blank" rel="noopener">https://docs.qgis.org/3.16/en/docs/pyqgis_developer_cookbook/index.html</a></p><p> PyQGIS API <a href="https://qgis.org/pyqgis/" target="_blank" rel="noopener">https://qgis.org/pyqgis/</a></p><p>QGIS C++ 开发手册 <a href="https://qgis.org/api/" target="_blank" rel="noopener">https://qgis.org/api/</a></p><p>QGIS API <a href="https://qgis.org/api/3.14/api_break.html" target="_blank" rel="noopener">https://qgis.org/api/3.14/api_break.html</a></p><p>早期3.1.0.0的用户手册<a href="https://docs.huihoo.com/qgis/qgis-1.0.0-user-guide-en.pdf" target="_blank" rel="noopener">https://docs.huihoo.com/qgis/qgis-1.0.0-user-guide-en.pdf</a></p><p>开发人员手册：<a href="https://docs.qgis.org/3.16/en/docs/developers_guide/index.html" target="_blank" rel="noopener">https://docs.qgis.org/3.16/en/docs/developers_guide/index.html</a></p><p>QgsDiagramRendererV2</p><p>通过 QgsVectorLayer 的 setDiagramRenderer() 方法，传入一个 QgsDiagramRendererV2 的实例，当前的矢量图层就会以设置的方法来渲染显示图表。</p><p>其中 QgsLinearlyInterpolatedDiagramRenderer和QgsSingleCategoryDiagramRenderer 分别是具体的渲染方法类，</p><p>Diagram类</p><p>QGis当中提供的图表类包括三个，QgsPieDiagram、QgsTextDiagram 和 QgsHistogramDiagram，它们分别对应于饼状图、文本图和柱状图，都是继承自 QgsDiagram 类</p><p>具体来说，有两个，一个是QgsDiagramSettings，用于配置针对图表的参数，另一个是 QgsDiagramLayerSettings，是更高一级的参数，将图表类作为一个图层，配置与矢量要素的显示关系.</p><table><thead><tr><th><strong>Name</strong></th><th><strong>说明</strong></th></tr></thead><tbody><tr><td>angleOffset</td><td>起始角度（仅饼状图）</td></tr><tr><td>backgroundColor</td><td>背景颜色</td></tr><tr><td>barWidth</td><td>柱宽度（仅柱状图）</td></tr><tr><td>categoryAttributes  \ categoryColors</td><td>用于控制不同属性显示不同颜色</td></tr><tr><td>diagramOrientation</td><td>图表方向</td></tr><tr><td>font</td><td>字体（仅文本图）</td></tr><tr><td>labelPlacementMethod</td><td>图表中文本的显示位置（仅文本图），包括Hight和XHight</td></tr><tr><td>maxScaleDenominator  \ minScaleDenominator</td><td>显示尺度。大于或小于缩放尺度，图表将不再显示</td></tr><tr><td>minimumSize</td><td>图表显示的最小尺寸。小于这个尺寸的图表会放大到这个尺寸显示</td></tr><tr><td>penColor  \ penWidth</td><td>控制轮廓的颜色和宽度</td></tr><tr><td>scaleByArea</td><td>是否根据要素面积进行缩放图表（仅polygon要素）</td></tr><tr><td>size</td><td>图表大小</td></tr><tr><td>sizeType</td><td>图表大小的单位，包括 MM 和 MapUnits</td></tr><tr><td>transparency</td><td>透明度</td></tr></tbody></table><p>基本代码：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> qgis_dev_layerPropDialog::setDiagramProperty()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 这一句是获取当前图层，修改成你自己获取当前图层的方式</span></span><br><span class="line">    QgsVectorLayer* layer = qobject_cast&lt;QgsVectorLayer*&gt;( activeLayer() ); </span><br><span class="line"> </span><br><span class="line">    QgsDiagram* diagram = <span class="number">0</span>;</span><br><span class="line">    QString diagramType = <span class="string">"Hist"</span>; <span class="comment">// 这一句修改成获取图表类型的代码</span></span><br><span class="line">    <span class="keyword">bool</span> scaleAttributeValueOk = <span class="literal">false</span>;</span><br><span class="line"> </span><br><span class="line">    QgsVectorDataProvider* provider = layer-&gt;dataProvider();</span><br><span class="line">    <span class="keyword">double</span> maxVal = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> fld = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span> ( fld != <span class="number">-1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">bool</span> ok = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">double</span> val = provider-&gt;maximumValue( fld ).toDouble( &amp;ok ); <span class="comment">// 获取该字段的最大值</span></span><br><span class="line">        <span class="keyword">if</span> ( ok )</span><br><span class="line">        &#123;</span><br><span class="line">            maxVal = val;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">bool</span> mValueLineEdit = <span class="literal">false</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span> ( diagramType == <span class="string">"Text"</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//diagram = new QgsTextDiagram();</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( diagramType == <span class="string">"Pie"</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//diagram = new QgsPieDiagram();</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="comment">// if ( diagramType == DIAGRAM_NAME_HISTOGRAM )</span></span><br><span class="line">    &#123;</span><br><span class="line">        diagram = <span class="keyword">new</span> QgsHistogramDiagram();</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">#<span class="meta-keyword">pragma</span> region 设置diagram属性</span></span><br><span class="line"> </span><br><span class="line">    QgsDiagramSettings ds; <span class="comment">// diagram的设置项</span></span><br><span class="line">    <span class="comment">//ds.font = mDiagramFont; // 设置字体</span></span><br><span class="line">    ds.transparency = <span class="number">0</span>; <span class="comment">// 设置透明度</span></span><br><span class="line"> </span><br><span class="line">    QList&lt;QColor&gt; categoryColors; <span class="comment">// 颜色</span></span><br><span class="line">    QList&lt;QString&gt; categoryAttributes; <span class="comment">// 属性</span></span><br><span class="line"> </span><br><span class="line">    QColor color = QColor( <span class="number">255</span>, <span class="number">0</span>, <span class="number">0</span> );</span><br><span class="line">    color.setAlpha( <span class="number">255</span> - ds.transparency );</span><br><span class="line">    categoryColors.append( color );</span><br><span class="line">    categoryAttributes.append( <span class="string">"ELEV"</span> );</span><br><span class="line"> </span><br><span class="line">    ds.categoryColors = categoryColors;</span><br><span class="line">    ds.categoryAttributes = categoryAttributes;</span><br><span class="line">    ds.size = QSizeF( <span class="number">1</span>, <span class="number">1</span> );</span><br><span class="line">    ds.sizeType = <span class="keyword">static_cast</span>&lt;QgsDiagramSettings::SizeType&gt;( <span class="number">0</span> );</span><br><span class="line">    ds.labelPlacementMethod = <span class="keyword">static_cast</span>&lt;QgsDiagramSettings::LabelPlacementMethod&gt;( <span class="number">1</span> );</span><br><span class="line">    ds.scaleByArea = <span class="literal">true</span>;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">    ds.minimumSize = <span class="number">0</span>;</span><br><span class="line"> </span><br><span class="line">    ds.backgroundColor = QColor( <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span> ); <span class="comment">// 背景色</span></span><br><span class="line">    ds.penColor = QColor( <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span> ); <span class="comment">// 轮廓颜色</span></span><br><span class="line">    ds.penWidth = <span class="number">1</span>; <span class="comment">// 轮廓宽度</span></span><br><span class="line"> </span><br><span class="line">    ds.minScaleDenominator = <span class="number">-1</span>;</span><br><span class="line">    ds.maxScaleDenominator = <span class="number">-1</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// Diagram 方向 (histogram)</span></span><br><span class="line">    ds.angleOffset = <span class="number">1440</span>;</span><br><span class="line">    ds.diagramOrientation = <span class="keyword">static_cast</span>&lt;QgsDiagramSettings::DiagramOrientation&gt;( <span class="number">0</span> );</span><br><span class="line"> </span><br><span class="line">    ds.barWidth = <span class="number">5</span>; <span class="comment">// 宽度</span></span><br><span class="line">    <span class="meta">#<span class="meta-keyword">pragma</span> endregion 设置diagram属性</span></span><br><span class="line"> </span><br><span class="line">    QgsLinearlyInterpolatedDiagramRenderer* dr = <span class="keyword">new</span> QgsLinearlyInterpolatedDiagramRenderer();</span><br><span class="line">    dr-&gt;setLowerValue( <span class="number">0.0</span> );</span><br><span class="line">    dr-&gt;setLowerSize( QSizeF( <span class="number">0.0</span>, <span class="number">0.0</span> ) );</span><br><span class="line">    dr-&gt;setUpperValue( <span class="number">2</span> );</span><br><span class="line">    dr-&gt;setUpperSize( QSizeF( <span class="number">2</span>, <span class="number">2</span> ) );</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">bool</span> isExpression = <span class="literal">true</span>;</span><br><span class="line">    dr-&gt;setClassificationAttributeIsExpression( isExpression );</span><br><span class="line"> </span><br><span class="line">    dr-&gt;setClassificationAttributeExpression( <span class="string">""</span> );</span><br><span class="line"> </span><br><span class="line">    dr-&gt;setDiagram( diagram );</span><br><span class="line">    dr-&gt;setDiagramSettings( ds );</span><br><span class="line">    layer-&gt;setDiagramRenderer( dr );</span><br><span class="line"> </span><br><span class="line">    QgsDiagramLayerSettings dls;</span><br><span class="line">    dls.dist = <span class="number">0</span>;</span><br><span class="line">    dls.priority = <span class="number">5</span>;</span><br><span class="line"> </span><br><span class="line">    dls.xPosColumn = <span class="number">-1</span>;</span><br><span class="line">    dls.yPosColumn = <span class="number">-1</span>;</span><br><span class="line">    dls.placement = <span class="keyword">static_cast</span>&lt;QgsDiagramLayerSettings::Placement&gt;( <span class="number">0</span> );</span><br><span class="line"> </span><br><span class="line">    dls.placementFlags = <span class="number">0</span>;</span><br><span class="line">    layer-&gt;setDiagramLayerSettings( dls );</span><br><span class="line"> </span><br><span class="line">    layer-&gt;setTitle( <span class="string">""</span> );</span><br><span class="line"> </span><br><span class="line">    QgsVectorSimplifyMethod simplifyMethod = m_layer-&gt;simplifyMethod();</span><br><span class="line">    simplifyMethod.setSimplifyHints( QgsVectorSimplifyMethod::NoSimplification );</span><br><span class="line">    simplifyMethod.setThreshold( <span class="number">1</span> );</span><br><span class="line">    simplifyMethod.setForceLocalOptimization( <span class="literal">true</span> );</span><br><span class="line">    simplifyMethod.setMaximumScale( <span class="number">1</span> );</span><br><span class="line">    layer-&gt;setSimplifyMethod( simplifyMethod );</span><br><span class="line"> </span><br><span class="line">    layer-&gt;triggerRepaint();</span><br><span class="line">    m_mapCanvas-&gt;refresh(); <span class="comment">// 改成你自己的 map canvas</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;QGIS git  &lt;a href=&quot;https://github.com/qgis&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;https://github.com/qgis&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;QGIS 快速指南
      
    
    </summary>
    
      <category term="GIS" scheme="http://11wy11.github.io/categories/GIS/"/>
    
    
      <category term="QGIS" scheme="http://11wy11.github.io/tags/QGIS/"/>
    
  </entry>
  
  <entry>
    <title>arcgis-vs-qgis</title>
    <link href="http://11wy11.github.io/2020/10/08/arcgis-vs-qgis/"/>
    <id>http://11wy11.github.io/2020/10/08/arcgis-vs-qgis/</id>
    <published>2020-10-08T11:17:25.000Z</published>
    <updated>2020-10-08T11:20:07.696Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><p>转载</p><p><a href="https://blog.csdn.net/sf2gis2/article/details/54864292?utm_medium=distribute.pc_aggpage_search_result.none-task-blog-2~all~first_rank_v2~rank_v25-3-54864292.nonecase&amp;utm_term=qgis%E6%B8%B2%E6%9F%93%E6%9C%BA%E5%88%B6&amp;spm=1000.2123.3001.4430" target="_blank" rel="noopener">https://blog.csdn.net/sf2gis2/article/details/54864292?utm_medium=distribute.pc_aggpage_search_result.none-task-blog-2~all~first_rank_v2~rank_v25-3-54864292.nonecase&amp;utm_term=qgis%E6%B8%B2%E6%9F%93%E6%9C%BA%E5%88%B6&amp;spm=1000.2123.3001.4430</a></p><h2 id="QGIS和ArcGIS的比较"><a href="#QGIS和ArcGIS的比较" class="headerlink" title="QGIS和ArcGIS的比较"></a>QGIS和ArcGIS的比较</h2><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdn.net/20160914170111685" alt="QGIS VS ArcGIS" title>                </div>                <div class="image-caption">QGIS VS ArcGIS</div>            </figure><p>你也许伴随着ArcGIS或者QGIS而成长。<br>每天你都坐在电脑然后做着同样的事情：你打开你的ArcGIS软件或者新的QGIS软件。<br>但是你有问过自己：我能不能通过其他的GIS软件获取更多的东西?<br>我们建议你阅读这些ArcGIS与QGIS之间的不同来使你成为一个更为优秀的地理信息工作者。这是GIS产业中两个明星产品的对决ArcGIS VS QGIS。</p><h3 id="1-QGIS容纳更多的数据格式"><a href="#1-QGIS容纳更多的数据格式" class="headerlink" title="1.QGIS容纳更多的数据格式"></a>1.QGIS容纳更多的数据格式</h3><p>ArcGIS没有支持所有的数据格式，毫无疑问，QGIS在处理各种类型的数据时非常顺手，QGIS在数据格式方面是个多面手，在使用数据方面是它的长处。<br>QGIS使用GDAL/OGR库来读取和写入地理信息数据格式，支持超过70种矢量格式。QGIS一开始就是为了与PostGIS协作而诞生的，而支持的名单随着数据格式的增多而逐渐变长：ENC，shapefile，geodatabase,MapInfo格式、Microstation文件格式，AutoCAD格式、SpatiaLite、Oracle Spatial、MSSQL空间<a href="http://lib.csdn.net/base/14" target="_blank" rel="noopener">数据库</a>、WKT等等。QGIS还支持NetCDF文件。<br>QGIS的接口允许你在一天之内还原一个工程。在设置习惯性分界符方面QGIS甚至比微软的Office还要优秀。<br>不用理清多种数据格式的冲突和纠结于数据格式，简单地使用过QGIS就可以处理它！<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdn.net/20160914170213080" alt="QGIS文件格式" title>                </div>                <div class="image-caption">QGIS文件格式</div>            </figure><br>QGIS在数据格式方面明显胜出。</p><h3 id="2-简洁的用户体验"><a href="#2-简洁的用户体验" class="headerlink" title="2.简洁的用户体验"></a>2.简洁的用户体验</h3><p>你也许从没认识到ArcGIS中“Add Data”按钮的功能有多强大。<br>是的，只是一个简单的“Add Data”按钮。你也许觉得很可笑，但等笑完以后请思考这个问题：这个按钮可以简单地完成影像加载是因为它能识别所有的图像格式。<br>你想加入一个电子表格吗？你想加入一个栅格影像吗？点击“Add Data”按钮，这很简单。<br>在QGIS中你想添加一个电子表格？单击“Add Vector”按钮，选择所需要的格式。QGIS中提供的按钮种类较多让人眼花缭乱。<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdn.net/20160914212545075" alt="QGIS的按钮" title>                </div>                <div class="image-caption">QGIS的按钮</div>            </figure><br>还记得ArcMap中打开界面以后立即显示的最近编辑的地图文件吗？QGIS的另一个更改就是在“工程-&gt;打开最近文件”添加了这一功能。<br>因此，ArcGIS的简洁性更加优秀。</p><h3 id="3-使用ArcCatalog和QGIS浏览器管理你的地理数据。"><a href="#3-使用ArcCatalog和QGIS浏览器管理你的地理数据。" class="headerlink" title="3.使用ArcCatalog和QGIS浏览器管理你的地理数据。"></a>3.使用ArcCatalog和QGIS浏览器管理你的地理数据。</h3><p>QGIS浏览器和ArcCatalog都是独立的地理信息数据管理软件。<br>这些应用程序帮助管理栅格、矢量的地理数据。提供简单的数据浏览功能，但核心是数据查询和管理。<br>使用搜索工具和过滤器可以帮我们找到需要的数据文件，这就像你自己私人的Google搜索引擎。使用ArcCatalog不仅可以管理数据，还可以管理地图、模型和工具。管理数据的一项重要工作就是创建元数据。它是什么时候创建的呢？谁创建的呢？它是如何创建的呢？都可以在元数据里找到我们需要的答案。<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdn.net/20160914212836424" alt="ArcCatalog" title>                </div>                <div class="image-caption">ArcCatalog</div>            </figure><br>近些年来，元数据也进化成了多种格式（ISO,FGDC,INSPIRE和NAP）。ArcCatalog向用户提供数据的元数据标准选项。QGIS中的QGIS浏览器和ArcGIS中的ArcCatalog都提供了非常简便的文件系统和地理数据管理功能。<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdn.net/20160914212900080" alt="QGIS Browser" title>                </div>                <div class="image-caption">QGIS Browser</div>            </figure><br>这项比较中，ArcCatalog凭借其可选择性更胜一筹。</p><h3 id="4-在ArcMap和QGIS中放心地加入表格"><a href="#4-在ArcMap和QGIS中放心地加入表格" class="headerlink" title="4.在ArcMap和QGIS中放心地加入表格"></a>4.在ArcMap和QGIS中放心地加入表格</h3><p>当你为空间数据加入一个属性表的时候，你一行一行地填写数据。<br>在ArcGIS中加入表格是非常直观的。在ArcMap中，你可以右键点击一个图层并且选择“join”，你也可以通过图层属性加入信息。<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdn.net/20160914213051755" alt="ArcGIS join" title>                </div>                <div class="image-caption">ArcGIS join</div>            </figure><br>在QGIS中也同样简单。在QGIS中，你可以使用图层属性加入表格。当你在QGIS中添加一个表关联的时候，可以选择性地重新命名特定关联的前缀。对于复杂关联这是很有效的。<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdn.net/20160914213114349" alt="QGIS join" title>                </div>                <div class="image-caption">QGIS join</div>            </figure><br>这点上两者打成平手。</p><h3 id="5-ArcGIS和QGIS都成功地解决了坐标系统和投影的问题"><a href="#5-ArcGIS和QGIS都成功地解决了坐标系统和投影的问题" class="headerlink" title="5.ArcGIS和QGIS都成功地解决了坐标系统和投影的问题"></a>5.ArcGIS和QGIS都成功地解决了坐标系统和投影的问题</h3><p>你在ArcGIS中加入的第一个数据集决定了你使用的坐标系统。当再次添加其他数据集时，ArcGIS将会对其进行在初始坐标系统上的重投影。一个“未知的空间参考系”代表存在数据冲突。在这种情况下，“未知单位”将会在ArcMap的右下角显示，这时，应该使用定义投影工具对其进行修正。<br>QGIS支持2700多种已知的坐标参考系统。它允许你方便地定义全球和工程范围的坐标参考系统。它同样允许你定义自定义参考系。<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdn.net/20160914213245804" alt="坐标系统" title>                </div>                <div class="image-caption">坐标系统</div>            </figure><br>QGIS和ArcGIS都对非常友好地对坐标系统进行了处理，虽然过去的QGIS在对.prj的支持上有点小问题。</p><h3 id="6-ArcGIS-Online为你提供全世界真实的地理数据"><a href="#6-ArcGIS-Online为你提供全世界真实的地理数据" class="headerlink" title="6.ArcGIS Online为你提供全世界真实的地理数据"></a>6.ArcGIS Online为你提供全世界真实的地理数据</h3><p>QGIS在OpenLayers插件中提供了一些底图，但远不如ArcGIS Online详细。<br>当你打开ArcGIS Online的数据目录的时候，令你开心的是：里面有成千上万的政府数据、详细底图和密集的信息。<br>基本的ArcGIS许可允许你链接到ArcGIS Online——一个地理信息数据的宝库。<br>一个简单的关于“enviroment”的搜索返回了超过2887条地理数据集：美国农业部的林火检测信息、海洋局的台风数据、全世界气候年鉴、海底深度底图等。这将会使任何环境研究变得方便。<br>我们想要强调的是ArcGIS Online是一个丰富的地理信息资源库，能帮助你分析和决策。记住，方便使用的同时也伴随着责任，请小心使用这个强大的工具。<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdn.net/20160914213733275" alt="ArcGIS Online" title>                </div>                <div class="image-caption">ArcGIS Online</div>            </figure></p><h3 id="7-地理处理许可"><a href="#7-地理处理许可" class="headerlink" title="7.地理处理许可"></a>7.地理处理许可</h3><p>“处理许可”听起来像是一个不好的东西，ArcGIS会向我们要求使用许可而QGIS则是开源的。<br>ArcGIS拥有很好的地理处理框架，无缝而且易于拓展。但是你的许可水平决定你可以使用其中的哪些模块。一个基础的许可让你能够使用一些非常强大的模块。一个高级许可能够让你使用任何模块。<br>而QGIS的使用不需要任何许可！开源的QGIS软件不限制能够使用的模块。<br>如果你想在ArcGIS10中使用清除工具，你必须要有一个高级许可。如果没有办法获得高级许可，就无法使用清除工具。而在 QGIS中的擦除工具在矢量分析工具箱中。（在difference工具里，这是与GRASS和SAGAGIS相互结合的一个工具，能够提供处理地理空间问题的必要的功能）这个功能是在基本的ArcGIS许可中是不能使用的。<br>QGIS的地理处理平台的开放性令人印象深刻。而在ArcGIS却必须受限于许可，真是让人感到无奈。<br>因此在这个方面QGIS是绝对的赢家。</p><h3 id="8-不用害怕，有插件"><a href="#8-不用害怕，有插件" class="headerlink" title="8.不用害怕，有插件"></a>8.不用害怕，有插件</h3><p>我们都知道，使用插件可以完成专题化地分析。 QGIS拥有能够处理各种GIS问题的插件集合，总数达到约300个。<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdn.net/20160914215507516" alt="QGIS  plugins" title>                </div>                <div class="image-caption">QGIS  plugins</div>            </figure><br>但是你也许不知道，ArcGIS也同样具有插件。这些插件也可以帮助我们解决各种GIS问题。<br>Esri公司最新推出了一款自己的应用商店——ArcGIS MarketPlace，，能够与R统计、海洋附加工具、网络公用数据表单、ET地理魔术师ArcGIS补丁等模块的良好交互，更多的插件后续将会按时推出。<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdn.net/20160914220215333" alt="ArcGIS MarketPlace" title>                </div>                <div class="image-caption">ArcGIS MarketPlace</div>            </figure><br>这里有几乎你能想到的所有的空间问题的付费或免费的解决方案。Esri几乎检查了该商店中所有产品的有效性，现在你应该明白Esri为什么在帮助你解决地理空间问题上为什么是一枝独秀了吧。<br>QGIS拥有一个极为精简的矢量处理机制，但是在模块的丰富程度上就不如Esri了。</p><h3 id="9-QGIS和ArcGIS中的栅格处理都同样傻瓜化"><a href="#9-QGIS和ArcGIS中的栅格处理都同样傻瓜化" class="headerlink" title="9.QGIS和ArcGIS中的栅格处理都同样傻瓜化"></a>9.QGIS和ArcGIS中的栅格处理都同样傻瓜化</h3><p>空间分析扩展工具中包含了大量的栅格数据处理过程。<br>不管是简单数学计算，统计或者生成表面，ArcGIS栅格处理工具都是紧密封装的，空间分析工具箱同样提供了地下水、水文，成本表面、太阳辐射等专题化工具。其他可选择的模块有过滤（重分类工具）和简化数据（归一化工具）。<br>QGIS中的栅格计算器可以使用简单的代数计算和三角函数。QGIS中提供了多种插值方法。常规的克里金方法在QGIS中是一个独立模块，而在ArcGIS中克里金工具则是其中的一个单选选项。GRASS中的r.cost模块是用来生成成本表面的。QGIS的优势在于拥有更多的过滤选项，比如地下水和太阳辐射，但并不像ArcGIS那样全面。<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdn.net/20160914221017337" alt="QGIS Toolbox" title>                </div>                <div class="image-caption">QGIS Toolbox</div>            </figure><br>很难在这两者之间决出一个胜者，因为他们都提供了相当多的栅格处理工具选择。</p><h3 id="10-ArcGIS地理统计工具箱更好-因为它教你统计"><a href="#10-ArcGIS地理统计工具箱更好-因为它教你统计" class="headerlink" title="10.ArcGIS地理统计工具箱更好,因为它教你统计"></a>10.ArcGIS地理统计工具箱更好,因为它教你统计</h3><p>你在组装家具的时候会看说明书吗？一般不看，是不是？<br>当你运行ArcGIS地理统计工具箱的时候，说明和输出的解释非常清楚。比如：当你运行Moran’s I 的时候，输出的报告传递了一个简单的解释。你就知道你的数据是不是被正确地处理了。<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdn.net/20160914221510124" alt="Morans" title="I'">                </div>                <div class="image-caption">I'</div>            </figure><br>在QGIS中你在使用一种工具前必须需要对它有一定的了解。这不完全是坏事，但明显不如ArcGIS方便。<br>ArcGIS中的回归分析工具箱制作得非常好用，因为其输出允许使用者把统计结果与其他数据结合起来，这为接下来的分析节省了时间。<br>QGIS中的组统计插件是非常简洁的，就像是在QGIS中内嵌的一个表格生成器一样。列代表统计的种类（平均值、最小值、变化幅度等），行是绝对字段如各种地名或者水域。添加一个字段并且进行计算，瞧，表格就生成了。<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdn.net/20160914221428452" alt="GroupStats" title>                </div>                <div class="image-caption">GroupStats</div>            </figure><br>当你能够理解文章中的晦涩概念的时候，你就理解了我这篇文章。ArcGIS更胜一筹因为其引导式的地理统计。</p><h3 id="11-使用QGIS的遥感工具箱时你能拥有X射线的视野"><a href="#11-使用QGIS的遥感工具箱时你能拥有X射线的视野" class="headerlink" title="11.使用QGIS的遥感工具箱时你能拥有X射线的视野"></a>11.使用QGIS的遥感工具箱时你能拥有X射线的视野</h3><p>在寂静的外太空，卫星在轨道上运行并使用多光谱传感器获取地面影像。例如Sentinel2a和Landset-8生产的卫星影像在GIS分析中得到了大量使用。<br>QGIS和ArcGIS都提供了大量的遥感工具。其中一些是手动工具，像chisel，能量分析工具像electric drill。<br>QGIS的半导体自动分类插件能让你下载Landset影像并且自动分类。欧菲奥工具箱（Orfeo toolbox）提供了从滤波、处理和操作栅格数据的工具。Lastools可以处理LiDAR数据。<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdn.net/20160914221703370" alt="Semi-Automatic Classfication Plugin" title>                </div>                <div class="image-caption">Semi-Automatic Classfication Plugin</div>            </figure><br>当ArcGIS10.1添加了图像分析工具箱的时候，它自带了遥感分析工具，提供采样、监督和非监督分类功能、融合、计算NDVI、正射纠正、亮度对比度透明度调整等等功能。Las数据集是一个处理LiDAR数据的尴尬的中间媒介，还有许多工作需要完成。<br>那么QGIS在遥感处理领域更胜一筹。</p><h3 id="12-使用ArcGIS设计你下一次的钓鱼路线"><a href="#12-使用ArcGIS设计你下一次的钓鱼路线" class="headerlink" title="12.使用ArcGIS设计你下一次的钓鱼路线"></a>12.使用ArcGIS设计你下一次的钓鱼路线</h3><p>在日常生活中，几乎每个人都有规划路径的体验。</p><ul><li>最近的啤酒店在哪儿？</li><li>去这个啤酒点的最短路线是什么？<br><img src="https://img-blog.csdn.net/20160914221932989" alt="路线规划"></li></ul><p>在ArcGIS中，只需要打开网络分析功能，把数据集加入，建立简单的拓扑关系可能稍微有点难度，但完成之后你就可以准备出发了。<br>使用“道路图”插件，QGIS计算最短路径。QGIS缺少一些ArcGIS网络分析中的一些工具-位置分配、新OD成本矩阵等<br>ArcGIS网络分析扩展工具是顶级水准。</p><h3 id="13-使用ArcGIS模型建立器指导工作流"><a href="#13-使用ArcGIS模型建立器指导工作流" class="headerlink" title="13.使用ArcGIS模型建立器指导工作流"></a>13.使用ArcGIS模型建立器指导工作流</h3><p>你曾经想过使用画图式的方法建立自动工作的工作流吗？<br>想一下：当你按照安排好的模型运行任务的时候，即使你一整天都躺在卧室也能完成工作。ArcGIS的模块建立器是最直观，模块化，实用的自动的地理处理工作的实现方法。<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdn.net/20160914222018146" alt="ArcGIS Model-Builder" title>                </div>                <div class="image-caption">ArcGIS Model-Builder</div>            </figure><br>把一系列的工具在建立器中串接起来，然后就可以实现自动处理了。只是简单地把模块拖出来按照流程图一样把他们串起来就好了，十分简单。再进一步：把你的模型导出并且分享给别人，或者导出成<a href="http://lib.csdn.net/base/11" target="_blank" rel="noopener">Python</a>代码并且修改它。<br>ArcGIS脚本都通过Arcpy模块工作,在Arcpy中编写代码是非常地简单的，基本上ArcGIS中的所有工具在其中都有同样名字的引用脚本，你可以在Esri的网站上找到并且粘贴使用。一切都是自动的。QGIS中也有和ArcGIS中模型建立器一样的工具，叫做图形式模块。<br>你可以像画图一样把一系列的模块按照一定的顺序拖动。不过，QGIS在使用这个模块的时候经常会崩溃，所以最好提前保存一下。<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdn.net/20160914222256435" alt="QGIS Model" title>                </div>                <div class="image-caption">QGIS Model</div>            </figure><br>对于QGIS来说，你可以使用PyQGIS模块和GDAL，你也可能会用到其他工程提供的大量模块。尽管存在各种bug，你还是可以得到你想要的结果。<br>我们喜欢模型建立器，我们喜欢Arcpy，这是ArcGIS的两个闪光点。</p><h3 id="14-在ArcGIS和QGIS中设计一个制图杰作"><a href="#14-在ArcGIS和QGIS中设计一个制图杰作" class="headerlink" title="14.在ArcGIS和QGIS中设计一个制图杰作"></a>14.在ArcGIS和QGIS中设计一个制图杰作</h3><p>开源怀疑者认为ArcGIS才是做出漂亮地图的唯一工具。但是QGIS也是一个可行的优秀制图工具。QGIS地图接口叫做“印刷工”，它简直就像是一个独立的应用程序一样。但是当你一旦在图层上加入符号和特征以后，你就会发现QGIS是制图的理想工具。<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdn.net/20160914222329978" alt="print" title>                </div>                <div class="image-caption">print</div>            </figure><br>ArcGIS的制图工具就是教你使用各种模板并导出地图产品。ArcGIS可以将其导出成为各种格式，如PDF,JPG,SVG,AI,PNG,EPS和EMF。ArcGIS制图工具是非常实用的。它可以非常容易地精确指定你的标签，使用简单的矩形连接数据框架。<br>我们认为QGIS和ArcGIS都达到了制图目的。</p><h3 id="15-在QGIS中使用符号"><a href="#15-在QGIS中使用符号" class="headerlink" title="15.在QGIS中使用符号"></a>15.在QGIS中使用符号</h3><p>ArcGIS的启动画面非常漂亮，我们喜欢各种被严格定义的符号，它们使得点线面状地物更加生动。ArcMap中的符号真的非常漂亮、有用和充足。<br>QGIS在这方面就略显不足。当然，在某些方面QGIS还是不错的，比如铁路和阴影多边形。而且，你可以从互联网上下载并且加载符号模板。QGIS强力推荐的一个功能是其ps式的填充选项。具有一个远超符号库的混合选项：淡化、全屏、躲避、加深、复制、燃烧（burn）、覆盖、轻微变亮、差异。<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdn.net/20160914222358889" alt="options" title>                </div>                <div class="image-caption">options</div>            </figure><br>梯度填充使得QGIS对于制图员来说非常的轻松。你可以使用两个或多个颜色简单地创造梯度。添加不同的种类的梯度计算方式：线性式、辐射式、圆锥式。QGIS的图层样式文件可以保存为.qml格式。而且更好的消息是颜色拾取器能够让用户手动选择颜色，而不用苦逼地输入rgb数字了。<br>QGIS有一些非常高级的符号，ArcGIS非常的实用。二者再次打平。</p><h3 id="16-在QGIS中设计漂亮的标签和标注"><a href="#16-在QGIS中设计漂亮的标签和标注" class="headerlink" title="16.在QGIS中设计漂亮的标签和标注"></a>16.在QGIS中设计漂亮的标签和标注</h3><p>在QGIS中添加标签是很方便的。QGIS的样式水平达到了一个新的高度。</p><ul><li>文字边缘添加了缓冲区（更好看）</li><li>为样式点添加了后置阴影</li><li>设置透明度、混合样式和偏移<br><img src="https://img-blog.csdn.net/20160914222500651" alt="labels"></li></ul><p>这些不易察觉的改变让标签变得更加美观。<br>而ArcGIS中的标签不如一些QGIS美观，你可以使用ArcGIS中的图像标签引擎来放置标签。获得想要添加标签特征的图层的控制权，设置标签的位置和比例尺。设置曲线标签和平行标签在ArcGIS中是很容易的。它非常智能。<br>画图工具箱在ArcGIS中控制着注释组。为注记设置一个单独的工具箱也许不是很直观。但是只要稍许练习你就能调整注记的组归属。<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdn.net/20160914222555246" alt="place" title>                </div>                <div class="image-caption">place</div>            </figure><br>QGIS凭借其漂亮的标签更胜一筹。但是注记和属性的放置方面ArcGIS更加优秀。<br>为了对质量负责我只能先发一半了=.=,各位大大原谅我…..</p><p>本文续借上一篇译文</p><h3 id="17-使用数据驱动框自动地组织制图"><a href="#17-使用数据驱动框自动地组织制图" class="headerlink" title="17.使用数据驱动框自动地组织制图"></a>17.使用数据驱动框自动地组织制图</h3><p>如果你正在制作一幅图，你肯定需要用到ArcGIS中的数据驱动框，它是你自动生产地图的得力工具。数据驱动框是在相互独立的不同图层页面之间进行切换的工具。制图员们经常使用数据驱动框和制图工具箱来完成制图过程。<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdn.net/20160921160708843" alt="Data Driven Pages" title>                </div>                <div class="image-caption">Data Driven Pages</div>            </figure><br>制图工具箱是用来制作带状的地图的，如果你的地图横跨多个投影，需要使用UTM区域计算工具。<br>QGIS的开发人员在程序中集成了一个非常好用的地图集切换工具箱。<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdn.net/20160921160750869" alt="Atlas-Toolbar" title>                </div>                <div class="image-caption">Atlas-Toolbar</div>            </figure><br>选中图层中包含的一些地理图形和字段，使用地图集生成工具，会得到一个新的只包含这些地理图形和字段的页面。与地理图形想关联的字段比如文字标签等都可以被使用。<br>地图集切换工具的功能很强大，QGIS和ArcGIS的数据驱动框都很棒。</p><h3 id="18-在ArcGlobe和ArcScene中观看三维场景"><a href="#18-在ArcGlobe和ArcScene中观看三维场景" class="headerlink" title="18.在ArcGlobe和ArcScene中观看三维场景"></a>18.在ArcGlobe和ArcScene中观看三维场景</h3><p>是时候告别二维平面世界，而走向三维了。<br>ArcGlobe和ArcScene都是标准独立的三维分析扩展程序，能够展示一个三维的立体世界。ArcScene用于小型场景的研究，可以通过竖轴因子调节物体的高度。<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdn.net/20160921163528007" alt="ArcScene" title>                </div>                <div class="image-caption">ArcScene</div>            </figure><br>ArcGlobe则是展示全球数据的良好媒介，支持模拟飞行地对地浏览。<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdn.net/20160921163819214" alt="ArcGlobe" title>                </div>                <div class="image-caption">ArcGlobe</div>            </figure><br>当然，使用这些模块需要一个三维分析的许可。<br>虽然QGIS本身缺乏一个像样的三维模块，但Qgis2threejs插件可以以三维形式展现场景。该插件可以向你的浏览器中导出地形数据，三维地图遮盖图和矢量数据。<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdn.net/20160921163923872" alt="QGIS 3DViewer" title>                </div>                <div class="image-caption">QGIS 3DViewer</div>            </figure><br>但是别觉得这个插件能够像ArcGlobe和ArcScene那样强大，ArcGIS的三维功能还是要比QGIS强太多了。</p><h3 id="19-设计一个宏大的网页地图来讲述故事"><a href="#19-设计一个宏大的网页地图来讲述故事" class="headerlink" title="19.设计一个宏大的网页地图来讲述故事"></a>19.设计一个宏大的网页地图来讲述故事</h3><p>网页地图正在蓬勃发展。许多政府和企业应用网页地图来讲述宏大的史诗故事。<br>在ArcGIS中设计网页地图是很简单的，制图员只需要通过ArcGISOnline把数据发送到网页上就可以了。ArcGIS Online for webmaps是这些在线地图在Esri的地理信息云中的存储位置。<br>而且更为方便的是ArcGIS推出的ArcGIS story maps，它能够非常方便地帮助我们利用地图讲述我们的故事。<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdn.net/20160921164033759" alt="ArcGIS-Webmap" title>                </div>                <div class="image-caption">ArcGIS-Webmap</div>            </figure><br>QGIS服务器提供WMS（网页地图服务），该服务与QGIS桌面端使用同样的库。所以QGIS桌面端提供的地图和打印模板只需要简单地将QGIS的工程文件复制到服务端文件夹就能够以网页地图的形式发布了。<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdn.net/20160921164140860" alt="QGIS-Webmap" title>                </div>                <div class="image-caption">QGIS-Webmap</div>            </figure></p><h3 id="20-使用ArcGIS-animations来动态展现数据"><a href="#20-使用ArcGIS-animations来动态展现数据" class="headerlink" title="20.使用ArcGIS animations来动态展现数据"></a>20.使用ArcGIS animations来动态展现数据</h3><p>你有没有想过动态地展现你的数据？<br>直观地看到北极冰雪随时间融化，展现全球的气候变化。ArcGIS中的动画工具箱使得数据从静态的变成动态的。各种地理信息随时间的变化可以在ArcGIS中非常容易的展现出来。<br>如果你有一个时间相关的字段，只需要将时间轴从左拖到右就能够直观地看出你的数据随时间的变化。当然，这需要一些并不繁重的准备工作（如填写字段），之后你就可以把生成的动画导出为影音格式让你的老板印象深刻。<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdn.net/20160921164318010" alt="Time-Series-Animation" title>                </div>                <div class="image-caption">Time-Series-Animation</div>            </figure><br>时间管理插件为QGIS添加了时间控制功能。你可以使用时间控制器让矢量特征随时间属性而变化。该时间控制器还支持实验栅格层和两点之间插值。你可以直接在地图窗口创造动画并且导出图像序列。<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdn.net/20160921164347713" alt="Time-Manager-QGIS" title>                </div>                <div class="image-caption">Time-Manager-QGIS</div>            </figure></p><h3 id="21-制造颜色编码的主题地图"><a href="#21-制造颜色编码的主题地图" class="headerlink" title="21.制造颜色编码的主题地图"></a>21.制造颜色编码的主题地图</h3><p>社会科学家经常制作专题图，来展现一些与地理区域相关的特殊主题。<br>QGIS为制作专题地图提供了一系列的工具：渐变色、渐变符号、比例符号和密集点，以及线状、块状和专栏的数据化符号、直方图和文本流程图等等。<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdn.net/20160921164543271" alt="Equal-Interval-Classification" title>                </div>                <div class="image-caption">Equal-Interval-Classification</div>            </figure><br>QGIS中有一个非常独特的工具：热力图。根据一个点集立刻创建出一个矢量的热力图。热力图渲染工具修正半径、色差、透明度和融合模式，最后在点图层产生一个动态的热力图。<br>你可以在QGIS中通过“设置列描述”或者“规则描述”来使众多字段符号化。而在ArcGIS中，使用“唯一值，多字段”也可以轻松达到类似的效果。点云图和大量图表是ArcMap的独一无二的优势。<br>QGIS和ArcGIS都具有良好的专题图制作功能。</p><h3 id="22-使用ArcMap的高级编辑工具创造一览无余的详细编辑"><a href="#22-使用ArcMap的高级编辑工具创造一览无余的详细编辑" class="headerlink" title="22.使用ArcMap的高级编辑工具创造一览无余的详细编辑"></a>22.使用ArcMap的高级编辑工具创造一览无余的详细编辑</h3><p>ArcGIS和QGIS的编辑功能稍有不同。<br>比如，你在QGIS中点击右键完成快速的矢量创建，而在ArcGIS中则需要双击。你会觉得单击右键是很方便而且不易出错的，而双击则容易在绘制大量矢量的时候出现不必要的错误。<br>QGIS提供一系列编辑工具如图形改造、切割和追踪还可以删除要素中的一部分形成一个环。使用捕捉选项可以捕捉要素点。QGIS的cad工具插件提供了13个高级工具，其中一个闪亮点是撤销编辑。在ArcMap中只能在进行矢量编辑的时候进行回退。<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdn.net/20160921165203185" alt="QGIS-Toolbar" title>                </div>                <div class="image-caption">QGIS-Toolbar</div>            </figure><br>在ArcMap中创建数据是相当轻松的，ArcGIS有许多高级编辑的选项。你可以通过要素模板创建一个新的要素。高级编辑还包括多块型要素打碎，曲线剔除、修剪或扩张，替换图形等。ArcMap中的边界追踪工具真得非常棒。<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdn.net/20160921165052809" alt="Editor-Toolbar" title>                </div>                <div class="image-caption">Editor-Toolbar</div>            </figure></p><h3 id="23-拓扑关系不是问题"><a href="#23-拓扑关系不是问题" class="headerlink" title="23.拓扑关系不是问题"></a>23.拓扑关系不是问题</h3><ul><li>这个点在多边形上吗</li><li>是否存在覆盖呢</li><li>这些线是否与多边形边界重合了？</li></ul><p>我所能想到的，能够描述ArcGIS中拓扑功能的词就是：完美。如果你担心你的地理信息数据有错误（重叠、缝隙等），ArcGIS提供一个丰富、完整的拓扑关系错误检查工具。它将对你的数据进行超过三十种规则的检查，来保证拓扑关系的正确。<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdn.net/20160921165336061" alt="ArcGIS-Topology" title>                </div>                <div class="image-caption">ArcGIS-Topology</div>            </figure><br>一旦你的数据被导入地理<a href="http://lib.csdn.net/base/14" target="_blank" rel="noopener">数据库</a>中，你就可以创建拓扑关系了。<br>QGIS包含一系列拓扑规则：“必须包含”、“绝不能重叠”、“绝不能有缝隙”、“绝不能有无效图形”、“绝不能有多区域型图形”、“觉不能覆盖”和“绝不能覆盖XX”。你可以用这些规则检查地理图形，但你如何修正它？<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdn.net/20160921165304138" alt="QGIS-Topology" title>                </div>                <div class="image-caption">QGIS-Topology</div>            </figure><br>ArcGIS的拓扑修正是交互式的，你可以一个接一个地查看错误并修正它们。<br>拓扑检查和修正编辑功能是ArcGIS的一个闪光点。</p><h3 id="24-以工程的形式表现数据记录"><a href="#24-以工程的形式表现数据记录" class="headerlink" title="24.以工程的形式表现数据记录"></a>24.以工程的形式表现数据记录</h3><p>QGIS和ArcGIS都拥有精简的地理数据记录管理机制，他们都提供相似的功能。<br>当你在QGIS中创建一个shapefile的时候，你需要立刻设定一些字段（文本、小数或者日期）。使用ArcGIS的时候你可以之后再创建字段-除非你是在ArcCatalog中。<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdn.net/20160921165449514" alt="atrribute-table-exmaple" title>                </div>                <div class="image-caption">atrribute-table-exmaple</div>            </figure><br>在QGIS中创建字段以后，你可以使用表管理插件重新命名它们。也许你认为在ArcGIS中不得不重新建立一个字段并把原来字段的值拷贝过来，其实数据管理功能中的“替换字段”可以完成这个过程。<br>在地理数据库中，用户可以设置数据记录的类型、归属和默认值，当用户开始输入属性信息的时候，可以使用下拉列表来选择。当地理信息统计出现问题时常使用这种方法来寻找无效的数据记录。<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdn.net/20160921165543940" alt="Domain-ArcGIS" title>                </div>                <div class="image-caption">Domain-ArcGIS</div>            </figure><br>通过地理位置的搜索功能通过交互式的选择工具已经有了很大提高。当记录被选中的时候，他们就被过滤出来了（并可以添加和移除）。字段计算工具支持<a href="http://lib.csdn.net/base/11" target="_blank" rel="noopener">Python</a>和VB脚本。<br>ArcGIS中必须停止编辑才能进行字段计算是广为诟病的。</p><h3 id="25-通过地理编码确定XY坐标"><a href="#25-通过地理编码确定XY坐标" class="headerlink" title="25.通过地理编码确定XY坐标"></a>25.通过地理编码确定XY坐标</h3><p>地理编码是给予街道地址XY坐标的过程。<br>地理编码可以通过ArcGIS Online Geocoding来实现。这是一个付费服务而且需要使用执照。<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdn.net/20160921170215403" alt="ArcGIS Online Geocoding" title>                </div>                <div class="image-caption">ArcGIS Online Geocoding</div>            </figure><br>ArcGIS桌面程序有其自己的方式来实现对你的数据进行地理编码<br>。只需要通过地理编码工具箱就可以找到目标的地理，再添加一个标签，你就完成了位置的标识。<br>如果你不想看到填满标识信息的表格，在QGIS中你有两种不错的选择。MMQGIS是一个很好的批量地理编码的工具，它支持包含地址信息的独立表格格式的数据，并把它们在地图中以点的形式标识出来。<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdn.net/20160921170308345" alt="QGIS-Geocoding" title>                </div>                <div class="image-caption">QGIS-Geocoding</div>            </figure><br>地理编码插件需要先输入地址，然后点击ok,瞧，地点就在地图上标出来了。<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdn.net/20160921170409033" alt="Geocoding Result" title>                </div>                <div class="image-caption">Geocoding Result</div>            </figure><br>五五开，平手！<br>我们不想为地理编码增加预算了，使用QGIS简单又实惠。</p><h3 id="26-使用数据转化工具替换地理图形"><a href="#26-使用数据转化工具替换地理图形" class="headerlink" title="26.使用数据转化工具替换地理图形"></a>26.使用数据转化工具替换地理图形</h3><p>要素图形化对于制图员来说是经常要用到的，但是替换要素却不是那么容易。但是在QGIS中，就不会很麻烦。<br>在QGIS中，你可以把线段转化成多边形，点转多边形或者任意两者之间的转化。<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdn.net/20160921180732195" alt="QGIS-conversion" title>                </div>                <div class="image-caption">QGIS-conversion</div>            </figure><br>在ArcMap中，你也许需要一个高级的许可来完成数据转化的功能。QGIS有一些相当酷的常规化工具：简化线、统计点和多边形。</p><h3 id="27-ArcGIS的文档相当详尽"><a href="#27-ArcGIS的文档相当详尽" class="headerlink" title="27.ArcGIS的文档相当详尽"></a>27.ArcGIS的文档相当详尽</h3><p>ArcGIS的文档非常棒。ArcGIS不仅提供工具的使用文档，还提供了一些示例数据让你实际操作一遍。<br>这并不代表QGIS的文档不好，它也提供了很多信息，也写的很规范，很实用，但它就是没有ArcGIS的文档好。<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdn.net/20160921180859618" alt="Geonet" title>                </div>                <div class="image-caption">Geonet</div>            </figure><br>Esri有Geonet，而QGIS又GIS Stack Exchange作为社区。<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdn.net/20160921180918187" alt="GIS-stack-exchange" title>                </div>                <div class="image-caption">GIS-stack-exchange</div>            </figure><br>QGIS的支持非常活跃，一个非常专注的志愿社区支持着QGIS项目，而ArcGIS的社区则主要是雇员和用户。<br>他们都提供了问题反馈的场所和手段。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>地理信息系统的设计的核心需求仅仅只有4个：创建地理数据、管理它、分析它并显示它。现有的软件都能够很好地完成这些基本功能。<br>所以说QGIS和ArcGIS并无一定的高下之分。<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://img-blog.csdn.net/20160921180954822" alt="QGIS-vs-ArcGIS-small" title>                </div>                <div class="image-caption">QGIS-vs-ArcGIS-small</div>            </figure><br>QGIS是免费的，而且有众多语言的支持。依赖于志愿者的努力，QGIS的社区十分活跃。你使用的越多，令你惊奇的发现也就越多：交互式的组状态表，支持csv的快捷导入，令人惊愕的制图符号和标记选项等等。<br>ArcGIS几乎是最好的GIS软件。它是可以扩展的，而且有全世界最大的用户社区。它提供样例数据和使用教程来帮助你获得实际操作的经验。模块设计器和自动化运行是顶级的功能，各各具特色的ArcGIS拓展软件也为其增光添彩。<br>但也许一个不懂行的人会问：ArcGIS赢在哪儿了？QGIS有什么优点吗？</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;转载&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://blog.csdn.net/sf2gis2/article/details/54864292?utm_medium=distribute.pc_aggpage_search_resul
      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>python入门</title>
    <link href="http://11wy11.github.io/2020/10/06/python-getting-start-1/"/>
    <id>http://11wy11.github.io/2020/10/06/python-getting-start-1/</id>
    <published>2020-10-06T08:31:16.000Z</published>
    <updated>2021-03-12T08:43:56.159Z</updated>
    
    <content type="html"><![CDATA[<p>python 安装使用tesseract，完成验证码图像识别；使用ssenium下载Chromedriver 模拟浏览器<br><a id="more"></a></p><h3 id="pytesseract-tesseror"><a href="#pytesseract-tesseror" class="headerlink" title="pytesseract/tesseror"></a>pytesseract/tesseror</h3><p>tesseract 下载地址：<a href="https://digi.bib.uni-mannheim.de/tesseract/" target="_blank" rel="noopener">https://digi.bib.uni-mannheim.de/tesseract/</a></p><p>遇到的问题:</p><p>1.FileNotFoundError: [WinError 2] 系统找不到指定的文件</p><p>解决方法:</p><p>方法1[推荐]: 将tesseract.exe添加到环境变量PATH中，</p><p>例如: D:\Tesseract-OCR,默认路径为C:\Program Files (x86)\Tesseract-OCR</p><p>注意: 为了使环境变量生效，需要关闭cmd窗口或是关闭pycharm等ide重新启动</p><p>方法2: 修改pytesseract.py文件，指定tesseract.exe安装路径</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># CHANGE THIS IF TESSERACT IS NOT IN YOUR PATH, OR IS NAMED DIFFERENTLY</span><br><span class="line">tesseract_cmd = &apos;C:\\Program Files (x86)\\Tesseract-OCR\\tesseract.exe‘</span><br></pre></td></tr></table></figure><p>方法3:  在实际运行代码中指定</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pytesseract.pytesseract.tesseract_cmd = &apos;D:\\Tesseract-OCR\\tesseract.exe&apos;</span><br></pre></td></tr></table></figure><p>2.pytesseract.pytesseract.TesseractError: (1, ‘Error opening data file \Tesseract-OCR\tessdata/eng.traineddata’)</p><p> 解决方法:</p><p>方法1[推荐]: </p><p>将tessdata目录的上级目录所在路径(默认为tesseract-ocr安装目录)添加至TESSDATA_PREFIX环境变量中</p><p>例如: C:\Program Files (x86)\Tesseract-OCR</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Please make sure the TESSDATA_PREFIX environment variable is set to the parent directory of your &quot;tessdata&quot; directory.</span><br></pre></td></tr></table></figure><p>方法2:  在.py文件配置中指定tessdata-dir</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">tessdata_dir_config = &apos;--tessdata-dir &quot;D:\\Tesseract-OCR\\tessdata&quot;&apos;</span><br><span class="line"># tessdata_dir_config = &apos;--tessdata-dir &quot;&apos;C:\\Program Files (x86)\\Tesseract-OCR\\tessdata&quot;&apos;</span><br><span class="line">pytesseract.image_to_string(image, config=tessdata_dir_config)</span><br></pre></td></tr></table></figure><h3 id="sessnium"><a href="#sessnium" class="headerlink" title="sessnium"></a>sessnium</h3><h4 id="环境安装"><a href="#环境安装" class="headerlink" title="环境安装"></a>环境安装</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">python+selenium+pycharm+webdriver </span><br><span class="line">1、 python安装包:https://www.python.org/getit/ </span><br><span class="line">2、 PyCharm 安装包:http://www.jetbrains.com/pycharm/download/ </span><br><span class="line">3、 Selenium安装包:https://pypi.python.org/pypi/selenium </span><br><span class="line">     selenium安装方式一: 安装python包，选择全部组件(pip、安装过程中配置环境变量) 然后执行pip install -U selenium 联网安装Selenium; </span><br><span class="line">     安装方式二: 安装python包，选择全部组件(pip、安装过程中配置环境变量) 解压selenium-3.13.0.tar.gz，然后用cmd进入解压目录，使用命令 Python setup.py install 安装Selenium。 </span><br><span class="line">4、 webdriver配置(以chromedriver为例): </span><br><span class="line">Chromedriver下载地址：http://npm.taobao.org/mirrors/chromedriver/ ***版本与浏览器版本保持一致</span><br><span class="line"> </span><br><span class="line">配置方式一: 1)把下载好的chromedriver.exe程序放置到python的安装路径下 2)在python中代码编写如下即可:</span><br><span class="line">driver = webdriver.Chrome() # Firefox、Ie、Edge等</span><br><span class="line">配置方式二: 1)把下载好的chromedriver.exe程序放置到python项目中(其它路径也可) 2)在python中代码编写如下即可:</span><br><span class="line">chromePath = chromedriver.exe路径 os.environ[‘webdriver.chrome.driver’] = chromePath # gecko ie等</span><br><span class="line">driver = webdriver.Chrome(executable_path=chromePath) # Firefox、Ie等</span><br></pre></td></tr></table></figure><p>安装后需要，下载对应的Chromedriver驱动<a href="https://sites.google.com/a/chromium.org/chromedriver/downloads/version-selection" target="_blank" rel="noopener">https://sites.google.com/a/chromium.org/chromedriver/downloads/version-selection</a></p><p>使用webDriver API</p><p><a href="https://selenium-python.readthedocs.io/api.html#module-selenium.webdriver.common.action_chains" target="_blank" rel="noopener">https://selenium-python.readthedocs.io/api.html#module-selenium.webdriver.common.action_chains</a></p><h4 id="识别元素"><a href="#识别元素" class="headerlink" title="识别元素"></a>识别元素</h4><p><strong>三、识别元素</strong></p><ol><li><p>基本元素定位</p><p>driver.find_element_by_id(<code>&#39;id_value&#39;</code>).send_keys(<code>&#39;最新疫情咨讯&#39;</code>)  #通过id定位<code>driver.find_element_by_name(</code>‘name_value’<code>).send_keys(</code>‘最新疫情咨讯’<code>)  #通过name定位</code>driver.find_element_by_class_name(<code>&#39;class_name_value&#39;</code>).send_keys(<code>&#39;最新疫情信息&#39;</code>)  #通过<code>class</code>元素定位</p><p>driver.find_element_by_tag_name(<code>&#39;input&#39;</code>).send_key(<code>&#39;最新疫情咨讯&#39;</code>)  #通过tag_name定位，&lt;缺点：tag_name值不唯一&gt;</p><p><code>driver.find_element_by_link_text(</code>‘新闻’<code>).click()   #link_text链接中的文本  &lt;缺点：只对标签生效&gt;</code></p><p>driver.find_element_by_partial_link_text(<code>&#39;新&#39;</code>).click()   #partial_link_text部分链接中的文本  &lt;缺点：只对标签生效&gt;</p></li><li><p>xpath定位元素</p></li></ol><h3 id="基本爬取下载数据"><a href="#基本爬取下载数据" class="headerlink" title="基本爬取下载数据"></a>基本爬取下载数据</h3>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;python 安装使用tesseract，完成验证码图像识别；使用ssenium下载Chromedriver 模拟浏览器&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="python" scheme="http://11wy11.github.io/categories/python/"/>
    
    
      <category term="python" scheme="http://11wy11.github.io/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>360前端星计划学习笔记（一）</title>
    <link href="http://11wy11.github.io/2020/04/08/360-learn-note-1/"/>
    <id>http://11wy11.github.io/2020/04/08/360-learn-note-1/</id>
    <published>2020-04-08T12:40:47.000Z</published>
    <updated>2020-09-19T08:18:54.179Z</updated>
    
    <content type="html"><![CDATA[<p>360前端星计划学习笔记（一）HTML&amp;前端&amp;CSS<br><a id="more"></a></p><h3 id="前端"><a href="#前端" class="headerlink" title="前端"></a>前端</h3><p>什么是前端：</p><p>使用Web技术栈解决多端的图形界面人机交互问题–360奇舞讲师团</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/04/08/360-learn-note-1/image-20200407154302122.png" alt="image-20200407154302122" title>                </div>                <div class="image-caption">image-20200407154302122</div>            </figure><p>&amp;lt!doctype html&amp;gt<br>渲染模式和HTML版本<br>HTML语法：标签和属性不区分大小写，推荐小写，可以不闭合，image /&gt;,属性值用双引号包裹，可省略。<br>文本标签<br>引用：blockquote长引用,cite作品名等短引用，q前文引用<br>强调：strong 强调突出，重要严重紧急，em重音，突出的词<br>内容划分：head nav main article aside(导航链接，推荐，广告等，不属于页面主要内容) footer<br>语义化：HTML中元素，属性，属性值都拥有某些含义。<br>谁在使用HTML，语义化好处<br>开发者：修改。维护页面-代码可读性，可维护性<br>浏览器：渲染页面<br>搜素引擎：提供关键词，排序-搜素引擎优化<br>屏幕阅读器：给盲人获得页面-提升无障碍性<br>传达内容，而不是样式<br>如何做到语义化：了解标签属性含义，思考什么标签最适合描述这个内容，尽量不用可视化工具生成代码而是手写代码</p><h3 id="CSS基础"><a href="#CSS基础" class="headerlink" title="CSS基础"></a>CSS基础</h3><p>Cascading style sheets</p><p>选择器 属性+属性值=声明<br>{；；} 声明块<br>选择器{；；} 规则<br>引入方式<br>外链（推荐，利于维护），嵌入，内联</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/04/08/360-learn-note-1/image-20200408101508689.png" alt="image-20200408101508689" title>                </div>                <div class="image-caption">image-20200408101508689</div>            </figure><p><strong>选择器Selector</strong></p><p>标签，类名，ID，DOM中的位置</p><p>通配选择器*</p><p>标签选择器：h1,p,img…</p><p>id 选择器：#ID值，唯一</p><p>类选择器：.done ,class的值可以多个，</p><p>属性选择器：eg.<input value="test" disabled> [disabled]</p><p>​    根据属性值选择 eg. input[type=”password”]</p><p>​    高级用法：a[href^=#]以#开头，$以什么结尾</p><p>伪类pseudo-classes</p><ul><li><p>不基于标签和属性定位元素</p></li><li><p>两种伪类：</p><ul><li><p>状态伪类  </p><p>a :link &amp;:visited &amp;:hover &amp;:active,input:focus</p></li><li><p>结构性伪类</p><p>li:first-child &amp;:last-child</p></li></ul></li></ul><p>组合器（combinator） </p><p>直接组合  AB 同时满足A，B input.error</p><p>后代组合 A B 选中B，如果它是A的<strong>子孙</strong> article p</p><p>亲子组合 A&gt;B 选中B，如果它是A<strong>的子元素</strong> article&gt;p</p><p>组合可多级</p><p>选择器组 </p><p><strong>设置文字样式</strong></p><ul><li><p>颜色：</p><p>#16进制</p><p>rgb:（0-255,0-255,0-255）</p><p>HSL:  (Hue色相 0-360；Saturation：饱和度0-100%；Lightness：亮度0-100%) eg. hsl(44,60%,50%)</p><p>颜色关键字：grey，black，white，</p><p> alpha 透明度 0-1，rgba，hsla</p></li><li><p>字体 font-family 一般指定多个字体的值，尽可能的保证在各种设备上都能显示。</p><ul><li>通用字体族：serif 某一类字体，sans-Serif 无衬线体（Arial,黑体），Fantasy(手写体)，Monospace（等宽字体，编辑器里一般用）</li><li>推荐：最后要写通用字体族；英文字体放在中文字体前面（中文一般包含英文字符，放在前面会无法使用英文）</li><li>Web Fonts  在服务器放置字体文件：.woff2,.ttf,<ul><li>中文字体文件一般比较大，会用字体处理工具，提取页面中用到的字符生成一个小的文件</li></ul></li></ul></li><li><p>字体大小font-size </p><ul><li>关键字：small middle large</li><li>长度：px em（相对于父元素 ）</li><li>百分比 相对于父元素</li></ul></li><li><p>font-style: normal itail</p></li><li><p>font-weight: 100-900,normal(400),bold(700),一般页面常用关键字，因为浏览器没有那么多字重的字体</p></li><li><p>line-height 行字体基线的距离：①px,②1.6 自身字体大小的倍数</p></li><li><p>font: style weight size family 可省略其他属性</p></li></ul><p><strong>设置对齐</strong></p><ul><li>text-align: left center right justify(两端分散对齐)</li><li>spacing ：letter-spacing 字母间间距，Word-spacing：词间距</li><li>text-indent : 首行文字缩进</li><li>text-decoration: none, underline, line-through, overline</li><li>white-space :空格和换行行为 normal 多空行合并一个，nowrap 不换行，pre 保留原有空格,空行，pre-wrap:只有显示不下换行 pre-line 保留原有空行</li></ul><h3 id="继承布局"><a href="#继承布局" class="headerlink" title="继承布局"></a>继承布局</h3><p>选择器的特异度（Specificity）</p><p>#nav .list li a:link 122</p><p>.hd ul.links a 022</p><p>高优先级会覆盖低优先级样式</p><p><strong>继承</strong></p><p>某些属性会自动继承其父元素的计算值，除非显式指定一个值</p><p>显示继承</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">* &#123;</span><br><span class="line"><span class="attribute">box-sizing</span>: inherit</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">html</span> &#123;</span><br><span class="line">    <span class="attribute">box-sizing</span>: border-box;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">some</span> &#123;</span><br><span class="line">    <span class="attribute">box-sizing</span>: content-box;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>初始值</strong></p><p><code>background-color :transparent</code></p><p><code>background-color: initial</code> 显示重置为初始值</p><p><strong>CSS 求值过程</strong></p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/04/08/360-learn-note-1/image-20200408110157615.png" alt="image-20200408110157615" title>                </div>                <div class="image-caption">image-20200408110157615</div>            </figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/04/08/360-learn-note-1/image-20200408110322465.png" alt="image-20200408110322465" title>                </div>                <div class="image-caption">image-20200408110322465</div>            </figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/04/08/360-learn-note-1/image-20200408110616811.png" alt="image-20200408110616811" title>                </div>                <div class="image-caption">image-20200408110616811</div>            </figure><ul><li>过滤：规则匹配</li><li>cascading层叠值:优先级排序</li><li>cascaded value=”” defaulting </li><li>resolving 将相对值，关键字转换为绝对值</li><li>computed Value 从代码上即能推断</li><li>formatting: 关键字，百分比转为绝对值 值 </li><li>使用值 进行实际时</li><li>constaining 400.2px -400px</li><li>实际值</li></ul><p><strong>布局Layout</strong></p><ul><li><p>盒模型</p><ul><li>content<ul><li>width content box 宽度，取值 长度，百分比，auto（由内容计算）</li><li>height 容器有指定的高度，百分数才生效，循环依赖是不会生效的</li></ul></li><li>padding</li><li>border<ul><li>三种属性<ul><li>border-width</li><li>border-style</li><li>border-color</li></ul></li><li>四个方向</li><li>可组合</li><li>绘制三角形等</li></ul></li><li>margin<ul><li>指定四个方向，值：长度，百分数(相对于容器的宽度)，auto，</li><li>使用margin: auto 水平居中</li><li>margin collapse：折叠，垂直方向，取较大的值，负值是绝对值的大小</li></ul></li><li>box-sizing: border-box<ul><li>指定的宽度包含border和padding的宽度</li></ul></li><li>overflow: visible hidden scroll</li></ul></li><li><p>块级</p><p>Block Level Box 不和其他盒子并列摆放</p><ul><li><p>块级元素 生成块级盒子</p><ul><li><p>body，article，div，main，section，h1-6p ul li</p></li><li><p>display:block</p></li></ul></li></ul></li><li><p>行级</p><p>Inline Level Box 放置一行或拆分多行</p><ul><li><p>行级元素 生成行级盒子，内容分散在多个行盒</p><ul><li><p>span em string cite code</p></li><li><p>display:inline</p></li></ul></li></ul></li><li><p>常规流</p><p>​    根元素、浮动和绝对定位的元素会脱离常规流</p><p>   其他元素都在常规流之内</p><p><img src="/2020/04/08/360-learn-note-1/image-20200408112713506.png" alt="image-20200408112713506"></p><ul><li><p>块级Block Formatting Context (BFC)</p><p>流的容器 新的流摆放布局内容</p><ul><li>根元素</li><li>浮动、绝对定位、inline-block</li><li>Flex和Grid子项</li><li>overflow值不为visible的块盒</li><li>内部排版规则<ul><li>盒子从上到下</li><li>垂直margin合并</li><li>内部盒子的margin不会与外面合并</li><li>不会和浮动元素重叠</li></ul></li></ul></li><li><p>行级上下文Inline Formatting Context (IFC)</p><ul><li>只包含行级盒子的容器会创建IFC</li><li>排版规则<ul><li>text-aligin vertical-aligin</li><li>避开浮动元素</li></ul></li></ul></li><li><p>table</p></li><li><p>flex</p><ul><li>display: flex</li><li>一种新的排版上下文</li><li>摆放的流向flex-direction: row,row-reverse,column,column-reverse</li><li>摆放顺序 order</li><li>盒子宽高</li><li>水平垂直对齐</li><li>flexibility 弹性<ul><li>可以设置子项的弹性，有剩余空间</li><li>flex-grow  扩展能力 都是1 内容的多的基准多，更宽一些</li><li>flex-shrink 收缩能力 flex-shrink:0不具备收缩能力</li><li>flex-basis 基本值展示 可以覆盖width，关键字：content 内容的宽度</li><li>flex 合并上述三个属性 flex: 1 1 auto</li></ul></li><li>flex-wrap nowrap,wrap</li><li>主轴 justify-content: flex-start, flex-end,center,space-between,space-around,space-evenly 相等的空格区分开</li><li>侧轴 align-items strentch(default 占满容器高度 )，baseline基线对齐<ul><li>子元素特殊对齐align-self</li></ul></li></ul></li><li><p>grid</p><p>​    二维布局方式，划分网格</p><p>   display：grid </p><ul><li><p>grid-template</p><ul><li>grid-template-columns: 30% 30% auto/100px 1fr 1fr (剩下的两列平分)</li><li>grid-template-rows :  100px auto/ 100px 1fr(剩余)</li></ul></li><li><p>设置子元素占用网格行列</p><ul><li><p>网格线    1 1 2, 3, 4</p><p>​                2            </p></li><li><p>网格区域  grid-area 1/1/3/3</p></li></ul></li></ul></li></ul></li><li><p>浮动</p><ul><li>文字环绕图片</li></ul></li><li><p>绝对定位</p><ul><li>position </li><li>static 非定位元素 默认值</li><li>relative 不脱离文档流，相对于自身进行偏离</li><li>absolute 脱离常规流，不会对流内元素产生影响，相对于非static的祖先元素</li><li>fixed 相对于浏览器窗口定位，不随页面滚动发生位置变化</li></ul></li></ul><h3 id="变形"><a href="#变形" class="headerlink" title="变形"></a>变形</h3><p><strong>transform</strong> 可设置多种变形函数</p><ul><li><p>translate 位移 元素移动不影响其他元素，按照自身原来位置进行计算摆放</p></li><li><p>transform-origin 设置原点，旋转中心,默认自身中心点</p></li><li><p>rotate 0.5turn 半圈 90deg</p></li><li><p>scale 自身坐标系</p></li><li><p>skew 倾斜</p></li><li><p>3d变形 </p><ul><li><p>perspective(100px)设置视角，人眼距离屏幕的距离</p><p>​    离屏幕更近，效果更明显</p></li><li><p>translate3d</p></li></ul></li></ul><p><strong>transition</strong> 过渡</p><ul><li>transition-property 指定哪些属性变化需要过渡</li><li>transition-duration 时间</li><li>transition-timing-function 快慢 linear ease,ease-in,ease-out, ease-in-out, steps</li><li>transition-delay 延迟</li></ul><p>@keyframes down{ from 50% to}关键帧</p><p>animation：关键帧名字 duration ease infinite(无限)</p><ul><li>animation–name</li><li>animation-duration 时间</li><li>animation–timing-function 快慢 </li><li>animation-delay 延迟</li><li>animation-iteration-count 次数</li><li>animation-direction 正序播放，逆序播放 <ul><li>normal: from&gt;to,alternate正反交替</li></ul></li></ul><h3 id="响应式布局"><a href="#响应式布局" class="headerlink" title="响应式布局"></a>响应式布局</h3><p><strong>viewport</strong> 通过meta设置视口 content=”width=device-width”</p><p><strong>图片尺寸设置</strong>：max-width: 100%</p><p><strong>背景图片：</strong></p><ul><li>background-size: cover 保证背景图片完整覆盖容器（展示内容类重要的图，商品图）</li><li>background-size: contain 把图片缩放到容器内，完整的显示出来（装饰背景）</li></ul><p><strong>media query</strong></p><p>​    @media screen and (min-width: 480px)</p><p><strong>使用不同尺寸的图片</strong> img srcset=”large.jpg 1200w” sizes=”(max-width:320px) 400px” src=”默认图片”</p><p><strong>字体大小</strong>：rem做单位，用@media调整根节点html的font-size</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;360前端星计划学习笔记（一）HTML&amp;amp;前端&amp;amp;CSS&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="前端" scheme="http://11wy11.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
      <category term="基础" scheme="http://11wy11.github.io/tags/%E5%9F%BA%E7%A1%80/"/>
    
  </entry>
  
  <entry>
    <title>css基础知识</title>
    <link href="http://11wy11.github.io/2020/04/05/css-base-knowledge-1/"/>
    <id>http://11wy11.github.io/2020/04/05/css-base-knowledge-1/</id>
    <published>2020-04-05T07:04:00.000Z</published>
    <updated>2020-12-04T11:44:27.755Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;

      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>前端基础复习-JavaScript-5</title>
    <link href="http://11wy11.github.io/2020/04/04/js-base-knowledge5/"/>
    <id>http://11wy11.github.io/2020/04/04/js-base-knowledge5/</id>
    <published>2020-04-04T15:07:00.000Z</published>
    <updated>2020-09-19T08:18:54.320Z</updated>
    
    <content type="html"><![CDATA[<p>前端自检清单JavaScript基础5–语法和API</p><a id="more"></a><h3 id="语法和API"><a href="#语法和API" class="headerlink" title="语法和API"></a>语法和API</h3><h4 id="1-理解ECMAScript和JavaScript的关系"><a href="#1-理解ECMAScript和JavaScript的关系" class="headerlink" title="1.理解ECMAScript和JavaScript的关系"></a>1.理解<code>ECMAScript</code>和<code>JavaScript</code>的关系</h4><p><code>JavaScript</code>包括核心语法，DOM，BOM，而核心语法实际上就是指ECMAScript，而JS又是不断在发展的, 而这个发展实际上最主要的就是ECMAScript版本的更新, 而DOM 和 BOM的更新较少, 因此, 可以认为 ECMAScript是JavaScript的参照, 而JavaScript是ECMAScript的一个实现. </p><p>例如ECMAScript2015简称ES6</p><h4 id="2-熟练运用es5、es6提供的语法规范"><a href="#2-熟练运用es5、es6提供的语法规范" class="headerlink" title="2.熟练运用es5、es6提供的语法规范"></a>2.熟练运用<code>es5</code>、<code>es6</code>提供的语法规范</h4><h4 id="3-熟练掌握JavaScript提供的全局对象（例如Date、Math）、全局函数（例如decodeURI、isNaN）、全局属性（例如Infinity、undefined）"><a href="#3-熟练掌握JavaScript提供的全局对象（例如Date、Math）、全局函数（例如decodeURI、isNaN）、全局属性（例如Infinity、undefined）" class="headerlink" title="3.熟练掌握JavaScript提供的全局对象（例如Date、Math）、全局函数（例如decodeURI、isNaN）、全局属性（例如Infinity、undefined）"></a>3.熟练掌握<code>JavaScript</code>提供的全局对象（例如<code>Date</code>、<code>Math</code>）、全局函数（例如<code>decodeURI</code>、<code>isNaN</code>）、全局属性（例如<code>Infinity</code>、<code>undefined</code>）</h4><h4 id="4-熟练应用map、reduce、filter-等高阶函数解决问题"><a href="#4-熟练应用map、reduce、filter-等高阶函数解决问题" class="headerlink" title="4.熟练应用map、reduce、filter 等高阶函数解决问题"></a>4.熟练应用<code>map</code>、<code>reduce</code>、<code>filter</code> 等高阶函数解决问题</h4><h4 id="5-setInterval需要注意的点，使用settimeout实现setInterval"><a href="#5-setInterval需要注意的点，使用settimeout实现setInterval" class="headerlink" title="5.setInterval需要注意的点，使用settimeout实现setInterval"></a>5.<code>setInterval</code>需要注意的点，使用<code>settimeout</code>实现<code>setInterval</code></h4><p>回调函数在计时之后才开始执行, 如果主线程执行时间过长，时间间隔未必准确，</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">myInterval</span>(<span class="params">callback,delay</span>)</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">interval</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        setTimeout(interval, delay);</span><br><span class="line">        callback();</span><br><span class="line">      &#125;</span><br><span class="line">      setTimeout(interval, delay)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="6-JavaScript提供的正则表达式API、可以使用正则表达式（邮箱校验、URL解析、去重等）解决常见问题"><a href="#6-JavaScript提供的正则表达式API、可以使用正则表达式（邮箱校验、URL解析、去重等）解决常见问题" class="headerlink" title="6.JavaScript提供的正则表达式API、可以使用正则表达式（邮箱校验、URL解析、去重等）解决常见问题"></a>6.<code>JavaScript</code>提供的正则表达式<code>API</code>、可以使用正则表达式（邮箱校验、<code>URL</code>解析、去重等）解决常见问题</h4><p>手机号码正则表达式<br>正则验证手机号，忽略前面的0，支持130-139，150-159。忽略前面0之后判断它是11位的。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/^<span class="number">0</span>*<span class="number">1</span>(<span class="number">3</span>|<span class="number">5</span>)\d&#123;<span class="number">9</span>&#125;$/</span><br></pre></td></tr></table></figure><p>使用正则表达式实现删除字符串中的空格</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">funtion trim(str) &#123;</span><br><span class="line">  <span class="keyword">let</span> reg = <span class="regexp">/^\s+|\s+$/g</span></span><br><span class="line">  <span class="keyword">return</span> str.replace(reg, <span class="string">''</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>限制文本框只能输入数字和两位小数点等等</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/^\d*\.\d&#123;<span class="number">0</span>,<span class="number">2</span>&#125;$/</span><br></pre></td></tr></table></figure><p>只能输入小写的英文字母和小数点，和冒号，正反斜杠(：./)</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/^[a-z\.:\/\\]*$/</span><br></pre></td></tr></table></figure><p>替换小数点前内容为指定内容<br>例如：infomarket.php?id=197 替换为 test.php?id=197</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/^[^\.]+/</span>;</span><br><span class="line"><span class="keyword">var</span> target = <span class="string">'---------'</span>;</span><br><span class="line">str = str.replace(reg, target)</span><br></pre></td></tr></table></figure><p>只匹配中文的正则表达式</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/[\u4E00-\u9FA5\uf900-\ufa2d]/ig</span><br></pre></td></tr></table></figure><p>返回字符串的中文字符个数<br>先去掉非中文字符，再返回length属性。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cLength</span>(<span class="params">str</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> reg = <span class="regexp">/[^\u4E00-\u9FA5\uf900-\ufa2d]/g</span>;</span><br><span class="line">  <span class="comment">//匹配非中文的正则表达式</span></span><br><span class="line">  <span class="keyword">var</span> temp = str.replace(reg,<span class="string">''</span>);</span><br><span class="line">  <span class="keyword">return</span> temp.length;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>正则表达式取得匹配IP地址前三段<br>只要匹配掉最后一段并且替换为空字符串就行了</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getPreThrstr</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> reg = <span class="regexp">/\.\d&#123;1,3&#125;$/</span>;</span><br><span class="line">  <span class="keyword">return</span> str.replace(reg,<span class="string">''</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>匹配<ul>与</ul>之间的内容</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/<span class="xml"><span class="tag">&lt;<span class="name">ul</span>&gt;</span>[\s\S]+?<span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><span class="regexp">/i</span></span><br></pre></td></tr></table></figure><p>用正则表达式获得文件名<br>c:\images\tupian\006.jpg<br>可能是直接在盘符根目录下，也可能在好几层目录下，要求替换到只剩文件名。<br>首先匹配非左右斜线字符0或多个，然后是左右斜线一个或者多个。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFileName</span>(<span class="params">str</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> reg = <span class="regexp">/[^\\\/]*[\\\/]+/g</span>;</span><br><span class="line">  <span class="comment">// xxx\ 或是 xxx/</span></span><br><span class="line">  str = str.replace(reg,<span class="string">''</span>);</span><br><span class="line">  <span class="keyword">return</span> str;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>绝对路径变相对路径<br>“<a href="http://23.123.22.12/image/somepic.gif&quot;转换为：&quot;/image/somepic.gif&quot;" target="_blank" rel="noopener">http://23.123.22.12/image/somepic.gif&quot;转换为：&quot;/image/somepic.gif&quot;</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/http:\/\/[^\/]+/</span>;</span><br><span class="line">str = str.replace(reg,<span class="string">""</span>);</span><br></pre></td></tr></table></figure><p>用户名正则<br>用于用户名注册，，用户名只 能用 中文、英文、数字、下划线、4-16个字符。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/^[\u4E00-\u9FA5\uf900-\ufa2d\w]&#123;<span class="number">4</span>,<span class="number">16</span>&#125;$/</span><br></pre></td></tr></table></figure><p>匹配英文地址<br>规则如下:<br>包含 “点”, “字母”,”空格”,”逗号”,”数字”，但开头和结尾不能是除字母外任何字符。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/^[a-zA-Z][\.a-zA-Z,<span class="number">0</span><span class="number">-9</span>]*[a-zA-Z]$/</span><br></pre></td></tr></table></figure><p>正则匹配价格<br>开头数字若干位，可能有一个小数点，小数点后面可以有两位数字。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/^\d+(\.\d&#123;<span class="number">2</span>&#125;)?$/</span><br></pre></td></tr></table></figure><p>身份证号码的匹配<br>身份证号码可以是15位或者是18位，其中最后一位可以是X。其它全是数字</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/^(\d&#123;<span class="number">14</span>&#125;|\d&#123;<span class="number">17</span>&#125;)(X|x)$/</span><br></pre></td></tr></table></figure><p>单词首字母大写<br>每单词首字大写，其他小写。如blue idea转换为Blue Idea，BLUE IDEA也转换为Blue Idea</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">firstCharUpper</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  str = str.toLowerCase();</span><br><span class="line">  <span class="keyword">let</span> reg = <span class="regexp">/\b(\w)/g</span>;</span><br><span class="line">  <span class="keyword">return</span> str.replace(reg, m =&gt; m.toUpperCase());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>正则验证日期格式<br>yyyy-mm-dd格式<br>4位数字，横线，1或者2位数字，再横线，最后又是1或者2位数字。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/^\d&#123;<span class="number">4</span>&#125;-\d&#123;<span class="number">1</span>,<span class="number">2</span>&#125;-\d&#123;<span class="number">1</span>,<span class="number">2</span>&#125;$/</span><br></pre></td></tr></table></figure><p>去掉文件的后缀名<br><a href="http://www.abc.com/dc/fda.asp" target="_blank" rel="noopener">www.abc.com/dc/fda.asp</a> 变为 <a href="http://www.abc.com/dc/fda" target="_blank" rel="noopener">www.abc.com/dc/fda</a></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">removeExp</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> str.replace(<span class="regexp">/\.\w$/</span>,<span class="string">''</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>验证邮箱的正则表达式<br>开始必须是一个或者多个单词字符或者是-，加上@，然后又是一个或者多个单词字符或者是-。然后是点“.”和单词字符和-的组合，可以有一个或者<br>多个组合。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/^[\w-]+@\w+\.\w+$/</span><br></pre></td></tr></table></figure><p>正则判断标签是否闭合<br>例如：&lt;img xxx=”xxx” 就是没有闭合的标签；</p><p></p><p>p的内容，同样也是没闭合的标签。</p><p>标签可能有两种方式闭合，<img xxx="xxx"> 或者是</p><p> xxx </p>。<p></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/<span class="xml"><span class="tag">&lt;<span class="name">([a-z]+)(\s*\w*?\s*=\s*".+?")*(\s*?</span>&gt;</span>[\s\S]*?(<span class="tag">&lt;<span class="name">\</span>/\<span class="attr">1</span>&gt;</span>)+|\s*\/&gt;)/i</span></span><br></pre></td></tr></table></figure><p>正则判断是否为数字与字母的混合<br>不能小于12位，且必须为字母和数字的混</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/^(([a-z]+[<span class="number">0</span><span class="number">-9</span>]+)|([<span class="number">0</span><span class="number">-9</span>]+[a-z]+))[a-z0<span class="number">-9</span>]*$/i</span><br></pre></td></tr></table></figure><p>将阿拉伯数字替换为中文大写形式</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">replaceReg</span>(<span class="params">reg,str</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">let</span> arr=[<span class="string">"零"</span>,<span class="string">"壹"</span>,<span class="string">"贰"</span>,<span class="string">"叁"</span>,<span class="string">"肆"</span>,<span class="string">"伍"</span>,<span class="string">"陆"</span>,<span class="string">"柒"</span>,<span class="string">"捌"</span>,<span class="string">"玖"</span>];</span><br><span class="line">  <span class="keyword">let</span> reg = <span class="regexp">/\d/g</span>;</span><br><span class="line">  <span class="keyword">return</span> str.replace(reg,<span class="function"><span class="keyword">function</span>(<span class="params">m</span>)</span>&#123;<span class="keyword">return</span> arr[m];&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>去掉标签的所有属性</p><p><td style="width: 23px; height: 26px;" align="left">***</td><br>变成没有任何属性的</p><p><td>***</td><br>思路：非捕获匹配属性，捕获匹配标签，使用捕获结果替换掉字符串。正则如下：</p><h4 id="7-JavaScript异常处理的方式，统一的异常处理方案"><a href="#7-JavaScript异常处理的方式，统一的异常处理方案" class="headerlink" title="7.JavaScript异常处理的方式，统一的异常处理方案"></a>7.<code>JavaScript</code>异常处理的方式，统一的异常处理方案</h4><p>Javascript 异常处理的演进<a href="https://zhuanlan.zhihu.com/p/25245932" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/25245932</a></p><p><strong>Promise 异常处理</strong></p><p>不仅是 reject，抛出的异常也会被作为拒绝状态被 Promise 捕获。在微任务中抛出的异常能够被捕获，宏任务中抛出异常无法被捕获，因为已经离开了函数的执行上下文</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fetch</span>(<span class="params">callback</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="built_in">Error</span>(<span class="string">'用户不存在'</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fetch().then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'请求处理'</span>, result) <span class="comment">// 永远不会执行</span></span><br><span class="line">&#125;).catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'请求处理异常'</span>, error) <span class="comment">// 请求处理异常 用户不存在</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fetch</span>(<span class="params">callback</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">             <span class="keyword">throw</span> <span class="built_in">Error</span>(<span class="string">'用户不存在'</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fetch().then(<span class="function"><span class="params">result</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'请求处理'</span>, result) <span class="comment">// 永远不会执行</span></span><br><span class="line">&#125;).catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'请求处理异常'</span>, error) <span class="comment">// 永远不会执行</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 程序崩溃</span></span><br><span class="line"><span class="comment">// Uncaught Error: 用户不存在</span></span><br></pre></td></tr></table></figure><p>Promise 的异常处理有了比较清晰的答案，只要注意在 macrotask 级别回调中使用 reject，就没有抓不住的异常。</p><p><strong>Async Await 异常</strong></p><p>不论是同步、异步的异常，await 都不会自动捕获，但好处是可以自动中断函数，我们大可放心编写业务逻辑，而不用担心异步异常后会被执行引发雪崩.</p><p>我们可以使用 try catch 捕获异常。</p><p>因为此时的异步其实在一个作用域中，通过 generator 控制执行顺序，所以可以将异步看做同步的代码去编写，包括使用 try catch 捕获异常。</p><p>try..catch</p><p>但无法捕获异步的错误</p><h5 id="业务场景-统一的异常处理方案："><a href="#业务场景-统一的异常处理方案：" class="headerlink" title="业务场景 统一的异常处理方案："></a>业务场景 统一的异常处理方案：</h5><p>我们来编写类级别装饰器，专门捕获 async 函数抛出的异常：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">const asyncClass = (errorHandler?: (error?: Error) =&gt; void) =&gt; (target: any) =&gt; &#123;</span><br><span class="line">    Object.getOwnPropertyNames(target.prototype).forEach(key =&gt; &#123;</span><br><span class="line">        const func = target.prototype[key]</span><br><span class="line">        target.prototype[key] = async (...args: any[]) =&gt; &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                await func.apply(this, args)</span><br><span class="line">            &#125; catch (error) &#123;</span><br><span class="line">                errorHandler &amp;&amp; errorHandler(error)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    return target</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>将类所有方法都用 try catch 包裹住，将异常交给业务方统一的 errorHandler 处理：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">const successRequest = () =&gt; Promise.resolve(&apos;a&apos;)</span><br><span class="line">const failRequest = () =&gt; Promise.reject(&apos;b&apos;)</span><br><span class="line"></span><br><span class="line">const iAsyncClass = asyncClass(error =&gt; &#123;</span><br><span class="line">    console.log(&apos;统一异常处理&apos;, error) // 统一异常处理 b</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">@iAsyncClass</span><br><span class="line">class Action &#123;</span><br><span class="line">    async successReuqest() &#123;</span><br><span class="line">        const result = await successRequest()</span><br><span class="line">        console.log(&apos;successReuqest&apos;, &apos;处理返回值&apos;, result)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    async failReuqest() &#123;</span><br><span class="line">        const result = await failRequest()</span><br><span class="line">        console.log(&apos;failReuqest&apos;, &apos;处理返回值&apos;, result) // 永远不会执行</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    async allReuqest() &#123;</span><br><span class="line">        const result1 = await successRequest()</span><br><span class="line">        console.log(&apos;allReuqest&apos;, &apos;处理返回值 success&apos;, result1)</span><br><span class="line">        const result2 = await failRequest()</span><br><span class="line">        console.log(&apos;allReuqest&apos;, &apos;处理返回值 success&apos;, result2) // 永远不会执行</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const action = new Action()</span><br><span class="line">action.successReuqest()</span><br><span class="line">action.failReuqest()</span><br><span class="line">action.allReuqest()</span><br></pre></td></tr></table></figure><p>我们也可以编写方法级别的异常处理：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">const asyncMethod = (errorHandler?: (error?: Error) =&gt; void) =&gt; (target: any, propertyKey: string, descriptor: PropertyDescriptor) =&gt; &#123;</span><br><span class="line">    const func = descriptor.value</span><br><span class="line">    return &#123;</span><br><span class="line">        get() &#123;</span><br><span class="line">            return (...args: any[]) =&gt; &#123;</span><br><span class="line">                return Promise.resolve(func.apply(this, args)).catch(error =&gt; &#123;</span><br><span class="line">                    errorHandler &amp;&amp; errorHandler(error)</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        set(newValue: any) &#123;</span><br><span class="line">            return newValue</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>业务方用法类似，只是装饰器需要放在函数上：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">const successRequest = () =&gt; Promise.resolve(&apos;a&apos;)</span><br><span class="line">const failRequest = () =&gt; Promise.reject(&apos;b&apos;)</span><br><span class="line"></span><br><span class="line">const asyncAction = asyncMethod(error =&gt; &#123;</span><br><span class="line">    console.log(&apos;统一异常处理&apos;, error) // 统一异常处理 b</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">class Action &#123;</span><br><span class="line">    @asyncAction async successReuqest() &#123;</span><br><span class="line">        const result = await successRequest()</span><br><span class="line">        console.log(&apos;successReuqest&apos;, &apos;处理返回值&apos;, result)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @asyncAction async failReuqest() &#123;</span><br><span class="line">        const result = await failRequest()</span><br><span class="line">        console.log(&apos;failReuqest&apos;, &apos;处理返回值&apos;, result) // 永远不会执行</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @asyncAction async allReuqest() &#123;</span><br><span class="line">        const result1 = await successRequest()</span><br><span class="line">        console.log(&apos;allReuqest&apos;, &apos;处理返回值 success&apos;, result1)</span><br><span class="line">        const result2 = await failRequest()</span><br><span class="line">        console.log(&apos;allReuqest&apos;, &apos;处理返回值 success&apos;, result2) // 永远不会执行</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const action = new Action()</span><br><span class="line">action.successReuqest()</span><br><span class="line">action.failReuqest()</span><br><span class="line">action.allReuqest()</span><br></pre></td></tr></table></figure><p>在 nodejs 端，记得监听全局错误，兜住落网之鱼：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">process.on(&apos;uncaughtException&apos;, (error: any) =&gt; &#123;</span><br><span class="line">    logger.error(&apos;uncaughtException&apos;, error)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">process.on(&apos;unhandledRejection&apos;, (error: any) =&gt; &#123;</span><br><span class="line">    logger.error(&apos;unhandledRejection&apos;, error)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>在浏览器端，记得监听 window 全局错误，兜住漏网之鱼：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">window.addEventListener(&apos;unhandledrejection&apos;, (event: any) =&gt; &#123;</span><br><span class="line">    logger.error(&apos;unhandledrejection&apos;, event)</span><br><span class="line">&#125;)</span><br><span class="line">window.addEventListener(&apos;onrejectionhandled&apos;, (event: any) =&gt; &#123;</span><br><span class="line">    logger.error(&apos;onrejectionhandled&apos;, event)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;前端自检清单JavaScript基础5–语法和API&lt;/p&gt;
    
    </summary>
    
      <category term="前端" scheme="http://11wy11.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
      <category term="js基础" scheme="http://11wy11.github.io/tags/js%E5%9F%BA%E7%A1%80/"/>
    
  </entry>
  
  <entry>
    <title>前端基础复习-JavaScript-4</title>
    <link href="http://11wy11.github.io/2020/04/04/js-base-knowledge4/"/>
    <id>http://11wy11.github.io/2020/04/04/js-base-knowledge4/</id>
    <published>2020-04-04T15:05:04.000Z</published>
    <updated>2020-09-19T08:18:54.318Z</updated>
    
    <content type="html"><![CDATA[<p>前端自检清单JavaScript基础4–执行机制</p><a id="more"></a><h3 id="执行机制"><a href="#执行机制" class="headerlink" title="执行机制"></a>执行机制</h3><h4 id="1-为何try里面放return，finally还会执行，理解其内部机制"><a href="#1-为何try里面放return，finally还会执行，理解其内部机制" class="headerlink" title="1.为何try里面放return，finally还会执行，理解其内部机制"></a>1.为何<code>try</code>里面放<code>return</code>，<code>finally</code>还会执行，理解其内部机制</h4><p>当try和finally里都有return时，会忽略try的return，而使用finally的return。</p><ul><li>JVM 采用异常表的方式来处理 try catch 的跳转逻辑</li><li>finally 的实现采用拷贝 finally 语句块的方式来实现 finally 一定会执行的语义逻辑</li></ul><h4 id="2-JavaScript如何实现异步编程，可以详细描述EventLoop机制"><a href="#2-JavaScript如何实现异步编程，可以详细描述EventLoop机制" class="headerlink" title="2.JavaScript如何实现异步编程，可以详细描述EventLoop机制"></a>2.<code>JavaScript</code>如何实现异步编程，可以详细描述<code>EventLoop</code>机制</h4><p>一个 Event Loop 中，可以有一个或者多个任务队列(task queue)，一个任务队列便是一系列有序任务(task)的集合；<strong>每个任务都有一个任务源(task source)，源自同一个任务源的 task 必须放到同一个任务队列，从不同源来的则被添加到不同队列。</strong> setTimeout/Promise 等API便是任务源，而进入任务队列的是他们指定的具体执行任务。</p><p>浏览器为了能够使得JS内部(macro)task与DOM任务能够有序的执行，<strong>会在一个(macro)task执行结束后，在下一个(macro)task 执行开始前，对页面进行重新渲染</strong>，流程如下：</p><pre><code>(macro)task-&gt;渲染-&gt;(macro)task-&gt;...</code></pre><p>microtask（又称为微任务），<strong>可以理解是在当前 task 执行结束后立即执行的任务</strong>。也就是说，在当前task任务后，下一个task之前，在渲染之前，执行所有microtask</p><ul><li>执行一个宏任务（栈中没有就从事件队列中获取）</li><li>执行过程中如果遇到微任务，就将它添加到微任务的任务队列中</li><li>宏任务执行完毕后，立即执行当前微任务队列中的所有微任务（依次执行）</li><li>当前宏任务执行完毕，开始检查渲染，然后GUI线程接管渲染</li><li>渲染完毕后，JS线程继续接管，开始下一个宏任务（从事件队列中获取）</li></ul><h4 id="3-宏任务和微任务分别有哪些"><a href="#3-宏任务和微任务分别有哪些" class="headerlink" title="3.宏任务和微任务分别有哪些"></a>3.宏任务和微任务分别有哪些</h4><p><strong>宏任务</strong>(macro)task主要包含：script(整体代码)、setTimeout、setInterval、I/O、UI交互事件、postMessage、MessageChannel、setImmediate(Node.js 环境)</p><p><strong>微任务</strong>：Promise.then、MutationObserver(在指定的DOM发生变化时被调用)、process.nextTick(Node.js 环境)</p><h4 id="4-可以快速分析一个复杂的异步嵌套逻辑，并掌握分析方法"><a href="#4-可以快速分析一个复杂的异步嵌套逻辑，并掌握分析方法" class="headerlink" title="4.可以快速分析一个复杂的异步嵌套逻辑，并掌握分析方法"></a>4.可以快速分析一个复杂的异步嵌套逻辑，并掌握分析方法</h4><p>理解好任务队列，宏任务和微任务</p><h4 id="5-使用Promise实现串行"><a href="#5-使用Promise实现串行" class="headerlink" title="5.使用Promise实现串行"></a>5.使用<code>Promise</code>实现串行</h4><p>在promise中返回一个promise对象就是一个串行。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//实现Promise串行</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makePromise</span>(<span class="params">value</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span>=&gt;</span>&#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">            resolve(value)</span><br><span class="line">        &#125;,<span class="built_in">Math</span>.random()*<span class="number">1000</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">print</span>(<span class="params">value</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> promises = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>].map(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> makePromise(item)</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">// 串行执行</span></span><br><span class="line"><span class="keyword">let</span> parallelPromises = promises.reduce(</span><br><span class="line">    (total, currentValue) =&gt; total.then(<span class="function"><span class="params">()</span> =&gt;</span> currentValue.then(print)),<span class="built_in">Promise</span>.resolve()</span><br><span class="line">  )</span><br><span class="line">  parallelPromises</span><br><span class="line">.then(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'total then done'</span>)</span><br><span class="line">&#125;)</span><br><span class="line">.catch(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'done'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h4 id="6-Node与浏览器EventLoop的差异"><a href="#6-Node与浏览器EventLoop的差异" class="headerlink" title="6.Node与浏览器EventLoop的差异"></a>6.<code>Node</code>与浏览器<code>EventLoop</code>的差异</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/04/04/js-base-knowledge4/img/node-libuv.png" alt="img" title>                </div>                <div class="image-caption">img</div>            </figure><ul><li><p><strong>timers 阶段</strong>：这个阶段执行timer（<code>setTimeout</code>、<code>setInterval</code>）的回调</p></li><li><p><strong>I/O callbacks 阶段</strong>：执行一些系统调用错误，比如网络通信的错误回调</p></li><li><p><strong>idle, prepare 阶段</strong>：仅node内部使用</p></li><li><p><strong>poll 阶段</strong>：获取新的I/O事件, 适当的条件下node将阻塞在这里，当已有超时timer，执行它的回调函数</p></li><li><p><strong>check 阶段</strong>：执行 <code>setImmediate()</code> 的回调</p></li><li><p><strong>close callbacks 阶段</strong>：执行 <code>socket</code> 的 <code>close</code> 事件回调</p></li></ul><p>浏览器环境下，<code>microtask</code>的任务队列是每个<code>macrotask</code>执行完之后执行。</p><p>而在Node.js中，<code>microtask</code>会在事件循环的各个阶段之间执行，也就是一个阶段执行完毕，就会去执行<code>microtask</code>队列的任务。</p><p>在nodejs中递归的调用<code>process.nextTick()</code>会导致I/O starving，官方推荐使用<code>setImmediate()</code></p><h4 id="7-如何在保证页面运行流畅的情况下处理海量数据"><a href="#7-如何在保证页面运行流畅的情况下处理海量数据" class="headerlink" title="7.如何在保证页面运行流畅的情况下处理海量数据"></a>7.如何在保证页面运行流畅的情况下处理海量数据</h4><h4 id="8-js的单线程模式"><a href="#8-js的单线程模式" class="headerlink" title="8.js的单线程模式"></a>8.js的单线程模式</h4><p>单线程，js的主要用途是与用户互动，以及操作DOM，如果使用多线程，容易产生复杂的同步问题。</p><ul><li>所有的同步任务都在主线程上执行，形成一个执行栈，</li><li>主线程之外，存在一个任务队列，当异步任务有了运行结果，则会在任务队列中放置一个事件</li><li><p>一旦”执行栈”中的所有同步任务执行完毕，系统就会读取”任务队列”，看看里面有哪些事件。那些对应的异步任务，于是结束等待状态，进入执行栈，开始执行。</p><ul><li>主线程不断重复上面的第三步。</li></ul></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;前端自检清单JavaScript基础4–执行机制&lt;/p&gt;
    
    </summary>
    
      <category term="前端" scheme="http://11wy11.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
      <category term="js基础" scheme="http://11wy11.github.io/tags/js%E5%9F%BA%E7%A1%80/"/>
    
  </entry>
  
  <entry>
    <title>前端基础复习-JavaScript-3</title>
    <link href="http://11wy11.github.io/2020/04/04/js-base-knowledge3/"/>
    <id>http://11wy11.github.io/2020/04/04/js-base-knowledge3/</id>
    <published>2020-04-04T15:04:57.000Z</published>
    <updated>2020-09-19T08:18:54.317Z</updated>
    
    <content type="html"><![CDATA[<p>前端自检清单JavaScript基础3–作用域和闭包</p><a id="more"></a><h3 id="作用域和闭包"><a href="#作用域和闭包" class="headerlink" title="作用域和闭包"></a>作用域和闭包</h3><h4 id="1-理解词法作用域和动态作用域"><a href="#1-理解词法作用域和动态作用域" class="headerlink" title="1.理解词法作用域和动态作用域"></a>1.理解词法作用域和动态作用域</h4><p>词法作用域是由写代码时将变量和块作用域写在哪里决定的，函数的词法作用域由函数声明所处位置决定的</p><p>查找 词法作用域查找只会查找一级标识符</p><p>遮蔽 从内逐级向外查找作用域，直到遇到第一个匹配的标识符为止，在多层嵌套作用域内定义同名标识符，产生遮蔽效应</p><p>动态作用域是运行时确定的，关注函数从何处调用</p><p>注js只有词法作用域，只是this的某种机制像动态作用域</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function foo()&#123;</span><br><span class="line">    console.log(a);//3(而不是2！)//动态作用域是应该是3，但是运行js代码输出的还是2</span><br><span class="line">&#125;</span><br><span class="line">function bar()&#123;</span><br><span class="line">    var a=3;</span><br><span class="line">    foo();</span><br><span class="line">&#125;</span><br><span class="line">var a=2;</span><br><span class="line">bar();</span><br></pre></td></tr></table></figure><h4 id="2-理解JavaScript的作用域和作用域链"><a href="#2-理解JavaScript的作用域和作用域链" class="headerlink" title="2.理解JavaScript的作用域和作用域链"></a>2.理解<code>JavaScript</code>的作用域和作用域链</h4><p>全局作用域</p><p>局部作用域</p><p>全局变量的作用域是全局的，在代码的任何地方都是有定义的。然而函数的参数和局部变量只在函数体内有定义。另外局部变量的优先级要高于同名的全局变量,也就是说当局部变量与全局变量重名时，局部变量会覆盖全局变量。</p><p>作用域链</p><p>作用域链就是由多个作用域组成的，当在自身作用域内找不到该变量的时候，会沿着作用域链逐步向上查找，若在全局作用域内部仍找不到该变量，则会抛出异常。</p><h4 id="3-理解JavaScript的执行上下文栈，可以应用堆栈信息快速定位问题"><a href="#3-理解JavaScript的执行上下文栈，可以应用堆栈信息快速定位问题" class="headerlink" title="3.理解JavaScript的执行上下文栈，可以应用堆栈信息快速定位问题"></a>3.理解<code>JavaScript</code>的执行上下文栈，可以应用堆栈信息快速定位问题</h4><p>执行期上下文</p><p>当<strong>函数执行</strong>时（准确来说，是在函数发生预编译的前一刻），会创建一个执行期上下文的内部对象。一个执行期上下文定义了一个函数执行时的环境。</p><p>每调用一次函数，就会创建一个新的上下文对象，他们之间是相互独立且独一无二的。当函数执行完毕，它所产生的执行期上下文会被销毁。</p><h4 id="4-this的原理以及几种不同使用场景的取值"><a href="#4-this的原理以及几种不同使用场景的取值" class="headerlink" title="4.this的原理以及几种不同使用场景的取值"></a>4.<code>this</code>的原理以及几种不同使用场景的取值</h4><p>this代表函数调用相关联的对象，通常称之为执行上下文。</p><ol><li>作为函数直接调用，非严格模式下，this指向window，严格模式下，this指向undefined；</li><li>作为某对象的方法调用，this通常指向调用的对象。</li><li>使用apply、call、bind 可以绑定this的指向。</li><li>在构造函数中，this指向新创建的对象</li><li>箭头函数没有单独的this值，this在箭头函数创建时确定，它与声明所在的上下文相同。</li></ol><h4 id="5-闭包的实现原理和作用，可以列举几个开发中闭包的实际应用"><a href="#5-闭包的实现原理和作用，可以列举几个开发中闭包的实际应用" class="headerlink" title="5.闭包的实现原理和作用，可以列举几个开发中闭包的实际应用"></a>5.闭包的实现原理和作用，可以列举几个开发中闭包的实际应用</h4><p>闭包的概念：指有权访问另一个函数作用域中的变量的函数，一般情况就是在一个函数中包含另一个函数。</p><p>闭包的作用：访问函数内部变量、保持函数在环境中一直存在，不会被垃圾回收机制处理</p><p>产生闭包：</p><p>将一个函数作为另一个函数的返回值</p><p>将函数作为实参传递给另一个函数调用</p><p>变量私有化</p><p>应用：防抖函数，计数器</p><h4 id="6-理解堆栈溢出和内存泄漏的原理，如何防止"><a href="#6-理解堆栈溢出和内存泄漏的原理，如何防止" class="headerlink" title="6.理解堆栈溢出和内存泄漏的原理，如何防止"></a>6.理解堆栈溢出和内存泄漏的原理，如何防止</h4><p><strong>内存泄漏</strong>：<strong>占用的内存</strong>没有及时释放。</p><p>注意，内存泄露的次数积累多了，就容易导致内存溢出。</p><p><strong>常见的内存泄露</strong>：</p><ul><li><p>1.意外的全局变量</p></li><li><p>2.没有及时清理的计时器或回调函数</p></li><li><p>3.闭包</p></li></ul><h4 id="7-如何处理循环的异步操作"><a href="#7-如何处理循环的异步操作" class="headerlink" title="7.如何处理循环的异步操作"></a>7.如何处理循环的异步操作</h4><p>for循环</p><p>递归处理异步函数</p><h4 id="8-理解模块化解决的实际问题，可列举几个模块化方案并理解其中原理"><a href="#8-理解模块化解决的实际问题，可列举几个模块化方案并理解其中原理" class="headerlink" title="8.理解模块化解决的实际问题，可列举几个模块化方案并理解其中原理"></a>8.理解模块化解决的实际问题，可列举几个模块化方案并理解其中原理</h4><p><strong>CommonJS规范</strong>，NodeJS使用，加载时运行，输出值的拷贝，会缓存结果，模块可多次加载，但只有第一次加载运行一次</p><p><strong>AMD</strong>，Asynchronous Moudle Definition “异步模块定义”，需要在声明的时候指定所有的依赖，通过形参传递依赖到模块内容中，特点：提前执行（异步加载依赖先执行）+延迟执行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">define(id?, dependencies, factory);</span><br><span class="line">//使用</span><br><span class="line">require(&apos;id&apos;)</span><br></pre></td></tr></table></figure><p><strong>CMD</strong>，与AMD主要区别在于定于模块与依赖引入部分。支持动态引入，特点：延迟执行（运行到需加载，根据顺序执行）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">define(funtion(require, exports, moudle) &#123;&#125;</span><br><span class="line"></span><br><span class="line">require</span><br><span class="line">require.async</span><br></pre></td></tr></table></figure><p><strong>ES6 Module</strong> 编译时运行，输出值的引用</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;前端自检清单JavaScript基础3–作用域和闭包&lt;/p&gt;
    
    </summary>
    
      <category term="前端" scheme="http://11wy11.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
      <category term="js基础" scheme="http://11wy11.github.io/tags/js%E5%9F%BA%E7%A1%80/"/>
    
  </entry>
  
  <entry>
    <title>前端基础复习-JavaScript-2</title>
    <link href="http://11wy11.github.io/2020/04/03/js-base-knowledge2/"/>
    <id>http://11wy11.github.io/2020/04/03/js-base-knowledge2/</id>
    <published>2020-04-03T10:43:24.000Z</published>
    <updated>2020-09-19T08:18:54.316Z</updated>
    
    <content type="html"><![CDATA[<p>前端自检清单JavaScript基础2–原型原型链<br><a id="more"></a></p><h3 id="原型和原型链"><a href="#原型和原型链" class="headerlink" title="原型和原型链"></a>原型和原型链</h3><h4 id="1-理解原型设计模式以及JavaScript中的原型规则"><a href="#1-理解原型设计模式以及JavaScript中的原型规则" class="headerlink" title="1.理解原型设计模式以及JavaScript中的原型规则"></a>1.理解原型设计模式以及<code>JavaScript</code>中的原型规则</h4><p><strong>原型模式</strong> ：是指原型实例指向创建对象的种类，并通过拷贝这些原型创建新的对象，是一种用来创建对象的模式，也就是创建一个对象作为另一个对象的prototype属性。</p><p>创建方式：<strong>Object.create(prototype, optionalDescriptorObjects)</strong> ②prototype</p><p> <strong>原型原则</strong>：</p><p>①所有的引用类型（数组，对象，函数）都有对象属性，都可以自由扩展属性。null除外；</p><p>②所有的引用类型（数组，对象，函数）都有对象属性，对象均有<code>__proto__</code>属性，属性值是一个普通的对象，<code>__proto__</code>的含义是隐式原型;</p><p>③所有的函数，均有一个prototype属性，属性值是一个普通的对象，<code>prototype</code>的含义是显式原型;</p><p>④所有的引用类型（数组，对象，函数）的属性<code>__proto__</code>指向它的构造函数prototype值</p><p>⑤当获得一个对象的属性时，首先在对象本身查找，如果没有会去它的<code>__proto__</code>中查找</p><h4 id="2-instanceof的底层实现原理，手动实现一个instanceof"><a href="#2-instanceof的底层实现原理，手动实现一个instanceof" class="headerlink" title="2.instanceof的底层实现原理，手动实现一个instanceof"></a>2.<code>instanceof</code>的底层实现原理，手动实现一个<code>instanceof</code></h4><p>将对象的<code>__proto__</code>指向与构造函数的prototype判断</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">new_instance_of</span>(<span class="params">leftVaule, rightVaule</span>) </span>&#123; </span><br><span class="line">    <span class="keyword">let</span> rightProto = rightVaule.prototype; <span class="comment">// 取右表达式的 prototype 值</span></span><br><span class="line">    leftVaule = leftVaule.__proto__; <span class="comment">// 取左表达式的__proto__值</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (leftVaule === <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (leftVaule === rightProto) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; </span><br><span class="line">        leftVaule = leftVaule.__proto__ </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h4 id="4-实现继承的几种方式以及他们的优缺点"><a href="#4-实现继承的几种方式以及他们的优缺点" class="headerlink" title="4.实现继承的几种方式以及他们的优缺点"></a>4.实现继承的几种方式以及他们的优缺点</h4><p><strong>构造函数</strong>：<code>Parent.call(this)</code>，优点：可以继承父类属性，避免引用类型的属性被所有子类共享，可以向父类构造函数里传参；缺点：无法继承Parent原型链上的属性和方法，②方法都在构造函数中定义，每次创建实例都会创建一遍方法</p><p><strong>原型链继承</strong>：<code>Child.prototype=new Parent()</code>把prototype设置为父类的实例，缺点：①无法向父类构造函数里传参数②父类原型上的引用属性被所有子类共享，</p><p><strong>组合继承</strong>:可以继承父类属性及原型链属性，也可向父类构造函数传参数，融合了构造函数和原型链继承的优点，缺点：父类构造函数被调用了两次</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function Child()&#123;</span><br><span class="line">   Parent.call(this)</span><br><span class="line">&#125;</span><br><span class="line">Child.prototype=new Parent();</span><br><span class="line">//优化</span><br><span class="line">function Child()&#123;</span><br><span class="line">   Parent.call(this)</span><br><span class="line">&#125;</span><br><span class="line">Child.prototype=Parent.prototype;//缺点：因为原型上有个属性constructor，子类的实例constructor也是parent，无法区分实例对象是父类还是子类，子类原型上添加属性影响父类</span><br></pre></td></tr></table></figure><p><strong>寄生继承</strong>: 优点可以添加方法和属性</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function createChild(p)&#123;</span><br><span class="line">   var o=Object.create(p);</span><br><span class="line">   o.newMethod=function()&#123;</span><br><span class="line">   &#125;</span><br><span class="line">   return o;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>寄生组合继承</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">function object(o) &#123;</span><br><span class="line">  function F() &#123;&#125;</span><br><span class="line">  F.prototype = o;</span><br><span class="line">  return new F();</span><br><span class="line">&#125;</span><br><span class="line">function inheritPrototype(subClass,superClass)&#123;</span><br><span class="line">var p=object(superClass.prototype);</span><br><span class="line">p.constructor=subClass;</span><br><span class="line">subClass.prototype=p;</span><br><span class="line">&#125;</span><br><span class="line">function Child()&#123;</span><br><span class="line">   Parent.apply(this,arguments);</span><br><span class="line">&#125;</span><br><span class="line">inheritPrototype(Child, Parent);</span><br></pre></td></tr></table></figure><p>优点：只调用了一次Parent构造函数，并且因此避免了在 Parent.prototype 上面创建不必要的、多余的属性。与此同时，原型链还能保持不变；</p><p><strong>ES6 class</strong> <strong>extends</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Parent</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(x,y)&#123;</span><br><span class="line">        <span class="keyword">this</span>.x = x;</span><br><span class="line">        <span class="keyword">this</span>.y = y;</span><br><span class="line">    &#125;</span><br><span class="line">    toString()&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Child</span> <span class="keyword">extends</span> <span class="title">Parent</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(x,y,color)&#123;</span><br><span class="line">        <span class="keyword">super</span>(x,y);</span><br><span class="line">        <span class="keyword">this</span>.color = color;</span><br><span class="line">    &#125;</span><br><span class="line">    toString()&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 通过extends关键字继承了Parent类所有的属性和方法。</span></span><br><span class="line"><span class="comment">* 子类的constructor方法 和 toString方法中都出现了super关键字,</span></span><br><span class="line"><span class="comment">* 在这里表示父类的构造函数，用来新建父类的this对象。</span></span><br><span class="line"><span class="comment">* 子类必须在constructor方法中调用super方法，因为子类的this对象必须通过父类的构造函数完成创建，</span></span><br><span class="line"><span class="comment">* 并且得到与父类同样的实例属性和方法。如果不调用，子类就得不到this对象，就不能进行二次加工。</span></span><br><span class="line"><span class="comment">* 要注意的一个地方是，在子类的构造函数中，只有调用super才可以使用this关键字，</span></span><br><span class="line"><span class="comment">* 所以this关键字要放到super关键字之后，</span></span><br><span class="line"><span class="comment">* 是因为子类实例的构建，基于父类实例，只有super方法能调用父类实例。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* ES5的继承实质是先创建子类的实例对象this，然后再将父类的方法添加到this上面(Parent.apply(this))</span></span><br><span class="line"><span class="comment">* ES6的继承实质是先将父类实例对象的属性和方法加到this上面(所以需先调用super方法)，然后再用子类构造函数修改this</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Child</span> <span class="keyword">extends</span> <span class="title">Parent</span></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//等同于</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Child</span> <span class="keyword">extends</span> <span class="title">Parent</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(...args)&#123;</span><br><span class="line">        <span class="keyword">super</span>(...args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* 如果子类没有定义constructor方法，这个方法会被默认添加，</span></span><br><span class="line"><span class="comment">* 也就是说不管有没有显示的定义，子类都有constructor方法。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Parent</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Child</span> <span class="keyword">extends</span> <span class="title">Parent</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>()&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* super这个关键字既可以当做函数使用，也可以当做对象使用</span></span><br><span class="line"><span class="comment">* 作为函数调用时，代表父类的构造函数，子类构造函数必须执行一次super函数</span></span><br><span class="line"><span class="comment">* super虽然代表了父类Parent的构造函数，但是返回的是子类Child的实例</span></span><br><span class="line"><span class="comment">* 即super内部的this指的是Child，super在这里就相当于：</span></span><br><span class="line"><span class="comment">* Parent.prototype.constructor.call(this)</span></span><br><span class="line"><span class="comment">* super作为函数使用时，super()只能用在子类的构造函数中*/</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Parent</span> </span>&#123;</span><br><span class="line">    outPut()&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="number">1</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Child</span> <span class="keyword">extends</span> <span class="title">Parent</span></span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>()&#123;</span><br><span class="line">        <span class="keyword">super</span>();</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">super</span>.outPut())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* super作为对象时，在普通方法中指向父类的原型对象，静态方法中指向父类</span></span><br><span class="line"><span class="comment">* super在普通方法中代表Parent.prototype,所以super.outPut()就相当于</span></span><br><span class="line"><span class="comment">* Parent.prototype.outPut()</span></span><br><span class="line"><span class="comment">* 注意，父类实例上的方法或属性是无法通过super调用的*/</span></span><br></pre></td></tr></table></figure><h4 id="5-至少说出一种开源项目-如Node-中应用原型继承的案例"><a href="#5-至少说出一种开源项目-如Node-中应用原型继承的案例" class="headerlink" title="5.至少说出一种开源项目(如Node)中应用原型继承的案例"></a>5.至少说出一种开源项目(如<code>Node</code>)中应用原型继承的案例</h4><h4 id="6-可以描述new一个对象的详细过程，手动实现一个new操作符"><a href="#6-可以描述new一个对象的详细过程，手动实现一个new操作符" class="headerlink" title="6.可以描述new一个对象的详细过程，手动实现一个new操作符"></a>6.可以描述<code>new</code>一个对象的详细过程，手动实现一个<code>new</code>操作符</h4><p>①创建一个空对象</p><p>②将父类构造函数this指针指向创建的Object</p><p>③如何父类构造函数有返回的对象，返回该对象，否则，就返回新建的对象</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function myNewOpt(Obj,args)&#123;</span><br><span class="line">    var o=Object.create(Obj.prototype);</span><br><span class="line">    Obj.apply(o,args);</span><br><span class="line">    return o;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="7-理解es6-class构造以及继承的底层实现原理"><a href="#7-理解es6-class构造以及继承的底层实现原理" class="headerlink" title="7.理解es6 class构造以及继承的底层实现原理"></a>7.理解<code>es6 class</code>构造以及继承的底层实现原理</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">class Parent &#123;</span><br><span class="line">    constructor(name,age)&#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">        this.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">    speakSomething()&#123;</span><br><span class="line">        console.log(&quot;I can speek chinese&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>class在babel编译后，</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&quot;use strict&quot;;</span><br><span class="line"></span><br><span class="line">var _createClass = function () &#123;</span><br><span class="line">    function defineProperties(target, props) &#123;</span><br><span class="line">        for (var i = 0; i &lt; props.length; i++) &#123;</span><br><span class="line">            var descriptor = props[i];</span><br><span class="line">            descriptor.enumerable = descriptor.enumerable || false;</span><br><span class="line">            descriptor.configurable = true;</span><br><span class="line">            if (&quot;value&quot; in descriptor) descriptor.writable = true;</span><br><span class="line">            Object.defineProperty(target, descriptor.key, descriptor);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return function (Constructor, protoProps, staticProps) &#123;</span><br><span class="line">        if (protoProps) defineProperties(Constructor.prototype, protoProps);</span><br><span class="line">        if (staticProps) defineProperties(Constructor, staticProps);</span><br><span class="line">        return Constructor;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;();</span><br><span class="line"></span><br><span class="line">function _classCallCheck(instance, Constructor) &#123;</span><br><span class="line">    if (!(instance instanceof Constructor)) &#123;</span><br><span class="line">        throw new TypeError(&quot;Cannot call a class as a function&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var Parent = function () &#123;</span><br><span class="line">    function Parent(name, age) &#123;</span><br><span class="line">        _classCallCheck(this, Parent);</span><br><span class="line"></span><br><span class="line">        this.name = name;</span><br><span class="line">        this.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    _createClass(Parent, [&#123;</span><br><span class="line">        key: &quot;speakSomething&quot;,</span><br><span class="line">        value: function speakSomething() &#123;</span><br><span class="line">            console.log(&quot;I can speek chinese&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;]);</span><br><span class="line"></span><br><span class="line">    return Parent;</span><br><span class="line">&#125;();</span><br></pre></td></tr></table></figure><p>在子类构造时，先调用父类构造函数设置this的属性和方法，然后子类构造中扩展修改this，底层实现使用了寄生组合继承</p><p><strong>继承</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Parent</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> height = <span class="number">12</span></span><br><span class="line">    <span class="keyword">constructor</span>(name,age)&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">    speakSomething()&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"I can speek chinese"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">Parent.prototype.color = <span class="string">'yellow'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//定义子类，继承父类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Child</span> <span class="keyword">extends</span> <span class="title">Parent</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> width = <span class="number">18</span></span><br><span class="line">    <span class="keyword">constructor</span>(name,age)&#123;</span><br><span class="line">        <span class="keyword">super</span>(name,age);</span><br><span class="line">    &#125;</span><br><span class="line">    coding()&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"I can code JS"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> c = <span class="keyword">new</span> Child(<span class="string">"job"</span>,<span class="number">30</span>);</span><br><span class="line">c.coding()</span><br></pre></td></tr></table></figure><p>转码之后的代码变成了这样</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">"use strict"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> _createClass = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">defineProperties</span>(<span class="params">target, props</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; props.length; i++) &#123;</span><br><span class="line">            <span class="keyword">var</span> descriptor = props[i];</span><br><span class="line">            descriptor.enumerable = descriptor.enumerable || <span class="literal">false</span>;</span><br><span class="line">            descriptor.configurable = <span class="literal">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">"value"</span> <span class="keyword">in</span> descriptor) descriptor.writable = <span class="literal">true</span>;</span><br><span class="line">            <span class="built_in">Object</span>.defineProperty(target, descriptor.key, descriptor);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">Constructor, protoProps, staticProps</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (protoProps) defineProperties(Constructor.prototype, protoProps);</span><br><span class="line">        <span class="keyword">if</span> (staticProps) defineProperties(Constructor, staticProps);</span><br><span class="line">        <span class="keyword">return</span> Constructor;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_possibleConstructorReturn</span>(<span class="params">self, call</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!self) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">ReferenceError</span>(<span class="string">"this hasn't been initialised - super() hasn't been called"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> call &amp;&amp; (<span class="keyword">typeof</span> call === <span class="string">"object"</span> || <span class="keyword">typeof</span> call === <span class="string">"function"</span>) ? call : self;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_inherits</span>(<span class="params">subClass, superClass</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> superClass !== <span class="string">"function"</span> &amp;&amp; superClass !== <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">"Super expression must either be null or a function, not "</span> + <span class="keyword">typeof</span> superClass);</span><br><span class="line">    &#125;</span><br><span class="line">    subClass.prototype = <span class="built_in">Object</span>.create(superClass &amp;&amp; superClass.prototype, &#123;</span><br><span class="line">        <span class="keyword">constructor</span>: &#123;</span><br><span class="line">            value: subClass,</span><br><span class="line">            enumerable: <span class="literal">false</span>,</span><br><span class="line">            writable: <span class="literal">true</span>,</span><br><span class="line">            configurable: <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">if</span> (superClass) <span class="built_in">Object</span>.setPrototypeOf ? <span class="built_in">Object</span>.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">_classCallCheck</span>(<span class="params">instance, Constructor</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!(instance <span class="keyword">instanceof</span> Constructor)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">TypeError</span>(<span class="string">"Cannot call a class as a function"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Parent = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Parent</span>(<span class="params">name, age</span>) </span>&#123;</span><br><span class="line">        _classCallCheck(<span class="keyword">this</span>, Parent);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    _createClass(Parent, [&#123;</span><br><span class="line">        key: <span class="string">"speakSomething"</span>,</span><br><span class="line">        value: <span class="function"><span class="keyword">function</span> <span class="title">speakSomething</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"I can speek chinese"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Parent;</span><br><span class="line">&#125;();</span><br><span class="line"></span><br><span class="line">Parent.height = <span class="number">12</span>;</span><br><span class="line"></span><br><span class="line">Parent.prototype.color = <span class="string">'yellow'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义子类，继承父类</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> Child = <span class="function"><span class="keyword">function</span> (<span class="params">_Parent</span>) </span>&#123;</span><br><span class="line">    _inherits(Child, _Parent);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Child</span>(<span class="params">name, age</span>) </span>&#123;</span><br><span class="line">        _classCallCheck(<span class="keyword">this</span>, Child);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> _possibleConstructorReturn(<span class="keyword">this</span>, (Child.__proto__ || <span class="built_in">Object</span>.getPrototypeOf(Child)).call(<span class="keyword">this</span>, name, age));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    _createClass(Child, [&#123;</span><br><span class="line">        key: <span class="string">"coding"</span>,</span><br><span class="line">        value: <span class="function"><span class="keyword">function</span> <span class="title">coding</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"I can code JS"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;]);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Child;</span><br><span class="line">&#125;(Parent);</span><br><span class="line"></span><br><span class="line">Child.width = <span class="number">18</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> c = <span class="keyword">new</span> Child(<span class="string">"job"</span>, <span class="number">30</span>);</span><br><span class="line">c.coding();</span><br></pre></td></tr></table></figure><p>原理：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function F()&#123;&#125;</span><br><span class="line">F.prototype = superClass.prototype</span><br><span class="line">subClass.prototype = new F()</span><br><span class="line">subClass.prototype.constructor = subClass</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;前端自检清单JavaScript基础2–原型原型链&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="前端" scheme="http://11wy11.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
      <category term="js基础" scheme="http://11wy11.github.io/tags/js%E5%9F%BA%E7%A1%80/"/>
    
  </entry>
  
  <entry>
    <title>前端基础复习-JavaScript-1</title>
    <link href="http://11wy11.github.io/2020/04/03/js-base-knowledge1/"/>
    <id>http://11wy11.github.io/2020/04/03/js-base-knowledge1/</id>
    <published>2020-04-03T10:36:11.000Z</published>
    <updated>2020-09-19T08:18:54.314Z</updated>
    
    <content type="html"><![CDATA[<p>前端自检清单JavaScript基础1–变量和类型<br><a id="more"></a></p><h3 id="变量和类型"><a href="#变量和类型" class="headerlink" title="变量和类型"></a>变量和类型</h3><h4 id="1-JavaScript规定了几种语言类型"><a href="#1-JavaScript规定了几种语言类型" class="headerlink" title="1.JavaScript规定了几种语言类型"></a>1.<code>JavaScript</code>规定了几种语言类型</h4><p>7种，</p><p>undefined,null,Number,Boolean,</p><p>String,Object,Symbol</p><h4 id="2-JavaScript对象的底层数据结构是什么"><a href="#2-JavaScript对象的底层数据结构是什么" class="headerlink" title="2.JavaScript对象的底层数据结构是什么"></a>2.<code>JavaScript</code>对象的底层数据结构是什么</h4><p>Null (js中的数据在底层是以二进制存储，如果前三位为0，那么就会判定为object，而null的所有都为0)</p><p><strong>js基本类型数据都是直接按值存储在栈中的</strong>(Undefined、Null、不是new出来的布尔、数字和字符串)</p><p><strong>js引用类型数据被存储于堆中</strong> (如对象、数组、函数等，它们是通过拷贝和new出来的），引用类型的数据的地址指针存储于栈中，地址指针指向堆中的数据</p><p>Object&gt;HeapObject（存储）&gt;JSReceiver(用于原型查找)-&gt;(FixedArrayBase-&gt;FixedArray)+JSObject-&gt;JSArray+JSCollection+(JSFunction&gt;JSMap+JSSet)</p><h4 id="3-Symbol类型在实际开发中的应用、可手动实现一个简单的Symbol"><a href="#3-Symbol类型在实际开发中的应用、可手动实现一个简单的Symbol" class="headerlink" title="3.Symbol类型在实际开发中的应用、可手动实现一个简单的Symbol"></a>3.<code>Symbol</code>类型在实际开发中的应用、可手动实现一个简单的<code>Symbol</code></h4><p>应用场景：1.使用Symbol来作为对象属性名（key）</p><p>2.使用Symbol来替代常量</p><p>3.使用Symbol定义类的私有属性和方法</p><p>symbol 类型的key不能被Object.keys和for—of</p><h4 id="4-JavaScript中的变量在内存中的具体存储形式"><a href="#4-JavaScript中的变量在内存中的具体存储形式" class="headerlink" title="4.JavaScript中的变量在内存中的具体存储形式"></a>4.<code>JavaScript</code>中的变量在内存中的具体存储形式</h4><p><code>JavaScript</code> 中的变量分为基本类型和引用类型:</p><p>基本类型: 保存在栈内存中的简单数据段，它们的值都有固定的大小，保存在栈空间，通过按值访问</p><p>引用类型: 保存在堆内存中的对象，值大小不固定，栈内存中存放的该对象的访问地址指向堆内存中的对象，<code>JavaScript</code> 不允许直接访问堆内存中的位置，因此操作对象时，实际操作对象的引用</p><h4 id="5-基本类型对应的内置对象，以及他们之间的装箱类型的拆箱操作"><a href="#5-基本类型对应的内置对象，以及他们之间的装箱类型的拆箱操作" class="headerlink" title="5.基本类型对应的内置对象，以及他们之间的装箱类型的拆箱操作"></a>5.基本类型对应的内置对象，以及他们之间的装箱类型的拆箱操作</h4><p>String，Number，Boolean</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// 隐式装箱： 每当读取一个基本类型的值时，后台会创建一个该基本类型所对应的对象。</span><br><span class="line">  // 在这个基本类型上调用方法，其实是在这个基本类型对象上调用方法。</span><br><span class="line">  // 这个基本类型的对象是临时的，它只存在于方法调用那一行代码执行的瞬间，执行方法后立刻被销毁。</span><br><span class="line">  let num=123;</span><br><span class="line">  num.toFixed(2); // &apos;123.00&apos;//上方代码在后台的真正步骤为</span><br><span class="line">  var c = new Number(123);</span><br><span class="line">  c.toFixed(2);</span><br><span class="line">  c = null;</span><br><span class="line">  // 显式装箱: 通过内置对象 Boolean、Object、String 等可以对基本类型进行显示装箱。</span><br><span class="line">  var obj = new String(&apos;123&apos;);</span><br></pre></td></tr></table></figure><h4 id="6-理解值类型和引用类型"><a href="#6-理解值类型和引用类型" class="headerlink" title="6.理解值类型和引用类型"></a>6.理解值类型和引用类型</h4><p>赋值传引用地址，值类型直接赋值</p><h4 id="7-null和undefined的区别"><a href="#7-null和undefined的区别" class="headerlink" title="7.null和undefined的区别"></a>7.<code>null</code>和<code>undefined</code>的区别</h4><p>undefined类型表示未定义，值只有一个undefined，</p><p>undefined是一个变量，而非关键字。</p><p>而Null只有一个值，null，表示空值，是关键字，可以通过null关键字来获取null值</p><h4 id="8-至少可以说出三种判断JavaScript数据类型的方式，以及他们的优缺点，如何准确的判断数组类型"><a href="#8-至少可以说出三种判断JavaScript数据类型的方式，以及他们的优缺点，如何准确的判断数组类型" class="headerlink" title="8.至少可以说出三种判断JavaScript数据类型的方式，以及他们的优缺点，如何准确的判断数组类型"></a>8.至少可以说出三种判断<code>JavaScript</code>数据类型的方式，以及他们的优缺点，如何准确的判断数组类型</h4><p>typeof </p><p>instanceof</p><p>constructor</p><p>Object,prototype.toString.call([])==’[object Array]’</p><p>Array.isArray()</p><h4 id="9-可能发生隐式类型转换的场景以及转换原则，应如何避免或巧妙应用"><a href="#9-可能发生隐式类型转换的场景以及转换原则，应如何避免或巧妙应用" class="headerlink" title="9.可能发生隐式类型转换的场景以及转换原则，应如何避免或巧妙应用"></a>9.可能发生隐式类型转换的场景以及转换原则，应如何避免或巧妙应用</h4><ul><li>isNaN ()</li><li>自增/自减运算符：<code>++</code>、<code>—-</code></li><li>正号/负号：<code>+a</code>、<code>-a</code></li><li>加号：<code>+</code></li><li>运算符：<code>-</code>、<code>*</code>、<code>/</code></li><li><p>==在不同类型时进行隐式类型转换</p><ul><li>会先判断是否在对比 null 和 undefined，是的话就会返回 true</li><li>判断两者类型是否为 string 和 number，是的话就会将字符串转换为 number</li><li>判断其中一方是否为 boolean，是的话就会把 boolean 转为 number 再进行判断</li><li>判断其中一方是否为 object 且另一方为 string、number 或者 symbol，是的话就会把 object 转为原始类型再进行判断</li><li>两边都是对象的话，那么只要不是同一对象的不同引用，都为false</li></ul></li><li><p>逻辑运算符：<code>&amp;&amp;</code>、<code>||</code>、<code>！</code> 。非布尔值进行<strong>与或</strong>运算时，会先将其转换为布尔值，然后再运算，但运算结果是<strong>原值</strong>。具体可以看下一篇文章《运算符》。</p></li><li><p>关系运算符：<code>&lt;</code>、<code>&gt;</code> <code>&lt;=</code> <code>&gt;=</code>等。关系运算符，得到的运算结果都是布尔值：要么是true，要么是false。</p></li></ul><h4 id="10-出现小数精度丢失的原因，JavaScript可以存储的最大数字、最大安全数字，JavaScript处理大数字的方法、避免精度丢失的方法"><a href="#10-出现小数精度丢失的原因，JavaScript可以存储的最大数字、最大安全数字，JavaScript处理大数字的方法、避免精度丢失的方法" class="headerlink" title="10.出现小数精度丢失的原因，JavaScript可以存储的最大数字、最大安全数字，JavaScript处理大数字的方法、避免精度丢失的方法"></a>10.出现小数精度丢失的原因，<code>JavaScript</code>可以存储的最大数字、最大安全数字，<code>JavaScript</code>处理大数字的方法、避免精度丢失的方法</h4><ul><li>精度丢失原因，说是 <code>JavaScript</code> 使用了 <code>IEEE 754</code> 规范，二进制储存十进制的小数时不能完整的表示小数</li><li>能够表示的最大数字 <code>Number.MAX_VALUE</code> 等于 <code>1.7976931348623157e+308</code> ,最大安全数字 <code>Number.MAX_SAFE_INTEGER</code> 等于 <code>9007199254740991</code></li><li>避免精度丢失<ul><li>计算小数时，先乘 <code>100</code> 或 <code>1000</code>，变成整数再运算</li><li>如果值超出了安全整数，有一个最新提案，<code>BigInt</code> 大整数，它可以表示任意大小的整数，注意只能表示整数，而不受安全整数的限制</li></ul></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;前端自检清单JavaScript基础1–变量和类型&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="前端" scheme="http://11wy11.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
      <category term="js基础" scheme="http://11wy11.github.io/tags/js%E5%9F%BA%E7%A1%80/"/>
    
  </entry>
  
  <entry>
    <title>emmet-grammar</title>
    <link href="http://11wy11.github.io/2020/03/30/emmet-grammar/"/>
    <id>http://11wy11.github.io/2020/03/30/emmet-grammar/</id>
    <published>2020-03-30T03:04:52.000Z</published>
    <updated>2020-09-19T08:18:54.312Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><p>emmet是一个提高前端开发效率的工具。</p><h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><h4 id="后代-gt"><a href="#后代-gt" class="headerlink" title="后代&gt;"></a>后代&gt;</h4><p>nav&gt;ul&gt;li</p><h4 id="兄弟"><a href="#兄弟" class="headerlink" title="兄弟+"></a>兄弟+</h4><p>div+p</p><h4 id="上级"><a href="#上级" class="headerlink" title="上级^"></a>上级^</h4><p>div+div&gt;p^span</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="分组"><a href="#分组" class="headerlink" title="分组()"></a>分组()</h4><p>div&gt;(header&gt;ul&gt;li*2)+content+footer</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">header</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">content</span>&gt;</span><span class="tag">&lt;/<span class="name">content</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">footer</span>&gt;</span><span class="tag">&lt;/<span class="name">footer</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="乘法"><a href="#乘法" class="headerlink" title="乘法*"></a>乘法*</h4><h4 id="自增符号"><a href="#自增符号" class="headerlink" title="自增符号$"></a>自增符号$</h4><p>ul&gt;li.item$*5</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item1"</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item2"</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"item3"</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br></pre></td></tr></table></figure><p>$@- 倒着的</p><p>$@x x开头</p><h4 id="ID和类属性"><a href="#ID和类属性" class="headerlink" title="ID和类属性"></a>ID和类属性</h4><p>#xxx, .xxx</p><p>form#search.wide</p><h4 id="自定义属性"><a href="#自定义属性" class="headerlink" title="自定义属性"></a>自定义属性</h4><p>img[data-src=”xxx”]</p><h4 id="文本"><a href="#文本" class="headerlink" title="文本"></a>文本</h4><p>{}  p{click}+a{here}</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>click<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">""</span>&gt;</span>here<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="HTML"><a href="#HTML" class="headerlink" title="HTML"></a>HTML</h4><p>! </p><p>a</p><p>a:link</p><p>a:mail</p><p>link:css</p><p>input:password</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;emmet是一个提高前端开发效率的工具。&lt;/p&gt;
&lt;h3 id=&quot;使用方法&quot;&gt;&lt;a href=&quot;#使用方法&quot; class=&quot;headerlink&quot; title=&quot;使用方法&quot;&gt;&lt;/a&gt;使用方法&lt;/h3&gt;&lt;h4 id=&quot;后代-gt&quot;&gt;&lt;a h
      
    
    </summary>
    
      <category term="前端" scheme="http://11wy11.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
      <category term="工具" scheme="http://11wy11.github.io/tags/%E5%B7%A5%E5%85%B7/"/>
    
  </entry>
  
  <entry>
    <title>日常技巧</title>
    <link href="http://11wy11.github.io/2020/03/28/daily-skill-1/"/>
    <id>http://11wy11.github.io/2020/03/28/daily-skill-1/</id>
    <published>2020-03-28T14:11:05.000Z</published>
    <updated>2021-03-10T13:05:25.832Z</updated>
    
    <content type="html"><![CDATA[<p>使用百度搜索资源平台的链接提交工具，推送博文，增加搜索可能。</p><a id="more"></a><h3 id="百度搜索资源平台"><a href="#百度搜索资源平台" class="headerlink" title="百度搜索资源平台"></a>百度搜索资源平台</h3><p><a href="https://ziyuan.baidu.com/linksubmit/" target="_blank" rel="noopener">https://ziyuan.baidu.com/linksubmit/</a></p><p>目前由于GitHub的机制，GitHub.io 的博客无法被有效爬虫搜索，一般只提交CSDN同步的一些博文。</p><p>以前可以的，现在需要先注册主站，才能解锁一些功能。恩，是时候搭建一个自己的站点了。</p><p>网上找到的，将自己的博文地址贴到下方的网址里，可以主动向百度搜索推送，加快抓取速度。不过亲测关键还是得自己博文写得能够吸引人，能真的解决大家的问题。</p><h3 id="提交非验证站点的链接"><a href="#提交非验证站点的链接" class="headerlink" title="提交非验证站点的链接"></a>提交非验证站点的链接</h3><p><a href="https://ziyuan.baidu.com/linksubmit/url" target="_blank" rel="noopener">https://ziyuan.baidu.com/linksubmit/url</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;使用百度搜索资源平台的链接提交工具，推送博文，增加搜索可能。&lt;/p&gt;
    
    </summary>
    
      <category term="使用技巧" scheme="http://11wy11.github.io/categories/%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/"/>
    
    
      <category term="搜索" scheme="http://11wy11.github.io/tags/%E6%90%9C%E7%B4%A2/"/>
    
  </entry>
  
  <entry>
    <title>VueAreaLinkage 设置默认值无效修改办法</title>
    <link href="http://11wy11.github.io/2020/03/28/vue-linkage-bug/"/>
    <id>http://11wy11.github.io/2020/03/28/vue-linkage-bug/</id>
    <published>2020-03-28T11:01:48.000Z</published>
    <updated>2020-09-19T08:18:54.322Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><p>关于使用VueAreaLinkage，自定义数据，动态设置绑定的数组后，行政区划组件上的label不发生变化的解决办法。</p><h3 id="组件基本介绍及使用场景"><a href="#组件基本介绍及使用场景" class="headerlink" title="组件基本介绍及使用场景"></a>组件基本介绍及使用场景</h3><blockquote><p>[vueAreaLinkage]<a href="https://www.npmjs.com/package/vue-area-linkage" target="_blank" rel="noopener">https://www.npmjs.com/package/vue-area-linkage</a>    “vueAreaLinkage”</p></blockquote><h4 id="VueAreaLinkage安装使用"><a href="#VueAreaLinkage安装使用" class="headerlink" title="VueAreaLinkage安装使用"></a>VueAreaLinkage安装使用</h4><p>5.0版本之后，可以通过<code>npm install vue-area-linkage --save</code>和<code>npm install area-data --save</code>安装依赖，在main.js种引入</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> VueAreaLinkage <span class="keyword">from</span> <span class="string">'vue-area-linkage'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'vue-area-linkage/dist/index.css'</span></span><br><span class="line"> Vue.use(VueAreaLinkage)</span><br><span class="line">    在页面组件内</span><br><span class="line"><span class="keyword">import</span> &#123; pca, pcaa &#125; <span class="keyword">from</span> <span class="string">'area-data'</span>; <span class="comment">// 城市数据</span></span><br><span class="line">    </span><br><span class="line">   <span class="comment">// 在data中定义数据：</span></span><br><span class="line">selected: [],</span><br><span class="line">pca: pca,</span><br><span class="line"> pcaa: pcaa</span><br></pre></td></tr></table></figure><p>下面主要介绍之前版本直接将源代码引入项目中并根据需要修改代码，符合自己的应用场景。</p><h4 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h4><p>实现市，县，乡三级联动，并通过点击地图区域，动态设置行政区划选择默认值。未修改的代码使用是，第一次设置默认值是生效的，之后通过修改绑定的selected数组，无法改变行政区划选择器上的label显示，下面主要介绍如何通过修改组件源码，实现设置默认值，行政区划自动更新。</p><p>自定义的region数据结构如下：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2020/03/28/vue-linkage-bug/image-20200328205049168.png" alt="image-20200328205049168" title>                </div>                <div class="image-caption">image-20200328205049168</div>            </figure><h3 id="VueAreaLinkage修改绑定Label不更新解决方案"><a href="#VueAreaLinkage修改绑定Label不更新解决方案" class="headerlink" title="VueAreaLinkage修改绑定Label不更新解决方案"></a>VueAreaLinkage修改绑定Label不更新解决方案</h3><p>以area-cascader组件为例</p><ol><li><p><strong>根据自己的region数据，修改area-cascader中index.vue中的getActiveLabels函数，将获取provinces的Key设置为自己的，以贵阳市为例，修改源代码中的86为52.area-select组件做类似处理</strong></p><p><img src="/2020/03/28/vue-linkage-bug/image-20200328204808766.png" alt="image-20200328204808766"></p></li><li><p><strong>修改area-cascader&gt;index.vue,修改SetDefaultValue函数，源代码中setDefaultValue只动态设置provinceCode和province，但因为业务需求只有一个市，所以动态设置selected数组时，label不及时更新，因为不会激活设置SetDefaultCode函数，因此，这里首先需要修改动态添加默认值所选中的县和乡。修改代码如下：</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">setDefaultValue() &#123;</span><br><span class="line">      <span class="keyword">let</span> provinceCode = <span class="string">""</span>;</span><br><span class="line">      <span class="keyword">let</span> cityCode = <span class="string">""</span>;</span><br><span class="line">      <span class="keyword">let</span> areaCode = <span class="string">""</span>;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.isCode) &#123;</span><br><span class="line">        provinceCode = <span class="keyword">this</span>.defaults[<span class="number">0</span>];</span><br><span class="line">        cityCode = <span class="keyword">this</span>.defaults[<span class="number">1</span>];</span><br><span class="line">        areaCode = <span class="keyword">this</span>.defaults[<span class="number">2</span>];</span><br><span class="line">        <span class="keyword">this</span>.curCityCode = cityCode;</span><br><span class="line">        <span class="keyword">this</span>.curAreaCode = areaCode;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> province = find(</span><br><span class="line">          <span class="keyword">this</span>.provinces,</span><br><span class="line">          item =&gt; item === <span class="keyword">this</span>.defaults[<span class="number">0</span>]</span><br><span class="line">        );</span><br><span class="line">        assert(province, <span class="string">`城市 <span class="subst">$&#123;<span class="keyword">this</span>.defaults[<span class="number">0</span>]&#125;</span> 不存在`</span>);</span><br><span class="line">        provinceCode = find(</span><br><span class="line">          <span class="built_in">Object</span>.keys(<span class="keyword">this</span>.provinces),</span><br><span class="line">          item =&gt; <span class="keyword">this</span>.provinces[item] === <span class="keyword">this</span>.defaults[<span class="number">0</span>]</span><br><span class="line">        );</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">this</span>.curProvinceCode = provinceCode;</span><br><span class="line">      <span class="comment">//-------------------------修改start</span></span><br><span class="line">      <span class="comment">//手动激活县变化</span></span><br><span class="line">      <span class="keyword">this</span>.citys = <span class="keyword">this</span>.data[<span class="keyword">this</span>.curProvinceCode];</span><br><span class="line">      <span class="keyword">if</span> (!<span class="keyword">this</span>.citys) &#123;</span><br><span class="line">        <span class="keyword">this</span>.citys = &#123;</span><br><span class="line">          [<span class="keyword">this</span>.curProvinceCode]: <span class="keyword">this</span>.curProvince</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">this</span>.curCity = <span class="keyword">this</span>.curProvince;</span><br><span class="line">        <span class="keyword">this</span>.curCityCode = <span class="keyword">this</span>.curCityCode;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> curCity = <span class="built_in">Object</span>.values(<span class="keyword">this</span>.citys)[<span class="number">0</span>];</span><br><span class="line">      <span class="keyword">let</span> curCityCode = <span class="built_in">Object</span>.keys(<span class="keyword">this</span>.citys)[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.defaults[<span class="number">1</span>]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.isCode) &#123;</span><br><span class="line">          curCityCode = find(</span><br><span class="line">            <span class="built_in">Object</span>.keys(<span class="keyword">this</span>.citys),</span><br><span class="line">            item =&gt; item === <span class="keyword">this</span>.defaults[<span class="number">1</span>]</span><br><span class="line">          );</span><br><span class="line">          assert(</span><br><span class="line">            curCityCode,</span><br><span class="line">            <span class="string">`城市 <span class="subst">$&#123;<span class="keyword">this</span>.defaults[<span class="number">1</span>]&#125;</span> 不存在于省份 <span class="subst">$&#123;<span class="keyword">this</span>.defaults[<span class="number">0</span>]&#125;</span> 中`</span></span><br><span class="line">          );</span><br><span class="line">          curCity = <span class="keyword">this</span>.citys[curCityCode];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          curCity = find(<span class="keyword">this</span>.citys, item =&gt; item === <span class="keyword">this</span>.defaults[<span class="number">1</span>]);</span><br><span class="line">          assert(</span><br><span class="line">            curCity,</span><br><span class="line">            <span class="string">`城市 <span class="subst">$&#123;<span class="keyword">this</span>.defaults[<span class="number">1</span>]&#125;</span> 不存在于省份 <span class="subst">$&#123;<span class="keyword">this</span>.defaults[<span class="number">0</span>]&#125;</span> 中`</span></span><br><span class="line">          );</span><br><span class="line">          curCityCode = find(</span><br><span class="line">            <span class="built_in">Object</span>.keys(<span class="keyword">this</span>.citys),</span><br><span class="line">            item =&gt; <span class="keyword">this</span>.citys[item] === <span class="keyword">this</span>.defaults[<span class="number">1</span>]</span><br><span class="line">          );</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">this</span>.curCity = curCity;</span><br><span class="line">      <span class="keyword">this</span>.curCityCode = curCityCode;</span><br><span class="line">      <span class="comment">//手动添加镇</span></span><br><span class="line">      <span class="keyword">this</span>.areas = <span class="keyword">this</span>.data[<span class="keyword">this</span>.curCityCode];</span><br><span class="line">      <span class="keyword">if</span> (!<span class="keyword">this</span>.areas) &#123;</span><br><span class="line">        <span class="keyword">this</span>.areas = &#123;</span><br><span class="line">          [<span class="keyword">this</span>.curCityCode]: <span class="keyword">this</span>.curCity</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">this</span>.curArea = <span class="keyword">this</span>.curCity;</span><br><span class="line">        <span class="keyword">this</span>.curAreaCode = <span class="keyword">this</span>.curCityCode;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">let</span> curArea = <span class="built_in">Object</span>.values(<span class="keyword">this</span>.areas)[<span class="number">0</span>];</span><br><span class="line">      <span class="keyword">let</span> curAreaCode = <span class="built_in">Object</span>.keys(<span class="keyword">this</span>.areas)[<span class="number">0</span>];</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.defaults[<span class="number">2</span>]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.isCode) &#123;</span><br><span class="line">          curAreaCode = find(</span><br><span class="line">            <span class="built_in">Object</span>.keys(<span class="keyword">this</span>.areas),</span><br><span class="line">            item =&gt; item == <span class="keyword">this</span>.defaults[<span class="number">2</span>]</span><br><span class="line">          );</span><br><span class="line">          assert(</span><br><span class="line">            curAreaCode,</span><br><span class="line">            <span class="string">`乡镇 <span class="subst">$&#123;<span class="keyword">this</span>.defaults[<span class="number">2</span>]&#125;</span> 不存在于县区 <span class="subst">$&#123;<span class="keyword">this</span>.defaults[<span class="number">1</span>]&#125;</span> 中`</span></span><br><span class="line">          );</span><br><span class="line">          curArea = <span class="keyword">this</span>.areas[curAreaCode];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">          curArea = find(<span class="keyword">this</span>.areas, item =&gt; item == <span class="keyword">this</span>.defaults[<span class="number">2</span>]);</span><br><span class="line">          assert(</span><br><span class="line">            curArea,</span><br><span class="line">            <span class="string">`乡镇 <span class="subst">$&#123;<span class="keyword">this</span>.defaults[<span class="number">2</span>]&#125;</span> 不存在于县区 <span class="subst">$&#123;<span class="keyword">this</span>.defaults[<span class="number">1</span>]&#125;</span> 中`</span></span><br><span class="line">          );</span><br><span class="line">          curAreaCode = find(</span><br><span class="line">            <span class="built_in">Object</span>.keys(<span class="keyword">this</span>.areas),</span><br><span class="line">            item =&gt; <span class="keyword">this</span>.areas[item] === <span class="keyword">this</span>.defaults[<span class="number">2</span>]</span><br><span class="line">          );</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">this</span>.curArea = curArea;</span><br><span class="line">      <span class="keyword">this</span>.curAreaCode = curAreaCode;</span><br><span class="line"><span class="comment">//-------------------------修改end</span></span><br><span class="line">      <span class="comment">//this.$refs.cascader.setValue(this.defaultsAreaCodes)</span></span><br><span class="line">      <span class="comment">// 还原默认值，避免用户选择出错</span></span><br><span class="line">      <span class="keyword">this</span>.$nextTick(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">this</span>.defaults = [];</span><br><span class="line">        <span class="comment">// this.isCode = false;</span></span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;,</span><br></pre></td></tr></table></figure></li></ol><ol start="3"><li><p><strong>源代码为了避免循环调用SetDefaultCode函数，有一个<code>isSetDefault</code>的变量，标识是否已经更新设置行政区划，这里也需要改一下，因为源代码中<code>curAreaCode</code>的watch监听中没有将其设置为false，因此，即使手动设置了<code>curAreaCode</code>值，但因为没有改变绑定的defaultAreaCodes因此组件内部没有更新。</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">curAreaCode(val) &#123;</span><br><span class="line">     <span class="keyword">this</span>.curArea = <span class="keyword">this</span>.areas[val];</span><br><span class="line">     <span class="keyword">this</span>.curAreaCode = val;</span><br><span class="line">     <span class="comment">//0328 add by weiyuan to resolve setDefault not to change</span></span><br><span class="line">     <span class="keyword">this</span>.isSetDefault=<span class="literal">false</span></span><br><span class="line">     <span class="keyword">this</span>.setDefaultsCodes();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>至此，完美解决修改绑定的数组值，VueAreaLinkage组件Label不更新问题。</p><h3 id="项目使用实例代码"><a href="#项目使用实例代码" class="headerlink" title="项目使用实例代码"></a>项目使用实例代码</h3><p><strong>首先main.js中注册组件并初始化region，</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import region from &apos;./assets/area-data/region&apos;</span><br><span class="line">import VueAreaLinkage from &apos;./components/area-utils/index&apos;</span><br><span class="line">Vue.use(VueAreaLinkage)</span><br><span class="line">Vue.prototype.$region = region</span><br></pre></td></tr></table></figure><p><strong>使用area-cascader封装cityPicker组件,这里还增加了根据权限过滤region数据，实现行政区划选择性显示</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">&lt;template&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;area-cascader :level=&quot;level&quot; v-model=&quot;valueArray&quot; :data=&quot;permissionData&quot; v-if=&quot;Object.keys(permissionData).length&quot; /&gt;</span><br><span class="line">    &lt;!--&lt;div&gt;&#123;&#123;selected&#125;&#125;&lt;/div&gt;--&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/template&gt;</span><br><span class="line"></span><br><span class="line">&lt;script&gt;</span><br><span class="line">import AreaCascader from &quot;./area-cascader/cascader&quot;;</span><br><span class="line">export default &#123;</span><br><span class="line">  name: &quot;CityPicker&quot;,</span><br><span class="line">  props: &#123;</span><br><span class="line">    level: &#123;</span><br><span class="line">      type: Number,</span><br><span class="line">      required: false,</span><br><span class="line">      default: 0</span><br><span class="line">    &#125;,</span><br><span class="line">    selected: &#123;</span><br><span class="line">      type: Array,</span><br><span class="line">      default: [&quot;5201&quot;, &quot;520100&quot;]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  component: &#123; &quot;area-cascader&quot;: AreaCascader &#125;,</span><br><span class="line">  data() &#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      valueArray: [],</span><br><span class="line">      permissionData: &#123;&#125;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;,</span><br><span class="line">  created() &#123;</span><br><span class="line">    this.valueArray = [].concat(this.selected);</span><br><span class="line">  &#125;,</span><br><span class="line">  mounted() &#123;</span><br><span class="line">    //需要根据权限筛选region数据</span><br><span class="line">    let user = JSON.parse(window.sessionStorage.getItem(&quot;access-user&quot;));</span><br><span class="line">    if(!user)&#123;</span><br><span class="line">       this.permissionData = this.$region;</span><br><span class="line">       return</span><br><span class="line">    &#125;</span><br><span class="line">    this.userName = user.username;</span><br><span class="line">    this.role = user.role;</span><br><span class="line">    this.regionid = user.pac;</span><br><span class="line">    if (this.regionid != undefined &amp;&amp; this.regionid != &quot;5201&quot;) &#123;</span><br><span class="line">      let allRegion = Object.assign(&#123;&#125;, this.$region);</span><br><span class="line">      if (this.regionid.length == 6) &#123;</span><br><span class="line">        //县级</span><br><span class="line">        let city = allRegion[&quot;5201&quot;];</span><br><span class="line">        for (var key in city) &#123;</span><br><span class="line">          if (key != this.regionid) &#123;</span><br><span class="line">            delete city[key];</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        for (var key in allRegion) &#123;</span><br><span class="line">          if (key.length &lt; 6) &#123;</span><br><span class="line">            continue;</span><br><span class="line">          &#125;</span><br><span class="line">          if (key != this.regionid) &#123;</span><br><span class="line">            delete allRegion[key];</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        this.permissionData = allRegion;</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        //镇级</span><br><span class="line">        this.permissionData = [];</span><br><span class="line">        let countyId = this.regionid.substring(0, 6);</span><br><span class="line">        let city = allRegion[&quot;5201&quot;];</span><br><span class="line">        let county = allRegion[countyId];</span><br><span class="line">        for (var key in city) &#123;</span><br><span class="line">          if (key != countyId) &#123;</span><br><span class="line">            delete city[key];</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        for (var key in allRegion) &#123;</span><br><span class="line">          if (key.length &lt; 6) &#123;</span><br><span class="line">            continue;</span><br><span class="line">          &#125;</span><br><span class="line">          if (key != countyId) &#123;</span><br><span class="line">            delete allRegion[key];</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        for (var key in county) &#123;</span><br><span class="line">          if (key != this.regionid) &#123;</span><br><span class="line">            delete county[key];</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        this.permissionData = allRegion;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      this.permissionData = this.$region;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  watch: &#123;</span><br><span class="line">    valueArray(curVal, oldVal) &#123;</span><br><span class="line">      if(curVal!=oldVal)&#123;</span><br><span class="line">this.$emit(&quot;selected&quot;, curVal);</span><br><span class="line">      &#125;</span><br><span class="line">      </span><br><span class="line">    &#125;,</span><br><span class="line">    selected(curVal, oldVal) &#123;</span><br><span class="line">      this.valueArray = [].concat(this.selected);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style scoped&gt;</span><br><span class="line">&lt;/style&gt;</span><br></pre></td></tr></table></figure><p><strong>使用</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;CityPicker</span><br><span class="line">                style=&quot;width:100%&quot;</span><br><span class="line">                @selected=&quot;selectSearchRegion&quot;</span><br><span class="line">                :selected=&quot;searchRegionArray&quot;</span><br><span class="line">                :level=&quot;1&quot;</span><br><span class="line">              /&gt;</span><br><span class="line">//需要动态修改是直接给searchRegionArray赋值即可，注意数组长度需要和联动级数匹配，即三级联动，数组需要长度为三</span><br></pre></td></tr></table></figure><h3 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h3><p><img src="/2020/03/28/vue-linkage-bug/citypicker-1585403838216.gif" alt></p></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;p&gt;关于使用VueAreaLinkage，自定义数据，动态设置绑定的数组后，行政区划组件上的label不发生变化的解决办法。&lt;/p&gt;
&lt;h3 id=&quot;组件基本介绍及使用场景&quot;&gt;&lt;a href=&quot;#组件基本介绍及使用场景&quot; class=&quot;hea
      
    
    </summary>
    
      <category term="前端" scheme="http://11wy11.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
      <category term="Vue 组件" scheme="http://11wy11.github.io/tags/Vue-%E7%BB%84%E4%BB%B6/"/>
    
  </entry>
  
  <entry>
    <title>日常知识--NodeJS进阶（一）</title>
    <link href="http://11wy11.github.io/2019/06/17/daily-nodejs-1/"/>
    <id>http://11wy11.github.io/2019/06/17/daily-nodejs-1/</id>
    <published>2019-06-17T03:48:55.000Z</published>
    <updated>2019-06-17T13:25:37.567Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;

      
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>日常知识点整理--MongoDB数据库初探</title>
    <link href="http://11wy11.github.io/2019/06/17/daily-mongodb-first/"/>
    <id>http://11wy11.github.io/2019/06/17/daily-mongodb-first/</id>
    <published>2019-06-17T01:46:55.000Z</published>
    <updated>2019-06-17T02:37:24.824Z</updated>
    
    <content type="html"><![CDATA[<p>mongodb数据库初次使用</p><a id="more"></a><h2 id="MongoDB安装"><a href="#MongoDB安装" class="headerlink" title="MongoDB安装"></a>MongoDB安装</h2><p>网上相关资料很多，需要自取，这里我使用ZIP安装包，解压到你想安装的目录，然后将bin目录的路径添加到环境变量中，可以在命令行中执行 mongod –help 查看是否配置成功</p><h2 id="设置数据目录等"><a href="#设置数据目录等" class="headerlink" title="设置数据目录等"></a>设置数据目录等</h2><p>可以新建一个MongoDBData的文件夹，里面创建log和db两个子文件夹，在命令行工具中打开到bin目录，执行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongod --logpath &quot;I:\Program Files\MongoDBData\log\mongodb.log&quot; --logappend --dbpath &quot;I:Program Files\MongoDBData\db&quot; --directoryperdb --install</span><br></pre></td></tr></table></figure><h2 id="命令行下运行MongoDB"><a href="#命令行下运行MongoDB" class="headerlink" title="命令行下运行MongoDB"></a>命令行下运行MongoDB</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net start MongoDB</span><br></pre></td></tr></table></figure><h2 id="连接MongoDB"><a href="#连接MongoDB" class="headerlink" title="连接MongoDB"></a>连接MongoDB</h2><p>运行mongo.exe</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">I:\Program Files\mongodb-4.0.10\bin&gt;mongo.exe</span><br></pre></td></tr></table></figure><h2 id="配置MongoDB服务"><a href="#配置MongoDB服务" class="headerlink" title="配置MongoDB服务"></a>配置MongoDB服务</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">systemLog:</span><br><span class="line">    destination: file</span><br><span class="line">    path: I:\Program Files\MongoDBData\log\mongodb.log</span><br><span class="line">storage:</span><br><span class="line">    dbPath: I:\Program Files\MongoDBData\db</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">I:\Program Files\mongodb-4.0.10\bin&gt;mongo.exe</span><br><span class="line">&gt;--config &quot;C:\mongodb\mongod.cfg&quot; --install</span><br></pre></td></tr></table></figure><p>但是我失败了，不管了，目测和<strong>设置数据目录</strong>等最找效果是一样的O(∩_∩)O</p><h2 id="MongoDB设置密码"><a href="#MongoDB设置密码" class="headerlink" title="MongoDB设置密码"></a>MongoDB设置密码</h2><ol><li><p>进入mongo.exe之后，执行show dbs可以查看现有数据库</p></li><li><p><code>use admin</code>进入admin数据库</p></li><li><p>创建管理员账户</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.createUser(&#123; user: "admin", pwd: "adminpassword", roles: [&#123; role: "userAdminAnyDatabase", db: "admin" &#125;] &#125;)</span><br></pre></td></tr></table></figure><p>mongodb中的用户是基于身份role的，该管理员账户的 role是 userAdminAnyDatabase。 ‘userAdmin’代表用户管理身份，’AnyDatabase’ 代表可以管理任何数据库。</p></li><li><p>验证用户是否成功添加</p><p><code>db.auth(&quot;admin&quot;, &quot;adminpassword&quot;)</code> 如果返回1，则表示成功。</p></li><li><p>exit退出</p></li><li><p>此时可以使用创建的用户和密码通过MongoDB Compass连接数据库，进行相关操作了</p></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;mongodb数据库初次使用&lt;/p&gt;
    
    </summary>
    
      <category term="日常" scheme="http://11wy11.github.io/categories/%E6%97%A5%E5%B8%B8/"/>
    
    
      <category term="数据库" scheme="http://11wy11.github.io/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>日常整理之mysql密码重置</title>
    <link href="http://11wy11.github.io/2019/06/16/daily-mysql-reset-password/"/>
    <id>http://11wy11.github.io/2019/06/16/daily-mysql-reset-password/</id>
    <published>2019-06-16T13:29:36.000Z</published>
    <updated>2019-06-16T14:33:37.443Z</updated>
    
    <content type="html"><![CDATA[<p>本人没有保管号自己mysql的密码，致使无法登陆上</p><a id="more"></a><h3 id="mysql密码重置"><a href="#mysql密码重置" class="headerlink" title="mysql密码重置"></a>mysql密码重置</h3><h4 id="1-修改my-ini-文件"><a href="#1-修改my-ini-文件" class="headerlink" title="1. 修改my.ini 文件"></a>1. 修改my.ini 文件</h4><p>在安装目录（如 I:\Program Files\mysql-8.0.15-winx64）下找到或新建my.ini；在[mysqld]段下面加入skip-grant-tables，并关闭mysql服务</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[mysql]</span></span><br><span class="line"><span class="comment"># 设置mysql客户端默认字符集</span></span><br><span class="line"><span class="attr">default-character-set</span>=utf8</span><br><span class="line"> </span><br><span class="line"><span class="section">[mysqld]</span></span><br><span class="line">skip-grant-tables</span><br><span class="line"><span class="comment"># 设置3306端口</span></span><br><span class="line"><span class="attr">port</span> = <span class="number">3306</span></span><br><span class="line"><span class="comment"># 设置mysql的安装目录</span></span><br><span class="line"><span class="attr">basedir</span>=I:\\Program Files\\mysql-<span class="number">8.0</span>.<span class="number">15</span>-winx64</span><br><span class="line"><span class="comment"># 设置 mysql数据库的数据的存放目录，MySQL 8+ 不需要以下配置，系统自己生成即可，否则有可能报错</span></span><br><span class="line"><span class="attr">datadir</span>=I:\\Program Files\\mysql-<span class="number">8.0</span>.<span class="number">15</span>-winx64\data</span><br><span class="line"><span class="comment"># datadir=C:\\web\\sqldata</span></span><br><span class="line"><span class="comment"># 允许最大连接数</span></span><br><span class="line"><span class="attr">max_connections</span>=<span class="number">20</span></span><br><span class="line"><span class="comment"># 服务端使用的字符集默认为8比特编码的latin1字符集</span></span><br><span class="line"><span class="attr">character-set-server</span>=utf8</span><br><span class="line"><span class="comment"># 创建新表时将使用的默认存储引擎</span></span><br><span class="line"><span class="attr">default-storage-engine</span>=INNODB</span><br></pre></td></tr></table></figure><h4 id="2-使用cd指令切换到mysql的bin目录"><a href="#2-使用cd指令切换到mysql的bin目录" class="headerlink" title="2. 使用cd指令切换到mysql的bin目录"></a>2. 使用cd指令切换到mysql的bin目录</h4><h4 id="3-执行mysqld-–console-–skip-grant-tables-–shared-memory"><a href="#3-执行mysqld-–console-–skip-grant-tables-–shared-memory" class="headerlink" title="3. 执行mysqld  –console –skip-grant-tables –shared-memory"></a>3. 执行mysqld  –console –skip-grant-tables –shared-memory</h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2019/06/16/daily-mysql-reset-password/1560692598969.png" alt="1560692598969" title>                </div>                <div class="image-caption">1560692598969</div>            </figure><h4 id="4-在以管理员身份打开一个cmd命令行工具，输入mysql"><a href="#4-在以管理员身份打开一个cmd命令行工具，输入mysql" class="headerlink" title="4. 在以管理员身份打开一个cmd命令行工具，输入mysql"></a>4. 在以管理员身份打开一个cmd命令行工具，输入mysql</h4><p>此时不需要密码几个直接进入</p><h4 id="5-使用-use-mysql-然后执行一下命令可以查看密码"><a href="#5-使用-use-mysql-然后执行一下命令可以查看密码" class="headerlink" title="5.  使用 use mysql,然后执行一下命令可以查看密码"></a>5.  使用 use mysql,然后执行一下命令可以查看密码</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select user,host,authentication_string from user</span><br></pre></td></tr></table></figure><h4 id="6-修改密码-ALTER-USER-39-root-39-39-localhost-39-IDENTIFIED-BY-39-新密码-39"><a href="#6-修改密码-ALTER-USER-39-root-39-39-localhost-39-IDENTIFIED-BY-39-新密码-39" class="headerlink" title="6. 修改密码 ALTER USER &#39;root&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;新密码&#39;;"></a>6. 修改密码 <code>ALTER USER &#39;root&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;新密码&#39;;</code></h4><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2019/06/16/daily-mysql-reset-password/1560693166712.png" alt="1560693166712" title>                </div>                <div class="image-caption">1560693166712</div>            </figure><h4 id="7-执行flush-privileges"><a href="#7-执行flush-privileges" class="headerlink" title="7. 执行flush privileges"></a>7. 执行<code>flush privileges</code></h4><h4 id="8-quit-退出"><a href="#8-quit-退出" class="headerlink" title="8. quit 退出"></a>8. quit 退出</h4><h4 id="9-回到第一个命名行窗口-ctrl-c，停止，可以将my-ini中skip-grant-tables删除，之后再使用net-start-mysql启动"><a href="#9-回到第一个命名行窗口-ctrl-c，停止，可以将my-ini中skip-grant-tables删除，之后再使用net-start-mysql启动" class="headerlink" title="9. 回到第一个命名行窗口 ctrl+c，停止，可以将my.ini中skip-grant-tables删除，之后再使用net start mysql启动"></a>9. 回到第一个命名行窗口 ctrl+c，停止，可以将my.ini中skip-grant-tables删除，之后再使用net start mysql启动</h4><h4 id="10-mysql-u-root-p-输入新密码登录"><a href="#10-mysql-u-root-p-输入新密码登录" class="headerlink" title="10. mysql -u root -p 输入新密码登录"></a>10. mysql -u root -p 输入新密码登录</h4>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;本人没有保管号自己mysql的密码，致使无法登陆上&lt;/p&gt;
    
    </summary>
    
      <category term="日常" scheme="http://11wy11.github.io/categories/%E6%97%A5%E5%B8%B8/"/>
    
    
      <category term="mysql" scheme="http://11wy11.github.io/tags/mysql/"/>
    
  </entry>
  
  <entry>
    <title>日常知识--初识NodeJS</title>
    <link href="http://11wy11.github.io/2019/06/15/daily-nodejs/"/>
    <id>http://11wy11.github.io/2019/06/15/daily-nodejs/</id>
    <published>2019-06-15T12:57:01.000Z</published>
    <updated>2020-12-04T11:59:44.776Z</updated>
    
    <content type="html"><![CDATA[<p>整理来自菜鸟教程中nodejs入门知识</p><a id="more"></a><h2 id="0-Webstorm设置nodejs提示"><a href="#0-Webstorm设置nodejs提示" class="headerlink" title="0. Webstorm设置nodejs提示"></a>0. Webstorm设置nodejs提示</h2><p>File&gt;Settings&gt;Languages &amp; Frameworks&gt;javaScript&gt;Libraries, Add Nodejs提示库</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2019/06/15/daily-nodejs/TIM截图20190615205947.png" alt="设置图" title>                </div>                <div class="image-caption">设置图</div>            </figure><h2 id="1-模块系统"><a href="#1-模块系统" class="headerlink" title="1. 模块系统"></a>1. 模块系统</h2><p>Node.js 中自带了一个叫做 <strong>http</strong> 的模块，我们在我们的代码中请求它并把返回值赋给一个本地变量。</p><p>这把我们的本地变量变成了一个拥有所有 http 模块所提供的公共方法的对象。</p><p>Node.js 的 require 方法中的文件查找策略如下：</p><p>由于 Node.js 中存在 4 类模块（原生模块和3种文件模块），尽管 require 方法极其简单，但是内部的加载却是十分复杂的，其加载优先级也各自不同。如下图所示：</p><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://www.runoob.com/wp-content/uploads/2014/03/nodejs-require.jpg" alt="img" title>                </div>                <div class="image-caption">img</div>            </figure><h3 id="1-1-从文件模块缓存中加载"><a href="#1-1-从文件模块缓存中加载" class="headerlink" title="1.1 从文件模块缓存中加载"></a>1.1 从文件模块缓存中加载</h3><p>尽管原生模块与文件模块的优先级不同，但是都会优先从文件模块的缓存中加载已经存在的模块。</p><h3 id="1-2-从原生模块加载"><a href="#1-2-从原生模块加载" class="headerlink" title="1.2 从原生模块加载"></a>1.2 从原生模块加载</h3><p>原生模块的优先级仅次于文件模块缓存的优先级。require 方法在解析文件名之后，优先检查模块是否在原生模块列表中。以http模块为例，尽管在目录下存在一个 http/http.js/http.node/http.json 文件，require(“http”) 都不会从这些文件中加载，而是从原生模块中加载。</p><p>原生模块也有一个缓存区，同样也是优先从缓存区加载。如果缓存区没有被加载过，则调用原生模块的加载方式进行加载和执行。</p><h3 id="1-3-从文件加载"><a href="#1-3-从文件加载" class="headerlink" title="1.3 从文件加载"></a>1.3 从文件加载</h3><p>当文件模块缓存中不存在，而且不是原生模块的时候，Node.js 会解析 require 方法传入的参数，并从文件系统中加载实际的文件，这里我们将详细描述查找文件模块的过程，其中，也有一些细节值得知晓。</p><p>require方法接受以下几种参数的传递：</p><ul><li>http、fs、path等，原生模块。</li><li>./mod或../mod，相对路径的文件模块。</li><li>/pathtomodule/mod，绝对路径的文件模块。</li><li>mod，非原生模块的文件模块。</li></ul><p>在路径 Y 下执行 require(X) 语句执行顺序：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span> 如果 X 是内置模块</span><br><span class="line">   a. 返回内置模块</span><br><span class="line">   b. 停止执行</span><br><span class="line"><span class="number">2.</span> 如果 X 以 <span class="string">'/'</span> 开头</span><br><span class="line">   a. 设置 Y 为文件根路径</span><br><span class="line"><span class="number">3.</span> 如果 X 以 <span class="string">'./'</span> 或 <span class="string">'/'</span> or <span class="string">'../'</span> 开头</span><br><span class="line">   a. LOAD_AS_FILE(Y + X)</span><br><span class="line">   b. LOAD_AS_DIRECTORY(Y + X)</span><br><span class="line"><span class="number">4.</span> LOAD_NODE_MODULES(X, dirname(Y))</span><br><span class="line"><span class="number">5.</span> 抛出异常 <span class="string">"not found"</span></span><br><span class="line"></span><br><span class="line">LOAD_AS_FILE(X)</span><br><span class="line"><span class="number">1.</span> 如果 X 是一个文件, 将 X 作为 JavaScript 文本载入并停止执行。</span><br><span class="line"><span class="number">2.</span> 如果 X.js 是一个文件, 将 X.js 作为 JavaScript 文本载入并停止执行。</span><br><span class="line"><span class="number">3.</span> 如果 X.json 是一个文件, 解析 X.json 为 JavaScript 对象并停止执行。</span><br><span class="line"><span class="number">4.</span> 如果 X.node 是一个文件, 将 X.node 作为二进制插件载入并停止执行。</span><br><span class="line"></span><br><span class="line">LOAD_INDEX(X)</span><br><span class="line"><span class="number">1.</span> 如果 X/index.js 是一个文件,  将 X/index.js 作为 JavaScript 文本载入并停止执行。</span><br><span class="line"><span class="number">2.</span> 如果 X/index.json 是一个文件, 解析 X/index.json 为 JavaScript 对象并停止执行。</span><br><span class="line"><span class="number">3.</span> 如果 X/index.node 是一个文件,  将 X/index.node 作为二进制插件载入并停止执行。</span><br><span class="line"></span><br><span class="line">LOAD_AS_DIRECTORY(X)</span><br><span class="line"><span class="number">1.</span> 如果 X/package.json 是一个文件,</span><br><span class="line">   a. 解析 X/package.json, 并查找 <span class="string">"main"</span> 字段。</span><br><span class="line">   b. let M = X + (json main 字段)</span><br><span class="line">   c. LOAD_AS_FILE(M)</span><br><span class="line">   d. LOAD_INDEX(M)</span><br><span class="line"><span class="number">2.</span> LOAD_INDEX(X)</span><br><span class="line"></span><br><span class="line">LOAD_NODE_MODULES(X, START)</span><br><span class="line"><span class="number">1.</span> <span class="keyword">let</span> DIRS=NODE_MODULES_PATHS(START)</span><br><span class="line"><span class="number">2.</span> <span class="keyword">for</span> each DIR <span class="keyword">in</span> DIRS:</span><br><span class="line">   a. LOAD_AS_FILE(DIR/X)</span><br><span class="line">   b. LOAD_AS_DIRECTORY(DIR/X)</span><br><span class="line"></span><br><span class="line">NODE_MODULES_PATHS(START)</span><br><span class="line"><span class="number">1.</span> <span class="keyword">let</span> PARTS = path split(START)</span><br><span class="line"><span class="number">2.</span> <span class="keyword">let</span> I = count <span class="keyword">of</span> PARTS - <span class="number">1</span></span><br><span class="line"><span class="number">3.</span> <span class="keyword">let</span> DIRS = []</span><br><span class="line"><span class="number">4.</span> <span class="keyword">while</span> I &gt;= <span class="number">0</span>,</span><br><span class="line">   a. if PARTS[I] = <span class="string">"node_modules"</span> CONTINUE</span><br><span class="line">   b. DIR = path join(PARTS[<span class="number">0</span> .. I] + <span class="string">"node_modules"</span>)</span><br><span class="line">   c. DIRS = DIRS + DIR</span><br><span class="line">   d. let I = I - <span class="number">1</span></span><br><span class="line"><span class="number">5.</span> <span class="keyword">return</span> DIRS</span><br></pre></td></tr></table></figure><h2 id="2-函数传递"><a href="#2-函数传递" class="headerlink" title="2. 函数传递"></a>2. 函数传递</h2><p>在JavaScript中，一个函数可以作为另一个函数的参数。我们可以先定义一个函数，然后传递，也可以在传递参数的地方直接定义函数。</p><p>Node.js中函数的使用与Javascript类似，举例来说，你可以这样做：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">say</span>(<span class="params">word</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(word);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">execute</span>(<span class="params">someFunction, value</span>) </span>&#123;</span><br><span class="line">  someFunction(value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">execute(say, <span class="string">"Hello"</span>);</span><br></pre></td></tr></table></figure><p>以上代码中，我们把 say 函数作为execute函数的第一个变量进行了传递。这里传递的不是 say 的返回值，而是 say 本身！</p><p>这样一来， say 就变成了execute 中的本地变量 someFunction ，execute可以通过调用 someFunction() （带括号的形式）来使用 say 函数。</p><p>当然，因为 say 有一个变量， execute 在调用 someFunction 时可以传递这样一个变量。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line"></span><br><span class="line">http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">request, response</span>) </span>&#123;</span><br><span class="line">  response.writeHead(<span class="number">200</span>, &#123;<span class="string">"Content-Type"</span>: <span class="string">"text/plain"</span>&#125;);</span><br><span class="line">  response.write(<span class="string">"Hello World"</span>);</span><br><span class="line">  response.end();</span><br><span class="line">&#125;).listen(<span class="number">8888</span>);</span><br></pre></td></tr></table></figure><h2 id="3-路由"><a href="#3-路由" class="headerlink" title="3. 路由"></a>3. 路由</h2><p>我们要为路由提供请求的 URL 和其他需要的 GET 及 POST 参数，随后路由需要根据这些数据来执行相应的代码。我们需要的所有数据都会包含在 request 对象中，该对象作为 onRequest() 回调函数的第一个参数传递。但是为了解析这些数据，我们需要额外的 Node.JS 模块，它们分别是 url 和 querystring 模块。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">      url.parse(string).query</span><br><span class="line">                                           |</span><br><span class="line">           url.parse(string).pathname      |</span><br><span class="line">                       |                   |</span><br><span class="line">                       |                   |</span><br><span class="line">                     ------ -------------------</span><br><span class="line">http:<span class="comment">//localhost:8888/start?foo=bar&amp;hello=world</span></span><br><span class="line">                                ---       -----</span><br><span class="line">                                 |          |</span><br><span class="line">                                 |          |</span><br><span class="line">              querystring.parse(queryString)[<span class="string">"foo"</span>]    |</span><br><span class="line">                                            |</span><br><span class="line">                         querystring.parse(queryString)[<span class="string">"hello"</span>]</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> http=<span class="built_in">require</span>(<span class="string">"http"</span>);</span><br><span class="line"><span class="keyword">var</span> url=<span class="built_in">require</span>(<span class="string">"url"</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">start</span>(<span class="params">route</span>)</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">onRequest</span>(<span class="params">request,response</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 发送 HTTP 头部</span></span><br><span class="line">        <span class="comment">// HTTP 状态值: 200 : OK</span></span><br><span class="line">        <span class="comment">// 内容类型: text/plain</span></span><br><span class="line">        <span class="keyword">var</span> pathname=url.parse(request.url).pathname;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"Request for "</span> + pathname + <span class="string">" received."</span>);</span><br><span class="line">        route(pathname);</span><br><span class="line">        response.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>&#125;);</span><br><span class="line">        <span class="comment">// 发送响应数据 "Hello World"</span></span><br><span class="line">        response.end(<span class="string">'Hello World\n'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    http.createServer(onRequest).listen(<span class="number">8888</span>);</span><br><span class="line">    <span class="comment">// 终端打印如下信息</span></span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Server running at http://127.0.0.1:8888/'</span>);</span><br><span class="line">&#125;</span><br><span class="line">exports.start=start;</span><br></pre></td></tr></table></figure><h2 id="4-全局变量"><a href="#4-全局变量" class="headerlink" title="4. 全局变量"></a>4. 全局变量</h2><h3 id="4-1-Node-js-全局对象"><a href="#4-1-Node-js-全局对象" class="headerlink" title="4.1 Node.js 全局对象"></a>4.1 Node.js 全局对象</h3><p>JavaScript 中有一个特殊的对象，称为全局对象（Global Object），它及其所有属性都可以在程序的任何地方访问，即全局变量。</p><p>在浏览器 JavaScript 中，通常 window 是全局对象， 而 Node.js 中的全局对象是 global，所有全局变量（除了 global 本身以外）都是 global 对象的属性。</p><p>在 Node.js 我们可以直接访问到 global 的属性，而不需要在应用中包含它。</p><hr><h3 id="4-2-全局对象与全局变量"><a href="#4-2-全局对象与全局变量" class="headerlink" title="4.2 全局对象与全局变量"></a>4.2 全局对象与全局变量</h3><p>global 最根本的作用是作为全局变量的宿主。按照 ECMAScript 的定义，满足以下条 件的变量是全局变量：</p><ul><li>在最外层定义的变量；</li><li>全局对象的属性；</li><li>隐式定义的变量（未定义直接赋值的变量）。</li></ul><p>当你定义一个全局变量时，这个变量同时也会成为全局对象的属性，反之亦然。需要注 意的是，在 Node.js 中你不可能在最外层定义变量，因为所有用户代码都是属于当前模块的， 而模块本身不是最外层上下文。</p><p><strong>注意：</strong> <strong>永远不要使用 var 定义变量以避免引入全局变量，因为全局变量会污染 命名空间，提高代码的耦合风险。</strong></p><ul><li>__filename</li><li>process</li><li>setTimeout(cb, ms)</li><li>clearTimeout(t)</li><li>setInterval(cb, ms)</li><li>console</li></ul><h2 id="5-常用工具"><a href="#5-常用工具" class="headerlink" title="5. 常用工具"></a>5. 常用工具</h2><ol><li><p>inherits</p><p><strong>util.inherits(constructor, superConstructor)</strong> 是一个实现对象间原型继承的函数。</p><p>JavaScript 的面向对象特性是基于原型的，与常见的基于类的不同。JavaScript 没有提供对象继承的语言级别特性，而是通过原型复制来实现的</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> util = <span class="built_in">require</span>(<span class="string">'util'</span>); </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Base</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">    <span class="keyword">this</span>.name = <span class="string">'base'</span>; </span><br><span class="line">    <span class="keyword">this</span>.base = <span class="number">1991</span>; </span><br><span class="line">    <span class="keyword">this</span>.sayHello = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Hello '</span> + <span class="keyword">this</span>.name); </span><br><span class="line">    &#125;; </span><br><span class="line">&#125; </span><br><span class="line">Base.prototype.showName = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.name);</span><br><span class="line">&#125;; </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Sub</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">    <span class="keyword">this</span>.name = <span class="string">'sub'</span>; </span><br><span class="line">&#125; </span><br><span class="line">util.inherits(Sub, Base); </span><br><span class="line"><span class="keyword">var</span> objBase = <span class="keyword">new</span> Base(); </span><br><span class="line">objBase.showName(); </span><br><span class="line">objBase.sayHello(); </span><br><span class="line"><span class="built_in">console</span>.log(objBase); </span><br><span class="line"><span class="keyword">var</span> objSub = <span class="keyword">new</span> Sub(); </span><br><span class="line">objSub.showName(); </span><br><span class="line"><span class="comment">//objSub.sayHello(); </span></span><br><span class="line"><span class="built_in">console</span>.log(objSub);</span><br></pre></td></tr></table></figure><p><strong>注意：</strong>Sub 仅仅继承了Base 在原型中定义的函数，而构造函数内部创造的 base 属 性和 sayHello 函数都没有被 Sub 继承。</p></li><li><p>isArray</p></li><li><p>inspect</p></li><li><p>isRegExp</p></li><li><p>isDate</p></li><li><p>isError</p></li></ol><h2 id="6-文件系统"><a href="#6-文件系统" class="headerlink" title="6. 文件系统"></a>6. 文件系统</h2><h3 id="6-1-异步和同步"><a href="#6-1-异步和同步" class="headerlink" title="6.1 异步和同步"></a>6.1 异步和同步</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 异步读取</span></span><br><span class="line">fs.readFile(<span class="string">'input.txt'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">   <span class="keyword">if</span> (err) &#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="built_in">console</span>.error(err);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="built_in">console</span>.log(<span class="string">"异步读取: "</span> + data.toString());</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 同步读取</span></span><br><span class="line"><span class="keyword">var</span> data = fs.readFileSync(<span class="string">'input.txt'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"同步读取: "</span> + data.toString());</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"程序执行完毕。"</span>);</span><br></pre></td></tr></table></figure><h3 id="6-2-打开文件，读写文件"><a href="#6-2-打开文件，读写文件" class="headerlink" title="6.2 打开文件，读写文件"></a>6.2 打开文件，读写文件</h3><p>以下为在异步模式下打开文件的语法格式：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fs.open(path, flags[, mode], callback)</span><br></pre></td></tr></table></figure><p><strong>参数</strong></p><p>参数使用说明如下：</p><ul><li><strong>path</strong> - 文件的路径。</li><li><strong>flags</strong> - 文件打开的行为。具体值详见下文。</li><li><strong>mode</strong> - 设置文件模式(权限)，文件创建默认权限为 0666(可读，可写)。</li><li><strong>callback</strong> - 回调函数，带有两个参数如：callback(err, fd)。</li></ul><p>flags 参数可以是以下值：</p><table><thead><tr><th style="text-align:left">Flag</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">r</td><td style="text-align:left">以读取模式打开文件。如果文件不存在抛出异常。</td></tr><tr><td style="text-align:left">r+</td><td style="text-align:left">以读写模式打开文件。如果文件不存在抛出异常。</td></tr><tr><td style="text-align:left">rs</td><td style="text-align:left">以同步的方式读取文件。</td></tr><tr><td style="text-align:left">rs+</td><td style="text-align:left">以同步的方式读取和写入文件。</td></tr><tr><td style="text-align:left">w</td><td style="text-align:left">以写入模式打开文件，如果文件不存在则创建。</td></tr><tr><td style="text-align:left">wx</td><td style="text-align:left">类似 ‘w’，但是如果文件路径存在，则文件写入失败。</td></tr><tr><td style="text-align:left">w+</td><td style="text-align:left">以读写模式打开文件，如果文件不存在则创建。</td></tr><tr><td style="text-align:left">wx+</td><td style="text-align:left">类似 ‘w+’， 但是如果文件路径存在，则文件读写失败。</td></tr><tr><td style="text-align:left">a</td><td style="text-align:left">以追加模式打开文件，如果文件不存在则创建。</td></tr><tr><td style="text-align:left">ax</td><td style="text-align:left">类似 ‘a’， 但是如果文件路径存在，则文件追加失败。</td></tr><tr><td style="text-align:left">a+</td><td style="text-align:left">以读取追加模式打开文件，如果文件不存在则创建。</td></tr><tr><td style="text-align:left">ax+</td><td style="text-align:left">类似 ‘a+’， 但是如果文件路径存在，则文件读取追加失败。</td></tr></tbody></table><h3 id="6-3-主要方法"><a href="#6-3-主要方法" class="headerlink" title="6.3  主要方法"></a>6.3  主要方法</h3><table><thead><tr><th style="text-align:left">序号</th><th style="text-align:left">方法 &amp; 描述</th></tr></thead><tbody><tr><td style="text-align:left">1</td><td style="text-align:left"><strong>fs.rename(oldPath, newPath, callback)</strong> 异步 rename().回调函数没有参数，但可能抛出异常。</td></tr><tr><td style="text-align:left">2</td><td style="text-align:left"><strong>fs.ftruncate(fd, len, callback)</strong> 异步 ftruncate().回调函数没有参数，但可能抛出异常。</td></tr><tr><td style="text-align:left">3</td><td style="text-align:left"><strong>fs.ftruncateSync(fd, len)</strong> 同步 ftruncate()</td></tr><tr><td style="text-align:left">4</td><td style="text-align:left"><strong>fs.truncate(path, len, callback)</strong> 异步 truncate().回调函数没有参数，但可能抛出异常。</td></tr><tr><td style="text-align:left">5</td><td style="text-align:left"><strong>fs.truncateSync(path, len)</strong> 同步 truncate()</td></tr><tr><td style="text-align:left">6</td><td style="text-align:left"><strong>fs.chown(path, uid, gid, callback)</strong> 异步 chown().回调函数没有参数，但可能抛出异常。</td></tr><tr><td style="text-align:left">7</td><td style="text-align:left"><strong>fs.chownSync(path, uid, gid)</strong> 同步 chown()</td></tr><tr><td style="text-align:left">8</td><td style="text-align:left"><strong>fs.fchown(fd, uid, gid, callback)</strong> 异步 fchown().回调函数没有参数，但可能抛出异常。</td></tr><tr><td style="text-align:left">9</td><td style="text-align:left"><strong>fs.fchownSync(fd, uid, gid)</strong> 同步 fchown()</td></tr><tr><td style="text-align:left">10</td><td style="text-align:left"><strong>fs.lchown(path, uid, gid, callback)</strong> 异步 lchown().回调函数没有参数，但可能抛出异常。</td></tr><tr><td style="text-align:left">11</td><td style="text-align:left"><strong>fs.lchownSync(path, uid, gid)</strong> 同步 lchown()</td></tr><tr><td style="text-align:left">12</td><td style="text-align:left"><strong>fs.chmod(path, mode, callback)</strong> 异步 chmod().回调函数没有参数，但可能抛出异常。</td></tr><tr><td style="text-align:left">13</td><td style="text-align:left"><strong>fs.chmodSync(path, mode)</strong> 同步 chmod().</td></tr><tr><td style="text-align:left">14</td><td style="text-align:left"><strong>fs.fchmod(fd, mode, callback)</strong> 异步 fchmod().回调函数没有参数，但可能抛出异常。</td></tr><tr><td style="text-align:left">15</td><td style="text-align:left"><strong>fs.fchmodSync(fd, mode)</strong> 同步 fchmod().</td></tr><tr><td style="text-align:left">16</td><td style="text-align:left"><strong>fs.lchmod(path, mode, callback)</strong> 异步 lchmod().回调函数没有参数，但可能抛出异常。Only available on Mac OS X.</td></tr><tr><td style="text-align:left">17</td><td style="text-align:left"><strong>fs.lchmodSync(path, mode)</strong> 同步 lchmod().</td></tr><tr><td style="text-align:left">18</td><td style="text-align:left"><strong>fs.stat(path, callback)</strong> 异步 stat(). 回调函数有两个参数 err, stats，stats 是 fs.Stats 对象。</td></tr><tr><td style="text-align:left">19</td><td style="text-align:left"><strong>fs.lstat(path, callback)</strong> 异步 lstat(). 回调函数有两个参数 err, stats，stats 是 fs.Stats 对象。</td></tr><tr><td style="text-align:left">20</td><td style="text-align:left"><strong>fs.fstat(fd, callback)</strong> 异步 fstat(). 回调函数有两个参数 err, stats，stats 是 fs.Stats 对象。</td></tr><tr><td style="text-align:left">21</td><td style="text-align:left"><strong>fs.statSync(path)</strong> 同步 stat(). 返回 fs.Stats 的实例。</td></tr><tr><td style="text-align:left">22</td><td style="text-align:left"><strong>fs.lstatSync(path)</strong> 同步 lstat(). 返回 fs.Stats 的实例。</td></tr><tr><td style="text-align:left">23</td><td style="text-align:left"><strong>fs.fstatSync(fd)</strong> 同步 fstat(). 返回 fs.Stats 的实例。</td></tr><tr><td style="text-align:left">24</td><td style="text-align:left"><strong>fs.link(srcpath, dstpath, callback)</strong> 异步 link().回调函数没有参数，但可能抛出异常。</td></tr><tr><td style="text-align:left">25</td><td style="text-align:left"><strong>fs.linkSync(srcpath, dstpath)</strong> 同步 link().</td></tr><tr><td style="text-align:left">26</td><td style="text-align:left"><strong>fs.symlink(srcpath, dstpath[, type], callback)</strong> 异步 symlink().回调函数没有参数，但可能抛出异常。 type 参数可以设置为 ‘dir’, ‘file’, 或 ‘junction’ (默认为 ‘file’) 。</td></tr><tr><td style="text-align:left">27</td><td style="text-align:left"><strong>fs.symlinkSync(srcpath, dstpath[, type])</strong> 同步 symlink().</td></tr><tr><td style="text-align:left">28</td><td style="text-align:left"><strong>fs.readlink(path, callback)</strong> 异步 readlink(). 回调函数有两个参数 err, linkString。</td></tr><tr><td style="text-align:left">29</td><td style="text-align:left"><strong>fs.realpath(path[, cache], callback)</strong> 异步 realpath(). 回调函数有两个参数 err, resolvedPath。</td></tr><tr><td style="text-align:left">30</td><td style="text-align:left"><strong>fs.realpathSync(path[, cache])</strong> 同步 realpath()。返回绝对路径。</td></tr><tr><td style="text-align:left">31</td><td style="text-align:left"><strong>fs.unlink(path, callback)</strong> 异步 unlink().回调函数没有参数，但可能抛出异常。</td></tr><tr><td style="text-align:left">32</td><td style="text-align:left"><strong>fs.unlinkSync(path)</strong> 同步 unlink().</td></tr><tr><td style="text-align:left">33</td><td style="text-align:left"><strong>fs.rmdir(path, callback)</strong> 异步 rmdir().回调函数没有参数，但可能抛出异常。</td></tr><tr><td style="text-align:left">34</td><td style="text-align:left"><strong>fs.rmdirSync(path)</strong> 同步 rmdir().</td></tr><tr><td style="text-align:left">35</td><td style="text-align:left"><strong>fs.mkdir(path[, mode], callback)</strong> S异步 mkdir(2).回调函数没有参数，但可能抛出异常。 访问权限默认为 0777。</td></tr><tr><td style="text-align:left">36</td><td style="text-align:left"><strong>fs.mkdirSync(path[, mode])</strong> 同步 mkdir().</td></tr><tr><td style="text-align:left">37</td><td style="text-align:left"><strong>fs.readdir(path, callback)</strong> 异步 readdir(3). 读取目录的内容。</td></tr><tr><td style="text-align:left">38</td><td style="text-align:left"><strong>fs.readdirSync(path)</strong> 同步 readdir().返回文件数组列表。</td></tr><tr><td style="text-align:left">39</td><td style="text-align:left"><strong>fs.close(fd, callback)</strong> 异步 close().回调函数没有参数，但可能抛出异常。</td></tr><tr><td style="text-align:left">40</td><td style="text-align:left"><strong>fs.closeSync(fd)</strong> 同步 close().</td></tr><tr><td style="text-align:left">41</td><td style="text-align:left"><strong>fs.open(path, flags[, mode], callback)</strong> 异步打开文件。</td></tr><tr><td style="text-align:left">42</td><td style="text-align:left"><strong>fs.openSync(path, flags[, mode])</strong> 同步 version of fs.open().</td></tr><tr><td style="text-align:left">43</td><td style="text-align:left"><strong>fs.utimes(path, atime, mtime, callback)</strong></td></tr><tr><td style="text-align:left">44</td><td style="text-align:left"><strong>fs.utimesSync(path, atime, mtime)</strong> 修改文件时间戳，文件通过指定的文件路径。</td></tr><tr><td style="text-align:left">45</td><td style="text-align:left"><strong>fs.futimes(fd, atime, mtime, callback)</strong></td></tr><tr><td style="text-align:left">46</td><td style="text-align:left"><strong>fs.futimesSync(fd, atime, mtime)</strong> 修改文件时间戳，通过文件描述符指定。</td></tr><tr><td style="text-align:left">47</td><td style="text-align:left"><strong>fs.fsync(fd, callback)</strong> 异步 fsync.回调函数没有参数，但可能抛出异常。</td></tr><tr><td style="text-align:left">48</td><td style="text-align:left"><strong>fs.fsyncSync(fd)</strong> 同步 fsync.</td></tr><tr><td style="text-align:left">49</td><td style="text-align:left"><strong>fs.write(fd, buffer, offset, length[, position], callback)</strong> 将缓冲区内容写入到通过文件描述符指定的文件。</td></tr><tr><td style="text-align:left">50</td><td style="text-align:left"><strong>fs.write(fd, data[, position[, encoding]], callback)</strong> 通过文件描述符 fd 写入文件内容。</td></tr><tr><td style="text-align:left">51</td><td style="text-align:left"><strong>fs.writeSync(fd, buffer, offset, length[, position])</strong> 同步版的 fs.write()。</td></tr><tr><td style="text-align:left">52</td><td style="text-align:left"><strong>fs.writeSync(fd, data[, position[, encoding]])</strong> 同步版的 fs.write().</td></tr><tr><td style="text-align:left">53</td><td style="text-align:left"><strong>fs.read(fd, buffer, offset, length, position, callback)</strong> 通过文件描述符 fd 读取文件内容。</td></tr><tr><td style="text-align:left">54</td><td style="text-align:left"><strong>fs.readSync(fd, buffer, offset, length, position)</strong> 同步版的 fs.read.</td></tr><tr><td style="text-align:left">55</td><td style="text-align:left"><strong>fs.readFile(filename[, options], callback)</strong> 异步读取文件内容。</td></tr><tr><td style="text-align:left">56</td><td style="text-align:left"><strong>fs.readFileSync(filename[, options])</strong></td></tr><tr><td style="text-align:left">57</td><td style="text-align:left"><strong>fs.writeFile(filename, data[, options], callback)</strong> 异步写入文件内容。</td></tr><tr><td style="text-align:left">58</td><td style="text-align:left"><strong>fs.writeFileSync(filename, data[, options])</strong> 同步版的 fs.writeFile。</td></tr><tr><td style="text-align:left">59</td><td style="text-align:left"><strong>fs.appendFile(filename, data[, options], callback)</strong> 异步追加文件内容。</td></tr><tr><td style="text-align:left">60</td><td style="text-align:left"><strong>fs.appendFileSync(filename, data[, options])</strong> The 同步 version of fs.appendFile.</td></tr><tr><td style="text-align:left">61</td><td style="text-align:left"><strong>fs.watchFile(filename[, options], listener)</strong> 查看文件的修改。</td></tr><tr><td style="text-align:left">62</td><td style="text-align:left"><strong>fs.unwatchFile(filename[, listener])</strong> 停止查看 filename 的修改。</td></tr><tr><td style="text-align:left">63</td><td style="text-align:left"><strong>fs.watch(filename[, options][, listener])</strong> 查看 filename 的修改，filename 可以是文件或目录。返回 fs.FSWatcher 对象。</td></tr><tr><td style="text-align:left">64</td><td style="text-align:left"><strong>fs.exists(path, callback)</strong> 检测给定的路径是否存在。</td></tr><tr><td style="text-align:left">65</td><td style="text-align:left"><strong>fs.existsSync(path)</strong> 同步版的 fs.exists.</td></tr><tr><td style="text-align:left">66</td><td style="text-align:left"><strong>fs.access(path[, mode], callback)</strong> 测试指定路径用户权限。</td></tr><tr><td style="text-align:left">67</td><td style="text-align:left"><strong>fs.accessSync(path[, mode])</strong> 同步版的 fs.access。</td></tr><tr><td style="text-align:left">68</td><td style="text-align:left"><strong>fs.createReadStream(path[, options])</strong> 返回ReadStream 对象。</td></tr><tr><td style="text-align:left">69</td><td style="text-align:left"><strong>fs.createWriteStream(path[, options])</strong> 返回 WriteStream 对象。</td></tr><tr><td style="text-align:left">70</td><td style="text-align:left"><strong>fs.symlink(srcpath, dstpath[, type], callback)</strong> 异步 symlink().回调函数没有参数，但可能抛出异常。</td></tr></tbody></table><h2 id="7-Get-Post请求"><a href="#7-Get-Post请求" class="headerlink" title="7. Get/Post请求"></a>7. Get/Post请求</h2><h3 id="7-1-获得get请求"><a href="#7-1-获得get请求" class="headerlink" title="7.1 获得get请求"></a>7.1 获得get请求</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">onGetRequest</span>(<span class="params">request,response</span>) </span>&#123;</span><br><span class="line">       <span class="comment">// 发送 HTTP 头部</span></span><br><span class="line">       <span class="comment">// HTTP 状态值: 200 : OK</span></span><br><span class="line">      <span class="comment">// 内容类型: text/plain</span></span><br><span class="line">       <span class="keyword">var</span> pathname=url.parse(request.url).pathname;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"Request for "</span> + pathname + <span class="string">" received."</span>);</span><br><span class="line">        route(pathname);</span><br><span class="line">       response.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/plain;charset=utf-8'</span>&#125;);</span><br><span class="line">       <span class="comment">// 发送响应数据 "Hello World"</span></span><br><span class="line">       <span class="comment">// 解析 url 参数</span></span><br><span class="line">       <span class="keyword">var</span> params = url.parse(request.url, <span class="literal">true</span>).query;</span><br><span class="line">       <span class="keyword">for</span>(<span class="keyword">let</span> key <span class="keyword">in</span> params)&#123;</span><br><span class="line">           response.write(key+<span class="string">":"</span>+params[key]+<span class="string">"\n"</span>);</span><br><span class="line">       &#125;</span><br><span class="line">       response.end(util.inspect(url.parse(request.url, <span class="literal">true</span>)));</span><br><span class="line">   &#125;</span><br><span class="line"> http.createServer(onGetRequest).listen(<span class="number">8888</span>);</span><br></pre></td></tr></table></figure><h3 id="7-2-获得post请求"><a href="#7-2-获得post请求" class="headerlink" title="7.2 获得post请求"></a>7.2 获得post请求</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> postHTML =</span><br><span class="line">    <span class="string">'&lt;html&gt;&lt;head&gt;&lt;meta charset="utf-8"&gt;&lt;title&gt; Node.js 实例&lt;/title&gt;&lt;/head&gt;'</span> +</span><br><span class="line">    <span class="string">'&lt;body&gt;'</span> +</span><br><span class="line">    <span class="string">'&lt;form method="post"&gt;'</span> +</span><br><span class="line">    <span class="string">'名称： &lt;input name="name"&gt;&lt;br&gt;'</span> +</span><br><span class="line">    <span class="string">'邮件： &lt;input name="email"&gt;&lt;br&gt;'</span> +</span><br><span class="line">    <span class="string">'地址： &lt;input name="address"&gt;&lt;br&gt;'</span> +</span><br><span class="line">    <span class="string">'&lt;input type="submit"&gt;'</span> +</span><br><span class="line">    <span class="string">'&lt;/form&gt;'</span> +</span><br><span class="line">    <span class="string">'&lt;/body&gt;&lt;/html&gt;'</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">onPostRequest</span>(<span class="params">request,response</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 定义了一个post变量，用于暂存请求体的信息</span></span><br><span class="line">    <span class="keyword">var</span> post = <span class="string">''</span>;</span><br><span class="line">    request.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">chunk</span>)</span>&#123;</span><br><span class="line">        post += chunk;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 在end事件触发后，通过querystring.parse将post解析为真正的POST请求格式，然后向客户端返回。</span></span><br><span class="line">    request.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        post = qs.parse(post);</span><br><span class="line">        response.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/html; charset=utf8'</span>&#125;);</span><br><span class="line">        <span class="keyword">if</span>(post.name) &#123; <span class="comment">// 输出提交的数据</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">let</span> key <span class="keyword">in</span> post)&#123;</span><br><span class="line">                response.write(key+<span class="string">":"</span>+post[key]+<span class="string">"\n"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;  <span class="comment">// 输出表单</span></span><br><span class="line">            response.write(postHTML);</span><br><span class="line">        &#125;</span><br><span class="line">        response.end();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line">http.createServer(onPostRequest).listen(<span class="number">8888</span>);</span><br></pre></td></tr></table></figure><h3 id="7-3-发送Get请求"><a href="#7-3-发送Get请求" class="headerlink" title="7.3 发送Get请求"></a>7.3 发送Get请求</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//发送get请求</span></span><br><span class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> qs = <span class="built_in">require</span>(<span class="string">'querystring'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> data = &#123;</span><br><span class="line">    a: <span class="number">123</span>,</span><br><span class="line">    time: <span class="keyword">new</span> <span class="built_in">Date</span>().getTime()&#125;;<span class="comment">//这是需要提交的数据</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> content = qs.stringify(data);</span><br><span class="line"><span class="keyword">var</span> options = &#123;</span><br><span class="line">    hostname: <span class="string">'127.0.0.1'</span>,</span><br><span class="line">    port: <span class="number">8888</span>,</span><br><span class="line">    path: <span class="string">'/pay/pay_callback?'</span> + content,</span><br><span class="line">    method: <span class="string">'GET'</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> req = http.request(options, <span class="function"><span class="keyword">function</span> (<span class="params">res</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'STATUS: '</span> + res.statusCode);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'HEADERS: '</span> + <span class="built_in">JSON</span>.stringify(res.headers));</span><br><span class="line">    res.setEncoding(<span class="string">'utf8'</span>);</span><br><span class="line">    res.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">chunk</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'BODY: '</span> + chunk);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">req.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'problem with request: '</span> + e.message);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">req.end();</span><br></pre></td></tr></table></figure><h3 id="7-4-发送Post请求"><a href="#7-4-发送Post请求" class="headerlink" title="7.4 发送Post请求"></a>7.4 发送Post请求</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//发送post</span></span><br><span class="line"><span class="keyword">var</span> contents = qs.stringify(&#123;</span><br><span class="line">    name:<span class="string">'byvoid'</span>,</span><br><span class="line">    email:<span class="string">'byvoid@byvoid.com'</span>,</span><br><span class="line">    address:<span class="string">'Zijing'</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> options = &#123;</span><br><span class="line">    host:<span class="string">'127.0.0.1'</span>,</span><br><span class="line">    port:<span class="number">8888</span>,</span><br><span class="line">    path:<span class="string">'/'</span>,</span><br><span class="line">    method:<span class="string">'POST'</span>,</span><br><span class="line">    headers:&#123;</span><br><span class="line">        <span class="string">'Content-Type'</span>:<span class="string">'application/x-www-form-urlencoded'</span>,</span><br><span class="line">        <span class="string">'Content-Length'</span>:contents.length</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> req = http.request(options, <span class="function"><span class="keyword">function</span>(<span class="params">res</span>)</span>&#123;</span><br><span class="line">    res.setEncoding(<span class="string">'utf8'</span>);</span><br><span class="line">    res.on(<span class="string">'data'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"data:"</span>,data);   <span class="comment">//一段html代码</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">req.write(contents);</span><br><span class="line">req.end();</span><br></pre></td></tr></table></figure><h2 id="8-工具模块"><a href="#8-工具模块" class="headerlink" title="8. 工具模块"></a>8. 工具模块</h2><table><thead><tr><th style="text-align:left">序号</th><th style="text-align:left">模块名 &amp; 描述</th></tr></thead><tbody><tr><td style="text-align:left">1</td><td style="text-align:left"><a href="https://www.runoob.com/nodejs/nodejs-os-module.html" target="_blank" rel="noopener"><strong>OS 模块</strong></a> 提供基本的系统操作函数。</td></tr><tr><td style="text-align:left">2</td><td style="text-align:left"><a href="https://www.runoob.com/nodejs/nodejs-path-module.html" target="_blank" rel="noopener"><strong>Path 模块</strong></a> 提供了处理和转换文件路径的工具。</td></tr><tr><td style="text-align:left">3</td><td style="text-align:left"><a href="https://www.runoob.com/nodejs/nodejs-net-module.html" target="_blank" rel="noopener"><strong>Net 模块</strong></a> 用于底层的网络通信。提供了服务端和客户端的的操作。</td></tr><tr><td style="text-align:left">4</td><td style="text-align:left"><a href="https://www.runoob.com/nodejs/nodejs-dns-module.html" target="_blank" rel="noopener"><strong>DNS 模块</strong></a> 用于解析域名。</td></tr><tr><td style="text-align:left">5</td><td style="text-align:left"><a href="https://www.runoob.com/nodejs/nodejs-domain-module.html" target="_blank" rel="noopener"><strong>Domain 模块</strong></a> 简化异步代码的异常处理，可以捕捉处理try catch无法捕捉的。</td></tr></tbody></table><h2 id="9-Express框架"><a href="#9-Express框架" class="headerlink" title="9. Express框架"></a>9. Express框架</h2><ul><li><p><strong>body-parser</strong> - node.js 中间件，用于处理 JSON, Raw, Text 和 URL 编码的数据。</p></li><li><p><strong>cookie-parser</strong> - 这就是一个解析Cookie的工具。通过req.cookies可以取到传过来的cookie，并把它们转成对象。</p></li><li><p><strong>multer</strong> - node.js 中间件，用于处理 enctype=”multipart/form-data”（设置表单的MIME编码）的表单数据。</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express=<span class="built_in">require</span>(<span class="string">"express"</span>)</span><br><span class="line"><span class="keyword">var</span> app=express();</span><br><span class="line"><span class="comment">//  主页输出 "Hello World"</span></span><br><span class="line">app.get(<span class="string">'/'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"主页 GET 请求"</span>);</span><br><span class="line">    res.send(<span class="string">'hello get'</span>);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//  POST 请求</span></span><br><span class="line">app.post(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"主页 POST 请求"</span>);</span><br><span class="line">    res.send(<span class="string">'Hello POST'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//  /del_user 页面响应</span></span><br><span class="line">app.get(<span class="string">'/del_user'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"/del_user 响应 DELETE 请求"</span>);</span><br><span class="line">    res.send(<span class="string">'删除页面'</span>);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//  /list_user 页面 GET 请求</span></span><br><span class="line">app.get(<span class="string">'/list_user'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"/list_user GET 请求"</span>);</span><br><span class="line">    res.send(<span class="string">'用户列表页面'</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对页面 abcd, abxcd, ab123cd, 等响应 GET 请求</span></span><br><span class="line">app.get(<span class="string">'/ab*cd'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"/ab*cd GET 请求"</span>);</span><br><span class="line">    res.send(<span class="string">'正则匹配'</span>);</span><br><span class="line">&#125;)</span><br><span class="line">app.get(<span class="string">'/index.html'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    res.sendFile( __dirname + <span class="string">"/public/html/"</span> + <span class="string">"index.html"</span> );</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">"fs"</span>);</span><br><span class="line"><span class="keyword">var</span> multer=<span class="built_in">require</span>(<span class="string">"multer"</span>);</span><br><span class="line"><span class="keyword">var</span> util = <span class="built_in">require</span>(<span class="string">'util'</span>);</span><br><span class="line"><span class="keyword">var</span> cookieParser = <span class="built_in">require</span>(<span class="string">'cookie-parser'</span>)</span><br><span class="line">app.use(cookieParser())</span><br><span class="line"><span class="comment">// 创建 application/x-www-form-urlencoded 编码解析</span></span><br><span class="line"><span class="keyword">var</span> urlencodedParser = bodyParser.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;)</span><br><span class="line">app.use(bodyParser.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;))</span><br><span class="line">app.use(multer(&#123;<span class="attr">dest</span>:<span class="string">'/tmp/'</span>&#125;).array(<span class="string">'image'</span>));</span><br><span class="line">app.post(<span class="string">'/process_post'</span>, urlencodedParser, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 输出 JSON 格式</span></span><br><span class="line">    <span class="keyword">var</span> response = &#123;</span><br><span class="line">        <span class="string">"first_name"</span>:req.body.first_name,</span><br><span class="line">        <span class="string">"last_name"</span>:req.body.last_name</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="built_in">console</span>.log(response);</span><br><span class="line">     <span class="built_in">console</span>.log(<span class="string">"Cookies: "</span> + util.inspect(req.cookies));</span><br><span class="line">    res.end(<span class="built_in">JSON</span>.stringify(response));</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">var</span> server =app.listen(<span class="number">8081</span>,<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> host=server.address().address;</span><br><span class="line">    <span class="keyword">var</span> port=server.address().port;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"应用实例，访问地址为 http://%s:%s"</span>, host, port)</span><br><span class="line">&#125;)</span><br><span class="line">app.post(<span class="string">'/file_upload'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(req.files[<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">var</span> des_file=__dirname+<span class="string">"/"</span>+req.files[<span class="number">0</span>].originalname;</span><br><span class="line">    fs.readFile(req.files[<span class="number">0</span>].path,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">        fs.watchFile(des_file,data,<span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(err)&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(err);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                response=&#123;</span><br><span class="line">                    message:<span class="string">'File uploaded successfully'</span>,</span><br><span class="line">                    filename: req.files[<span class="number">0</span>].originalname</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">console</span>.log(response);</span><br><span class="line">            res.end(<span class="built_in">JSON</span>.stringify(response));</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ul><h2 id="10-RESTful-API"><a href="#10-RESTful-API" class="headerlink" title="10. RESTful API"></a>10. RESTful API</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">/测试restful api</span><br><span class="line"><span class="comment">//添加的新用户数据</span></span><br><span class="line"><span class="keyword">var</span> user = &#123;</span><br><span class="line">    <span class="string">"user4"</span> : &#123;</span><br><span class="line">        <span class="string">"name"</span> : <span class="string">"mohit"</span>,</span><br><span class="line">        <span class="string">"password"</span> : <span class="string">"password4"</span>,</span><br><span class="line">        <span class="string">"profession"</span> : <span class="string">"teacher"</span>,</span><br><span class="line">        <span class="string">"id"</span>: <span class="number">4</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">app.post(<span class="string">'/adduser'</span>,urlencodedParser,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> newData=req.body;</span><br><span class="line">    fs.readFile(__dirname+<span class="string">"/public/static/users.json"</span>,<span class="string">"utf-8"</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">        data = <span class="built_in">JSON</span>.parse( data );</span><br><span class="line">        data[<span class="string">"user4"</span>] = newData;</span><br><span class="line">        <span class="built_in">console</span>.log( data );</span><br><span class="line">        res.end( <span class="built_in">JSON</span>.stringify(data));</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//  /del_user 页面响应</span></span><br><span class="line">app.get(<span class="string">'/del_user/:id'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// First read existing users.</span></span><br><span class="line">    fs.readFile( __dirname + <span class="string">"/public/static/"</span> + <span class="string">"users.json"</span>, <span class="string">'utf8'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">        data = <span class="built_in">JSON</span>.parse( data );</span><br><span class="line">        <span class="keyword">delete</span> data[<span class="string">"user"</span> +req.params.id];</span><br><span class="line"></span><br><span class="line">        <span class="built_in">console</span>.log( data );</span><br><span class="line">        res.end( <span class="built_in">JSON</span>.stringify(data));</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//  /list_user 页面 GET 请求</span></span><br><span class="line">app.get(<span class="string">'/list_user'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"/list_user GET 请求"</span>);</span><br><span class="line">    fs.readFile(__dirname+<span class="string">"/public/static/"</span>+<span class="string">"users.json"</span>,<span class="string">"utf-8"</span>,<span class="function"><span class="keyword">function</span> (<span class="params">err,data</span>) </span>&#123;</span><br><span class="line">        res.end(data);</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">app.get(<span class="string">'/:id'</span>,<span class="function"><span class="keyword">function</span> (<span class="params">req,res</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 首先我们读取已存在的用户</span></span><br><span class="line">    fs.readFile( __dirname + <span class="string">"/public/static/"</span> + <span class="string">"users.json"</span>, <span class="string">'utf8'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">        data = <span class="built_in">JSON</span>.parse( data );</span><br><span class="line">        <span class="keyword">var</span> user = data[<span class="string">"user"</span> + req.params.id]</span><br><span class="line">        <span class="built_in">console</span>.log( user );</span><br><span class="line">        res.end( <span class="built_in">JSON</span>.stringify(user));</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h2 id="11-多进程"><a href="#11-多进程" class="headerlink" title="11. 多进程"></a>11. 多进程</h2><h3 id="exec-方法"><a href="#exec-方法" class="headerlink" title="exec() 方法"></a>exec() 方法</h3><p>child_process.exec</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> child_process = <span class="built_in">require</span>(<span class="string">'child_process'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;<span class="number">3</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> workerProcess = child_process.exec(<span class="string">'node support.js '</span>+i, <span class="function"><span class="keyword">function</span> (<span class="params">error, stdout, stderr</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (error) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(error.stack);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'Error code: '</span>+error.code);</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'Signal received: '</span>+error.signal);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'stdout: '</span> + stdout);</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'stderr: '</span> + stderr);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    workerProcess.on(<span class="string">'exit'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">code</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'子进程已退出，退出码 '</span>+code);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="spawn-方法"><a href="#spawn-方法" class="headerlink" title="spawn() 方法"></a>spawn() 方法</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> child_process = <span class="built_in">require</span>(<span class="string">'child_process'</span>);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;<span class="number">3</span>; i++) &#123;</span><br><span class="line"><span class="keyword">var</span> workerProcess = child_process.spawn(<span class="string">'node'</span>, [<span class="string">'support.js'</span>, i]);</span><br><span class="line">workerProcess.stdout.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'stdout: '</span> + data);</span><br><span class="line">&#125;);</span><br><span class="line">workerProcess.stderr.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'stderr: '</span> + data);</span><br><span class="line">&#125;);</span><br><span class="line">workerProcess.on(<span class="string">'close'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">code</span>) </span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'子进程已退出，退出码 '</span>+code);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ork-方法"><a href="#ork-方法" class="headerlink" title="ork 方法"></a>ork 方法</h3><p>child_process.fork 是 spawn() 方法的特殊形式，用于创建进程，语法格式如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">child_process.fork(modulePath[, args][, options])</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">const</span> child_process = <span class="built_in">require</span>(<span class="string">'child_process'</span>);</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;<span class="number">3</span>; i++) &#123;</span><br><span class="line"><span class="keyword">var</span> worker_process = child_process.fork(<span class="string">"support.js"</span>, [i]);    </span><br><span class="line">worker_process.on(<span class="string">'close'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">code</span>) </span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'子进程已退出，退出码 '</span> + code);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="12-Node-js-连接-MySQL"><a href="#12-Node-js-连接-MySQL" class="headerlink" title="12. Node.js 连接 MySQL"></a>12. Node.js 连接 MySQL</h2><h4 id="安装驱动"><a href="#安装驱动" class="headerlink" title="安装驱动"></a>安装驱动</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cnpm install mysql</span><br></pre></td></tr></table></figure><h4 id="连接数据库"><a href="#连接数据库" class="headerlink" title="连接数据库"></a>连接数据库</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mysql      = <span class="built_in">require</span>(<span class="string">'mysql'</span>);</span><br><span class="line"><span class="keyword">var</span> connection = mysql.createConnection(&#123;</span><br><span class="line">host     : <span class="string">'localhost'</span>,</span><br><span class="line">user     : <span class="string">'root'</span>,</span><br><span class="line">password : <span class="string">'123456'</span>,</span><br><span class="line">database : <span class="string">'test'</span></span><br><span class="line">&#125;);</span><br><span class="line">connection.connect();</span><br><span class="line">connection.query(<span class="string">'SELECT 1 + 1 AS solution'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">error, results, fields</span>) </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (error) <span class="keyword">throw</span> error;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'The solution is: '</span>, results[<span class="number">0</span>].solution);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h4 id="数据库操作-CURD"><a href="#数据库操作-CURD" class="headerlink" title="数据库操作( CURD )"></a>数据库操作( CURD )</h4><p>使用connection.query执行sql语句，实现增删改查</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">var mysql=require(&quot;mysql&quot;);</span><br><span class="line">var connection =mysql.createConnection(&#123;</span><br><span class="line">    host:&quot;localhost&quot;,</span><br><span class="line">    user:&quot;root&quot;,</span><br><span class="line">    password:&quot;123456&quot;,</span><br><span class="line">    database:&apos;nodejsBase&apos;</span><br><span class="line">&#125;);</span><br><span class="line">connection.connect();</span><br><span class="line">//查询</span><br><span class="line">connection.query(&apos;select * from websites&apos;,function (error,results) &#123;</span><br><span class="line">    if(error)&#123;</span><br><span class="line">        console.log(&apos;[SELECT ERROR] - &apos;,error.message);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    console.log(results);</span><br><span class="line">&#125;);</span><br><span class="line">//插入</span><br><span class="line">var  addSql = &apos;INSERT INTO websites(Id,name,url,alexa,country) VALUES(0,?,?,?,?)&apos;;</span><br><span class="line">var  addSqlParams = [&apos;菜鸟工具&apos;, &apos;https://c.runoob.com&apos;,&apos;23453&apos;, &apos;CN&apos;];</span><br><span class="line">connection.query(addSql,addSqlParams,function (err,result) &#123;</span><br><span class="line">    if(err)&#123;</span><br><span class="line">        console.log(&apos;[INSERT ERROR] - &apos;,err.message);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    console.log(&apos;--------------------------INSERT----------------------------&apos;);</span><br><span class="line">    //console.log(&apos;INSERT ID:&apos;,result.insertId);</span><br><span class="line">    console.log(&apos;INSERT ID:&apos;,result);</span><br><span class="line">    console.log(&apos;-----------------------------------------------------------------\n\n&apos;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">//更新</span><br><span class="line">var updateSql=&apos;update websites set name=?,url=? where id=?&apos;;</span><br><span class="line">var updateParams=[&apos;菜鸟移动站&apos;, &apos;https://m.runoob.com&apos;,6];</span><br><span class="line">connection.query(updateSql,updateParams,function (err,result) &#123;</span><br><span class="line">    if(err)&#123;</span><br><span class="line">        console.log(&apos;[UPDATE ERROR] - &apos;,err.message);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line">    console.log(&apos;--------------------------UPDATE----------------------------&apos;);</span><br><span class="line">    console.log(&apos;UPDATE affectedRows&apos;,result.affectedRows);</span><br><span class="line">    console.log(&apos;-----------------------------------------------------------------\n\n&apos;);</span><br><span class="line">&#125;);</span><br><span class="line">//删除</span><br><span class="line">var deleteSql=&apos;delete from websites where id=7&apos;;</span><br><span class="line">connection.query(deleteSql,function (err, result) &#123;</span><br><span class="line">    if(err)&#123;</span><br><span class="line">        console.log(&apos;[DELETE ERROR] - &apos;,err.message);</span><br><span class="line">        return;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    console.log(&apos;--------------------------DELETE----------------------------&apos;);</span><br><span class="line">    console.log(&apos;DELETE affectedRows&apos;,result.affectedRows);</span><br><span class="line">    console.log(&apos;-----------------------------------------------------------------\n\n&apos;);</span><br><span class="line">&#125;);</span><br><span class="line">connection.end();</span><br></pre></td></tr></table></figure><h3 id="13-Node-js-连接MongoDB"><a href="#13-Node-js-连接MongoDB" class="headerlink" title="13. Node.js 连接MongoDB"></a>13. Node.js 连接MongoDB</h3><p>cnpm install mongodb –save</p><ol><li>创建数据库</li><li>创建集合</li><li>增删改查数据</li><li>聚合（连接）操作</li><li>删除集合</li></ol><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> MongoClient = <span class="built_in">require</span>(<span class="string">'mongodb'</span>).MongoClient;</span><br><span class="line"><span class="keyword">var</span> url = <span class="string">"mongodb://localhost:27017/nodejsBase"</span>;</span><br><span class="line">MongoClient.connect(url, &#123; <span class="attr">useNewUrlParser</span>: <span class="literal">true</span> &#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err, db</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"数据库已创建!"</span>);</span><br><span class="line">    <span class="keyword">var</span> dbase = db.db(<span class="string">"nodejsBase"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// dbase.createCollection('site', function (err, res) &#123;</span></span><br><span class="line">    <span class="comment">//     if (err) throw err;</span></span><br><span class="line">    <span class="comment">//     console.log("创建集合!");</span></span><br><span class="line">    <span class="comment">//     db.close();</span></span><br><span class="line">    <span class="comment">// &#125;);</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> myobj = &#123; <span class="attr">name</span>: <span class="string">"菜鸟教程"</span>, <span class="attr">url</span>: <span class="string">"www.runoob"</span> &#125;;</span><br><span class="line">    dbase.collection(<span class="string">"site"</span>).insertOne(myobj, <span class="function"><span class="keyword">function</span>(<span class="params">err, res</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"文档插入成功"</span>);</span><br><span class="line">        <span class="comment">//db.close();</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// myobj =  [</span></span><br><span class="line">    <span class="comment">//     &#123; name: '菜鸟工具', url: 'https://c.runoob.com', type: 'cn'&#125;,</span></span><br><span class="line">    <span class="comment">//     &#123; name: 'Google', url: 'https://www.google.com', type: 'en'&#125;,</span></span><br><span class="line">    <span class="comment">//     &#123; name: 'Facebook', url: 'https://www.google.com', type: 'en'&#125;</span></span><br><span class="line">    <span class="comment">// ];</span></span><br><span class="line">    <span class="comment">// dbase.collection("site").insertMany(myobj, function(err, res) &#123;</span></span><br><span class="line">    <span class="comment">//     if (err) throw err;</span></span><br><span class="line">    <span class="comment">//     console.log("插入的文档数量为: " + res.insertedCount);</span></span><br><span class="line">    <span class="comment">//     //db.close();</span></span><br><span class="line">    <span class="comment">// &#125;);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//查询全部</span></span><br><span class="line">    <span class="comment">// dbase.collection("site").find(&#123;&#125;).toArray(function (err,result) &#123;</span></span><br><span class="line">    <span class="comment">//     if (err) throw err;</span></span><br><span class="line">    <span class="comment">//     console.log(result);</span></span><br><span class="line">    <span class="comment">//     //db.close();</span></span><br><span class="line">    <span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//更新</span></span><br><span class="line">    <span class="keyword">var</span> whereStr = &#123;<span class="string">"name"</span>:<span class="string">'菜鸟教程'</span>&#125;;  <span class="comment">// 查询条件</span></span><br><span class="line">    <span class="keyword">var</span> updateStr = &#123;<span class="attr">$set</span>: &#123; <span class="string">"url"</span> : <span class="string">"https://www.runoob.com"</span> ,<span class="attr">type</span>:<span class="string">'cn'</span>&#125;&#125;;</span><br><span class="line">    dbase.collection(<span class="string">"site"</span>).updateMany(whereStr,updateStr,<span class="function"><span class="keyword">function</span> (<span class="params">err,result</span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"更新————————————————————————"</span>);</span><br><span class="line">        <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">        <span class="built_in">console</span>.log(result.result.nModified + <span class="string">" 条文档被更新"</span>);</span><br><span class="line">        <span class="comment">//db.close();</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// //条件</span></span><br><span class="line">    <span class="comment">// dbase.collection("site").find(&#123;name:"菜鸟教程"&#125;).toArray(function (err,result) &#123;</span></span><br><span class="line">    <span class="comment">//     console.log("查询————————————————————————");</span></span><br><span class="line">    <span class="comment">//     if (err) throw err;</span></span><br><span class="line">    <span class="comment">//     console.log(result);</span></span><br><span class="line">    <span class="comment">//     //db.close();</span></span><br><span class="line">    <span class="comment">// &#125;);</span></span><br><span class="line">    <span class="comment">// //删除</span></span><br><span class="line">    <span class="comment">// dbase.collection("site").deleteMany(whereStr, function(err, result) &#123;</span></span><br><span class="line">    <span class="comment">//     console.log("删除————————————————————————");</span></span><br><span class="line">    <span class="comment">//     if (err) throw err;</span></span><br><span class="line">    <span class="comment">//     console.log(result.result.n + " 条文档被删除");</span></span><br><span class="line">    <span class="comment">//     db.close();</span></span><br><span class="line">    <span class="comment">// &#125;);</span></span><br><span class="line">    <span class="comment">//查询排序 分页skip 跳过指定条数 limit条数</span></span><br><span class="line">    <span class="comment">// var mysort = &#123; type: 1 &#125;;//1升序，-1降序</span></span><br><span class="line">    <span class="comment">// dbase.collection("site").find().sort(mysort).skip(2).limit(5).toArray(function(err, result) &#123;</span></span><br><span class="line">    <span class="comment">//     if (err) throw err;</span></span><br><span class="line">    <span class="comment">//     console.log(result);</span></span><br><span class="line">    <span class="comment">//     db.close();</span></span><br><span class="line">    <span class="comment">// &#125;);</span></span><br><span class="line">    <span class="comment">//连接操作</span></span><br><span class="line">    <span class="comment">// dbase.createCollection('orders', function (err, res) &#123;</span></span><br><span class="line">    <span class="comment">//     if (err) throw err;</span></span><br><span class="line">    <span class="comment">//     console.log("创建orders集合!");</span></span><br><span class="line">    <span class="comment">//     db.close();</span></span><br><span class="line">    <span class="comment">// &#125;);</span></span><br><span class="line">    <span class="comment">// dbase.createCollection('products', function (err, res) &#123;</span></span><br><span class="line">    <span class="comment">//     if (err) throw err;</span></span><br><span class="line">    <span class="comment">//     console.log("创建products集合!");</span></span><br><span class="line">    <span class="comment">//     db.close();</span></span><br><span class="line">    <span class="comment">// &#125;);</span></span><br><span class="line">    <span class="comment">// let orderData=&#123;_id:1,product_id:154,status:1&#125;</span></span><br><span class="line">    <span class="comment">// dbase.collection("orders").insertOne(orderData,function (err,result) &#123;</span></span><br><span class="line">    <span class="comment">//     if (err) throw err;</span></span><br><span class="line">    <span class="comment">//     console.log(result.result.n);</span></span><br><span class="line">    <span class="comment">// &#125;)</span></span><br><span class="line">    <span class="comment">// let productData=[ &#123; _id: 154, name: '笔记本电脑' &#125;,</span></span><br><span class="line">    <span class="comment">//     &#123; _id: 155, name: '耳机' &#125;,</span></span><br><span class="line">    <span class="comment">//     &#123; _id: 156, name: '台式电脑' &#125;];</span></span><br><span class="line">    <span class="comment">// dbase.collection("products").insertMany(productData,function (err,result) &#123;</span></span><br><span class="line">    <span class="comment">//     if (err) console.log(err);</span></span><br><span class="line">    <span class="comment">//     console.log(result.result.n);</span></span><br><span class="line">    <span class="comment">// &#125;)</span></span><br><span class="line">    dbase.collection(<span class="string">"orders"</span>)</span><br><span class="line">        .aggregate([&#123;</span><br><span class="line">            $lookup:</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">from</span>: <span class="string">'products'</span>,            <span class="comment">// 右集合</span></span><br><span class="line">                    localField: <span class="string">'product_id'</span>,    <span class="comment">// 左集合 join 字段</span></span><br><span class="line">                    foreignField: <span class="string">'_id'</span>,         <span class="comment">// 右集合 join 字段</span></span><br><span class="line">                    <span class="keyword">as</span>: <span class="string">'orderdetails'</span>           <span class="comment">// 新生成字段（类型array）</span></span><br><span class="line">                &#125;</span><br><span class="line">        &#125;])</span><br><span class="line">        .toArray(<span class="function"><span class="keyword">function</span>(<span class="params">err, res</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringify(res));</span><br><span class="line">        db.close();</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">//分组等</span></span><br><span class="line">    dbase.collection(<span class="string">"site"</span>)</span><br><span class="line">        .aggregate([&#123;</span><br><span class="line">            $group:&#123;<span class="attr">_id</span>:<span class="string">'$name'</span>,<span class="attr">num</span>:&#123;<span class="attr">$sum</span>:<span class="number">1</span>&#125;&#125;</span><br><span class="line">        &#125;])</span><br><span class="line">        .toArray(<span class="function"><span class="keyword">function</span>(<span class="params">err, res</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="built_in">JSON</span>.stringify(res));</span><br><span class="line">            db.close();</span><br><span class="line">        &#125;);</span><br><span class="line">    <span class="comment">//其他操作类似，查看mongodb操作相关内容</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;整理来自菜鸟教程中nodejs入门知识&lt;/p&gt;
    
    </summary>
    
      <category term="前端" scheme="http://11wy11.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
      <category term="nodejs" scheme="http://11wy11.github.io/tags/nodejs/"/>
    
  </entry>
  
  <entry>
    <title>日常知识点整理--CSS基础</title>
    <link href="http://11wy11.github.io/2019/06/14/daily-css/"/>
    <id>http://11wy11.github.io/2019/06/14/daily-css/</id>
    <published>2019-06-14T02:07:40.000Z</published>
    <updated>2020-12-04T12:01:53.654Z</updated>
    
    <content type="html"><![CDATA[<p>我所不熟悉的CSS属性<br><a id="more"></a></p><p>[TOC]</p><h2 id="我所不熟悉的CSS属性"><a href="#我所不熟悉的CSS属性" class="headerlink" title="我所不熟悉的CSS属性"></a>我所不熟悉的CSS属性</h2><h3 id="before-选择器"><a href="#before-选择器" class="headerlink" title="before 选择器"></a>before 选择器</h3><p>:before 选择器向选定的元素前插入内容</p><p>使用<a href="https://www.runoob.com/cssref/pr-gen-content.html" target="_blank" rel="noopener">content</a> 属性来指定要插入的内容。 </p><h3 id="after-选择器"><a href="#after-选择器" class="headerlink" title="after 选择器"></a>after 选择器</h3><p>:after 选择器向选定的元素之后插入内容。</p><p>例如插入下三角</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="undefined">select&#123;       </span></span><br><span class="line"><span class="undefined">    height: 40px;</span></span><br><span class="line"><span class="undefined">    padding: 5px;</span></span><br><span class="line"><span class="css">    <span class="selector-tag">background-color</span>:<span class="selector-id">#ececec</span>;</span></span><br><span class="line"><span class="undefined">    border: 0;</span></span><br><span class="line"><span class="undefined">    outline: none;</span></span><br><span class="line"><span class="undefined">    font-size: 16px;       </span></span><br><span class="line"><span class="undefined">    width: 240px;</span></span><br><span class="line"><span class="undefined">   -webkit-appearance: none;</span></span><br><span class="line"><span class="undefined">    -moz-appearance: none;</span></span><br><span class="line"><span class="undefined">    appearance: none;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="css"><span class="selector-class">.select</span><span class="selector-pseudo">:after</span> &#123;</span></span><br><span class="line"><span class="css">    <span class="selector-tag">content</span><span class="selector-pseudo">:"</span>▼";    </span></span><br><span class="line"><span class="undefined">    padding: 12px 8px;</span></span><br><span class="line"><span class="undefined">    position: absolute; right: 10px; top: 0;    </span></span><br><span class="line"><span class="undefined">    z-index: 1;</span></span><br><span class="line"><span class="undefined">    text-align: center;</span></span><br><span class="line"><span class="undefined">    width: 10%;</span></span><br><span class="line"><span class="undefined">    height: 100%;      </span></span><br><span class="line"><span class="undefined">    pointer-events: none;</span></span><br><span class="line"><span class="undefined">    box-sizing: border-box;   </span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"select"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">name</span>=<span class="string">"select"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span>&gt;</span>select<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span>&gt;</span>option<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span>&gt;</span>option<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span>&gt;</span>option<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span>&gt;</span>option<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span>&gt;</span>option<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span>&gt;</span>option<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="filter-滤镜-属性"><a href="#filter-滤镜-属性" class="headerlink" title="filter(滤镜) 属性"></a>filter(滤镜) 属性</h3><table><thead><tr><th style="text-align:left">Filter</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">none</td><td style="text-align:left">默认值，没有效果。</td></tr><tr><td style="text-align:left">blur(<em>px</em>)</td><td style="text-align:left">给图像设置高斯模糊。”radius”一值设定高斯函数的标准差，或者是屏幕上以多少像素融在一起， 所以值越大越模糊；  如果没有设定值，则默认是0；这个参数可设置css长度值，但不接受百分比值。</td></tr><tr><td style="text-align:left">brightness(<em>%</em>)</td><td style="text-align:left">给图片应用一种线性乘法，使其看起来更亮或更暗。如果值是0%，图像会全黑。值是100%，则图像无变化。其他的值对应线性乘数效果。值超过100%也是可以的，图像会比原来更亮。如果没有设定值，默认是1。</td></tr><tr><td style="text-align:left">contrast(<em>%</em>)</td><td style="text-align:left">调整图像的对比度。值是0%的话，图像会全黑。值是100%，图像不变。值可以超过100%，意味着会运用更低的对比。若没有设置值，默认是1。</td></tr><tr><td style="text-align:left">drop-shadow(<em>h-shadow v-shadow blur spread color</em>)</td><td style="text-align:left">给图像设置一个阴影效果。阴影是合成在图像下面，可以有模糊度的，可以以特定颜色画出的遮罩图的偏移版本。 函数接受<shadow>(在CSS3背景中定义)类型的值，除了”inset”关键字是不允许的。该函数与已有的box-shadow box-shadow属性很相似；不同之处在于，通过滤镜，一些浏览器为了更好的性能会提供硬件加速。<code>&lt;shadow&gt;参数如下：`</code><strong><offset-x></offset-x></strong> <strong><offset-y></offset-y></strong> (必须)这是设置阴影偏移量的两个 <length>值. <strong><offset-x></offset-x></strong> 设定水平方向距离. 负值会使阴影出现在元素左边. <strong><offset-y></offset-y></strong>设定垂直距离.负值会使阴影出现在元素上方。查看<strong><length></length></strong>可能的单位.<strong>如果两个值都是0</strong>, 则阴影出现在元素正后面 (如果设置了 <blur-radius> and/or <spread-radius>，会有模糊效果).<strong><blur-radius></blur-radius></strong> (可选)这是第三个code&gt;<length>值. 值越大，越模糊，则阴影会变得更大更淡.不允许负值 若未设定，默认是0 (则阴影的边界很锐利).<strong><spread-radius></spread-radius></strong> (可选)这是第四个 <length>值. 正值会使阴影扩张和变大，负值会是阴影缩小.若未设定，默认是0 (阴影会与元素一样大小). 注意: Webkit, 以及一些其他浏览器 不支持第四个长度，如果加了也不会渲染。 <strong><color></color></strong> (可选)查看 <color>该值可能的关键字和标记。若未设定，颜色值基于浏览器。在Gecko (Firefox), Presto (Opera)和Trident (Internet Explorer)中， 会应用color<strong>color</strong>属性的值。另外, 如果颜色值省略，WebKit中阴影是透明的。`</color></length></length></spread-radius></blur-radius></length></shadow></td></tr><tr><td style="text-align:left">grayscale(<em>%</em>)</td><td style="text-align:left">将图像转换为灰度图像。值定义转换的比例。值为100%则完全转为灰度图像，值为0%图像无变化。值在0%到100%之间，则是效果的线性乘子。若未设置，值默认是0；</td></tr><tr><td style="text-align:left">hue-rotate(<em>deg</em>)</td><td style="text-align:left">给图像应用色相旋转。”angle”一值设定图像会被调整的色环角度值。值为0deg，则图像无变化。若值未设置，默认值是0deg。该值虽然没有最大值，超过360deg的值相当于又绕一圈。</td></tr><tr><td style="text-align:left">invert(<em>%</em>)</td><td style="text-align:left">反转输入图像。值定义转换的比例。100%的价值是完全反转。值为0%则图像无变化。值在0%和100%之间，则是效果的线性乘子。 若值未设置，值默认是0。</td></tr><tr><td style="text-align:left">opacity(<em>%</em>)</td><td style="text-align:left">转化图像的透明程度。值定义转换的比例。值为0%则是完全透明，值为100%则图像无变化。值在0%和100%之间，则是效果的线性乘子，也相当于图像样本乘以数量。 若值未设置，值默认是1。该函数与已有的opacity属性很相似，不同之处在于通过filter，一些浏览器为了提升性能会提供硬件加速。</td></tr><tr><td style="text-align:left">saturate(<em>%</em>)</td><td style="text-align:left">转换图像饱和度。值定义转换的比例。值为0%则是完全不饱和，值为100%则图像无变化。其他值，则是效果的线性乘子。超过100%的值是允许的，则有更高的饱和度。 若值未设置，值默认是1。</td></tr><tr><td style="text-align:left">sepia(<em>%</em>)</td><td style="text-align:left">将图像转换为深褐色。值定义转换的比例。值为100%则完全是深褐色的，值为0%图像无变化。值在0%到100%之间，则是效果的线性乘子。若未设置，值默认是0；</td></tr><tr><td style="text-align:left">url()</td><td style="text-align:left">URL函数接受一个XML文件，该文件设置了 一个SVG滤镜，且可以包含一个锚点来指定一个具体的滤镜元素。例如：<code>filter: url(svg-url#element-id)</code></td></tr><tr><td style="text-align:left">initial</td><td style="text-align:left">设置属性为默认值，可参阅： <a href="https://www.runoob.com/cssref/css-initial.html" target="_blank" rel="noopener">CSS initial 关键字</a></td></tr><tr><td style="text-align:left">inherit</td><td style="text-align:left">从父元素继承该属性，可参阅：<a href="https://www.runoob.com/cssref/css-inherit.html" target="_blank" rel="noopener">CSS inherit 关键字</a></td></tr></tbody></table><h3 id="伪类"><a href="#伪类" class="headerlink" title="伪类"></a>伪类</h3><h4 id="anchor伪类"><a href="#anchor伪类" class="headerlink" title="anchor伪类"></a>anchor伪类</h4><p>在支持 CSS 的浏览器中，链接的不同状态都可以以不同的方式显示</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">a</span><span class="selector-pseudo">:link</span> &#123;<span class="attribute">color</span>:<span class="number">#FF0000</span>;&#125; <span class="comment">/* 未访问的链接 */</span> <span class="selector-tag">a</span><span class="selector-pseudo">:visited</span> &#123;<span class="attribute">color</span>:<span class="number">#00FF00</span>;&#125; <span class="comment">/* 已访问的链接 */</span> <span class="selector-tag">a</span><span class="selector-pseudo">:hover</span> &#123;<span class="attribute">color</span>:<span class="number">#FF00FF</span>;&#125; <span class="comment">/* 鼠标划过链接 */</span> <span class="selector-tag">a</span><span class="selector-pseudo">:active</span> &#123;<span class="attribute">color</span>:<span class="number">#0000FF</span>;&#125; <span class="comment">/* 已选中的链接 */</span></span><br></pre></td></tr></table></figure><p><strong>注意：</strong> 在CSS定义中，a:hover 必须被置于 a:link 和 a:visited 之后，才是有效的。</p><p><strong>注意：</strong> 在 CSS 定义中，a:active 必须被置于 a:hover 之后，才是有效的。</p><h4 id="CSS-属性-选择器"><a href="#CSS-属性-选择器" class="headerlink" title="CSS 属性 选择器"></a>CSS 属性 选择器</h4><p>下面的例子是把包含标题（title）的所有元素变为蓝色：</p><p>实例</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-attr">[title]</span> &#123;     <span class="attribute">color</span>:blue; &#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;我所不熟悉的CSS属性&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="前端" scheme="http://11wy11.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
      <category term="CSS" scheme="http://11wy11.github.io/tags/CSS/"/>
    
  </entry>
  
  <entry>
    <title>日常知识点整理——js基础</title>
    <link href="http://11wy11.github.io/2019/06/13/daily-js/"/>
    <id>http://11wy11.github.io/2019/06/13/daily-js/</id>
    <published>2019-06-13T03:43:50.000Z</published>
    <updated>2020-12-04T12:00:06.983Z</updated>
    
    <content type="html"><![CDATA[<p>手写图片瀑布流及图片懒加载</p><a id="more"></a><h4 id="随机获得照片地址"><a href="#随机获得照片地址" class="headerlink" title="随机获得照片地址"></a>随机获得照片地址</h4><p><a href="http://lorempixel.com/1600/900" target="_blank" rel="noopener">http://lorempixel.com/1600/900</a></p><p><a href="https://unsplash.it/1600/900?random（国内加载略慢）" target="_blank" rel="noopener">https://unsplash.it/1600/900?random（国内加载略慢）</a></p><p><a href="https://uploadbeta.com/api/pictures/random/?key=BingEverydayWallpaperPicture【返回必应图片】" target="_blank" rel="noopener">https://uploadbeta.com/api/pictures/random/?key=BingEverydayWallpaperPicture【返回必应图片】</a></p><p><a href="http://cn.bing.com/HPImageArchive.aspx?format=js&amp;idx=0&amp;n=1（必应返回JSON数据，具体百度" target="_blank" rel="noopener">http://cn.bing.com/HPImageArchive.aspx?format=js&amp;idx=0&amp;n=1（必应返回JSON数据，具体百度</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;手写图片瀑布流及图片懒加载&lt;/p&gt;
    
    </summary>
    
      <category term="日常" scheme="http://11wy11.github.io/categories/%E6%97%A5%E5%B8%B8/"/>
    
    
      <category term="js" scheme="http://11wy11.github.io/tags/js/"/>
    
  </entry>
  
  <entry>
    <title>日常知识点整理——正则表达式regex</title>
    <link href="http://11wy11.github.io/2019/06/12/daily-regex/"/>
    <id>http://11wy11.github.io/2019/06/12/daily-regex/</id>
    <published>2019-06-12T08:00:27.000Z</published>
    <updated>2020-12-04T11:59:47.247Z</updated>
    
    <content type="html"><![CDATA[<p>转载 开心师姐的博客<br><a id="more"></a></p><p>转载<a href="https://rosychen.com/2019/06/10/2019-06-10-%E3%80%90JS%E5%9F%BA%E7%A1%80%E3%80%91%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" target="_blank" rel="noopener">https://rosychen.com/2019/06/10/2019-06-10-%E3%80%90JS%E5%9F%BA%E7%A1%80%E3%80%91%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/</a></p><h2 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h2><ul><li>了解正则表达式基本语法</li><li>能够使用JavaScript的正则对象</li></ul><h3 id="正则表达式简介"><a href="#正则表达式简介" class="headerlink" title="正则表达式简介"></a>正则表达式简介</h3><h4 id="什么是正则表达式"><a href="#什么是正则表达式" class="headerlink" title="什么是正则表达式"></a>什么是正则表达式</h4><p>正则表达式：用于匹配规律规则的表达式，正则表达式最初是科学家对人类神经系统的工作原理的早期研究，现在在编程语言中有广泛的应用。正则表通常被用来检索、替换那些符合某个模式(规则)的文本。<br>正则表达式是对字符串操作的一种逻辑公式，就是用事先定义好的一些特定字符、及这些特定字符的组合，组成一个“规则字符串”，这个“规则字符串”用来表达对字符串的一种过滤逻辑。</p><h4 id="正则表达式的作用"><a href="#正则表达式的作用" class="headerlink" title="正则表达式的作用"></a>正则表达式的作用</h4><ol><li>给定的字符串是否符合正则表达式的过滤逻辑(匹配)</li><li>可以通过正则表达式，从字符串中获取我们想要的特定部分(提取)</li><li>强大的字符串替换能力(替换)</li></ol><h4 id="正则表达式的特点"><a href="#正则表达式的特点" class="headerlink" title="正则表达式的特点"></a>正则表达式的特点</h4><ol><li>灵活性、逻辑性和功能性非常的强</li><li>可以迅速地用极简单的方式达到字符串的复杂控制</li><li>对于刚接触的人来说，比较晦涩难懂</li></ol><h3 id="正则表达式的测试"><a href="#正则表达式的测试" class="headerlink" title="正则表达式的测试"></a>正则表达式的测试</h3><ul><li><a href="https://c.runoob.com/front-end/854" target="_blank" rel="noopener">在线测试正则</a> </li></ul><h3 id="正则表达式的组成"><a href="#正则表达式的组成" class="headerlink" title="正则表达式的组成"></a>正则表达式的组成</h3><ul><li>普通字符</li><li>特殊字符(元字符)：正则表达式中有特殊意义的字符</li></ul><p>示例：</p><ul><li><code>\d</code> 匹配数字</li><li><code>ab\d</code> 匹配 ab1、ab2</li></ul><h3 id="元字符串"><a href="#元字符串" class="headerlink" title="元字符串"></a>元字符串</h3><p>通过测试工具演示下面元字符的使用</p><h4 id="常用元字符串"><a href="#常用元字符串" class="headerlink" title="常用元字符串"></a>常用元字符串</h4><table><thead><tr><th>元字符</th><th>说明</th></tr></thead><tbody><tr><td>.</td><td>匹配除换行符以外的任意单个字符</td></tr><tr><td>\d</td><td>匹配数字</td></tr><tr><td>\D</td><td>匹配任意非数字的字符</td></tr><tr><td>\w</td><td>匹配字母或数字或下划线</td></tr><tr><td>\W</td><td>匹配任意不是字母，数字，下划线</td></tr><tr><td>\s</td><td>匹配任意的空白符</td></tr><tr><td>\S</td><td>匹配任意不是空白符的字符</td></tr><tr><td>^</td><td>表示匹配行首的文本(以谁开始)</td></tr><tr><td>$</td><td>表示匹配行尾的文本(以谁结束)</td></tr></tbody></table><h4 id="限定符"><a href="#限定符" class="headerlink" title="限定符"></a>限定符</h4><table><thead><tr><th>限定符</th><th>说明</th></tr></thead><tbody><tr><td>*</td><td>重复零次或更多次</td></tr><tr><td>+</td><td>重复一次或更多次</td></tr><tr><td>?</td><td>重复零次或一次</td></tr><tr><td>{n}</td><td>重复n次</td></tr><tr><td>{n,}</td><td>重复n次或更多次</td></tr><tr><td>{n,m}</td><td>重复n到m次</td></tr></tbody></table><h4 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[] 字符串用中括号括起来，表示匹配其中的任一字符，相当于或的意思</span><br><span class="line">[^]  匹配除中括号以内的内容</span><br><span class="line">\ 转义符</span><br><span class="line">| 或者，选择两者中的一个。注意|将左右两边分为两部分，而不管左右两边有多长多乱</span><br><span class="line">() 从两个直接量中选择一个，分组</span><br><span class="line">   eg：gr(a|e)y匹配gray和grey</span><br><span class="line">[\u4e00-\u9fa5]  匹配汉字</span><br></pre></td></tr></table></figure><h3 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h3><p>验证手机号：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">^\d&#123;<span class="number">11</span>&#125;$</span><br></pre></td></tr></table></figure><p>验证邮编：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">^\d&#123;<span class="number">6</span>&#125;$</span><br></pre></td></tr></table></figure><p>验证日期 2012-5-01</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">^\d&#123;<span class="number">4</span>&#125;-\d&#123;<span class="number">1</span>,<span class="number">2</span>&#125;-\d&#123;<span class="number">1</span>,<span class="number">2</span>&#125;$</span><br></pre></td></tr></table></figure><p>验证邮箱 <a href="mailto:xxx@itcast.cn" target="_blank" rel="noopener">xxx@itcast.cn</a>：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">^\w+@\w+\.\w+$</span><br></pre></td></tr></table></figure><p>验证IP地址 192.168.1.10</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">^\d&#123;<span class="number">1</span>,<span class="number">3</span>&#125;\(.\d&#123;<span class="number">1</span>,<span class="number">3</span>&#125;)&#123;<span class="number">3</span>&#125;$</span><br></pre></td></tr></table></figure><p>使用正则表达式 提取网址协议，域名，IP, 端口等参数</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">var url = &quot;http://192.168.1.111:8888/#/statistic/htmel/dkdkd/dksdkldsl.html&quot;;</span><br><span class="line">var patt = /(\w+):\/\/([^/:]+):(\d*)\/#\/(\S+)/;</span><br><span class="line">arr = url.match(patt);</span><br><span class="line">for (let i = 0; i &lt; arr.length; i++) &#123;</span><br><span class="line">  console.log(arr[i])</span><br><span class="line">&#125;</span><br><span class="line">var index = arr[arr.length - 1];</span><br><span class="line">// var arrIndex = index.split(&quot;/&quot;)</span><br><span class="line">var arrIndex = index.match(/(\w+)/g);</span><br><span class="line">for (let i = 0; i &lt; arrIndex.length; i++) &#123;</span><br><span class="line">  console.log(arrIndex[i])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="JavaScript-中使用正则表达式"><a href="#JavaScript-中使用正则表达式" class="headerlink" title="JavaScript 中使用正则表达式"></a>JavaScript 中使用正则表达式</h2><h3 id="创建正则对象"><a href="#创建正则对象" class="headerlink" title="创建正则对象"></a>创建正则对象</h3><p>方式1：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="keyword">new</span> Regex(<span class="string">'\d'</span>, <span class="string">'i'</span>);</span><br><span class="line"><span class="keyword">var</span> reg = <span class="keyword">new</span> Regex(<span class="string">'\d'</span>, <span class="string">'gi'</span>);</span><br></pre></td></tr></table></figure><p>方式2：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/\d/i</span>;</span><br><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/\d/gi</span>;</span><br></pre></td></tr></table></figure><h4 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h4><table><thead><tr><th>标志</th><th>说明</th></tr></thead><tbody><tr><td>i</td><td>忽略大小写</td></tr><tr><td>g</td><td>全局匹配</td></tr><tr><td>gi</td><td>全局匹配+忽略大小写</td></tr></tbody></table><h3 id="正则匹配"><a href="#正则匹配" class="headerlink" title="正则匹配"></a>正则匹配</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 匹配日期</span></span><br><span class="line"><span class="keyword">var</span> dateStr = <span class="string">'2015-10-10'</span>;</span><br><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/^\d&#123;4&#125;-\d&#123;1,2&#125;-\d&#123;1,2&#125;$/</span></span><br><span class="line"><span class="built_in">console</span>.log(reg.test(dateStr));</span><br></pre></td></tr></table></figure><h3 id="匹配正则表达式"><a href="#匹配正则表达式" class="headerlink" title="匹配正则表达式"></a>匹配正则表达式</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//console.log(/./.test("除了回车换行以外的任意字符"));//true</span></span><br><span class="line"><span class="comment">// console.log(/.*/.test("0个到多个"));//true</span></span><br><span class="line"><span class="comment">// console.log(/.+/.test("1个到多个"));//true</span></span><br><span class="line"><span class="comment">// console.log(/.?/.test("哈哈"));//true</span></span><br><span class="line"><span class="comment">// console.log(/[0-9]/.test("9527"));//true</span></span><br><span class="line"><span class="comment">// console.log(/[a-z]/.test("what"));//true</span></span><br><span class="line"><span class="comment">// console.log(/[A-Z]/.test("Are"));//true</span></span><br><span class="line"><span class="comment">// console.log(/[a-zA-Z]/.test("干啥子"));//false</span></span><br><span class="line"><span class="comment">// console.log(/[0-9a-zA-Z]/.test("9ebg"));//true</span></span><br><span class="line"><span class="comment">// console.log(/b|(ara)/.test("abra"));//true</span></span><br><span class="line"><span class="comment">// console.log(/[a-z]&#123;2,3&#125;/.test("arfsf"));//true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="regexp">/\d/</span>.test(<span class="string">"998"</span>));<span class="comment">//true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="regexp">/\d*/</span>.test(<span class="string">"998"</span>));<span class="comment">//true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="regexp">/\d+/</span>.test(<span class="string">"998"</span>));<span class="comment">//true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="regexp">/\d&#123;0,&#125;/</span>.test(<span class="string">"998"</span>));<span class="comment">//true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="regexp">/\d&#123;2,3&#125;/</span>.test(<span class="string">"998"</span>));<span class="comment">//true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="regexp">/\D/</span>.test(<span class="string">"eat"</span>));<span class="comment">//true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="regexp">/\s/</span>.test(<span class="string">"  "</span>));<span class="comment">//true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="regexp">/\S/</span>.test(<span class="string">"嘎嘎"</span>));<span class="comment">//true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="regexp">/\w/</span>.test(<span class="string">"_"</span>));<span class="comment">//true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="regexp">/\W/</span>.test(<span class="string">"_"</span>));<span class="comment">//true</span></span><br></pre></td></tr></table></figure><h3 id="正则表达式案例"><a href="#正则表达式案例" class="headerlink" title="正则表达式案例"></a>正则表达式案例</h3><p>1.验证密码强弱<br>2.验证邮箱：[0-9a-zA-Z_.-]+[@][0-9a-zA-Z._-]+([.][a-zA-Z]+){1,2}<br>3.验证中文名字[\u4e00-\u9fa5]</p><h3 id="正则提取"><a href="#正则提取" class="headerlink" title="正则提取"></a>正则提取</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 提取工资</span></span><br><span class="line"><span class="keyword">var</span> str = <span class="string">"张三：1000，李四：5000，王五：8000。"</span>;</span><br><span class="line"><span class="keyword">var</span> array = str.match(<span class="regexp">/\d+/g</span>);</span><br><span class="line"><span class="built_in">console</span>.log(array);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 提取email地址</span></span><br><span class="line"><span class="keyword">var</span> str = <span class="string">"123123@xx.com,fangfang@valuedopinions.cn 286669312@qq.com 2、emailenglish@emailenglish.englishtown.com 286669312@qq.com..."</span>;</span><br><span class="line"><span class="keyword">var</span> array = str.match(<span class="regexp">/\w+@\w+\.\w+(\.\w+)?/g</span>);</span><br><span class="line"><span class="built_in">console</span>.log(array);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 分组提取  </span></span><br><span class="line"><span class="comment">// 3. 提取日期中的年部分  2015-5-10</span></span><br><span class="line"><span class="keyword">var</span> dateStr = <span class="string">'2016-1-5'</span>;</span><br><span class="line"><span class="comment">// 正则表达式中的()作为分组来使用，获取分组匹配到的结果用Regex.$1 $2 $3....来获取</span></span><br><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/(\d&#123;4&#125;)-\d&#123;1,2&#125;-\d&#123;1,2&#125;/</span>;</span><br><span class="line"><span class="keyword">if</span> (reg.test(dateStr)) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">RegExp</span>.$<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 提取邮件中的每一部分</span></span><br><span class="line"><span class="keyword">var</span> reg = <span class="regexp">/(\w+)@(\w+)\.(\w+)(\.\w+)?/</span>;</span><br><span class="line"><span class="keyword">var</span> str = <span class="string">"123123@xx.com"</span>;</span><br><span class="line"><span class="keyword">if</span> (reg.test(str)) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">RegExp</span>.$<span class="number">1</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">RegExp</span>.$<span class="number">2</span>);</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="built_in">RegExp</span>.$<span class="number">3</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//5. 提取网址URI组件</span></span><br><span class="line"><span class="keyword">var</span> str = <span class="string">"http://www.runoob.com:80/html/html-tutorial.html"</span>;</span><br><span class="line"><span class="keyword">var</span> patt1 = <span class="regexp">/(\w+):\/\/([^/:]+)(:\d*)?([^# ]*)/</span>;</span><br><span class="line">arr = str.match(patt1);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; arr.length ; i++) &#123;</span><br><span class="line">    <span class="built_in">document</span>.write(arr[i]);</span><br><span class="line"><span class="built_in">document</span>.write(<span class="string">"&lt;br&gt;"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//out </span></span><br><span class="line"><span class="comment">// http</span></span><br><span class="line"><span class="comment">// www.runoob.com</span></span><br><span class="line"> <span class="comment">// :80</span></span><br><span class="line"> <span class="comment">// /html/html-tutorial.html</span></span><br></pre></td></tr></table></figure><h3 id="正则替换"><a href="#正则替换" class="headerlink" title="正则替换"></a>正则替换</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 替换所有空白</span></span><br><span class="line"><span class="keyword">var</span> str = <span class="string">"   123AD  asadf   asadfasf  adf "</span>;</span><br><span class="line">str = str.replace(<span class="regexp">/\s/g</span>,<span class="string">"xx"</span>);</span><br><span class="line"><span class="built_in">console</span>.log(str);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 替换所有,|，</span></span><br><span class="line"><span class="keyword">var</span> str = <span class="string">"abc,efg,123，abc,123，a"</span>;</span><br><span class="line">str = str.replace(<span class="regexp">/,|，/g</span>, <span class="string">"."</span>);</span><br><span class="line"><span class="built_in">console</span>.log(str);</span><br></pre></td></tr></table></figure><h3 id="案例：表单验证"><a href="#案例：表单验证" class="headerlink" title="案例：表单验证"></a>案例：表单验证</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">QQ号：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"txtQQ"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">邮箱：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"txtEMail"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">手机：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"txtPhone"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">生日：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"txtBirthday"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">姓名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">id</span>=<span class="string">"txtName"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取文本框</span></span><br><span class="line"><span class="keyword">var</span> txtQQ = <span class="built_in">document</span>.getElementById(<span class="string">"txtQQ"</span>);</span><br><span class="line"><span class="keyword">var</span> txtEMail = <span class="built_in">document</span>.getElementById(<span class="string">"txtEMail"</span>);</span><br><span class="line"><span class="keyword">var</span> txtPhone = <span class="built_in">document</span>.getElementById(<span class="string">"txtPhone"</span>);</span><br><span class="line"><span class="keyword">var</span> txtBirthday = <span class="built_in">document</span>.getElementById(<span class="string">"txtBirthday"</span>);</span><br><span class="line"><span class="keyword">var</span> txtName = <span class="built_in">document</span>.getElementById(<span class="string">"txtName"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//</span></span><br><span class="line">txtQQ.onblur = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">//获取当前文本框对应的span</span></span><br><span class="line">  <span class="keyword">var</span> span = <span class="keyword">this</span>.nextElementSibling;</span><br><span class="line">  <span class="keyword">var</span> reg = <span class="regexp">/^\d&#123;5,12&#125;$/</span>;</span><br><span class="line">  <span class="comment">//判断验证是否成功</span></span><br><span class="line">  <span class="keyword">if</span>(!reg.test(<span class="keyword">this</span>.value) )&#123;</span><br><span class="line">    <span class="comment">//验证不成功</span></span><br><span class="line">    span.innerText = <span class="string">"请输入正确的QQ号"</span>;</span><br><span class="line">    span.style.color = <span class="string">"red"</span>;</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">//验证成功</span></span><br><span class="line">    span.innerText = <span class="string">""</span>;</span><br><span class="line">    span.style.color = <span class="string">""</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//txtEMail</span></span><br><span class="line">txtEMail.onblur = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">//获取当前文本框对应的span</span></span><br><span class="line">  <span class="keyword">var</span> span = <span class="keyword">this</span>.nextElementSibling;</span><br><span class="line">  <span class="keyword">var</span> reg = <span class="regexp">/^\w+@\w+\.\w+(\.\w+)?$/</span>;</span><br><span class="line">  <span class="comment">//判断验证是否成功</span></span><br><span class="line">  <span class="keyword">if</span>(!reg.test(<span class="keyword">this</span>.value) )&#123;</span><br><span class="line">    <span class="comment">//验证不成功</span></span><br><span class="line">    span.innerText = <span class="string">"请输入正确的EMail地址"</span>;</span><br><span class="line">    span.style.color = <span class="string">"red"</span>;</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">//验证成功</span></span><br><span class="line">    span.innerText = <span class="string">""</span>;</span><br><span class="line">    span.style.color = <span class="string">""</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>表单验证部分，封装成函数：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> regBirthday = <span class="regexp">/^\d&#123;4&#125;-\d&#123;1,2&#125;-\d&#123;1,2&#125;$/</span>;</span><br><span class="line">addCheck(txtBirthday, regBirthday, <span class="string">"请输入正确的出生日期"</span>);</span><br><span class="line"><span class="comment">//给文本框添加验证</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addCheck</span>(<span class="params">element, reg, tip</span>) </span>&#123;</span><br><span class="line">  element.onblur = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">//获取当前文本框对应的span</span></span><br><span class="line">    <span class="keyword">var</span> span = <span class="keyword">this</span>.nextElementSibling;</span><br><span class="line">    <span class="comment">//判断验证是否成功</span></span><br><span class="line">    <span class="keyword">if</span>(!reg.test(<span class="keyword">this</span>.value) )&#123;</span><br><span class="line">      <span class="comment">//验证不成功</span></span><br><span class="line">      span.innerText = tip;</span><br><span class="line">      span.style.color = <span class="string">"red"</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="comment">//验证成功</span></span><br><span class="line">      span.innerText = <span class="string">""</span>;</span><br><span class="line">      span.style.color = <span class="string">""</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>通过给元素增加自定义验证属性对表单进行验证：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">id</span>=<span class="string">"frm"</span>&gt;</span></span><br><span class="line">  QQ号：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"txtQQ"</span> <span class="attr">data-rule</span>=<span class="string">"qq"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  邮箱：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"txtEMail"</span> <span class="attr">data-rule</span>=<span class="string">"email"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  手机：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"txtPhone"</span> <span class="attr">data-rule</span>=<span class="string">"phone"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  生日：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"txtBirthday"</span> <span class="attr">data-rule</span>=<span class="string">"date"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">  姓名：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"txtName"</span> <span class="attr">data-rule</span>=<span class="string">"cn"</span>&gt;</span><span class="tag">&lt;<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 所有的验证规则</span></span><br><span class="line"><span class="keyword">var</span> rules = [</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">'qq'</span>,</span><br><span class="line">    reg: <span class="regexp">/^\d&#123;5,12&#125;$/</span>,</span><br><span class="line">    tip: <span class="string">"请输入正确的QQ"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">'email'</span>,</span><br><span class="line">    reg: <span class="regexp">/^\w+@\w+\.\w+(\.\w+)?$/</span>,</span><br><span class="line">    tip: <span class="string">"请输入正确的邮箱地址"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">'phone'</span>,</span><br><span class="line">    reg: <span class="regexp">/^\d&#123;11&#125;$/</span>,</span><br><span class="line">    tip: <span class="string">"请输入正确的手机号码"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">'date'</span>,</span><br><span class="line">    reg: <span class="regexp">/^\d&#123;4&#125;-\d&#123;1,2&#125;-\d&#123;1,2&#125;$/</span>,</span><br><span class="line">    tip: <span class="string">"请输入正确的出生日期"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    name: <span class="string">'cn'</span>,</span><br><span class="line">    reg: <span class="regexp">/^[\u4e00-\u9fa5]&#123;2,4&#125;$/</span>,</span><br><span class="line">    tip: <span class="string">"请输入正确的姓名"</span></span><br><span class="line">  &#125;];</span><br><span class="line"></span><br><span class="line">addCheck(<span class="string">'frm'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//给文本框添加验证</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addCheck</span>(<span class="params">formId</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> i = <span class="number">0</span>,</span><br><span class="line">      len = <span class="number">0</span>,</span><br><span class="line">      frm =<span class="built_in">document</span>.getElementById(formId);</span><br><span class="line">  len = frm.children.length;</span><br><span class="line">  <span class="keyword">for</span> (; i &lt; len; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> element = frm.children[i];</span><br><span class="line">    <span class="comment">// 表单元素中有name属性的元素添加验证</span></span><br><span class="line">    <span class="keyword">if</span> (element.name) &#123;</span><br><span class="line">      element.onblur = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 使用dataset获取data-自定义属性的值</span></span><br><span class="line">        <span class="keyword">var</span> ruleName = <span class="keyword">this</span>.dataset.rule;</span><br><span class="line">        <span class="keyword">var</span> rule =getRuleByRuleName(rules, ruleName);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> span = <span class="keyword">this</span>.nextElementSibling;</span><br><span class="line">        <span class="comment">//判断验证是否成功</span></span><br><span class="line">        <span class="keyword">if</span>(!rule.reg.test(<span class="keyword">this</span>.value) )&#123;</span><br><span class="line">          <span class="comment">//验证不成功</span></span><br><span class="line">          span.innerText = rule.tip;</span><br><span class="line">          span.style.color = <span class="string">"red"</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">          <span class="comment">//验证成功</span></span><br><span class="line">          span.innerText = <span class="string">""</span>;</span><br><span class="line">          span.style.color = <span class="string">""</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 根据规则的名称获取规则对象</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getRuleByRuleName</span>(<span class="params">rules, ruleName</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> i = <span class="number">0</span>,</span><br><span class="line">      len = rules.length;</span><br><span class="line">  <span class="keyword">var</span> rule = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">for</span> (; i &lt; len; i++) &#123;</span><br><span class="line">    <span class="keyword">if</span> (rules[i].name == ruleName) &#123;</span><br><span class="line">      rule = rules[i];</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> rule;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="菜鸟工具部分例子"><a href="#菜鸟工具部分例子" class="headerlink" title="菜鸟工具部分例子"></a>菜鸟工具部分例子</h2><ul><li>Email地址：<code>^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$</code></li><li>域名：<code>[a-zA-Z0-9][-a-zA-Z0-9]{0,62}(/.[a-zA-Z0-9][-a-zA-Z0-9]{0,62})+/.?</code></li><li>InternetURL：<code>[a-zA-z]+://[^\s]* 或 ^http://([\w-]+\.)+[\w-]+(/[\w-./?%&amp;=]*)?$</code></li><li>手机号码：<code>^(13[0-9]|14[5|7]|15[0|1|2|3|5|6|7|8|9]|18[0|1|2|3|5|6|7|8|9])\d{8}$</code></li><li>电话号码(“XXX-XXXXXXX”、”XXXX-XXXXXXXX”、”XXX-XXXXXXX”、”XXX-XXXXXXXX”、”XXXXXXX”和”XXXXXXXX)：<code>^(\(\d{3,4}-)|\d{3.4}-)?\d{7,8}$</code></li><li>国内电话号码(0511-4405222、021-87888822)：<code>\d{3}-\d{8}|\d{4}-\d{7}</code></li><li>电话号码正则表达式（支持手机号码，3-4位区号，7-8位直播号码，1－4位分机号）: <code>((\d{11})|^((\d{7,8})|(\d{4}|\d{3})-(\d{7,8})|(\d{4}|\d{3})-(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1})|(\d{7,8})-(\d{4}|\d{3}|\d{2}|\d{1}))$)</code></li><li>身份证号(15位、18位数字)，最后一位是校验位，可能为数字或字符X：<code>(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)</code></li><li>帐号是否合法(字母开头，允许5-16字节，允许字母数字下划线)：<code>^[a-zA-Z][a-zA-Z0-9_]{4,15}$</code></li><li>密码(以字母开头，长度在6~18之间，只能包含字母、数字和下划线)：<code>^[a-zA-Z]\w{5,17}$</code></li><li>强密码(必须包含大小写字母和数字的组合，不能使用特殊字符，长度在 8-10 之间)：<code>^(?=.*\d)(?=.*[a-z])(?=.*[A-Z])[a-zA-Z0-9]{8,10}$</code></li><li>强密码(必须包含大小写字母和数字的组合，可以使用特殊字符，长度在8-10之间)：<code>^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,10}$</code></li><li>日期格式：<code>^\d{4}-\d{1,2}-\d{1,2}</code></li><li>一年的12个月(01～09和1～12)：<code>^(0?[1-9]|1[0-2])$</code></li><li>一个月的31天(01～09和1～31)：<code>^((0?[1-9])|((1|2)[0-9])|30|31)$</code></li><li>钱的输入格式：<ul><li>有四种钱的表示形式我们可以接受:”10000.00” 和 “10,000.00”, 和没有 “分” 的 “10000” 和 “10,000”：<code>^[1-9][0-9]*$</code></li><li>这表示任意一个不以0开头的数字,但是,这也意味着一个字符”0”不通过,所以我们采用下面的形式：<code>^(0|[1-9][0-9]*)$</code></li><li>一个0或者一个不以0开头的数字.我们还可以允许开头有一个负号：<code>^(0|-?[1-9][0-9]*)$</code></li><li>这表示一个0或者一个可能为负的开头不为0的数字.让用户以0开头好了.把负号的也去掉,因为钱总不能是负的吧。下面我们要加的是说明可能的小数部分：<code>^[0-9]+(.[0-9]+)?$</code></li><li>必须说明的是,小数点后面至少应该有1位数,所以”10.”是不通过的,但是 “10” 和 “10.2” 是通过的：<code>^[0-9]+(.[0-9]{2})?$</code></li><li>这样我们规定小数点后面必须有两位,如果你认为太苛刻了,可以这样：<code>^[0-9]+(.[0-9]{1,2})?$</code></li><li>这样就允许用户只写一位小数.下面我们该考虑数字中的逗号了,我们可以这样：<code>^[0-9]{1,3}(,[0-9]{3})*(.[0-9]{1,2})?$</code></li><li>1到3个数字,后面跟着任意个 逗号+3个数字,逗号成为可选,而不是必须：<code>^([0-9]+|[0-9]{1,3}(,[0-9]{3})*)(.[0-9]{1,2})?$</code></li><li>备注：这就是最终结果了,别忘了”+”可以用”*”替代如果你觉得空字符串也可以接受的话(奇怪,为什么?)最后,别忘了在用函数时去掉去掉那个反斜杠,一般的错误都在这里</li></ul></li><li>xml文件：<code>^([a-zA-Z]+-?)+[a-zA-Z0-9]+\\.[x|X][m|M][l|L]$</code></li><li>中文字符的正则表达式：<code>[\u4e00-\u9fa5]</code></li><li>双字节字符：<code>[^\x00-\xff]</code> (包括汉字在内，可以用来计算字符串的长度(一个双字节字符长度计2，ASCII字符计1))</li><li>空白行的正则表达式：<code>\n\s*\r</code> (可以用来删除空白行)</li><li>HTML标记的正则表达式：<code>&lt;(\S*?)[^&gt;]*&gt;.*?|&lt;.*? /&gt;</code>( 首尾空白字符的正则表达式：<code>^\s*|\s*$或(^\s*)|(\s*$)</code>(可以用来删除行首行尾的空白字符(包括空格、制表符、换页符等等)，非常有用的表达式)</li><li>腾讯QQ号：<code>[1-9][0-9]{4,}</code> (腾讯QQ号从10000开始)</li><li>中国邮政编码：<code>[1-9]\d{5}(?!\d)</code> (中国邮政编码为6位数字)</li><li>IP地址：<code>((?:(?:25[0-5]|2[0-4]\\d|[01]?\\d?\\d)\\.){3}(?:25[0-5]|2[0-4]\\d|[01]?\\d?\\d))</code></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;转载 开心师姐的博客&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="前端" scheme="http://11wy11.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
      <category term="前端" scheme="http://11wy11.github.io/tags/%E5%89%8D%E7%AB%AF/"/>
    
      <category term="日常" scheme="http://11wy11.github.io/tags/%E6%97%A5%E5%B8%B8/"/>
    
  </entry>
  
  <entry>
    <title>AI组件开发（十）--中文乱码问题解决方案</title>
    <link href="http://11wy11.github.io/2019/04/19/ai-chinese-note/"/>
    <id>http://11wy11.github.io/2019/04/19/ai-chinese-note/</id>
    <published>2019-04-19T13:51:01.000Z</published>
    <updated>2019-04-19T13:52:16.215Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;

      
    
    </summary>
    
      <category term="AI组件开发" scheme="http://11wy11.github.io/categories/AI%E7%BB%84%E4%BB%B6%E5%BC%80%E5%8F%91/"/>
    
    
      <category term="AI" scheme="http://11wy11.github.io/tags/AI/"/>
    
  </entry>
  
  <entry>
    <title>AI组件开发（九）--AIDocumentListSuite</title>
    <link href="http://11wy11.github.io/2019/04/19/ai-nine-documentlist-note/"/>
    <id>http://11wy11.github.io/2019/04/19/ai-nine-documentlist-note/</id>
    <published>2019-04-19T12:41:28.000Z</published>
    <updated>2019-04-19T14:41:23.090Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><h1 id="DocumentListSuite创建文档"><a href="#DocumentListSuite创建文档" class="headerlink" title="DocumentListSuite创建文档"></a>DocumentListSuite创建文档</h1><p>  使用场景，通常我们写的插件在创建图层或者绘制时，需要判断当前时候存在文档且文档是否处于激活状态，没有这需要创建然后进行之后的操作  </p><p>  AIDocumentListSuite中的New方法能够很好的满足我们的需要。<br>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//判断当前是否有文档</span><br><span class="line">AIDocumentHandle currentDocument;</span><br><span class="line">ai::int32 count=0;</span><br><span class="line">sAIDocumentList-&gt;Count(&amp;count);</span><br><span class="line">if (count == 0)&#123;</span><br><span class="line">sAIDocumentList-&gt;New(ai::UnicodeString(&quot;&quot;), NULL, kDialogNone, &amp;currentDocument);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="使用默认设置创建"><a href="#使用默认设置创建" class="headerlink" title="使用默认设置创建"></a>使用默认设置创建</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sAIDocumentList-&gt;New(ai::UnicodeString(&quot;&quot;), NULL, kDialogOff, &amp;currentDocument);</span><br></pre></td></tr></table></figure><h2 id="自定义文档属性创建"><a href="#自定义文档属性创建" class="headerlink" title="自定义文档属性创建"></a>自定义文档属性创建</h2><p>这里比较坑，根据官网api文档，如果文档参数不为空时，必须完整的定义NewDocumentPreset<br>实现如下所示<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">AINewDocumentPreset newDocumentPreset;</span><br><span class="line">newDocumentPreset.docTitle = ai::UnicodeString(L&quot;新建文档&quot;);</span><br><span class="line">newDocumentPreset.docWidth = 500;</span><br><span class="line">newDocumentPreset.docHeight = 250;</span><br><span class="line">newDocumentPreset.docNumArtboards = 1;</span><br><span class="line">newDocumentPreset.docArtboardLayout = kAIArtboardLayoutCol;</span><br><span class="line">newDocumentPreset.docArtboardSpacing = 1;</span><br><span class="line">newDocumentPreset.docArtboardRowsOrCols = 1;</span><br><span class="line">newDocumentPreset.docColorMode = kAICMYKColorModel;</span><br><span class="line">newDocumentPreset.docUnits = kMillimetersUnits;</span><br><span class="line">newDocumentPreset.docPreviewMode = kAIPreviewModeDefault;</span><br><span class="line">newDocumentPreset.docTransparencyGrid = kAITransparencyGridNone;</span><br><span class="line">newDocumentPreset.docRasterResolution = kAIRasterResolutionHigh;</span><br><span class="line">sAIDocumentList-&gt;New(ai::UnicodeString(L&quot;新建文档&quot;) , &amp;newDocumentPreset, kDialogOff, &amp;currentDocument);</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h1 id=&quot;DocumentListSuite创建文档&quot;&gt;&lt;a href=&quot;#DocumentListSuite创建文档&quot; class=&quot;headerlink&quot; title=&quot;DocumentListSuite创建文档&quot;&gt;&lt;/a&gt;Docum
      
    
    </summary>
    
      <category term="AI组件开发" scheme="http://11wy11.github.io/categories/AI%E7%BB%84%E4%BB%B6%E5%BC%80%E5%8F%91/"/>
    
    
      <category term="AI" scheme="http://11wy11.github.io/tags/AI/"/>
    
  </entry>
  
  <entry>
    <title>C#打包更新设置</title>
    <link href="http://11wy11.github.io/2019/04/19/cplusplus-release-update-note/"/>
    <id>http://11wy11.github.io/2019/04/19/cplusplus-release-update-note/</id>
    <published>2019-04-19T10:47:20.000Z</published>
    <updated>2019-04-19T11:55:23.149Z</updated>
    
    <content type="html"><![CDATA[<p>C#打包更新设置<br><a id="more"></a><br>我的是Setup1.的General Information文件，如我左边圈住的有三个重要的项，如下图。</p><p>Product Version：你本次产品的版本号，每次发布新产品，这个的Version号，要增加一下。我上次的版本是1.02，所以这次我设置为1.03.</p><p>Product Code：这就是一个guid，相当于产品的唯一识别码，每一次发布新版本，<strong>需要变更</strong>，可点击该行右边的{…}按钮进行随机分配。</p><p>Upgrade Code：这个是产品的升级码，同一个产品共用一个升级码，这里要<strong>保持不变</strong>。就像所有的vs2010都用的同一个Upgrade Code，每此vs2010有update，它只是改的Product Code。</p><p>测试无效，仍在探索新方法</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;C#打包更新设置&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="C#" scheme="http://11wy11.github.io/categories/C/"/>
    
    
      <category term="C#" scheme="http://11wy11.github.io/tags/C/"/>
    
  </entry>
  
  <entry>
    <title>微信小程序初探(一)</title>
    <link href="http://11wy11.github.io/2019/04/16/wx-mini-application-first-note/"/>
    <id>http://11wy11.github.io/2019/04/16/wx-mini-application-first-note/</id>
    <published>2019-04-16T12:47:24.000Z</published>
    <updated>2019-04-18T03:49:58.838Z</updated>
    
    <content type="html"><![CDATA[<a id="more"></a><h1 id="按钮绑定事件传参数"><a href="#按钮绑定事件传参数" class="headerlink" title="按钮绑定事件传参数"></a>按钮绑定事件传参数</h1><p>使用自定义属性，然后获取</p><h1 id="列表嵌套或指定子项"><a href="#列表嵌套或指定子项" class="headerlink" title="列表嵌套或指定子项"></a>列表嵌套或指定子项</h1><h1 id="设置属性值对于json数组中的某个属性赋值"><a href="#设置属性值对于json数组中的某个属性赋值" class="headerlink" title="设置属性值对于json数组中的某个属性赋值"></a>设置属性值对于json数组中的某个属性赋值</h1><h1 id="微信小程序云开发第一步"><a href="#微信小程序云开发第一步" class="headerlink" title="微信小程序云开发第一步"></a>微信小程序云开发第一步</h1><p>  在使用开发者工具创建一个新的小程序并勾选小程序-云开发，会生成一个小程序云开发的QuickStart的小程序应用<br>  按照官方提示要将cloudfunctions下的login 创建并部署到云端，然后才能获取到用户的Openid<br>  刚开始尝试发现，不管是点击创建并部署云端安装依赖，还是创建并部署所有文件，点击页面中获得用户id的按钮还是会报<br>  errcode -404011，-504002的错误，提示你云函数没有部署成功<br>  【解决方案】 在开发者工具中点击云开发，在云函数中创建同名函数，在右键login部署后，发现功能可以正常使用了</p><h1 id="需要用到的帮助文档"><a href="#需要用到的帮助文档" class="headerlink" title="需要用到的帮助文档"></a>需要用到的帮助文档</h1><ol><li>云开发Server API文档 <a href="https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-server-api/" target="_blank" rel="noopener">https://developers.weixin.qq.com/miniprogram/dev/wxcloud/reference-server-api/</a></li><li>云开发指引文档 <a href="https://developers.weixin.qq.com/miniprogram/dev/wxcloud/basis/getting-started.html" target="_blank" rel="noopener">https://developers.weixin.qq.com/miniprogram/dev/wxcloud/basis/getting-started.html</a></li><li>服务端接口文档 <a href="https://developers.weixin.qq.com/miniprogram/dev/api-backend/" target="_blank" rel="noopener">https://developers.weixin.qq.com/miniprogram/dev/api-backend/</a></li><li>小程序API文档  <a href="https://developers.weixin.qq.com/miniprogram/dev/api/" target="_blank" rel="noopener">https://developers.weixin.qq.com/miniprogram/dev/api/</a></li><li>小程序组件文档 <a href="https://developers.weixin.qq.com/miniprogram/dev/component/" target="_blank" rel="noopener">https://developers.weixin.qq.com/miniprogram/dev/component/</a></li><li>小程序基础指南 <a href="https://developers.weixin.qq.com/miniprogram/dev/" target="_blank" rel="noopener">https://developers.weixin.qq.com/miniprogram/dev/</a></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h1 id=&quot;按钮绑定事件传参数&quot;&gt;&lt;a href=&quot;#按钮绑定事件传参数&quot; class=&quot;headerlink&quot; title=&quot;按钮绑定事件传参数&quot;&gt;&lt;/a&gt;按钮绑定事件传参数&lt;/h1&gt;&lt;p&gt;使用自定义属性，然后获取&lt;/p&gt;
&lt;h1 id=
      
    
    </summary>
    
      <category term="微信小程序" scheme="http://11wy11.github.io/categories/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/"/>
    
    
      <category term="微信小程序" scheme="http://11wy11.github.io/tags/%E5%BE%AE%E4%BF%A1%E5%B0%8F%E7%A8%8B%E5%BA%8F/"/>
    
  </entry>
  
  <entry>
    <title>mysql安装步骤（备忘）</title>
    <link href="http://11wy11.github.io/2019/04/15/mysql-install-note/"/>
    <id>http://11wy11.github.io/2019/04/15/mysql-install-note/</id>
    <published>2019-04-15T07:24:52.000Z</published>
    <updated>2019-04-15T07:45:32.689Z</updated>
    
    <content type="html"><![CDATA[<p>使用archive 解压版安装<br><a id="more"></a></p><h1 id="下载安装包"><a href="#下载安装包" class="headerlink" title="下载安装包"></a>下载安装包</h1><ol><li>在window安装MySQL,<a href="https://dev.mysql.com/downloads/mysql/" target="_blank" rel="noopener">MySQL下载</a><br>在页面最下方找到ZIP Archive<figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2019/04/15/mysql-install-note/pic1.png" alt="安装包截图" title>                </div>                <div class="image-caption">安装包截图</div>            </figure>  </li><li>将文件解压到你想安装的位置</li><li><p>在解压文件夹<strong>I:\Program Files\mysql-8.0.15-winx64</strong>下，创建<strong>my.ini</strong>,配置以下信息  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[mysql]</span><br><span class="line"># 设置mysql客户端默认字符集</span><br><span class="line">default-character-set=utf8</span><br><span class="line"> </span><br><span class="line">[mysqld]</span><br><span class="line"># 设置3306端口</span><br><span class="line">port = 3306</span><br><span class="line"># 设置mysql的安装目录</span><br><span class="line">basedir=I:\\Program Files\\mysql-8.0.15-winx64</span><br><span class="line"># 设置 mysql数据库的数据的存放目录，MySQL 8+ 不需要以下配置，系统自己生成即可，否则有可能报错</span><br><span class="line"># datadir=C:\\web\\sqldata</span><br><span class="line"># 允许最大连接数</span><br><span class="line">max_connections=20</span><br><span class="line"># 服务端使用的字符集默认为8比特编码的latin1字符集</span><br><span class="line">character-set-server=utf8</span><br><span class="line"># 创建新表时将使用的默认存储引擎</span><br><span class="line">default-storage-engine=INNODB</span><br></pre></td></tr></table></figure></li><li><p>以管理员身份打开 cmd 命令行工具，切换目录：<br>初始化数据库：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;i:</span><br><span class="line">I:&gt;&gt;cd I:\Program Files\mysql-8.0.15-winx64\bin</span><br><span class="line">I:\Program Files\mysql-8.0.15-winx64\bin&gt;&gt; mysqld --initialize --console</span><br></pre></td></tr></table></figure><p>执行完成后，会输出 root 用户的初始默认密码，如：<br><img src="/2019/04/15/mysql-install-note/pic2.png" alt="初始密码"><br>bl&amp;;bUgwl9WM就是初始密码，后续登录需要用到，你也可以在登陆后修改密码。</p><p>输入以下安装命令：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqld install</span><br></pre></td></tr></table></figure><p>启动输入以下命令即可：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net start mysql</span><br></pre></td></tr></table></figure></li></ol><h1 id="登录MySQL"><a href="#登录MySQL" class="headerlink" title="登录MySQL"></a>登录MySQL</h1><p>  当 MySQL 服务已经运行时, 我们可以通过 MySQL 自带的客户端工具登录到 MySQL 数据库中, 首先打开命令提示符, 输入以下格式的命名:<br>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -h 主机名 -u 用户名 -p</span><br></pre></td></tr></table></figure></p><p>  参数说明：</p><ul><li>-h : 指定客户端所要登录的 MySQL 主机名, 登录本机(localhost 或 127.0.0.1)该参数可以省略;</li><li>-u : 登录的用户名;</li><li><p>-p : 告诉服务器将会使用一个密码来登录, 如果所要登录的用户名密码为空, 可以忽略此选项。</p><p>若密码存在, 输入密码登录, 不存在则直接按回车登录。登录成功后你将会看到 Welecome to the MySQL monitor… 的提示语。</p><p>然后命令提示符会一直以 mysq&gt; 加一个闪烁的光标等待命令的输入, 输入 exit 或 quit 退出登录。</p></li></ul><h1 id="修改默认密码"><a href="#修改默认密码" class="headerlink" title="修改默认密码"></a>修改默认密码</h1><p>  进入数据库后，执行<br>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update user set password=password(&quot;新密码&quot;) where user=&quot;root&quot;</span><br></pre></td></tr></table></figure></p><h1 id="设置环境变量更方便的启动和停止等"><a href="#设置环境变量更方便的启动和停止等" class="headerlink" title="设置环境变量更方便的启动和停止等"></a>设置环境变量更方便的启动和停止等</h1><p>  右键我的电脑-&gt;属性-&gt;高级系统设置-&gt;环境变量-&gt;path-&gt;编辑，将你的mysql软件下的bin目录的全路径放里面。<br>   最后在那个目录的路径后面加个英文的分号（;）保存就行了。如D:\mysql\mysql-x.x.xx-winx64\bin;</p><h1 id="其他常用命令"><a href="#其他常用命令" class="headerlink" title="其他常用命令"></a>其他常用命令</h1>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">show databases;//查看数据库</span><br><span class="line">use 数据库名;//切换数据库目录</span><br><span class="line">show tables;//查看表</span><br><span class="line">select * from 表名;//sql查询</span><br><span class="line">exit 退出</span><br></pre></td></tr></table></figure><h1 id="常见问题及解决方案"><a href="#常见问题及解决方案" class="headerlink" title="常见问题及解决方案"></a>常见问题及解决方案</h1><ol><li>navicat连接mysql8后报1251的错误<br>【解决方案1】：<br>原因：<br>在网上查的是,出现这个原因是mysql8 之前的版本中加密规则是mysql_native_password,而在mysql8之后,加密规则是caching_sha2_password,<br>解决问题方法有两种,一种是升级navicat驱动,一种是把mysql用户登录密码加密规则还原成mysql_native_password.<br>第二种：<br>ALTER USER ‘root‘@’localhost’ IDENTIFIED BY ‘password’ PASSWORD EXPIRE NEVER; #修改加密规则<br>ALTER USER ‘root‘@’localhost’ IDENTIFIED WITH mysql_native_password BY ‘password’; #更新一下用户的密码<br>FLUSH PRIVILEGES; #刷新权限   </li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;使用archive 解压版安装&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="MySQL" scheme="http://11wy11.github.io/categories/MySQL/"/>
    
    
      <category term="MySQL" scheme="http://11wy11.github.io/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>C# 使用NLog显示和输出日志</title>
    <link href="http://11wy11.github.io/2019/04/10/cplusplus-log-note/"/>
    <id>http://11wy11.github.io/2019/04/10/cplusplus-log-note/</id>
    <published>2019-04-10T03:15:48.000Z</published>
    <updated>2019-04-15T07:23:39.694Z</updated>
    
    <content type="html"><![CDATA[<p>使用NLog插件显示和输出日志，记录用户使用情况等<br><a id="more"></a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"> public static Logger logger;</span><br><span class="line">private void initLogger()</span><br><span class="line">        &#123;</span><br><span class="line">            // Step 1. Create configuration object</span><br><span class="line">            LoggingConfiguration logConfig = new LoggingConfiguration();</span><br><span class="line"></span><br><span class="line">            // Step 2. Create targets and add them to the configuration</span><br><span class="line">            RichTextBoxTarget rtbTarget = new RichTextBoxTarget();</span><br><span class="line">            logConfig.AddTarget(&quot;richTextBox&quot;, rtbTarget);</span><br><span class="line">            rtbTarget.FormName = &quot;MainForm&quot;; // your winform class name</span><br><span class="line">            rtbTarget.ControlName = &quot;richTextBox1&quot;; // your RichTextBox control/variable name</span><br><span class="line">            //rtbTarget.UseDefaultRowColoringRules = false;</span><br><span class="line">            rtbTarget.RowColoringRules.Add(</span><br><span class="line">                new RichTextBoxRowColoringRule(</span><br><span class="line">                    &quot;level == LogLevel.Error&quot;, //condition</span><br><span class="line">                    &quot;DarkRed&quot;, // font color</span><br><span class="line">                    &quot;Control&quot;, //backgroud color</span><br><span class="line">                    FontStyle.Bold</span><br><span class="line">                    )</span><br><span class="line">                );</span><br><span class="line">            rtbTarget.RowColoringRules.Add(</span><br><span class="line">                new RichTextBoxRowColoringRule(</span><br><span class="line">                    &quot;level == LogLevel.Warn&quot;, //condition</span><br><span class="line">                    &quot;Navy&quot;, // font color</span><br><span class="line">                    &quot;Control&quot;, //backgroud color</span><br><span class="line">                    FontStyle.Bold</span><br><span class="line">                    )</span><br><span class="line">                );</span><br><span class="line"></span><br><span class="line">            FileTarget fileTarget = new FileTarget();</span><br><span class="line">            logConfig.AddTarget(&quot;logFile&quot;, fileTarget);</span><br><span class="line"></span><br><span class="line">            // Step 3. Set target properties</span><br><span class="line">            //string commonLayout = &quot;$&#123;date:format=MM-dd HH\\:mm\\:ss&#125; $&#123;logger&#125; $&#123;message&#125;&quot;;</span><br><span class="line">            string commonLayout = &quot;$&#123;date:format=HH\\:mm&#125; $&#123;logger&#125; $&#123;message&#125;&quot;;</span><br><span class="line">            rtbTarget.Layout = commonLayout;</span><br><span class="line"></span><br><span class="line">            //string curDatetimeStr = DateTime.Now.ToString();</span><br><span class="line">            DateTime curDateTime = DateTime.Now;</span><br><span class="line">            string curDatetimeStr = String.Format(&quot;&#123;0:yyyy-MM-dd_HHmmss&#125;&quot;, curDateTime); //&quot;2013-06-11_142102&quot;</span><br><span class="line">            fileTarget.FileName = &quot;$&#123;basedir&#125;/logfile/&quot; + curDatetimeStr + &quot;_log.txt&quot;; //&#123;&apos;$&#123;basedir&#125;/2013-06-11_142102_log.txt&apos;&#125;</span><br><span class="line">            fileTarget.Layout = commonLayout;</span><br><span class="line"></span><br><span class="line">            // Step 4. Define rules</span><br><span class="line">            LoggingRule ruleRichTextBox = new LoggingRule(&quot;*&quot;, LogLevel.Debug, rtbTarget);</span><br><span class="line">            logConfig.LoggingRules.Add(ruleRichTextBox);</span><br><span class="line"></span><br><span class="line">            LoggingRule ruleFile = new LoggingRule(&quot;*&quot;, LogLevel.Debug, fileTarget);</span><br><span class="line">            logConfig.LoggingRules.Add(ruleFile);</span><br><span class="line"></span><br><span class="line">            // Step 5. Activate the configuration</span><br><span class="line">            LogManager.Configuration = logConfig;</span><br><span class="line"></span><br><span class="line">            // Example usage</span><br><span class="line">            logger = LogManager.GetLogger(&quot;&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">//使用</span><br><span class="line"> logger.Info(&quot;Info:开始进行文件夹目录结构检查&quot;);</span><br><span class="line"> logger.Error(&quot;XXXXXXX&quot;);</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;使用NLog插件显示和输出日志，记录用户使用情况等&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="C#" scheme="http://11wy11.github.io/categories/C/"/>
    
    
      <category term="C#" scheme="http://11wy11.github.io/tags/C/"/>
    
  </entry>
  
  <entry>
    <title>C#读取txt和xml文件等</title>
    <link href="http://11wy11.github.io/2019/04/10/cplusplus-txt-xml-read-note/"/>
    <id>http://11wy11.github.io/2019/04/10/cplusplus-txt-xml-read-note/</id>
    <published>2019-04-10T03:05:59.000Z</published>
    <updated>2019-04-10T03:16:33.421Z</updated>
    
    <content type="html"><![CDATA[<p>读取txt和xml等，生成Dictionary等<br><a id="more"></a></p><h1 id="TXT文件读取"><a href="#TXT文件读取" class="headerlink" title="TXT文件读取"></a>TXT文件读取</h1><p>pac文件格式：<br>11000,XX省<br>11100,XX市<br>11101,XXXX区<br>11102,XXXX1区    </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">public static Dictionary&lt;string, string&gt; countyPacMap = new Dictionary&lt;string, string&gt;();//存储区域PAC码对应信息</span><br><span class="line"> FileStream file = new FileStream(&quot;Config/PAC.txt&quot;, FileMode.OpenOrCreate);</span><br><span class="line">            StreamReader reader = new StreamReader(file, UnicodeEncoding.GetEncoding(&quot;UTF-8&quot;));</span><br><span class="line">            string strLine = string.Empty;</span><br><span class="line">            while ((strLine = reader.ReadLine()) != null)</span><br><span class="line">            &#123;</span><br><span class="line">                strLine = strLine.Trim().ToString();</span><br><span class="line">                string[] nameAndCode = strLine.Split(&apos;,&apos;);</span><br><span class="line">                string name = nameAndCode[1];</span><br><span class="line">                string pac = nameAndCode[0];</span><br><span class="line">                countyPacMap.Add(name, pac);</span><br><span class="line">            &#125;</span><br><span class="line">            file.Close();</span><br></pre></td></tr></table></figure><h1 id="XML读取"><a href="#XML读取" class="headerlink" title="XML读取"></a>XML读取</h1><p>XML格式：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;Directory Name=&quot;XX&quot; &gt;</span><br><span class="line">  &lt;Directory Name=&quot;1-采样数据&quot; &gt;</span><br><span class="line">    &lt;File DestinationDirectory=&quot;1-采样数据&quot; isCheckAttribute=&quot;true&quot; type=&quot;1&quot; sheetNum=&quot;1&quot; &gt;XXX.txt&lt;/File&gt;</span><br><span class="line">    &lt;File DestinationDirectory=&quot;1-采样数据&quot;&gt;2-登记表.pdf&lt;/File&gt;</span><br><span class="line">    &lt;File DestinationDirectory=&quot;1-采样数据&quot;&gt;3-送样单.pdf&lt;/File&gt;</span><br><span class="line">  &lt;/Directory&gt;</span><br><span class="line">&lt;/Directory&gt;</span><br></pre></td></tr></table></figure></p><p>读取XML<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"> public static List&lt;FieldModel&gt; getFieldsFromXml(String xmlName, int index)</span><br><span class="line">         &#123;</span><br><span class="line">             string m_strConfig = &quot;Tables/&quot;;</span><br><span class="line">             List&lt;FieldModel&gt; result = new List&lt;FieldModel&gt;();</span><br><span class="line">             XmlDocument doc = new XmlDocument();</span><br><span class="line">             doc.Load(m_strConfig + xmlName + &quot;.xml&quot;);             </span><br><span class="line">             XmlNode root = doc.SelectSingleNode(&quot;Table&quot;);</span><br><span class="line">             XmlNode sheet = root.ChildNodes[index];</span><br><span class="line">             // 得到根节点的所有子节点</span><br><span class="line">             XmlNodeList xnl = sheet.ChildNodes;</span><br><span class="line">             foreach (XmlNode xn in xnl)</span><br><span class="line">             &#123;</span><br><span class="line">                 FieldModel fieldModel = new FieldModel();</span><br><span class="line">                 // 将节点转换为元素，便于得到节点的属性值</span><br><span class="line">                 XmlElement xe = (XmlElement)xn;</span><br><span class="line">                 fieldModel.FieldName = xe.GetAttribute(&quot;Name&quot;).ToString();</span><br><span class="line">                 fieldModel.FieldType = xe.GetAttribute(&quot;Type&quot;).ToString();</span><br><span class="line">                 fieldModel.RuleType = xe.GetAttribute(&quot;RuleType&quot;).ToString();</span><br><span class="line">                 fieldModel.RuleParms = xe.GetAttribute(&quot;RuleParms&quot;).ToString();</span><br><span class="line">                 result.Add(fieldModel);</span><br><span class="line">             &#125;</span><br><span class="line">             return result;</span><br><span class="line">         &#125;</span><br><span class="line">         public static string[] getFieldCNames(ArrayList array)</span><br><span class="line">         &#123;</span><br><span class="line">             int nums = array.Count;</span><br><span class="line">             string[] names = new string[nums];</span><br><span class="line">             for (int i = 0; i &lt; nums; i++)</span><br><span class="line">             &#123;</span><br><span class="line">                 FieldModel fieldModel = (FieldModel)array[i];</span><br><span class="line">                 names[i] = fieldModel.FieldName;</span><br><span class="line">             &#125;</span><br><span class="line">             return names;</span><br><span class="line">         &#125;</span><br><span class="line">//FieldModel类</span><br><span class="line">class FieldModel</span><br><span class="line">    &#123;</span><br><span class="line">        public FieldModel()</span><br><span class="line">        &#123;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        private string fieldName;</span><br><span class="line"></span><br><span class="line">        public string FieldName</span><br><span class="line">        &#123;</span><br><span class="line">            get &#123; return fieldName; &#125;</span><br><span class="line">            set &#123; fieldName = value; &#125;</span><br><span class="line">        &#125;</span><br><span class="line">       </span><br><span class="line">        private string ruleType;</span><br><span class="line"></span><br><span class="line">        public string RuleType</span><br><span class="line">        &#123;</span><br><span class="line">            get &#123; return ruleType; &#125;</span><br><span class="line">            set &#123; ruleType = value; &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        private string fieldType;</span><br><span class="line"></span><br><span class="line">        public string FieldType</span><br><span class="line">        &#123;</span><br><span class="line">            get &#123; return fieldType; &#125;</span><br><span class="line">            set &#123; fieldType = value; &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        private string ruleParms;</span><br><span class="line"></span><br><span class="line">        public string RuleParms</span><br><span class="line">        &#123;</span><br><span class="line">            get &#123; return ruleParms; &#125;</span><br><span class="line">            set &#123; ruleParms = value; &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;读取txt和xml等，生成Dictionary等&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="C#" scheme="http://11wy11.github.io/categories/C/"/>
    
    
      <category term="C#" scheme="http://11wy11.github.io/tags/C/"/>
    
  </entry>
  
  <entry>
    <title>C#读取，生成Excel</title>
    <link href="http://11wy11.github.io/2019/04/10/cplusplus-excel-note/"/>
    <id>http://11wy11.github.io/2019/04/10/cplusplus-excel-note/</id>
    <published>2019-04-10T02:58:28.000Z</published>
    <updated>2019-04-15T07:24:12.357Z</updated>
    
    <content type="html"><![CDATA[<p>使用NPOI开源插件读取和操作Excel等<br><a id="more"></a></p><h1 id="ExcelUtils"><a href="#ExcelUtils" class="headerlink" title="ExcelUtils"></a>ExcelUtils</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br></pre></td><td class="code"><pre><span class="line">using GDZLCHECK.Forms;</span><br><span class="line">using NPOI.HSSF.UserModel;</span><br><span class="line">using NPOI.SS.UserModel;</span><br><span class="line">using NPOI.SS.Util;</span><br><span class="line">using NPOI.XSSF.UserModel;</span><br><span class="line">using System;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using System.Data;</span><br><span class="line">using System.IO;</span><br><span class="line">using System.Linq;</span><br><span class="line">using System.Text;</span><br><span class="line">using System.Threading.Tasks;</span><br><span class="line">using System.Windows.Forms;</span><br><span class="line"></span><br><span class="line">namespace GDZLCHECK.Utils</span><br><span class="line">&#123;</span><br><span class="line">    class ExcelUtils</span><br><span class="line">    &#123;</span><br><span class="line">        public static IWorkbook GetWorkbook(string filePath)</span><br><span class="line">        &#123;</span><br><span class="line">            IWorkbook workbook;</span><br><span class="line">            string fileType = System.IO.Path.GetExtension(filePath);</span><br><span class="line">            if (string.IsNullOrEmpty(fileType))</span><br><span class="line">                return null;</span><br><span class="line">            try</span><br><span class="line">            &#123;</span><br><span class="line">                using (FileStream file = new FileStream(filePath, FileMode.Open, FileAccess.Read))</span><br><span class="line">                &#123;</span><br><span class="line">                    if (fileType == &quot;.xls&quot;)</span><br><span class="line">                    &#123;</span><br><span class="line">                        workbook = new HSSFWorkbook(file) as IWorkbook;</span><br><span class="line">                    &#125;</span><br><span class="line">                    else if (fileType == &quot;.xlsx&quot;)</span><br><span class="line">                    &#123;</span><br><span class="line">                        workbook = new XSSFWorkbook(file);</span><br><span class="line">                    &#125;</span><br><span class="line">                    else</span><br><span class="line">                    &#123;</span><br><span class="line">                        return null;</span><br><span class="line">                    &#125;</span><br><span class="line">                    file.Close();</span><br><span class="line">                    return workbook;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            catch (Exception ex)</span><br><span class="line">            &#123;</span><br><span class="line">                MessageBox.Show(&quot;打开excel失败，文件可能正被打开&quot;);</span><br><span class="line">                Console.WriteLine( ex.Message.ToString());</span><br><span class="line">               </span><br><span class="line">               // MainForm.logger.Error(&quot;Error: 打开&quot;+filePath+&quot; excel失败，文件可能正被打开&quot;);</span><br><span class="line">                return null;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// 判断指定行列所在的单元格是否为合并单元格，</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        /// &lt;param name=&quot;sheet&quot;&gt;Excel工作表&lt;/param&gt;</span><br><span class="line">        /// &lt;param name=&quot;rowIndex&quot;&gt;行索引，从0开始&lt;/param&gt;</span><br><span class="line">        /// &lt;param name=&quot;columnIndex&quot;&gt;列索引，从0开始&lt;/param&gt;</span><br><span class="line">        /// &lt;returns&gt;返回是否为合并单元格的布尔(Boolean)值&lt;/returns&gt;</span><br><span class="line">        public static bool IsMergeCell(ISheet sheet, int rowIndex, int columnIndex)</span><br><span class="line">        &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            for (int i = 0; i &lt; sheet.NumMergedRegions; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                CellRangeAddress range = sheet.GetMergedRegion(i);</span><br><span class="line">                sheet.IsMergedRegion(range);</span><br><span class="line"></span><br><span class="line">                //这种算法只有当指定行列索引刚好是合并单元格的第一个跨度行第一个跨度列时才能取得合并单元格的跨度</span><br><span class="line">                //if (range.FirstRow == rowIndex &amp;&amp; range.FirstColumn == columnIndex)</span><br><span class="line">                //&#123;</span><br><span class="line">                //    dimension.DataCell = sheet.GetRow(range.FirstRow).GetCell(range.FirstColumn);</span><br><span class="line">                //    dimension.RowSpan = range.LastRow - range.FirstRow + 1;</span><br><span class="line">                //    dimension.ColumnSpan = range.LastColumn - range.FirstColumn + 1;</span><br><span class="line">                //    dimension.FirstRowIndex = range.FirstRow;</span><br><span class="line">                //    dimension.LastRowIndex = range.LastRow;</span><br><span class="line">                //    dimension.FirstColumnIndex = range.FirstColumn;</span><br><span class="line">                //    dimension.LastColumnIndex = range.LastColumn;</span><br><span class="line">                //    break;</span><br><span class="line">                //&#125;</span><br><span class="line"></span><br><span class="line">                if ((rowIndex &gt;= range.FirstRow &amp;&amp; range.LastRow &gt;= rowIndex) &amp;&amp; (columnIndex &gt;= range.FirstColumn &amp;&amp; range.LastColumn &gt;= columnIndex))</span><br><span class="line">                &#123;</span><br><span class="line"></span><br><span class="line">                    break;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            bool result;</span><br><span class="line">            if (rowIndex &gt;= 0 &amp;&amp; sheet.LastRowNum &gt; rowIndex)</span><br><span class="line">            &#123;</span><br><span class="line">                IRow row = sheet.GetRow(rowIndex);</span><br><span class="line">                if (columnIndex &gt;= 0 &amp;&amp; row.LastCellNum &gt; columnIndex)</span><br><span class="line">                &#123;</span><br><span class="line">                    ICell cell = row.GetCell(columnIndex);</span><br><span class="line">                    result = cell.IsMergedCell;</span><br><span class="line">                &#125;</span><br><span class="line">                else</span><br><span class="line">                &#123;</span><br><span class="line">                    result = false;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            else</span><br><span class="line">            &#123;</span><br><span class="line">                result = false;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            return result;</span><br><span class="line">        &#125;</span><br><span class="line">        public static object GetCellValue(ICell cell)</span><br><span class="line">        &#123;</span><br><span class="line">            object value = &quot;&quot;;</span><br><span class="line">            try</span><br><span class="line">            &#123;</span><br><span class="line">                if (cell.CellType != CellType.Blank)</span><br><span class="line">                &#123;</span><br><span class="line">                    switch (cell.CellType)</span><br><span class="line">                    &#123;</span><br><span class="line">                        case CellType.Numeric:</span><br><span class="line">                            // Date comes here  </span><br><span class="line">                            if (DateUtil.IsCellDateFormatted(cell))</span><br><span class="line">                            &#123;</span><br><span class="line">                                value = cell.DateCellValue;</span><br><span class="line">                            &#125;</span><br><span class="line">                            else</span><br><span class="line">                            &#123;</span><br><span class="line">                                // Numeric type  </span><br><span class="line">                                value = cell.NumericCellValue;</span><br><span class="line">                            &#125;</span><br><span class="line">                            break;</span><br><span class="line">                        case CellType.Boolean:</span><br><span class="line">                            // Boolean type  </span><br><span class="line">                            value = cell.BooleanCellValue;</span><br><span class="line">                            break;</span><br><span class="line">                        case CellType.Formula:</span><br><span class="line">                            value = cell.CellFormula;</span><br><span class="line">                            break;</span><br><span class="line">                        default:</span><br><span class="line">                            // String type  </span><br><span class="line">                            value = cell.StringCellValue;</span><br><span class="line">                            break;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            catch (Exception)</span><br><span class="line">            &#123;</span><br><span class="line">                value = &quot;&quot;;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            return value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        //判断是否为空</span><br><span class="line">        public static bool isEmptyRow(ICell cell)</span><br><span class="line">        &#123;</span><br><span class="line">            if (cell == null)</span><br><span class="line">                return true;</span><br><span class="line">            else</span><br><span class="line">            &#123;</span><br><span class="line">                if (cell.CellType == CellType.Blank || string.IsNullOrEmpty(cell.ToString().Trim()))</span><br><span class="line">                    return true;</span><br><span class="line">                else</span><br><span class="line">                    return false;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public static DataTable ExportToDataTable(ISheet sheet)</span><br><span class="line">        &#123;</span><br><span class="line">            DataTable dt = new DataTable();</span><br><span class="line"></span><br><span class="line">            //默认，第一行是字段</span><br><span class="line">            IRow headRow = sheet.GetRow(0);</span><br><span class="line"></span><br><span class="line">            //设置datatable字段</span><br><span class="line">            for (int i = headRow.FirstCellNum, len = headRow.LastCellNum; i &lt; len; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                dt.Columns.Add(headRow.Cells[i].StringCellValue);</span><br><span class="line">            &#125;</span><br><span class="line">            //遍历数据行</span><br><span class="line">            for (int i = (sheet.FirstRowNum + 1), len = sheet.LastRowNum + 1; i &lt; len; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                IRow tempRow = sheet.GetRow(i);</span><br><span class="line">                DataRow dataRow = dt.NewRow();</span><br><span class="line"></span><br><span class="line">                //遍历一行的每一个单元格</span><br><span class="line">                for (int r = 0, j = tempRow.FirstCellNum, len2 = tempRow.LastCellNum; j &lt; len2; j++, r++)</span><br><span class="line">                &#123;</span><br><span class="line"></span><br><span class="line">                    ICell cell = tempRow.GetCell(j);</span><br><span class="line"></span><br><span class="line">                    if (cell != null)</span><br><span class="line">                    &#123;</span><br><span class="line">                        switch (cell.CellType)</span><br><span class="line">                        &#123;</span><br><span class="line">                            case CellType.String:</span><br><span class="line">                                dataRow[r] = cell.StringCellValue;</span><br><span class="line">                                break;</span><br><span class="line">                            case CellType.Numeric:</span><br><span class="line">                                dataRow[r] = cell.NumericCellValue;</span><br><span class="line">                                break;</span><br><span class="line">                            case CellType.Boolean:</span><br><span class="line">                                dataRow[r] = cell.BooleanCellValue;</span><br><span class="line">                                break;</span><br><span class="line">                            default: dataRow[r] = &quot;&quot;;</span><br><span class="line">                                break;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                dt.Rows.Add(dataRow);</span><br><span class="line">            &#125;</span><br><span class="line">            return dt;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;使用NPOI开源插件读取和操作Excel等&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="C#" scheme="http://11wy11.github.io/categories/C/"/>
    
    
      <category term="C#" scheme="http://11wy11.github.io/tags/C/"/>
    
  </entry>
  
  <entry>
    <title>C#winform程序全局异常处理</title>
    <link href="http://11wy11.github.io/2019/04/10/cplusplus-exception-note/"/>
    <id>http://11wy11.github.io/2019/04/10/cplusplus-exception-note/</id>
    <published>2019-04-10T02:39:18.000Z</published>
    <updated>2019-04-10T02:57:42.576Z</updated>
    
    <content type="html"><![CDATA[<p>全局处理未处理异常<br><a id="more"></a></p><h1 id="program-cs入口"><a href="#program-cs入口" class="headerlink" title="program.cs入口"></a>program.cs入口</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">using GDZLCHECK.Forms;</span><br><span class="line">using NLog;</span><br><span class="line">using System;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using System.Linq;</span><br><span class="line">using System.Threading.Tasks;</span><br><span class="line">using System.Windows.Forms;</span><br><span class="line">namespace GDZLCHECK</span><br><span class="line">&#123;</span><br><span class="line">    static class Program</span><br><span class="line">    &#123;</span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// 应用程序的主入口点。</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        [STAThread]</span><br><span class="line">        static void Main()</span><br><span class="line">        &#123;</span><br><span class="line">            try</span><br><span class="line">            &#123;</span><br><span class="line">                Application.EnableVisualStyles();</span><br><span class="line">                Application.SetCompatibleTextRenderingDefault(false);</span><br><span class="line"></span><br><span class="line">                //处理未捕获的异常</span><br><span class="line">                Application.SetUnhandledExceptionMode(UnhandledExceptionMode.CatchException);</span><br><span class="line">                //处理UI线程异常</span><br><span class="line">                Application.ThreadException += new System.Threading.ThreadExceptionEventHandler(Application_ThreadException);</span><br><span class="line">                //处理非UI线程异常</span><br><span class="line">                AppDomain.CurrentDomain.UnhandledException += new UnhandledExceptionEventHandler(CurrentDomain_UnhandledException);                           </span><br><span class="line">                ESRI.ArcGIS.RuntimeManager.Bind(ESRI.ArcGIS.ProductCode.EngineOrDesktop);</span><br><span class="line">                Application.EnableVisualStyles();</span><br><span class="line">                Application.SetCompatibleTextRenderingDefault(false);</span><br><span class="line">                Application.Run(new MainForm());</span><br><span class="line">                glExitApp = true;</span><br><span class="line">            &#125;</span><br><span class="line">            catch (Exception e)</span><br><span class="line">            &#123;</span><br><span class="line">                MessageBox.Show(&quot;请确保安装有ArcGIS和Office,且ArcGIS License已启动&quot;);</span><br><span class="line">                Application.Exit();  </span><br><span class="line">                </span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        static bool glExitApp = false;</span><br><span class="line">        static void CurrentDomain_UnhandledException(object sender, UnhandledExceptionEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            MessageBox.Show(&quot;抱歉，您的操作没有能够完成，请再试一次或者联系软件提供商&quot;);   </span><br><span class="line">            Logger logger = LogManager.GetCurrentClassLogger();</span><br><span class="line">            logger.Error(&quot;CurrentDomain_UnhandledException&quot;);</span><br><span class="line">            logger.Error(&quot;IsTerminating:&quot; + e.IsTerminating.ToString());</span><br><span class="line">            logger.Error(e.ExceptionObject.ToString());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        static void Application_ThreadException(object sender, System.Threading.ThreadExceptionEventArgs e)</span><br><span class="line">        &#123;</span><br><span class="line">            MessageBox.Show(&quot;抱歉，您的操作没有能够完成，请再试一次或者联系软件提供商&quot;);</span><br><span class="line">            Logger logger = LogManager.GetCurrentClassLogger();</span><br><span class="line">            logger.Error(&quot;Application_ThreadException:&quot;+e.Exception.Message);           </span><br><span class="line">            logger.Error(e.Exception);</span><br><span class="line">            //throw new NotImplementedException();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;全局处理未处理异常&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="C#" scheme="http://11wy11.github.io/categories/C/"/>
    
    
      <category term="C#" scheme="http://11wy11.github.io/tags/C/"/>
    
  </entry>
  
  <entry>
    <title>C#读取word模板填充数据生成带水印的pdf</title>
    <link href="http://11wy11.github.io/2019/04/10/cplusplus-wordtemplete-note/"/>
    <id>http://11wy11.github.io/2019/04/10/cplusplus-wordtemplete-note/</id>
    <published>2019-04-10T01:32:08.000Z</published>
    <updated>2019-04-10T01:52:08.459Z</updated>
    
    <content type="html"><![CDATA[<p>使用Microsoft Office 的COM组件,方便快捷，较好的复用和使用模板快速生成较复杂的文档<br>不足在于对于环境依赖较高<br><a id="more"></a></p><h1 id="Word相关处理类"><a href="#Word相关处理类" class="headerlink" title="Word相关处理类"></a>Word相关处理类</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br></pre></td><td class="code"><pre><span class="line">using System;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using System.ComponentModel;</span><br><span class="line">using System.Data;</span><br><span class="line">using System.Drawing;</span><br><span class="line">using System.Linq;</span><br><span class="line">using System.Text;</span><br><span class="line">using Microsoft.Office.Interop.Word;</span><br><span class="line">using System.Windows.Forms;</span><br><span class="line">using System.Threading;</span><br><span class="line">namespace GDZLCHECK.Utils</span><br><span class="line">&#123;</span><br><span class="line">    class CreateWord</span><br><span class="line">    &#123;</span><br><span class="line">        private _Application wordApp= null;</span><br><span class="line">        private _Document wordDoc= null;</span><br><span class="line">         public _Application Application</span><br><span class="line">         &#123;</span><br><span class="line">            get</span><br><span class="line">            &#123;</span><br><span class="line">            return wordApp;</span><br><span class="line">            &#125;</span><br><span class="line">            set</span><br><span class="line">            &#123;</span><br><span class="line">            wordApp = value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        public _Document Document</span><br><span class="line">        &#123;</span><br><span class="line">          get</span><br><span class="line">          &#123;</span><br><span class="line">            return wordDoc;</span><br><span class="line">          &#125;</span><br><span class="line">          set</span><br><span class="line">          &#123;</span><br><span class="line">            wordDoc = value;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">         //保存新文件</span><br><span class="line">        public void SaveDocument(string filePath)</span><br><span class="line">        &#123;</span><br><span class="line">           // killWinWordProcess();</span><br><span class="line">            object oMissing = System.Reflection.Missing.Value;</span><br><span class="line">            //SaveFileDialog sfd = new SaveFileDialog();</span><br><span class="line">            //sfd.Filter = &quot;Word Document(*.doc)|*.doc|PDF(*.pdf)|*.pdf&quot;;</span><br><span class="line">            //sfd.DefaultExt = &quot;Word Document(*.doc)|*.doc&quot;;</span><br><span class="line">            //if (sfd.ShowDialog() == DialogResult.OK)</span><br><span class="line">            //&#123;</span><br><span class="line">                //object filename = sfd.FileName;</span><br><span class="line">            object filename = filePath;</span><br><span class="line">            wordDoc.SaveAs(ref filename, ref oMissing, ref oMissing, ref oMissing,</span><br><span class="line">            ref oMissing, ref oMissing, ref oMissing, ref oMissing, ref oMissing,</span><br><span class="line">            ref oMissing, ref oMissing, ref oMissing, ref oMissing, ref oMissing,</span><br><span class="line">            ref oMissing, ref oMissing);</span><br><span class="line">            wordDoc.Close(ref oMissing, ref oMissing, ref oMissing);</span><br><span class="line">            //关闭word</span><br><span class="line">            wordApp.Quit(ref oMissing, ref oMissing, ref oMissing);</span><br><span class="line">            //&#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        //在书签处插入值</span><br><span class="line">        public bool InsertValue(string bookmark, string value)</span><br><span class="line">        &#123;</span><br><span class="line">          object bkObj =bookmark;</span><br><span class="line">          if(wordApp.ActiveDocument.Bookmarks.Exists(bookmark))</span><br><span class="line">          &#123;</span><br><span class="line">            wordApp.ActiveDocument.Bookmarks.get_Item(ref bkObj).Select();</span><br><span class="line">            wordApp.Selection.TypeText(value);</span><br><span class="line">            return true;</span><br><span class="line">          &#125;</span><br><span class="line">          return false;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        //插入表格,bookmark书签</span><br><span class="line">        public Table InsertTable(string bookmark, int rows, int columns,float width)</span><br><span class="line">        &#123;</span><br><span class="line">          object miss =System.Reflection.Missing.Value;</span><br><span class="line">          object oStart =bookmark;</span><br><span class="line">          Range range =wordDoc.Bookmarks.get_Item(ref oStart).Range;//表格插入位置</span><br><span class="line">          Table newTable =wordDoc.Tables.Add(range,rows, columns, ref miss, ref miss);</span><br><span class="line">          //设置表的格式</span><br><span class="line">          newTable.Borders.Enable =1; //允许有边框，默认没有边框(为0时报错，1为实线边框，2、3为虚线边框，以后的数字没试过)</span><br><span class="line">          newTable.Borders.OutsideLineWidth=WdLineWidth.wdLineWidth050pt;//边框宽度</span><br><span class="line">          if(width != 0)</span><br><span class="line">          &#123;</span><br><span class="line">            newTable.PreferredWidth=width;//表格宽度</span><br><span class="line">          &#125;</span><br><span class="line">          newTable.AllowPageBreaks =false;</span><br><span class="line">          return newTable;</span><br><span class="line">        &#125;</span><br><span class="line">        // 合并单元格 表id,开始行号,开始列号,结束行号,结束列号</span><br><span class="line">        public void MergeCell(int n, int row1, int column1, int row2, int column2)</span><br><span class="line">        &#123;</span><br><span class="line">            wordDoc.Content.Tables[n].Cell(row1, column1).Merge(wordDoc.Content.Tables[n].Cell(row2, column2));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 合并单元格 表名,开始行号,开始列号,结束行号,结束列号</span><br><span class="line">        public void MergeCell(Microsoft.Office.Interop.Word.Table table, int row1, int column1, int row2, int column2)</span><br><span class="line">        &#123;</span><br><span class="line">            table.Cell(row1, column1).Merge(table.Cell(row2, column2));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 设置表格内容对齐方式 Align水平方向，Vertical垂直方向(左对齐，居中对齐，右对齐分别对应Align和Vertical的值为-1,0,1)Microsoft.Office.Interop.Word.Table table</span><br><span class="line">        public void SetParagraph_Table(int n, int Align, int Vertical)</span><br><span class="line">        &#123;</span><br><span class="line">            switch (Align)</span><br><span class="line">            &#123;</span><br><span class="line">                case -1: wordDoc.Content.Tables[n].Range.ParagraphFormat.Alignment = WdParagraphAlignment.wdAlignParagraphLeft; break;//左对齐</span><br><span class="line">                case 0: wordDoc.Content.Tables[n].Range.ParagraphFormat.Alignment = WdParagraphAlignment.wdAlignParagraphCenter; break;//水平居中</span><br><span class="line">                case 1: wordDoc.Content.Tables[n].Range.ParagraphFormat.Alignment = WdParagraphAlignment.wdAlignParagraphRight; break;//右对齐</span><br><span class="line">            &#125;</span><br><span class="line">            switch (Vertical)</span><br><span class="line">            &#123;</span><br><span class="line">                case -1: wordDoc.Content.Tables[n].Range.Cells.VerticalAlignment = WdCellVerticalAlignment.wdCellAlignVerticalTop; break;//顶端对齐</span><br><span class="line">                case 0: wordDoc.Content.Tables[n].Range.Cells.VerticalAlignment = WdCellVerticalAlignment.wdCellAlignVerticalCenter; break;//垂直居中</span><br><span class="line">                case 1: wordDoc.Content.Tables[n].Range.Cells.VerticalAlignment = WdCellVerticalAlignment.wdCellAlignVerticalBottom; break;//底端对齐</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 设置单元格内容对齐方式</span><br><span class="line">        public void SetParagraph_Table(int n, int row, int column, int Align, int Vertical)</span><br><span class="line">        &#123;</span><br><span class="line">            switch (Align)</span><br><span class="line">            &#123;</span><br><span class="line">                case -1: wordDoc.Content.Tables[n].Cell(row, column).Range.ParagraphFormat.Alignment = WdParagraphAlignment.wdAlignParagraphLeft; break;//左对齐</span><br><span class="line">                case 0: wordDoc.Content.Tables[n].Cell(row, column).Range.ParagraphFormat.Alignment = WdParagraphAlignment.wdAlignParagraphCenter; break;//水平居中</span><br><span class="line">                case 1: wordDoc.Content.Tables[n].Cell(row, column).Range.ParagraphFormat.Alignment = WdParagraphAlignment.wdAlignParagraphRight; break;//右对齐</span><br><span class="line">            &#125;</span><br><span class="line">            switch (Vertical)</span><br><span class="line">            &#123;</span><br><span class="line">                case -1: wordDoc.Content.Tables[n].Cell(row, column).Range.Cells.VerticalAlignment = WdCellVerticalAlignment.wdCellAlignVerticalTop; break;//顶端对齐</span><br><span class="line">                case 0: wordDoc.Content.Tables[n].Cell(row, column).Range.Cells.VerticalAlignment = WdCellVerticalAlignment.wdCellAlignVerticalCenter; break;//垂直居中</span><br><span class="line">                case 1: wordDoc.Content.Tables[n].Cell(row, column).Range.Cells.VerticalAlignment = WdCellVerticalAlignment.wdCellAlignVerticalBottom; break;//底端对齐</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        // 设置表格字体</span><br><span class="line">        public void SetFont_Table(Microsoft.Office.Interop.Word.Table table, string fontName, double size)</span><br><span class="line">        &#123;</span><br><span class="line">            if (size != 0)</span><br><span class="line">            &#123;</span><br><span class="line">                table.Range.Font.Size = Convert.ToSingle(size);</span><br><span class="line">            &#125;</span><br><span class="line">            if (fontName != &quot;&quot;)</span><br><span class="line">            &#123;</span><br><span class="line">                table.Range.Font.Name = fontName;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 设置单元格字体</span><br><span class="line">        public void SetFont_Table(int n, int row, int column, string fontName, double size, int bold)</span><br><span class="line">        &#123;</span><br><span class="line">            if (size != 0)</span><br><span class="line">            &#123;</span><br><span class="line">                wordDoc.Content.Tables[n].Cell(row, column).Range.Font.Size = Convert.ToSingle(size);</span><br><span class="line">            &#125;</span><br><span class="line">            if (fontName != &quot;&quot;)</span><br><span class="line">            &#123;</span><br><span class="line">                wordDoc.Content.Tables[n].Cell(row, column).Range.Font.Name = fontName;</span><br><span class="line">            &#125;</span><br><span class="line">            wordDoc.Content.Tables[n].Cell(row, column).Range.Font.Bold = bold;// 0 表示不是粗体，其他值都是</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 是否使用边框,n表格的序号,use是或否</span><br><span class="line">        // 该处边框参数可以用int代替bool可以让方法更全面</span><br><span class="line">        // 具体值方法中介绍</span><br><span class="line">        public void UseBorder(int n, bool use)</span><br><span class="line">        &#123;</span><br><span class="line">            if (use)</span><br><span class="line">            &#123;</span><br><span class="line">                wordDoc.Content.Tables[n].Borders.Enable = 1;</span><br><span class="line">                //允许有边框，默认没有边框(为0时无边框，1为实线边框，2、3为虚线边框，以后的数字没试过)</span><br><span class="line">            &#125;</span><br><span class="line">            else</span><br><span class="line">            &#123;</span><br><span class="line">                wordDoc.Content.Tables[n].Borders.Enable = 0;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 给表格插入一行,n表格的序号从1开始记</span><br><span class="line">        public void AddRow(int n)</span><br><span class="line">        &#123;</span><br><span class="line">            object miss = System.Reflection.Missing.Value;</span><br><span class="line">            wordDoc.Content.Tables[n].Rows.Add(ref miss);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 给表格添加一行</span><br><span class="line">        public void AddRow(Microsoft.Office.Interop.Word.Table table)</span><br><span class="line">        &#123;</span><br><span class="line">            object miss = System.Reflection.Missing.Value;</span><br><span class="line">            table.Rows.Add(ref miss);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 给表格插入rows行,n为表格的序号</span><br><span class="line">        public void AddRow(int n, int rows)</span><br><span class="line">        &#123;</span><br><span class="line">            object miss = System.Reflection.Missing.Value;</span><br><span class="line">            Microsoft.Office.Interop.Word.Table table = wordDoc.Content.Tables[n];</span><br><span class="line">            for (int i = 0; i &lt; rows; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                table.Rows.Add(ref miss);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 删除表格第rows行,n为表格的序号</span><br><span class="line">        public void DeleteRow(int n, int row)</span><br><span class="line">        &#123;</span><br><span class="line">            Microsoft.Office.Interop.Word.Table table = wordDoc.Content.Tables[n];</span><br><span class="line">            table.Rows[row].Delete();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 给表格中单元格插入元素，table所在表格，row行号，column列号，value插入的元素</span><br><span class="line">        public void InsertCell(Microsoft.Office.Interop.Word.Table table, int row, int column, string value)</span><br><span class="line">        &#123;</span><br><span class="line">            table.Cell(row, column).Range.Text = value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 给表格中单元格插入元素，n表格的序号从1开始记，row行号，column列号，value插入的元素</span><br><span class="line">        public void InsertCell(int n, int row, int column, string value)</span><br><span class="line">        &#123;</span><br><span class="line">            wordDoc.Content.Tables[n].Cell(row, column).Range.Text = value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // 给表格插入一行数据，n为表格的序号，row行号，columns列数，values插入的值</span><br><span class="line">        public void InsertCell(int n, int row, int columns, string[] values)</span><br><span class="line">        &#123;</span><br><span class="line">            Microsoft.Office.Interop.Word.Table table = wordDoc.Content.Tables[n];</span><br><span class="line">            for (int i = 0; i &lt; columns; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                table.Cell(row, i + 1).Range.Text = values[i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        //杀掉winword.exe进程</span><br><span class="line">        public void killWinWordProcess()</span><br><span class="line">        &#123;</span><br><span class="line">          System.Diagnostics.Process[] processes = System.Diagnostics.Process.GetProcessesByName(&quot;WINWORD&quot;);</span><br><span class="line">          foreach (System.Diagnostics.Process process in processes)</span><br><span class="line">          &#123;</span><br><span class="line">            bool b = process.MainWindowTitle==&quot;&quot;;</span><br><span class="line">            if (process.MainWindowTitle ==&quot;&quot;)</span><br><span class="line">            &#123;</span><br><span class="line">              process.Kill();</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Word转pdf"><a href="#Word转pdf" class="headerlink" title="Word转pdf"></a>Word转pdf</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">using System;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using System.Linq;</span><br><span class="line">using System.Text;</span><br><span class="line">using Microsoft.Office.Interop.Word;</span><br><span class="line">using System.IO;</span><br><span class="line">namespace GDZLCHECK</span><br><span class="line">&#123;</span><br><span class="line">    class WordToPdfUtil</span><br><span class="line">    &#123;</span><br><span class="line">        public static bool wordToPdf(String sourcePath)</span><br><span class="line">        &#123;</span><br><span class="line">            bool result = false;</span><br><span class="line">            _Application application = new Application();</span><br><span class="line">            _Document document = null;</span><br><span class="line">            try</span><br><span class="line">            &#123;</span><br><span class="line">                application.Visible = false;</span><br><span class="line">                document = application.Documents.Open(sourcePath);</span><br><span class="line">                string PDFPath = sourcePath.Replace(&quot;.doc&quot;, &quot;.pdf&quot;);//pdf存放位置</span><br><span class="line">                if (!File.Exists(@PDFPath))//存在PDF，不需要继续转换</span><br><span class="line">                &#123;</span><br><span class="line">                    document.ExportAsFixedFormat(PDFPath, Microsoft.Office.Interop.Word.WdExportFormat.wdExportFormatPDF);</span><br><span class="line">                &#125;</span><br><span class="line">                result = true;</span><br><span class="line">            &#125;</span><br><span class="line">            catch (Exception e)</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(e.Message);</span><br><span class="line">                result = false;</span><br><span class="line">            &#125;</span><br><span class="line">            finally</span><br><span class="line">            &#123;</span><br><span class="line">                document.Close();</span><br><span class="line">            &#125;</span><br><span class="line">            return result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="pdf加水印"><a href="#pdf加水印" class="headerlink" title="pdf加水印"></a>pdf加水印</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">using iTextSharp.text;</span><br><span class="line">using iTextSharp.text.pdf;</span><br><span class="line">using System;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using System.Data;</span><br><span class="line">using System.IO;</span><br><span class="line">using System.Linq;</span><br><span class="line">using System.Text;</span><br><span class="line">using System.Threading.Tasks;</span><br><span class="line">using System.Windows.Forms;</span><br><span class="line"> public static void setWatermark(string filePath, string outputfilepath, string waterMarkName, string waterMarkAddr)</span><br><span class="line">        &#123;</span><br><span class="line">            PdfReader pdfReader = null;</span><br><span class="line">            PdfStamper pdfStamper = null;</span><br><span class="line">            try</span><br><span class="line">            &#123;</span><br><span class="line">                pdfReader = new PdfReader(filePath);</span><br><span class="line">                pdfStamper = new PdfStamper(pdfReader, new FileStream(outputfilepath, FileMode.Create));</span><br><span class="line">                //设置权限为只读</span><br><span class="line">                pdfStamper.SetEncryption(PdfWriter.STRENGTH128BITS, null, null, PdfWriter.ALLOW_SCREENREADERS | PdfWriter.AllowPrinting);                         </span><br><span class="line">                int total = pdfReader.NumberOfPages+1;//获取PDF的总页数</span><br><span class="line">                iTextSharp.text.Rectangle psize = pdfReader.GetPageSize(1);//获取第一页</span><br><span class="line">                float width = psize.Width;//PDF页面的宽度，用于计算水印倾斜</span><br><span class="line">                float height = psize.Height;</span><br><span class="line">                PdfContentByte waterContent;</span><br><span class="line">                BaseFont basefont = BaseFont.CreateFont(@&quot;C:\WINDOWS\Fonts\SIMFANG.TTF&quot;, BaseFont.IDENTITY_H, BaseFont.EMBEDDED);</span><br><span class="line">                PdfGState gs = new PdfGState();</span><br><span class="line">                //i从2开始，因为不给封面添加水印</span><br><span class="line">                for (int i = 2; i &lt; total; i++)</span><br><span class="line">                &#123;</span><br><span class="line">                    waterContent = pdfStamper.GetOverContent(i);//在内容上方加水印</span><br><span class="line">                    //透明度</span><br><span class="line">                    waterContent.SetGState(gs);</span><br><span class="line">                    //开始写入文本</span><br><span class="line">                    waterContent.BeginText();</span><br><span class="line">                    waterContent.SetColorFill(BaseColor.RED);</span><br><span class="line">                    waterContent.SetFontAndSize(basefont, 30);</span><br><span class="line">                    waterContent.SetTextMatrix(0, 0);</span><br><span class="line">                    if (waterMarkAddr == null || waterMarkAddr == &quot;&quot;)</span><br><span class="line">                    &#123;</span><br><span class="line">                        waterContent.ShowTextAligned(Element.ALIGN_CENTER, waterMarkName, width / 2, height / 2, 55);</span><br><span class="line">                    &#125;</span><br><span class="line">                    else</span><br><span class="line">                    &#123;</span><br><span class="line">                        waterContent.ShowTextAligned(Element.ALIGN_CENTER, waterMarkName, width / 2, height / 2 + 100, 55);</span><br><span class="line">                        waterContent.ShowTextAligned(Element.ALIGN_CENTER, waterMarkAddr, width / 2, height / 2 - 100, 55);</span><br><span class="line">                    &#125;</span><br><span class="line">                    waterContent.EndText();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            catch (Exception e)</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(e.ToString());</span><br><span class="line">            &#125;</span><br><span class="line">            finally</span><br><span class="line">            &#123;</span><br><span class="line">                if (pdfStamper != null)</span><br><span class="line">                    pdfStamper.Close();</span><br><span class="line"></span><br><span class="line">                if (pdfReader != null)</span><br><span class="line">                    pdfReader.Close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><h1 id="主函数调用"><a href="#主函数调用" class="headerlink" title="主函数调用"></a>主函数调用</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br></pre></td><td class="code"><pre><span class="line">if (this.tbManagerName.Text.ToString() == &quot;&quot; || this.tbContact.Text.ToString() == &quot;&quot; || this.tbUnit.Text.ToString() == &quot;&quot;)</span><br><span class="line">           &#123;</span><br><span class="line">               MessageBox.Show(&quot;请输入项目负责人姓名,联系电话,承担单位&quot;);</span><br><span class="line">               return;</span><br><span class="line">           &#125;         </span><br><span class="line">           //ConstantInfo.outStatic();</span><br><span class="line">           FolderBrowserDialog dialog = new FolderBrowserDialog();</span><br><span class="line">           dialog.Description = &quot;请选择检查报告输出位置&quot;;</span><br><span class="line">           string outputFilePath = &quot;&quot;;</span><br><span class="line">           if (dialog.ShowDialog() == DialogResult.OK)</span><br><span class="line">           &#123;</span><br><span class="line">               outputFilePath = dialog.SelectedPath;</span><br><span class="line">               string managerName = this.tbManagerName.Text.ToString();</span><br><span class="line">               string contactNum = this.tbContact.Text.ToString();</span><br><span class="line">               string unitName = this.tbUnit.Text.ToString();</span><br><span class="line">               //水印1</span><br><span class="line">               //PdfUtils.GeneratePDF(resultDt, strPacName, isPassed, managerName, contactNum, unitName, outputFilePath, 1);</span><br><span class="line">               //水印2</span><br><span class="line">               // PdfUtils.GeneratePDF(resultDt, strPac,isPassed,outputFilePath, 2);</span><br><span class="line">               //图片水印 </span><br><span class="line">               // string picPath = string.Format(&quot;&#123;0&#125;/Resource/&#123;1&#125;&quot;, AppDomain.CurrentDomain.BaseDirectory,&quot;logo.png&quot;);</span><br><span class="line">               //PdfUtils.GeneratePDF(resultDt, strPac,isPassed,outputFilePath, 3,picPath);  </span><br><span class="line">               //读取word模板生成数据，转为PDF，然后添加水印，删除临时文件</span><br><span class="line">               this.lbShowProcess.Text = &quot;正在准备统计数据...&quot;;</span><br><span class="line">               this.pbProgress.Visible = true;</span><br><span class="line">               statisticNum();</span><br><span class="line">               this.pbProgress.Position = 30; </span><br><span class="line">               this.lbShowProcess.Text = &quot;开始生成检查报告...&quot;;</span><br><span class="line">                          </span><br><span class="line">               savePdf(outputFilePath, managerName, contactNum, unitName);</span><br><span class="line">               this.lbShowProcess.Text = &quot;检查报告导出完成&quot;;</span><br><span class="line">           &#125;</span><br><span class="line">           </span><br><span class="line">//保存pdf</span><br><span class="line">  private void savePdf(string outputFilePath, string managerName, string contactNum, string unitName)</span><br><span class="line">         &#123;</span><br><span class="line">             String[] origin = &#123; &quot;O1&quot;, &quot;O2&quot;, &quot;O3&quot;, &quot;O4&quot;, &quot;O5&quot;, &quot;O6&quot; &#125;;//设计点             </span><br><span class="line">             //创建一个Word应用程序实例</span><br><span class="line">             Microsoft.Office.Interop.Word._Application oWord = new Microsoft.Office.Interop.Word.Application();</span><br><span class="line">             //设置为不可见</span><br><span class="line">             oWord.Visible = false;</span><br><span class="line">             //模板文件地址，这里假设在X盘根目录</span><br><span class="line">             string templatePath = string.Format(&quot;&#123;0&#125;/Config/&#123;1&#125;&quot;, AppDomain.CurrentDomain.BaseDirectory, &quot;template.dot&quot;);</span><br><span class="line">             object oTemplate = templatePath;</span><br><span class="line">             //以模板为基础生成文档</span><br><span class="line">             Microsoft.Office.Interop.Word._Document oDoc = oWord.Documents.Add(ref oTemplate, ref oMissing, ref oMissing, ref oMissing);</span><br><span class="line"> </span><br><span class="line">             CreateWord c = new CreateWord();</span><br><span class="line">             c.Application = oWord;</span><br><span class="line"> </span><br><span class="line">             c.Document = oDoc;</span><br><span class="line">            int total = origin.Length</span><br><span class="line">            this.pbProgress.Properties.Minimum = 0;            </span><br><span class="line">             this.pbProgress.Properties.Maximum =total+10;</span><br><span class="line">             this.pbProgress.Properties.Step = 1;                             </span><br><span class="line">             int i = 0, j = 0;</span><br><span class="line">             foreach (String s in origin)</span><br><span class="line">             &#123; </span><br><span class="line">                 Application.DoEvents();</span><br><span class="line">                 c.InsertValue(s, Convert.ToString(ConstantInfo.StaticResult[j][i]));</span><br><span class="line">                 this.pbProgress.PerformStep();</span><br><span class="line">                 i++;</span><br><span class="line">             &#125;            </span><br><span class="line">             c.InsertValue(&quot;单位&quot;, unitName);</span><br><span class="line">             c.InsertValue(&quot;负责人&quot;, managerName);</span><br><span class="line">             c.InsertValue(&quot;电话&quot;, contactNum);</span><br><span class="line">             c.InsertValue(&quot;日期&quot;, DateTime.Now.ToString(&quot;yyyy-MM-dd HH:mm:ss&quot;));                    </span><br><span class="line">             int rowNum = resultDt.Rows.Count;</span><br><span class="line">             int colNum = resultDt.Columns.Count;</span><br><span class="line">             if (rowNum &gt; 0)</span><br><span class="line">             &#123;</span><br><span class="line">                 //插入结果行</span><br><span class="line">                 c.AddRow(4, rowNum);</span><br><span class="line">                 //插入值</span><br><span class="line">                 for (int rowIndex = 0; rowIndex &lt; rowNum; rowIndex++)</span><br><span class="line">                 &#123;</span><br><span class="line">                     Application.DoEvents();</span><br><span class="line">                     for (int colIndex = 0; colIndex &lt; colNum; colIndex++)</span><br><span class="line">                     &#123;</span><br><span class="line">                         c.InsertCell(4, rowIndex+2, colIndex+1, resultDt.Rows[rowIndex][colIndex].ToString());</span><br><span class="line">                     &#125;</span><br><span class="line">                     this.pbProgress.PerformStep();</span><br><span class="line">                 &#125;</span><br><span class="line"> </span><br><span class="line">             &#125;</span><br><span class="line"> </span><br><span class="line">             string fileName = string.Format(&quot;数据_&#123;0&#125;.doc&quot;, DateTime.Now.ToString(&quot;yyyyMMddHHmmss&quot;));</span><br><span class="line">             string filePath = string.Format(&quot;&#123;0&#125;/Resource/&#123;1&#125;&quot;, AppDomain.CurrentDomain.BaseDirectory, fileName);</span><br><span class="line">             c.SaveDocument(filePath);//此时已经生成word</span><br><span class="line">             Thread.Sleep(5000);</span><br><span class="line">             WordToPdfUtil.wordToPdf(filePath);//转为pdf</span><br><span class="line"> </span><br><span class="line">             string waterMarkName = &quot;检查:&quot; + (isPassed ? &quot;通过&quot; : &quot;未通过&quot;);</span><br><span class="line">             string waterMarkAddr = strPacName;</span><br><span class="line">             string outputFileName = string.Format(this.strPacName+&quot;数据入库预检查报告_&#123;0&#125;.pdf&quot;, DateTime.Now.ToString(&quot;yyyyMMddHHmmss&quot;));</span><br><span class="line">             outputFilePath = string.Format(&quot;&#123;0&#125;/&#123;1&#125;&quot;, outputFilePath, outputFileName);</span><br><span class="line">             if (outputFilePath == null || outputFilePath == &quot;&quot;)</span><br><span class="line">             &#123;</span><br><span class="line">                 outputFilePath = string.Format(&quot;&#123;0&#125;/Resource/&#123;1&#125;&quot;, AppDomain.CurrentDomain.BaseDirectory, outputFileName);</span><br><span class="line">             &#125;</span><br><span class="line">             string pdfPath = filePath.Replace(&quot;.doc&quot;, &quot;.pdf&quot;);//pdf存放位置</span><br><span class="line">             setWatermark(pdfPath, outputFilePath, waterMarkName, waterMarkAddr);//先生成水印，再删除临时文件 ,加密在设置水印中实现</span><br><span class="line"> </span><br><span class="line">             //先生成水印，再删除临时文件</span><br><span class="line">             if (File.Exists(filePath))//判断临时文件是否存在，如果存在则删除</span><br><span class="line">             &#123;</span><br><span class="line">                 File.Delete(filePath);</span><br><span class="line">                 GC.Collect();//回收垃圾</span><br><span class="line">             &#125;</span><br><span class="line">             string PDFPath = filePath.Replace(&quot;.doc&quot;, &quot;.pdf&quot;);//pdf存放位置</span><br><span class="line">             if (File.Exists(PDFPath))//判断临时文件是否存在，如果存在则删除</span><br><span class="line">             &#123;</span><br><span class="line">                 File.Delete(PDFPath);</span><br><span class="line">                 GC.Collect();//回收垃圾</span><br><span class="line">             &#125;</span><br><span class="line">             Application.DoEvents();</span><br><span class="line">             this.pbProgress.Position = total + 10;</span><br><span class="line">             MessageBox.Show(&quot;保存检查结果成功&quot;);</span><br><span class="line">             this.pbProgress.Visible = false;</span><br><span class="line">             Console.WriteLine(&quot;done&quot;);</span><br><span class="line">         &#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;使用Microsoft Office 的COM组件,方便快捷，较好的复用和使用模板快速生成较复杂的文档&lt;br&gt;不足在于对于环境依赖较高&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="C#" scheme="http://11wy11.github.io/categories/C/"/>
    
    
      <category term="C#" scheme="http://11wy11.github.io/tags/C/"/>
    
  </entry>
  
  <entry>
    <title>C#利用itextSharp直接生成pdf</title>
    <link href="http://11wy11.github.io/2019/04/10/cplusplus-pdf-itextsharp-note/"/>
    <id>http://11wy11.github.io/2019/04/10/cplusplus-pdf-itextsharp-note/</id>
    <published>2019-04-10T01:16:23.000Z</published>
    <updated>2019-04-10T01:31:17.090Z</updated>
    
    <content type="html"><![CDATA[<p>C#使用开源第三方库itextsharp直接生成pdf,相较于Microsoft Office 的COM组件，不需要依赖office环境，程序兼容性好，更轻量。<br>但也存在一些不足，对于复杂模板的实现较为复杂，介绍一个使用实例<br><a id="more"></a></p><h1 id="pdf工具类"><a href="#pdf工具类" class="headerlink" title="pdf工具类"></a>pdf工具类</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br></pre></td><td class="code"><pre><span class="line">using iTextSharp.text;</span><br><span class="line">using iTextSharp.text.pdf;</span><br><span class="line">using System;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using System.Data;</span><br><span class="line">using System.IO;</span><br><span class="line">using System.Linq;</span><br><span class="line">using System.Text;</span><br><span class="line">using System.Threading.Tasks;</span><br><span class="line">using System.Windows.Forms;</span><br><span class="line"></span><br><span class="line">namespace GDZLCHECK.Utils</span><br><span class="line">&#123;</span><br><span class="line">    class PdfUtils</span><br><span class="line">    &#123;</span><br><span class="line">        private static PdfUtils instance;</span><br><span class="line">        public static PdfUtils GetInstance()</span><br><span class="line">        &#123;</span><br><span class="line">            if (instance == null)</span><br><span class="line">            &#123;</span><br><span class="line">                instance = new PdfUtils();</span><br><span class="line">            &#125;</span><br><span class="line">            return instance;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        private static Document doc;</span><br><span class="line">        private static BaseFont bf = BaseFont.CreateFont(@&quot;C://Windows/Fonts/simsun.ttc,0&quot;, BaseFont.IDENTITY_H, BaseFont.EMBEDDED);</span><br><span class="line">        //四种字体</span><br><span class="line">        private static Font fontBig = new Font(bf, 20, Font.BOLD);</span><br><span class="line">        private static Font fontMiddle = new Font(bf, 15, Font.BOLD);</span><br><span class="line">        private static Font fontSmall = new Font(bf, 13, Font.BOLD);</span><br><span class="line">        private static Font fontSmall1 = new Font(bf, 13, Font.BOLD);</span><br><span class="line">        private static Font fontSmallNoBold = new Font(bf, 13);</span><br><span class="line">        private static float IndentationLeft = 50;//距左边距</span><br><span class="line">        //如果要传参数进来，可自定义</span><br><span class="line">        public static void GeneratePDF(DataTable tableSource, string pac, bool isPassed,string managerName,string contactNum,string unitName,string outputFilePath = &quot;&quot;, int type = 1, string watermarkPicPath = &quot;&quot;)</span><br><span class="line">        &#123;</span><br><span class="line">            doc = new Document(PageSize.A4);</span><br><span class="line">            doc.AddAuthor(&quot;XXXXXX&quot;);</span><br><span class="line">            doc.AddCreationDate();</span><br><span class="line">            doc.AddHeader(&quot;isPass&quot;, isPassed.ToString());</span><br><span class="line">            try</span><br><span class="line">            &#123;</span><br><span class="line">                //MemoryStream ms2 = new MemoryStream();</span><br><span class="line">                string fileName = string.Format(&quot;数据_&#123;0&#125;.pdf&quot;, DateTime.Now.ToString(&quot;yyyyMMddHHmmss&quot;));</span><br><span class="line">                string filePath = string.Format(&quot;&#123;0&#125;/Resource/&#123;1&#125;&quot;, AppDomain.CurrentDomain.BaseDirectory, fileName);</span><br><span class="line">                FileStream fs = new FileStream(filePath, FileMode.Create);//创建临时文件，到时生成好后删除</span><br><span class="line">                PdfWriter writer = PdfWriter.GetInstance(doc, fs);</span><br><span class="line">                writer.CloseStream = false;//把doc内容写入流中</span><br><span class="line">                doc.Open();</span><br><span class="line">                //添加封面</span><br><span class="line">                //添加质检标志</span><br><span class="line">                string picPath = string.Format(&quot;&#123;0&#125;/Resource/&#123;1&#125;&quot;, AppDomain.CurrentDomain.BaseDirectory, &quot;mark.png&quot;);</span><br><span class="line">                Image img = Image.GetInstance(new Uri(picPath));</span><br><span class="line">                float PageHeight = PageSize.A4.Height/7;</span><br><span class="line">                double percentHeight = Math.Round((PageHeight / img.Height), 2);</span><br><span class="line"></span><br><span class="line">                float PageWidth = PageSize.A4.Width/2;</span><br><span class="line">                double percentWidth = Math.Round((PageWidth / img.Width), 2);</span><br><span class="line">                double percent = percentHeight &gt; percentWidth ? percentWidth : percentHeight;</span><br><span class="line">                img.ScalePercent((float)percent * 100);</span><br><span class="line">                doc.Add(img);</span><br><span class="line">                //每次在添加文本内容之前可以先设置字体</span><br><span class="line">                HeaderAndFooterEvent.SetFont(BaseColor.BLACK, &quot;宋体&quot;, 36, Font.BOLD);</span><br><span class="line">                //添加一个空段落来占位，五个参数分别为：内容，对齐方式（1为居中，0为居左，2为居右），段后空行数，段前空行数，行间距</span><br><span class="line">                //doc.Add(HeaderAndFooterEvent.AddParagraph(&quot; &quot;, 1, 100, 0, 1.5f));</span><br><span class="line"></span><br><span class="line">                //这个方法为上一个方法的重载，三个参数分别为：内容，对齐方式，行间距</span><br><span class="line">                doc.Add(HeaderAndFooterEvent.AddParagraph(&quot;检  验  报  告&quot;, 1, 2.41f));</span><br><span class="line">                HeaderAndFooterEvent.SetFont(BaseColor.BLACK, &quot;宋体&quot;, 28, Font.BOLD);</span><br><span class="line">                doc.Add(HeaderAndFooterEvent.AddParagraph(&quot;TEST  REPORT&quot;, 1, 1.5f));</span><br><span class="line">                doc.Add(HeaderAndFooterEvent.AddParagraph(&quot; &quot;, 1, 50, 0, 1.5f));</span><br><span class="line">                HeaderAndFooterEvent.SetFont(BaseColor.BLACK, &quot;宋体&quot;, 28, Font.BOLD);//空行</span><br><span class="line">                string projectName=&quot;项目名称&quot;;</span><br><span class="line">                //检测信息             </span><br><span class="line">                bool isChangeRow = false;//对于项目名称过长需要换行截断</span><br><span class="line">                string anotherStr = &quot;&quot;;</span><br><span class="line">                if (projectName.Length &gt; 19)</span><br><span class="line">                &#123;</span><br><span class="line">                    isChangeRow = true;</span><br><span class="line">                    anotherStr = projectName.Substring(19, projectName.Length - 19);</span><br><span class="line">                &#125;</span><br><span class="line">                if (isChangeRow)</span><br><span class="line">                &#123;</span><br><span class="line">                    AddPartnerContent(&quot;项目名称  :&quot;, projectName.Substring(0, 19), 38, 0);//添加项目名称</span><br><span class="line">                    AddPartnerContent(&quot;           &quot;, anotherStr, 38, 0);//添加项目名称</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">                else</span><br><span class="line">                &#123;</span><br><span class="line">                    AddPartnerContent(&quot;项目名称  :&quot;, projectName, 38, 0);//添加项目名称</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                AddPartnerContent(&quot;项目负责人:&quot;, managerName, 38, 0);//添加项目负责人</span><br><span class="line">                AddPartnerContent(&quot;联系电话  :&quot;, contactNum, 38, 1);//添加联系电话</span><br><span class="line">                AddPartnerContent(&quot;承担单位  :&quot;, unitName, 38, 0);//添加承担单位</span><br><span class="line">                AddPartnerContent(&quot;检测日期  :&quot;, DateTime.Now.ToString(&quot;yyyy-MM-dd HH:mm:ss&quot;), 38, 1);//添加项目名称</span><br><span class="line">                //检查结果详情</span><br><span class="line">                doc.NewPage();</span><br><span class="line">                //实现页眉页脚  </span><br><span class="line">                writer.PageEvent = new HeaderAndFooterEvent();</span><br><span class="line">                HeaderAndFooterEvent.PAGE_NUMBER = true;//实现页眉跟页脚  </span><br><span class="line">                HeaderAndFooterEvent.tpl = writer.DirectContent.CreateTemplate(500, 500); //定义模板</span><br><span class="line"></span><br><span class="line">                HeaderAndFooterEvent.HeaderLeft = &quot;耕地质量地球化学调查评价&quot;;</span><br><span class="line">                HeaderAndFooterEvent.HeaderRight = &quot;成果检查&quot;;</span><br><span class="line">                HeaderAndFooterEvent.FooterLeft = &quot;&quot;;</span><br><span class="line">                HeaderAndFooterEvent.FooterRight = DateTime.Now.ToString(&quot;yyyy-MM-dd HH:mm:ss&quot;) + &quot;(UTC)&quot;;</span><br><span class="line">                //核心操作</span><br><span class="line">                CreateLine();//生成一条下横线</span><br><span class="line">                CreateEmptyRow(1);//生成一行空行</span><br><span class="line">                HeaderAndFooterEvent.SetFont(BaseColor.BLACK, &quot;宋体&quot;, 15, Font.BOLD);</span><br><span class="line">                doc.Add(HeaderAndFooterEvent.AddParagraph(&quot;耕地质量地球化学调查评价成果检查报告&quot;, 1, 1.5f));</span><br><span class="line">                //AddHeaderTitleContent(&quot;汇交数据检查报告&quot;);//添加表头</span><br><span class="line">                CreateEmptyRow(1);//生成一行空行</span><br><span class="line">                //AddPartnerContent(&quot;生产单位&quot;, pac, 30);//添加合作单位</span><br><span class="line">                //AddPartnerContent(&quot;检查单位&quot;,&quot;WHU&quot;,25);//添加合作单位</span><br><span class="line">                //AddPageNumberContent(1,1);//添加页码</span><br><span class="line">                HeaderAndFooterEvent.SetFont(BaseColor.BLACK, &quot;宋体1&quot;, 12);</span><br><span class="line">                doc.Add(HeaderAndFooterEvent.AddParagraph(&quot;项目名称:  XXXXXX&quot;, 0, 1.5f));</span><br><span class="line">                doc.Add(HeaderAndFooterEvent.AddParagraph(&quot;项目负责人:&quot;+managerName+&quot;              &quot;, 0, 1.5f));</span><br><span class="line">                doc.Add(HeaderAndFooterEvent.AddParagraph(&quot;联系电话:&quot;+contactNum+&quot;         &quot;, 0, 1.5f));</span><br><span class="line">                doc.Add(HeaderAndFooterEvent.AddParagraph(&quot;承担单位:&quot; + unitName + &quot;          &quot;, 0, 1.5f));</span><br><span class="line">                doc.Add(HeaderAndFooterEvent.AddParagraph(&quot;检测日期: &quot; + DateTime.Now.ToString(&quot;yyyy-MM-dd HH:mm:ss&quot;), 0, 1.5f));</span><br><span class="line">                CreateEmptyRow(1);//生成一行空行</span><br><span class="line"></span><br><span class="line">                #region 生成表格数据</span><br><span class="line">                PdfPTable table = new PdfPTable(6);//5列的table</span><br><span class="line">                //添加表格列头     </span><br><span class="line">                table.WidthPercentage = 100;</span><br><span class="line">                table.SetTotalWidth(new float[] &#123; 70, 150,80, 150, 80, 120 &#125;);</span><br><span class="line">                table.AddCell(GetPdfCell(&quot;序号&quot;, fontSmallNoBold, Element.ALIGN_CENTER));</span><br><span class="line">                table.AddCell(GetPdfCell(&quot;检查对象&quot;, fontSmallNoBold, Element.ALIGN_CENTER));</span><br><span class="line">                table.AddCell(GetPdfCell(&quot;检查类型&quot;, fontSmallNoBold, Element.ALIGN_CENTER));</span><br><span class="line">                table.AddCell(GetPdfCell(&quot;检查内容&quot;, fontSmallNoBold, Element.ALIGN_CENTER));</span><br><span class="line">                table.AddCell(GetPdfCell(&quot;检查结果&quot;, fontSmallNoBold, Element.ALIGN_CENTER));</span><br><span class="line">                table.AddCell(GetPdfCell(&quot;备注&quot;, fontSmallNoBold, Element.ALIGN_CENTER));              </span><br><span class="line"></span><br><span class="line">                int emptyRow = 20;//如果table的行数小于20行，那么剩余部分显示空白行</span><br><span class="line">                if (tableSource.Rows.Count &gt; 0)</span><br><span class="line">                &#123;</span><br><span class="line">                    emptyRow = emptyRow - tableSource.Rows.Count;//如果为负数，说明不需要生成空白行</span><br><span class="line">                    for (int i = 0; i &lt; tableSource.Rows.Count; i++)</span><br><span class="line">                    &#123;</span><br><span class="line">                        DataRow row = tableSource.Rows[i];</span><br><span class="line">                        table.AddCell(GetPdfCell((i + 1).ToString(), fontSmallNoBold, Element.ALIGN_CENTER));</span><br><span class="line">                        table.AddCell(GetPdfCell(row[&quot;Object&quot;].ToString(), fontSmallNoBold, Element.ALIGN_CENTER));</span><br><span class="line">                        table.AddCell(GetPdfCell(row[&quot;Type&quot;].ToString(), fontSmallNoBold, Element.ALIGN_CENTER));</span><br><span class="line">                        table.AddCell(GetPdfCell(row[&quot;Content&quot;].ToString(), fontSmallNoBold, Element.ALIGN_CENTER));</span><br><span class="line">                        table.AddCell(GetPdfCell(row[&quot;Result&quot;].ToString(), fontSmallNoBold, Element.ALIGN_CENTER));</span><br><span class="line">                        table.AddCell(GetPdfCell(row[&quot;Info&quot;].ToString(), fontSmallNoBold, Element.ALIGN_CENTER));                      </span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                if (emptyRow &gt; 0)//说明数据源不足20行</span><br><span class="line">                &#123;</span><br><span class="line">                    for (int i = 0; i &lt; emptyRow; i++)</span><br><span class="line">                    &#123;</span><br><span class="line">                        table.AddCell(GetPdfCell(((20 - emptyRow) + i + 1).ToString(), fontSmallNoBold, Element.ALIGN_CENTER));</span><br><span class="line">                        table.AddCell(GetPdfCell(&quot;&quot;, fontSmallNoBold, Element.ALIGN_CENTER));</span><br><span class="line">                        table.AddCell(GetPdfCell(&quot;&quot;, fontSmallNoBold, Element.ALIGN_CENTER));</span><br><span class="line">                        table.AddCell(GetPdfCell(&quot;&quot;, fontSmallNoBold, Element.ALIGN_CENTER));</span><br><span class="line">                        table.AddCell(GetPdfCell(&quot;&quot;, fontSmallNoBold, Element.ALIGN_CENTER));                       </span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                doc.Add(table);</span><br><span class="line">                #endregion</span><br><span class="line"></span><br><span class="line">                #region 添加水印</span><br><span class="line">                string waterMarkName = &quot;检查:&quot;+(isPassed?&quot;通过&quot;:&quot;未通过&quot;);</span><br><span class="line">                string waterMarkAddr = pac;              </span><br><span class="line">                #endregion</span><br><span class="line"></span><br><span class="line">                doc.Close();          </span><br><span class="line">                fs.Close();</span><br><span class="line">                string outputFileName = string.Format(&quot;检查报告_&#123;0&#125;.pdf&quot;, DateTime.Now.ToString(&quot;yyyyMMddHHmmss&quot;));</span><br><span class="line">                outputFilePath = string.Format(&quot;&#123;0&#125;/&#123;1&#125;&quot;, outputFilePath, outputFileName);</span><br><span class="line">                if (outputFilePath == null || outputFilePath == &quot;&quot;)</span><br><span class="line">                &#123;</span><br><span class="line">                     outputFilePath = string.Format(&quot;&#123;0&#125;/Resource/&#123;1&#125;&quot;, AppDomain.CurrentDomain.BaseDirectory, outputFileName);</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                switch (type)</span><br><span class="line">                &#123;</span><br><span class="line">                    case 1:</span><br><span class="line">                        //目前使用并在其中设置了只读</span><br><span class="line">                        setWatermark(filePath,outputFilePath,waterMarkName,waterMarkAddr);//先生成水印，再删除临时文件</span><br><span class="line">                        break;</span><br><span class="line">                    case 2:                       </span><br><span class="line">                       waterMarkName = string.Format(&quot;汇交检查：&#123;0&#125;  区域：&#123;1&#125; &quot;, &quot;通过&quot;, waterMarkAddr);</span><br><span class="line">                       setWatermark(filePath, outputFilePath, waterMarkName);</span><br><span class="line">                        break;</span><br><span class="line">                    case 3:</span><br><span class="line">                        setPicWatermark(filePath, outputFilePath, watermarkPicPath);</span><br><span class="line">                        break;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">                //先生成水印，再删除临时文件</span><br><span class="line">                if (File.Exists(filePath))//判断临时文件是否存在，如果存在则删除</span><br><span class="line">                &#123;</span><br><span class="line">                    File.Delete(filePath);</span><br><span class="line">                    GC.Collect();//回收垃圾</span><br><span class="line">                &#125;</span><br><span class="line">                //设置只读</span><br><span class="line">                //pdfreadonly(outputFilePath);</span><br><span class="line">                MessageBox.Show(&quot;保存检查结果成功&quot;);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            catch (DocumentException ex)</span><br><span class="line">            &#123;</span><br><span class="line">                throw new Exception(ex.Message);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        #region 生成一条横线</span><br><span class="line">        private static void CreateLine()</span><br><span class="line">        &#123;</span><br><span class="line">            PdfPTable table = new PdfPTable(1);//一个单元格的</span><br><span class="line">            table.WidthPercentage = 100;</span><br><span class="line">            PdfPCell cell = new PdfPCell();</span><br><span class="line">            cell.BorderWidthBottom = 0.5f;</span><br><span class="line">            table.AddCell(cell);</span><br><span class="line">            doc.Add(table);</span><br><span class="line">        &#125;</span><br><span class="line">        #endregion</span><br><span class="line"></span><br><span class="line">        #region 生成N行空白行</span><br><span class="line">        private static void CreateEmptyRow(int emptyRowNum)</span><br><span class="line">        &#123;</span><br><span class="line">            for (int i = 0; i &lt; emptyRowNum; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                doc.Add(new Paragraph(&quot; &quot;));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        #endregion</span><br><span class="line"></span><br><span class="line">        #region 生成标题</span><br><span class="line">        private static void AddHeaderTitleContent(string content)</span><br><span class="line">        &#123;</span><br><span class="line">            Paragraph p = new Paragraph(content, fontMiddle);</span><br><span class="line">            p.IndentationLeft = IndentationLeft;//距离左边距</span><br><span class="line">            doc.Add(p);</span><br><span class="line">        &#125;</span><br><span class="line">        #endregion</span><br><span class="line"></span><br><span class="line">        #region 生成带下划线的内容</span><br><span class="line">        private static void AddPartnerContent(string stationName, string stationValue, int maxlength,int type)</span><br><span class="line">        &#123;</span><br><span class="line">            fontSmall.SetStyle(Font.UNDERLINE);//文字下划线          </span><br><span class="line">            Paragraph content = new Paragraph();</span><br><span class="line">            content.IndentationLeft = 100;</span><br><span class="line">            Chunk chunkName = new Chunk(stationName, fontSmall1);</span><br><span class="line">            Chunk chunkText = new Chunk(GetEmptyString(maxlength, stationValue,type), fontSmall);</span><br><span class="line">            content.Add(0, chunkName);</span><br><span class="line">            content.Add(1, chunkText);</span><br><span class="line">            content.SpacingAfter = 2;</span><br><span class="line">            content.SpacingBefore = 2;</span><br><span class="line">            content.MultipliedLeading = 1.5f;</span><br><span class="line">            content.Alignment = 0;</span><br><span class="line">            doc.Add(content);           </span><br><span class="line">        &#125;</span><br><span class="line">        //居中显示内容</span><br><span class="line">        private static string GetEmptyString(int maxlength, string text,int type)</span><br><span class="line">        &#123;</span><br><span class="line">            int padding =0;</span><br><span class="line">            if (type == 0)</span><br><span class="line">            &#123;</span><br><span class="line">                padding = (maxlength - text.Length* 2) ;</span><br><span class="line">            &#125;</span><br><span class="line">            else &#123;</span><br><span class="line">                padding = (maxlength - text.Length);</span><br><span class="line">            &#125;</span><br><span class="line">            string empty = string.Empty;</span><br><span class="line">            for (int i = 0; i &lt; padding; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                empty += &quot; &quot;;</span><br><span class="line">            &#125;</span><br><span class="line">            return string.Format(&quot;&#123;1&#125;&#123;0&#125;&quot;, empty, text);</span><br><span class="line">        &#125;</span><br><span class="line">        #endregion</span><br><span class="line"></span><br><span class="line">        #region 生成页码</span><br><span class="line">        private static void AddPageNumberContent(int total,int currentPage)</span><br><span class="line">        &#123;</span><br><span class="line">            var content = new Paragraph(&quot;共 &quot;+total+&quot; 页  第&quot;+currentPage+&quot;   页&quot;, fontSmall);</span><br><span class="line">            content.IndentationRight = IndentationLeft + 20;</span><br><span class="line">            content.Alignment = 2;    //居左</span><br><span class="line">            doc.Add(content);</span><br><span class="line">        &#125;</span><br><span class="line">        #endregion</span><br><span class="line"></span><br><span class="line">        #region 生成单元格</span><br><span class="line">        private static PdfPCell GetPdfCell(string content, Font font, int horizontalAlignment)</span><br><span class="line">        &#123;</span><br><span class="line">            PdfPCell cell = new PdfPCell(new Paragraph(content, font));</span><br><span class="line">            cell.HorizontalAlignment = horizontalAlignment;//水平位置</span><br><span class="line">            cell.VerticalAlignment = Element.ALIGN_CENTER;//垂直居中</span><br><span class="line">            cell.MinimumHeight = 20;//单元格的最小高度</span><br><span class="line">            return cell;</span><br><span class="line">        &#125;</span><br><span class="line">        #endregion</span><br><span class="line"></span><br><span class="line">        #region 生成水印</span><br><span class="line">     </span><br><span class="line">        public static bool CreatePDFByPic(string picPdfPath, string picPath)</span><br><span class="line">        &#123;</span><br><span class="line">            //新建一个文档</span><br><span class="line">            Document doc = new Document();</span><br><span class="line">            try</span><br><span class="line">            &#123;</span><br><span class="line">                //建立一个书写器(Writer)与document对象关联</span><br><span class="line">                PdfWriter.GetInstance(doc, new FileStream(picPdfPath, FileMode.Create, FileAccess.ReadWrite));</span><br><span class="line">                //打开一个文档</span><br><span class="line">                doc.Open();</span><br><span class="line">                //向文档中添加内容</span><br><span class="line">                Image img = Image.GetInstance(picPath);</span><br><span class="line">                //img.SetAbsolutePosition();</span><br><span class="line">                doc.Add(img);</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line">            catch (Exception ex)</span><br><span class="line">            &#123;</span><br><span class="line">                return false;</span><br><span class="line">                throw ex;</span><br><span class="line">            &#125;</span><br><span class="line">            finally</span><br><span class="line">            &#123;</span><br><span class="line">                if (doc != null)</span><br><span class="line">                &#123;</span><br><span class="line">                    doc.Close();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// 加图片水印</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        /// &lt;param name=&quot;inputfilepath&quot;&gt;&lt;/param&gt;</span><br><span class="line">        /// &lt;param name=&quot;outputfilepath&quot;&gt;&lt;/param&gt;</span><br><span class="line">        /// &lt;param name=&quot;ModelPicName&quot;&gt;&lt;/param&gt;</span><br><span class="line">        /// &lt;param name=&quot;top&quot;&gt;&lt;/param&gt;</span><br><span class="line">        /// &lt;param name=&quot;left&quot;&gt;&lt;/param&gt;</span><br><span class="line">        /// &lt;returns&gt;&lt;/returns&gt;</span><br><span class="line">        public static bool setPicWatermark(string inputfilepath, string outputfilepath, string ModelPicName)</span><br><span class="line">        &#123;</span><br><span class="line">            //throw new NotImplementedException();</span><br><span class="line">            PdfReader pdfReader = null;</span><br><span class="line">            PdfStamper pdfStamper = null;</span><br><span class="line">            try</span><br><span class="line">            &#123;</span><br><span class="line">                pdfReader = new PdfReader(inputfilepath);</span><br><span class="line">                int numberOfPages = pdfReader.NumberOfPages;</span><br><span class="line"></span><br><span class="line">                iTextSharp.text.Rectangle psize = pdfReader.GetPageSize(1);</span><br><span class="line"></span><br><span class="line">                float width = psize.Width;</span><br><span class="line"></span><br><span class="line">                float height = psize.Height;              </span><br><span class="line">               </span><br><span class="line"></span><br><span class="line">                pdfStamper = new PdfStamper(pdfReader, new FileStream(outputfilepath, FileMode.Create));</span><br><span class="line"></span><br><span class="line">                PdfContentByte waterMarkContent;</span><br><span class="line"></span><br><span class="line">                iTextSharp.text.Image image = iTextSharp.text.Image.GetInstance(ModelPicName);</span><br><span class="line">                float left = width / 2 - image.Width; </span><br><span class="line">                float top = 10;</span><br><span class="line">                image.GrayFill = 50;//透明度，灰色填充</span><br><span class="line">                //image.Rotation//旋转</span><br><span class="line">                //image.RotationDegrees//旋转角度</span><br><span class="line">                //水印的位置 </span><br><span class="line">                if (left &lt; 0)</span><br><span class="line">                &#123;</span><br><span class="line">                    left = width / 2 - image.Width;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                //image.SetAbsolutePosition(left, (height - image.Height) - top);</span><br><span class="line">                image.SetAbsolutePosition(left, (height / 2 - image.Height) - top);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                //每一页加水印,也可以设置某一页加水印 </span><br><span class="line">                for (int i = 1; i &lt;= numberOfPages; i++)</span><br><span class="line">                &#123;</span><br><span class="line">                    //waterMarkContent = pdfStamper.GetUnderContent(i);//内容下层加水印</span><br><span class="line">                    waterMarkContent = pdfStamper.GetOverContent(i);//内容上层加水印</span><br><span class="line"></span><br><span class="line">                    waterMarkContent.AddImage(image);</span><br><span class="line">                &#125;</span><br><span class="line">                //strMsg = &quot;success&quot;;</span><br><span class="line">                return true;</span><br><span class="line">            &#125;</span><br><span class="line">            catch (Exception ex)</span><br><span class="line">            &#123;</span><br><span class="line">                throw ex;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            finally</span><br><span class="line">            &#123;</span><br><span class="line"></span><br><span class="line">                if (pdfStamper != null)</span><br><span class="line">                    pdfStamper.Close();</span><br><span class="line"></span><br><span class="line">                if (pdfReader != null)</span><br><span class="line">                    pdfReader.Close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// 添加普通偏转角度文字水印</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        /// &lt;param name=&quot;inputfilepath&quot;&gt;&lt;/param&gt;</span><br><span class="line">        /// &lt;param name=&quot;outputfilepath&quot;&gt;&lt;/param&gt;</span><br><span class="line">        /// &lt;param name=&quot;waterMarkName&quot;&gt;&lt;/param&gt;</span><br><span class="line">        /// &lt;param name=&quot;permission&quot;&gt;&lt;/param&gt;</span><br><span class="line">        public static void setWatermark(string inputfilepath, string outputfilepath, string waterMarkName)</span><br><span class="line">        &#123;</span><br><span class="line">            PdfReader pdfReader = null;</span><br><span class="line">            PdfStamper pdfStamper = null;</span><br><span class="line">            try</span><br><span class="line">            &#123;</span><br><span class="line">                pdfReader = new PdfReader(inputfilepath);</span><br><span class="line">                pdfStamper = new PdfStamper(pdfReader, new FileStream(outputfilepath, FileMode.Create));</span><br><span class="line">                int total = pdfReader.NumberOfPages + 1;</span><br><span class="line">                iTextSharp.text.Rectangle psize = pdfReader.GetPageSize(1);</span><br><span class="line">                float width = psize.Width;</span><br><span class="line">                float height = psize.Height;</span><br><span class="line">                PdfContentByte content;</span><br><span class="line">                BaseFont font = BaseFont.CreateFont(@&quot;C:\WINDOWS\Fonts\SIMFANG.TTF&quot;, BaseFont.IDENTITY_H, BaseFont.EMBEDDED);</span><br><span class="line">                PdfGState gs = new PdfGState();</span><br><span class="line">                for (int i = 1; i &lt; total; i++)</span><br><span class="line">                &#123;</span><br><span class="line">                    content = pdfStamper.GetOverContent(i);//在内容上方加水印</span><br><span class="line">                    //content = pdfStamper.GetUnderContent(i);//在内容下方加水印</span><br><span class="line">                    //透明度</span><br><span class="line">                    gs.FillOpacity = 0.3f;</span><br><span class="line">                    content.SetGState(gs);</span><br><span class="line">                    //content.SetGrayFill(0.3f);</span><br><span class="line">                    //开始写入文本</span><br><span class="line">                    content.BeginText();</span><br><span class="line">                    content.SetColorFill(BaseColor.LIGHT_GRAY);</span><br><span class="line">                    content.SetFontAndSize(font, 40);</span><br><span class="line">                    content.SetTextMatrix(0, 0);</span><br><span class="line">                    content.ShowTextAligned(Element.ALIGN_CENTER, waterMarkName, width / 2 - 50, height / 2 - 50, 55);</span><br><span class="line">                    //content.SetColorFill(BaseColor.BLACK);</span><br><span class="line">                    //content.SetFontAndSize(font, 8);</span><br><span class="line">                    //content.ShowTextAligned(Element.ALIGN_CENTER, waterMarkName, 0, 0, 0);</span><br><span class="line">                    content.EndText();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            catch (Exception ex)</span><br><span class="line">            &#123;</span><br><span class="line">                throw ex;</span><br><span class="line">            &#125;</span><br><span class="line">            finally</span><br><span class="line">            &#123;</span><br><span class="line"></span><br><span class="line">                if (pdfStamper != null)</span><br><span class="line">                    pdfStamper.Close();</span><br><span class="line"></span><br><span class="line">                if (pdfReader != null)</span><br><span class="line">                    pdfReader.Close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// 添加倾斜水印</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        /// &lt;param name=&quot;inputfilepath&quot;&gt;&lt;/param&gt;</span><br><span class="line">        /// &lt;param name=&quot;outputfilepath&quot;&gt;&lt;/param&gt;</span><br><span class="line">        /// &lt;param name=&quot;waterMarkName&quot;&gt;&lt;/param&gt;</span><br><span class="line">        /// &lt;param name=&quot;userPassWord&quot;&gt;&lt;/param&gt;</span><br><span class="line">        /// &lt;param name=&quot;ownerPassWord&quot;&gt;&lt;/param&gt;</span><br><span class="line">        /// &lt;param name=&quot;permission&quot;&gt;&lt;/param&gt;</span><br><span class="line">        public static void setWatermark(string inputfilepath, string outputfilepath, string waterMarkName, string userPassWord, string ownerPassWord, int permission)</span><br><span class="line">        &#123;</span><br><span class="line">            PdfReader pdfReader = null;</span><br><span class="line">            PdfStamper pdfStamper = null;</span><br><span class="line">            try</span><br><span class="line">            &#123;</span><br><span class="line">                pdfReader = new PdfReader(inputfilepath);</span><br><span class="line">                pdfStamper = new PdfStamper(pdfReader, new FileStream(outputfilepath, FileMode.Create));</span><br><span class="line">                // 设置密码   </span><br><span class="line">                //pdfStamper.SetEncryption(false,userPassWord, ownerPassWord, permission); </span><br><span class="line"></span><br><span class="line">                int total = pdfReader.NumberOfPages + 1;</span><br><span class="line">                PdfContentByte content;</span><br><span class="line">                BaseFont font = BaseFont.CreateFont(@&quot;C:\WINDOWS\Fonts\SIMFANG.TTF&quot;, BaseFont.IDENTITY_H, BaseFont.EMBEDDED);</span><br><span class="line">                PdfGState gs = new PdfGState();</span><br><span class="line">                gs.FillOpacity = 0.2f;//透明度</span><br><span class="line"></span><br><span class="line">                int j = waterMarkName.Length;</span><br><span class="line">                char c;</span><br><span class="line">                int rise = 0;</span><br><span class="line">                for (int i = 1; i &lt; total; i++)</span><br><span class="line">                &#123;</span><br><span class="line">                    rise = 500;</span><br><span class="line">                    content = pdfStamper.GetOverContent(i);//在内容上方加水印</span><br><span class="line">                    //content = pdfStamper.GetUnderContent(i);//在内容下方加水印</span><br><span class="line"></span><br><span class="line">                    content.BeginText();</span><br><span class="line">                    content.SetColorFill(BaseColor.DARK_GRAY);</span><br><span class="line">                    content.SetFontAndSize(font, 50);</span><br><span class="line">                    // 设置水印文字字体倾斜 开始 </span><br><span class="line">                    if (j &gt;= 15)</span><br><span class="line">                    &#123;</span><br><span class="line">                        content.SetTextMatrix(200, 120);</span><br><span class="line">                        for (int k = 0; k &lt; j; k++)</span><br><span class="line">                        &#123;</span><br><span class="line">                            content.SetTextRise(rise);</span><br><span class="line">                            c = waterMarkName[k];</span><br><span class="line">                            content.ShowText(c + &quot;&quot;);</span><br><span class="line">                            rise -= 20;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    else</span><br><span class="line">                    &#123;</span><br><span class="line">                        content.SetTextMatrix(180, 100);</span><br><span class="line">                        for (int k = 0; k &lt; j; k++)</span><br><span class="line">                        &#123;</span><br><span class="line">                            content.SetTextRise(rise);</span><br><span class="line">                            c = waterMarkName[k];</span><br><span class="line">                            content.ShowText(c + &quot;&quot;);</span><br><span class="line">                            rise -= 18;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    // 字体设置结束 </span><br><span class="line">                    content.EndText();</span><br><span class="line">                    // 画一个圆 </span><br><span class="line">                    //content.Ellipse(250, 450, 350, 550);</span><br><span class="line">                    //content.SetLineWidth(1f);</span><br><span class="line">                    //content.Stroke(); </span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            catch (Exception ex)</span><br><span class="line">            &#123;</span><br><span class="line">                throw ex;</span><br><span class="line">            &#125;</span><br><span class="line">            finally</span><br><span class="line">            &#123;</span><br><span class="line"></span><br><span class="line">                if (pdfStamper != null)</span><br><span class="line">                    pdfStamper.Close();</span><br><span class="line"></span><br><span class="line">                if (pdfReader != null)</span><br><span class="line">                    pdfReader.Close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">       /// &lt;summary&gt;</span><br><span class="line">       /// </span><br><span class="line">       /// &lt;/summary&gt;</span><br><span class="line">       /// &lt;param name=&quot;filePath&quot;&gt;&lt;/param&gt;</span><br><span class="line">       /// &lt;param name=&quot;outputfilepath&quot;&gt;&lt;/param&gt;</span><br><span class="line">       /// &lt;param name=&quot;waterMarkName&quot;&gt;&lt;/param&gt;</span><br><span class="line">       /// &lt;param name=&quot;waterMarkAddr&quot;&gt;&lt;/param&gt;</span><br><span class="line">        public static void setWatermark(string filePath, string outputfilepath, string waterMarkName, string waterMarkAddr)</span><br><span class="line">        &#123;</span><br><span class="line">            PdfReader pdfReader = null;</span><br><span class="line">            PdfStamper pdfStamper = null;</span><br><span class="line">            try</span><br><span class="line">            &#123;</span><br><span class="line">                pdfReader = new PdfReader(filePath);</span><br><span class="line">                pdfStamper = new PdfStamper(pdfReader, new FileStream(outputfilepath, FileMode.Create));</span><br><span class="line">                //设置权限为只读</span><br><span class="line">                pdfStamper.SetEncryption(PdfWriter.STRENGTH128BITS, null, null, PdfWriter.ALLOW_SCREENREADERS | PdfWriter.AllowPrinting);                         </span><br><span class="line">                int total = pdfReader.NumberOfPages+1;//获取PDF的总页数</span><br><span class="line">                iTextSharp.text.Rectangle psize = pdfReader.GetPageSize(1);//获取第一页</span><br><span class="line">                float width = psize.Width;//PDF页面的宽度，用于计算水印倾斜</span><br><span class="line">                float height = psize.Height;</span><br><span class="line">                PdfContentByte waterContent;</span><br><span class="line">                BaseFont basefont = BaseFont.CreateFont(@&quot;C:\WINDOWS\Fonts\SIMFANG.TTF&quot;, BaseFont.IDENTITY_H, BaseFont.EMBEDDED);</span><br><span class="line">                PdfGState gs = new PdfGState();</span><br><span class="line">                //i从2开始，因为不给封面添加水印</span><br><span class="line">                for (int i = 2; i &lt; total; i++)</span><br><span class="line">                &#123;</span><br><span class="line">                    waterContent = pdfStamper.GetOverContent(i);//在内容上方加水印</span><br><span class="line">                    //透明度</span><br><span class="line">                    waterContent.SetGState(gs);</span><br><span class="line">                    //开始写入文本</span><br><span class="line">                    waterContent.BeginText();</span><br><span class="line">                    waterContent.SetColorFill(BaseColor.RED);</span><br><span class="line">                    waterContent.SetFontAndSize(basefont, 30);</span><br><span class="line">                    waterContent.SetTextMatrix(0, 0);</span><br><span class="line">                    if (waterMarkAddr == null || waterMarkAddr == &quot;&quot;)</span><br><span class="line">                    &#123;</span><br><span class="line">                        waterContent.ShowTextAligned(Element.ALIGN_CENTER, waterMarkName, width / 2, height / 2, 55);</span><br><span class="line">                    &#125;</span><br><span class="line">                    else</span><br><span class="line">                    &#123;</span><br><span class="line">                        waterContent.ShowTextAligned(Element.ALIGN_CENTER, waterMarkName, width / 2, height / 2 + 100, 55);</span><br><span class="line">                        waterContent.ShowTextAligned(Element.ALIGN_CENTER, waterMarkAddr, width / 2, height / 2 - 100, 55);</span><br><span class="line">                    &#125;</span><br><span class="line">                    waterContent.EndText();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            catch (Exception e)</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(e.ToString());</span><br><span class="line">            &#125;</span><br><span class="line">            finally</span><br><span class="line">            &#123;</span><br><span class="line">                if (pdfStamper != null)</span><br><span class="line">                    pdfStamper.Close();</span><br><span class="line"></span><br><span class="line">                if (pdfReader != null)</span><br><span class="line">                    pdfReader.Close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        #endregion</span><br><span class="line">        #region 只读</span><br><span class="line">        public static void pdfreadonly(string pdfname)</span><br><span class="line">        &#123;</span><br><span class="line"></span><br><span class="line">            string pdfFile = pdfname;// &quot;d:\\sample.pdf&quot;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            //把文件读入内存可立即释放文件句柄，方便信息覆盖原文件</span><br><span class="line"></span><br><span class="line">            PdfReader reader = new PdfReader(File.ReadAllBytes(pdfFile));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            //获取到本文件的 MetaData 信息</span><br><span class="line"></span><br><span class="line">            Dictionary&lt;string, string&gt; info = reader.Info;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            reader.Close();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            //覆盖掉原 PDF 文件中</span><br><span class="line"></span><br><span class="line">            PdfStamper stamper = new PdfStamper(reader, new FileStream(pdfFile, FileMode.Create, FileAccess.Write));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            stamper.MoreInfo = info;</span><br><span class="line"></span><br><span class="line">            stamper.SetEncryption(PdfWriter.STRENGTH40BITS, null, null, PdfWriter.AllowScreenReaders);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            stamper.Close();</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        #endregion</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="页眉页脚生成类"><a href="#页眉页脚生成类" class="headerlink" title="页眉页脚生成类"></a>页眉页脚生成类</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br></pre></td><td class="code"><pre><span class="line">using iTextSharp.text;</span><br><span class="line">using iTextSharp.text.pdf;</span><br><span class="line">using System;</span><br><span class="line">using System.Collections.Generic;</span><br><span class="line">using System.Linq;</span><br><span class="line">using System.Text;</span><br><span class="line">using System.Threading.Tasks;</span><br><span class="line"></span><br><span class="line">namespace GDZLCHECK.Utils</span><br><span class="line">&#123;</span><br><span class="line">    public class HeaderAndFooterEvent : PdfPageEventHelper, IPdfPageEvent</span><br><span class="line">    &#123;</span><br><span class="line">        #region 静态字段</span><br><span class="line"></span><br><span class="line">        public static PdfTemplate tpl = null;</span><br><span class="line">        public static bool PAGE_NUMBER = false;//为True时就生成 页眉和页脚  </span><br><span class="line">        public static iTextSharp.text.Rectangle rect = PageSize.A4;   //文档大小</span><br><span class="line"></span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// 正文字体</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        private static Font font;</span><br><span class="line"></span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// 页眉页脚字体</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        public static string HeaderFooterFontName = &quot;黑体&quot;;</span><br><span class="line"></span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// 页头页脚字号</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        public static int HeaderFooterFontSize = 10;</span><br><span class="line"></span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// 页头页尾字体颜色</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        public static BaseColor HeaderFooterFontColor = BaseColor.BLACK;</span><br><span class="line"></span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// 左边页眉</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        public static string HeaderLeft &#123; get; set; &#125;</span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// 右边页眉</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        public static string HeaderRight &#123; get; set; &#125;</span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// 左边页脚</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        public static string FooterLeft &#123; get; set; &#125;</span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// 右边页脚</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        public static string FooterRight &#123; get; set; &#125;</span><br><span class="line"></span><br><span class="line">        #endregion</span><br><span class="line"></span><br><span class="line">        #region 设置页面大小</span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// 设置页面大小</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        /// &lt;param name=&quot;type&quot;&gt;页面大小(如&quot;A4&quot;)&lt;/param&gt;</span><br><span class="line">        public static void SetPageSize(string type)</span><br><span class="line">        &#123;</span><br><span class="line">            switch (type.Trim())</span><br><span class="line">            &#123;</span><br><span class="line">                case &quot;A4&quot;:</span><br><span class="line">                    rect = PageSize.A4;</span><br><span class="line">                    break;</span><br><span class="line">                case &quot;A8&quot;:</span><br><span class="line">                    rect = PageSize.A8;</span><br><span class="line">                    break;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        #endregion</span><br><span class="line"></span><br><span class="line">        #region 设置字体</span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// 设置字体</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        /// &lt;param name=&quot;size&quot;&gt;字体大小&lt;/param&gt;</span><br><span class="line">        public static void SetFont(BaseColor color, string fontName = &quot;华文中宋&quot;, float size = 12, int style = Font.NORMAL)</span><br><span class="line">        &#123;</span><br><span class="line">            font = new Font(BaseFontAndSize(fontName), size, style, color);</span><br><span class="line">        &#125;</span><br><span class="line">        #endregion</span><br><span class="line"></span><br><span class="line">        #region 生成页眉页脚</span><br><span class="line"></span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// 关闭一个页面时发生  </span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        public override void OnEndPage(PdfWriter writer, Document document)</span><br><span class="line">        &#123;</span><br><span class="line">            if (PAGE_NUMBER)</span><br><span class="line">            &#123;</span><br><span class="line">                Font HeaderFooterFont = FontAndSize(HeaderFooterFontName, HeaderFooterFontSize, Font.NORMAL, HeaderFooterFontColor);</span><br><span class="line">                Phrase header_left = new Phrase(HeaderLeft, HeaderFooterFont);</span><br><span class="line">                Phrase header_right = new Phrase(HeaderRight, HeaderFooterFont);</span><br><span class="line"></span><br><span class="line">                Phrase footer_left = new Phrase(FooterLeft, HeaderFooterFont);</span><br><span class="line">                Phrase footer_center = new Phrase(&quot;第&quot; + (writer.PageNumber-1) + &quot;页/共     页&quot;, HeaderFooterFont);</span><br><span class="line">                Phrase footer_right = new Phrase(FooterRight, HeaderFooterFont);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                PdfContentByte cb = writer.DirectContent;</span><br><span class="line"></span><br><span class="line">                //模版 显示总共页数  </span><br><span class="line">                cb.AddTemplate(tpl, document.Right - 290 + document.LeftMargin, document.Bottom - 15);//调节模版显示的位置  </span><br><span class="line"></span><br><span class="line">                //页眉显示的位置  </span><br><span class="line">                ColumnText.ShowTextAligned(cb, Element.ALIGN_CENTER, header_right,</span><br><span class="line">                       document.Right - 50 + document.LeftMargin, document.Top + 15, 0);</span><br><span class="line"></span><br><span class="line">                ColumnText.ShowTextAligned(cb, Element.ALIGN_CENTER, header_left,</span><br><span class="line">                       document.Right - 500 + document.LeftMargin, document.Top + 15, 0);</span><br><span class="line"></span><br><span class="line">                //页脚显示的位置  </span><br><span class="line">                ColumnText.ShowTextAligned(cb, Element.ALIGN_CENTER, footer_left,</span><br><span class="line">                       document.Right - 535 + document.LeftMargin, document.Bottom - 15, 0);</span><br><span class="line"></span><br><span class="line">                ColumnText.ShowTextAligned(cb, Element.ALIGN_CENTER, footer_center,</span><br><span class="line">                       document.Right - 300 + document.LeftMargin, document.Bottom - 15, 0);</span><br><span class="line"></span><br><span class="line">                ColumnText.ShowTextAligned(cb, Element.ALIGN_CENTER, footer_right,</span><br><span class="line">                       document.Right - 80 + document.LeftMargin, document.Bottom - 15, 0);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// 打开一个新页面时发生 </span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        public override void OnStartPage(PdfWriter writer, Document document)</span><br><span class="line">        &#123;</span><br><span class="line">            if (PAGE_NUMBER)</span><br><span class="line">            &#123;</span><br><span class="line">                writer.PageCount = writer.PageNumber - 1;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// 关闭PDF文档时发生该事件</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        public override void OnCloseDocument(PdfWriter writer, Document document)</span><br><span class="line">        &#123;</span><br><span class="line">            BaseFont bf = BaseFontAndSize(HeaderFooterFontName);</span><br><span class="line">            tpl.BeginText();</span><br><span class="line">            tpl.SetFontAndSize(bf, HeaderFooterFontSize);</span><br><span class="line">            tpl.ShowText((writer.PageNumber - 1).ToString());//总页数 </span><br><span class="line">            tpl.EndText();</span><br><span class="line">            tpl.ClosePath();</span><br><span class="line">        &#125;</span><br><span class="line">        #endregion</span><br><span class="line"></span><br><span class="line">        #region 私有方法</span><br><span class="line"></span><br><span class="line">        private static Font FontAndSize(string font_name, int size, int style, BaseColor baseColor)</span><br><span class="line">        &#123;</span><br><span class="line">            BaseFont baseFont;</span><br><span class="line">            //BaseFont.AddToResourceSearch(&quot;iTextAsian.dll&quot;);</span><br><span class="line">            //BaseFont.AddToResourceSearch(&quot;iTextAsianCmaps.dll&quot;);</span><br><span class="line">            Font font = null;</span><br><span class="line">            string file_name = &quot;&quot;;</span><br><span class="line">            int fontStyle;</span><br><span class="line">            switch (font_name)</span><br><span class="line">            &#123;</span><br><span class="line">                case &quot;黑体&quot;:</span><br><span class="line">                    file_name = &quot;SIMHEI.TTF&quot;;</span><br><span class="line">                    break;</span><br><span class="line">                case &quot;华文中宋&quot;:</span><br><span class="line">                    file_name = &quot;STZHONGS.TTF&quot;;</span><br><span class="line">                    break;</span><br><span class="line">                case &quot;宋体&quot;:</span><br><span class="line">                    file_name = &quot;SIMYOU.TTF&quot;;</span><br><span class="line">                    break;</span><br><span class="line">                case &quot;宋体1&quot;:</span><br><span class="line">                    file_name = &quot;simsun.ttc&quot;;</span><br><span class="line">                    break;</span><br><span class="line">                default:</span><br><span class="line">                    file_name = &quot;SIMYOU.TTF&quot;;</span><br><span class="line">                    break;</span><br><span class="line">            &#125;</span><br><span class="line">            baseFont = BaseFont.CreateFont(@&quot;c:/windows/fonts/&quot; + file_name, BaseFont.IDENTITY_H, BaseFont.NOT_EMBEDDED);</span><br><span class="line"></span><br><span class="line">            if (style &lt; -1)</span><br><span class="line">            &#123;</span><br><span class="line">                fontStyle = Font.NORMAL;</span><br><span class="line">            &#125;</span><br><span class="line">            else</span><br><span class="line">            &#123;</span><br><span class="line">                fontStyle = style;</span><br><span class="line">            &#125;</span><br><span class="line">            font = new Font(baseFont, size, fontStyle, baseColor);</span><br><span class="line">            return font;</span><br><span class="line">        &#125;</span><br><span class="line">        private static BaseFont BaseFontAndSize(string font_name)</span><br><span class="line">        &#123;</span><br><span class="line">            BaseFont baseFont;</span><br><span class="line">            //BaseFont.AddToResourceSearch(&quot;iTextAsian.dll&quot;);</span><br><span class="line">            //BaseFont.AddToResourceSearch(&quot;iTextAsianCmaps.dll&quot;);</span><br><span class="line">            string file_name = &quot;&quot;;</span><br><span class="line">            switch (font_name)</span><br><span class="line">            &#123;</span><br><span class="line">                case &quot;黑体&quot;:</span><br><span class="line">                    file_name = &quot;SIMHEI.TTF&quot;;</span><br><span class="line">                    break;</span><br><span class="line">                case &quot;华文中宋&quot;:</span><br><span class="line">                    file_name = &quot;STZHONGS.TTF&quot;;</span><br><span class="line">                    break;</span><br><span class="line">                case &quot;宋体&quot;:</span><br><span class="line">                    file_name = &quot;SIMYOU.TTF&quot;;</span><br><span class="line">                    break;</span><br><span class="line">                default:</span><br><span class="line">                    file_name = &quot;SIMYOU.TTF&quot;;</span><br><span class="line">                    break;</span><br><span class="line">            &#125;</span><br><span class="line">            baseFont = BaseFont.CreateFont(@&quot;c:/windows/fonts/&quot; + file_name, BaseFont.IDENTITY_H, BaseFont.NOT_EMBEDDED);</span><br><span class="line">            return baseFont;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        #endregion</span><br><span class="line"></span><br><span class="line">        #region 添加段落</span><br><span class="line"></span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// 添加段落</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        /// &lt;param name=&quot;content&quot;&gt;内容&lt;/param&gt;</span><br><span class="line">        /// &lt;param name=&quot;Alignment&quot;&gt;对齐方式（1为居中，0为居左，2为居右）&lt;/param&gt;</span><br><span class="line">        /// &lt;param name=&quot;SpacingAfter&quot;&gt;段后空行数（0为默认值）&lt;/param&gt;</span><br><span class="line">        /// &lt;param name=&quot;SpacingBefore&quot;&gt;段前空行数（0为默认值）&lt;/param&gt;</span><br><span class="line">        /// &lt;param name=&quot;MultipliedLeading&quot;&gt;行间距（0为默认值）&lt;/param&gt;</span><br><span class="line">        public static Paragraph AddParagraph(string content, int Alignment, float SpacingAfter, float SpacingBefore, float MultipliedLeading)</span><br><span class="line">        &#123;</span><br><span class="line">            Paragraph pra = new Paragraph(content, font);</span><br><span class="line">            pra.Alignment = Alignment;</span><br><span class="line">            pra.SpacingAfter = SpacingAfter;</span><br><span class="line">            pra.SpacingBefore = SpacingBefore;</span><br><span class="line">            pra.MultipliedLeading = MultipliedLeading;</span><br><span class="line">            return pra;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public static Paragraph AddParagraph(string content, int Alignment, float MultipliedLeading)</span><br><span class="line">        &#123;</span><br><span class="line">            Paragraph pra = new Paragraph(content, font);</span><br><span class="line">            pra.Alignment = Alignment;</span><br><span class="line">            pra.MultipliedLeading = MultipliedLeading;</span><br><span class="line">            return pra;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public static void AddPhrase(PdfWriter writer, Document document, string content, float marginLift, float marginBottom)</span><br><span class="line">        &#123;</span><br><span class="line">            Phrase phrase = new Phrase(content, font);</span><br><span class="line"></span><br><span class="line">            PdfContentByte cb = writer.DirectContent;</span><br><span class="line">            ColumnText.ShowTextAligned(cb, Element.ALIGN_CENTER, phrase,</span><br><span class="line">                       marginLift + document.LeftMargin, marginBottom, 0);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        #endregion</span><br><span class="line"></span><br><span class="line">        #region 添加图片</span><br><span class="line">        /// &lt;summary&gt;</span><br><span class="line">        /// 添加图片</span><br><span class="line">        /// &lt;param name=&quot;Alignment&quot;&gt;对齐方式 (0/1/2)&lt;/param&gt;</span><br><span class="line">        /// &lt;param name=&quot;marginRight&quot;&gt;页边距&lt;/param&gt;</span><br><span class="line">        /// &lt;param name=&quot;marginBottom&quot;&gt;页边距&lt;/param&gt;</span><br><span class="line">        /// &lt;/summary&gt;</span><br><span class="line">        public static iTextSharp.text.Image AddImage(string path, int Alignment, float marginRight, float marginBottom)</span><br><span class="line">        &#123;</span><br><span class="line">            Image img = Image.GetInstance(new Uri(path));</span><br><span class="line">            img.Alignment = Alignment;</span><br><span class="line">            //等比缩放，宽与高的缩放系数哪个大就取哪一个（比如高的系数是0.8，宽的是0.7，则取0.7。这样图片就不会超出页面范围）</span><br><span class="line">            if (img.Width &gt; img.Height)</span><br><span class="line">            &#123;</span><br><span class="line">                //这里计算图片的缩放系数，因为图片width&gt;height,所以将图片旋转90度以适应页面，计算缩放系数的时候宽与高对调</span><br><span class="line">                float PageHeight = PageSize.A4.Height - marginBottom * 3;</span><br><span class="line">                double percentHeight = Math.Round((PageHeight / img.Width), 2);</span><br><span class="line"></span><br><span class="line">                float PageWidth = PageSize.A4.Width - marginRight * 2;</span><br><span class="line">                double percentWidth = Math.Round((PageWidth / img.Height), 2);</span><br><span class="line"></span><br><span class="line">                double percent = percentHeight &gt; percentWidth ? percentWidth : percentHeight;</span><br><span class="line">                img.ScalePercent((float)percent * 100);</span><br><span class="line">                img.RotationDegrees = 90f;</span><br><span class="line">            &#125;</span><br><span class="line">            else</span><br><span class="line">            &#123;</span><br><span class="line">                float PageHeight = PageSize.A4.Height - marginBottom * 3;</span><br><span class="line">                double percentHeight = Math.Round((PageHeight / img.Height), 2);</span><br><span class="line"></span><br><span class="line">                float PageWidth = PageSize.A4.Width - marginRight * 2;</span><br><span class="line">                double percentWidth = Math.Round((PageWidth / img.Width), 2);</span><br><span class="line"></span><br><span class="line">                double percent = percentHeight &gt; percentWidth ? percentWidth : percentHeight;</span><br><span class="line">                img.ScalePercent((float)percent * 100);</span><br><span class="line">            &#125;</span><br><span class="line">            return img;</span><br><span class="line">        &#125;</span><br><span class="line">        #endregion</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="主函数调用方式"><a href="#主函数调用方式" class="headerlink" title="主函数调用方式"></a>主函数调用方式</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">if (this.tbManagerName.Text.ToString() == &quot;&quot; || this.tbContact.Text.ToString() == &quot;&quot; || this.tbUnit.Text.ToString() == &quot;&quot;)</span><br><span class="line">            &#123;</span><br><span class="line">                MessageBox.Show(&quot;请输入项目负责人姓名,联系电话,承担单位&quot;);</span><br><span class="line">                return;</span><br><span class="line">            &#125;         </span><br><span class="line">            //ConstantInfo.outStatic();</span><br><span class="line">            FolderBrowserDialog dialog = new FolderBrowserDialog();</span><br><span class="line">            dialog.Description = &quot;请选择检查报告输出位置&quot;;</span><br><span class="line">            string outputFilePath = &quot;&quot;;</span><br><span class="line">            if (dialog.ShowDialog() == DialogResult.OK)</span><br><span class="line">            &#123;</span><br><span class="line">                outputFilePath = dialog.SelectedPath;</span><br><span class="line">                string managerName = this.tbManagerName.Text.ToString();</span><br><span class="line">                string contactNum = this.tbContact.Text.ToString();</span><br><span class="line">                string unitName = this.tbUnit.Text.ToString();                            </span><br><span class="line">                this.lbShowProcess.Text = &quot;正在准备统计数据...&quot;;</span><br><span class="line">                this.pbProgress.Visible = true;</span><br><span class="line">                statisticNum();</span><br><span class="line">                this.pbProgress.Position = 30; </span><br><span class="line">                this.lbShowProcess.Text = &quot;开始生成检查报告...&quot;;</span><br><span class="line">                //文字水印1</span><br><span class="line">                PdfUtils.GeneratePDF(resultDt, strPacName, isPassed, managerName, contactNum, unitName, outputFilePath, 1);</span><br><span class="line">                //水印2</span><br><span class="line">                // PdfUtils.GeneratePDF(resultDt, strPac,isPassed,outputFilePath, 2);</span><br><span class="line">                //图片水印 </span><br><span class="line">                // string picPath = string.Format(&quot;&#123;0&#125;/Resource/&#123;1&#125;&quot;, AppDomain.CurrentDomain.BaseDirectory,&quot;logo.png&quot;);</span><br><span class="line">                //PdfUtils.GeneratePDF(resultDt, strPac,isPassed,outputFilePath, 3,picPath);  </span><br><span class="line">                this.lbShowProcess.Text = &quot;检查报告导出完成&quot;;</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;C#使用开源第三方库itextsharp直接生成pdf,相较于Microsoft Office 的COM组件，不需要依赖office环境，程序兼容性好，更轻量。&lt;br&gt;但也存在一些不足，对于复杂模板的实现较为复杂，介绍一个使用实例&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="C#" scheme="http://11wy11.github.io/categories/C/"/>
    
    
      <category term="C#" scheme="http://11wy11.github.io/tags/C/"/>
    
      <category term="VS打包" scheme="http://11wy11.github.io/tags/VS%E6%89%93%E5%8C%85/"/>
    
  </entry>
  
  <entry>
    <title>C# Regex正则表达式</title>
    <link href="http://11wy11.github.io/2019/03/29/cplusplus-regex-note/"/>
    <id>http://11wy11.github.io/2019/03/29/cplusplus-regex-note/</id>
    <published>2019-03-29T12:30:30.000Z</published>
    <updated>2019-03-30T01:52:20.513Z</updated>
    
    <content type="html"><![CDATA[<p>正则表达式的本质是使用一系列特殊字符模式，来表示某一类字符串。<br><a id="more"></a></p><h1 id="Regex-正则表达式"><a href="#Regex-正则表达式" class="headerlink" title="Regex 正则表达式"></a>Regex 正则表达式</h1><p>正则表达式的本质是使用一系列特殊字符模式，来表示某一类字符串。正则表达式无疑是处理文本最有力的工具，而.NET提供的Regex类实现了验证正则表达式的方法。Regex 类表示不可变（只读）的正则表达式。它还包含各种静态方法，允许在不显式创建其他类的实例的情况下使用其他正则表达式类。</p><h1 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h1><table><thead><tr><th>代码</th><th>说明</th></tr></thead><tbody><tr><td>.</td><td>匹配除换行符以外的任意字符。</td></tr><tr><td>\w</td><td>匹配字母或数字或下划线或汉字。</td></tr><tr><td>\s</td><td>匹配任意的空白符。</td></tr><tr><td>\d</td><td>匹配数字。</td></tr><tr><td>\b</td><td>匹配单词的开始或结束。</td></tr><tr><td>[ck]</td><td>匹配包含括号内元素的字符</td></tr><tr><td>^</td><td>匹配行的开始。</td></tr><tr><td>$</td><td>匹配行的结束。</td></tr><tr><td>\</td><td>对下一个字符转义。比如$是个特殊的字符。要匹配$的话就得用\$</td></tr><tr><td>&#124;</td><td>分支条件，如：x&#124;  y匹配 x 或 y。</td></tr><tr><td>反义元字符</td><td></td></tr><tr><td>代码</td><td>说明</td></tr><tr><td>\W</td><td>匹配任意不是字母，数字，下划线，汉字的字符。</td></tr><tr><td>\S</td><td>匹配任意不是空白符的字符。等价于 [^ \f\n\r\t\v]。</td></tr><tr><td>\D</td><td>匹配任意非数字的字符。等价于 [^0-9]。</td></tr><tr><td>\B</td><td>匹配不是单词开头或结束的位置。</td></tr><tr><td>[^CK]</td><td>匹配除了CK以外的任意字符。</td></tr><tr><td></td><td></td></tr><tr><td>特殊元字符</td><td></td></tr><tr><td>代码</td><td>说明</td></tr><tr><td>\f</td><td>匹配一个换页符。等价于 \x0c 和 \cL。</td></tr><tr><td>\n</td><td>匹配一个换行符。等价于 \x0a 和 \cJ。</td></tr><tr><td>\r</td><td>匹配一个回车符。等价于 \x0d 和 \cM。</td></tr><tr><td>\t</td><td>匹配一个制表符。等价于 \x09 和 \cI。</td></tr><tr><td>\v</td><td>匹配一个垂直制表符。等价于 \x0b 和 \cK。</td></tr><tr><td>限定符</td><td></td></tr><tr><td>代码</td><td>说明</td></tr><tr><td>*</td><td>匹配前面的子表达式零次或多次。</td></tr><tr><td>+</td><td>匹配前面的子表达式一次或多次。</td></tr><tr><td>?</td><td>匹配前面的子表达式零次或一次。</td></tr><tr><td>{n}</td><td>n 是一个非负整数。匹配确定的 n 次。</td></tr><tr><td>{n,}</td><td>n 是一个非负整数。至少匹配n 次。</td></tr><tr><td>{n,m}</td><td>m 和 n 均为非负整数，其中n &lt;= m。最少匹配 n 次且最多匹配 m 次。</td></tr><tr><td></td><td></td></tr><tr><td>懒惰限定符</td><td></td></tr><tr><td>代码</td><td>说明</td></tr><tr><td>*?</td><td>重复任意次，但尽可能少重复。</td></tr><tr><td></td><td>如 “acbacb”  正则  “a.*?b” 只会取到第一个”acb” 原本可以全部取到但加了限定符后，只会匹配尽可能少的字符 ，而”acbacb”最少字符的结果就是”acb” 。</td></tr><tr><td>+?</td><td>重复1次或更多次，但尽可能少重复。与上面一样，只是至少要重复1次。</td></tr><tr><td>??</td><td>重复0次或1次，但尽可能少重复。</td></tr><tr><td></td><td>如 “aaacb” 正则 “a.??b” 只会取到最后的三个字符”acb”。</td></tr><tr><td>{n,m}?</td><td>重复n到m次，但尽可能少重复。</td></tr><tr><td></td><td>如 “aaaaaaaa”  正则 “a{0,m}” 因为最少是0次所以取到结果为空。</td></tr><tr><td>{n,}?</td><td>重复n次以上，但尽可能少重复。</td></tr><tr><td></td><td>如 “aaaaaaa”  正则 “a{1,}” 最少是1次所以取到结果为 “a”。</td></tr><tr><td></td><td></td></tr><tr><td>捕获分组</td><td></td></tr><tr><td>代码</td><td>说明</td></tr><tr><td>(exp)</td><td>匹配exp,并捕获文本到自动命名的组里。</td></tr><tr><td>(?<name>exp)</name></td><td>匹配exp,并捕获文本到名称为name的组里。</td></tr><tr><td>(?:exp)</td><td>匹配exp,不捕获匹配的文本，也不给此分组分配组号以下为零宽断言。</td></tr><tr><td>(?=exp)</td><td>匹配exp前面的位置。</td></tr><tr><td></td><td>如 “How are you doing” 正则”(?<txt>.+(?=ing))” 这里取ing前所有的字符，并定义了一个捕获分组名字为 “txt” 而”txt”这个组里的值为”How are you do”;</txt></td></tr><tr><td>(?&lt;=exp)</td><td>匹配exp后面的位置。</td></tr><tr><td></td><td>如 “How are you doing” 正则”(?<txt>(?&lt;=How).+)” 这里取”How”之后所有的字符，并定义了一个捕获分组名字为 “txt” 而”txt”这个组里的值为” are you doing”;</txt></td></tr><tr><td>(?!exp)</td><td>匹配后面跟的不是exp的位置。</td></tr><tr><td></td><td>如 “123abc” 正则 “\d{3}(?!\d)”匹配3位数字后非数字的结果</td></tr><tr><td>(?&lt;!exp)</td><td>匹配前面不是exp的位置。</td></tr><tr><td></td><td>如 “abc123 “ 正则 “(?&lt;![0-9])123” 匹配”123”前面是非数字的结果也可写成”(?!&lt;\d)123”</td></tr></tbody></table><h1 id="数字常用表达式"><a href="#数字常用表达式" class="headerlink" title="数字常用表达式"></a>数字常用表达式</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">//数字</span><br><span class="line">    Regex reg = new Regex(@&quot;^[0-9]*$&quot;);</span><br><span class="line">    //n位的数字</span><br><span class="line">    Regex reg = new Regex(@&quot;^\d&#123;n&#125;$&quot;);</span><br><span class="line">    //至少n位的数字</span><br><span class="line">    Regex reg = new Regex(@&quot;^\d&#123;n,&#125;$&quot;);</span><br><span class="line">    //m-n位的数字</span><br><span class="line">    Regex reg = new Regex(@&quot;^\d&#123;m,n&#125;$&quot;);</span><br><span class="line">    //零和非零开头的数字</span><br><span class="line">    Regex reg = new Regex(@&quot;^(0|[1-9][0-9]*)$&quot;);</span><br><span class="line">    //非零开头的最多带两位小数的数字</span><br><span class="line">    Regex reg = new Regex(@&quot;^([1-9][0-9]*)+(.[0-9]&#123;1,2&#125;)?$&quot;);</span><br><span class="line">    //带1-2位小数的正数或负数</span><br><span class="line">    Regex reg = new Regex(@&quot;^(\-)?\d+(\.\d&#123;1,2&#125;)?$&quot;);</span><br><span class="line">    //正数、负数、和小数</span><br><span class="line">    Regex reg = new Regex(@&quot;^(\-|\+)?\d+(\.\d+)?$&quot;);</span><br><span class="line">    //有两位小数的正实数</span><br><span class="line">    Regex reg = new Regex(@&quot;^[0-9]+(.[0-9]&#123;2&#125;)?$&quot;);</span><br><span class="line">    //有1~3位小数的正实数</span><br><span class="line">    Regex reg = new Regex(@&quot;^[0-9]+(.[0-9]&#123;1,3&#125;)?$&quot;);</span><br><span class="line">    //非零的正整数</span><br><span class="line">    Regex reg = new Regex(@&quot;^[1-9]\d*$ 或 ^([1-9][0-9]*)&#123;1,3&#125;$ 或 ^\+?[1-9][0-9]*$&quot;);</span><br><span class="line">    //非零的负整数</span><br><span class="line">    Regex reg = new Regex(@&quot;^\-[1-9][]0-9″*$ 或 ^-[1-9]\d*$&quot;);</span><br><span class="line">    //非负整数</span><br><span class="line">    Regex reg = new Regex(@&quot;^\d+$ 或 ^[1-9]\d*|0$&quot;);</span><br><span class="line">    //非正整数</span><br><span class="line">    Regex reg = new Regex(@&quot;^-[1-9]\d*|0$ 或 ^((-\d+)|(0+))$&quot;);</span><br><span class="line">    //非负浮点数</span><br><span class="line">    Regex reg = new Regex(@&quot;^\d+(\.\d+)?$ 或 ^[1-9]\d*\.\d*|0\.\d*[1-9]\d*|0?\.0+|0$&quot;);</span><br><span class="line">    //非正浮点数</span><br><span class="line">    Regex reg = new Regex(@&quot;^((-\d+(\.\d+)?)|(0+(\.0+)?))$ 或 ^(-([1-9]\d*\.\d*|0\.\d*[1-9]\d*))|0?\.0+|0$&quot;);</span><br><span class="line">    //正浮点数</span><br><span class="line">    Regex reg = new Regex(@&quot;^[1-9]\d*\.\d*|0\.\d*[1-9]\d*$ 或 ^(([0-9]+\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\.[0-9]+)|([0-9]*[1-9][0-9]*))$&quot;);</span><br><span class="line">    //负浮点数</span><br><span class="line">    Regex reg = new Regex(@&quot;^-([1-9]\d*\.\d*|0\.\d*[1-9]\d*)$ 或 ^(-(([0-9]+\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\.[0-9]+)|([0-9]*[1-9][0-9]*)))$&quot;);</span><br><span class="line">    //浮点数</span><br><span class="line">    Regex reg = new Regex(@&quot;^(-?\d+)(\.\d+)?$ 或 ^-?([1-9]\d*\.\d*|0\.\d*[1-9]\d*|0?\.0+|0)$&quot;);</span><br></pre></td></tr></table></figure><h1 id="字符"><a href="#字符" class="headerlink" title="字符"></a>字符</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">//汉字</span><br><span class="line">    Regex reg = new Regex(@&quot;^[\u4e00-\u9fa5]&#123;0,&#125;$&quot;);</span><br><span class="line">    //英文和数字</span><br><span class="line">    Regex reg = new Regex(@&quot;^[A-Za-z0-9]+$ 或 ^[A-Za-z0-9]&#123;4,40&#125;$&quot;);</span><br><span class="line">    //长度为3-20的所有字符</span><br><span class="line">    Regex reg = new Regex(@&quot;^.&#123;3,20&#125;$&quot;);</span><br><span class="line">    //由26个英文字母组成的字符串</span><br><span class="line">    Regex reg = new Regex(@&quot;^[A-Za-z]+$&quot;);</span><br><span class="line">    //由26个大写英文字母组成的字符串</span><br><span class="line">    Regex reg = new Regex(@&quot;^[A-Z]+$&quot;);</span><br><span class="line">    //由26个小写英文字母组成的字符串</span><br><span class="line">    Regex reg = new Regex(@&quot;^[a-z]+$&quot;);</span><br><span class="line">    //由数字和26个英文字母组成的字符串</span><br><span class="line">    Regex reg = new Regex(@&quot;^[A-Za-z0-9]+$&quot;);</span><br><span class="line">    //由数字、26个英文字母或者下划线组成的字符串</span><br><span class="line">    Regex reg = new Regex(@&quot;^\w+$ 或 ^\w&#123;3,20&#125;$&quot;);</span><br><span class="line">    //中文、英文、数字包括下划线</span><br><span class="line">    Regex reg = new Regex(@&quot;^[\u4E00-\u9FA5A-Za-z0-9_]+$&quot;);</span><br><span class="line">    //中文、英文、数字但不包括下划线等符号</span><br><span class="line">    Regex reg = new Regex(@&quot;^[\u4E00-\u9FA5A-Za-z0-9]+$ 或 ^[\u4E00-\u9FA5A-Za-z0-9]&#123;2,20&#125;$&quot;);</span><br><span class="line">    //可以输入含有^%&amp;’,;=?$\”等字符</span><br><span class="line">    Regex reg = new Regex(@&quot;[^%&amp;’,;=?$\x22]+&quot;);</span><br><span class="line">    //禁止输入含有~的字符</span><br><span class="line">    Regex reg = new Regex(@&quot;[^~\x22]+&quot;);</span><br></pre></td></tr></table></figure><h1 id="其他表达式"><a href="#其他表达式" class="headerlink" title="其他表达式"></a>其他表达式</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">//Email地址</span><br><span class="line">    Regex reg = new Regex(@&quot;^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$&quot;);</span><br><span class="line">    //域名</span><br><span class="line">    Regex reg = new Regex(@&quot;[a-zA-Z0-9][-a-zA-Z0-9]&#123;0,62&#125;(/.[a-zA-Z0-9][-a-zA-Z0-9]&#123;0,62&#125;)+/.?&quot;);</span><br><span class="line">    //InternetURL</span><br><span class="line">    Regex reg = new Regex(@&quot;[a-zA-z]+://[^\s]* 或 ^http://([\w-]+\.)+[\w-]+(/[\w-./?%&amp;=]*)?$&quot;);</span><br><span class="line">    //手机号码</span><br><span class="line">    Regex reg = new Regex(@&quot;^(13[0-9]|14[5|7]|15[0|1|2|3|5|6|7|8|9]|18[0|1|2|3|5|6|7|8|9])\d&#123;8&#125;$&quot;);</span><br><span class="line">    //电话号码(“XXX-XXXXXXX”、”XXXX-XXXXXXXX”、”XXX-XXXXXXX”、”XXX-XXXXXXXX”、”XXXXXXX”和”XXXXXXXX)</span><br><span class="line">    Regex reg = new Regex(@&quot;^($$\d&#123;3,4&#125;-)|\d&#123;3.4&#125;-)?\d&#123;7,8&#125;$&quot;);</span><br><span class="line">    //国内电话号码(0511-4405222、021-87888822)</span><br><span class="line">    Regex reg = new Regex(@&quot;\d&#123;3&#125;-\d&#123;8&#125;|\d&#123;4&#125;-\d&#123;7&#125;&quot;);</span><br><span class="line">    //身份证号(15位、18位数字)</span><br><span class="line">    Regex reg = new Regex(@&quot;^\d&#123;15&#125;|\d&#123;18&#125;$&quot;);</span><br><span class="line">    //短身份证号码(数字、字母x结尾)</span><br><span class="line">    Regex reg = new Regex(@&quot;^([0-9])&#123;7,18&#125;(x|X)?$ 或 ^\d&#123;8,18&#125;|[0-9x]&#123;8,18&#125;|[0-9X]&#123;8,18&#125;?$&quot;);</span><br><span class="line">    //帐号是否合法(字母开头，允许5-16字节，允许字母数字下划线)</span><br><span class="line">    Regex reg = new Regex(@&quot;^[a-zA-Z][a-zA-Z0-9_]&#123;4,15&#125;$&quot;);</span><br><span class="line">    //密码(以字母开头，长度在6~18之间，只能包含字母、数字和下划线)</span><br><span class="line">    Regex reg = new Regex(@&quot;^[a-zA-Z]\w&#123;5,17&#125;$&quot;);</span><br><span class="line">    //强密码(必须包含大小写字母和数字的组合，不能使用特殊字符，长度在8-10之间)</span><br><span class="line">    Regex reg = new Regex(@&quot;^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).&#123;8,10&#125;$&quot;);</span><br><span class="line">    //日期格式</span><br><span class="line">    Regex reg = new Regex(@&quot;^\d&#123;4&#125;-\d&#123;1,2&#125;-\d&#123;1,2&#125;&quot;);</span><br><span class="line">    //一年的12个月(01～09和1～12)</span><br><span class="line">    Regex reg = new Regex(@&quot;^(0?[1-9]|1[0-2])$&quot;);</span><br><span class="line">    //一个月的31天(01～09和1～31)</span><br><span class="line">    Regex reg = new Regex(@&quot;^((0?[1-9])|((1|2)[0-9])|30|31)$&quot;);</span><br><span class="line">    //钱的输入格式：</span><br><span class="line">    //有四种钱的表示形式我们可以接受:”10000.00″ 和 “10,000.00”, 和没有 “分” 的 “10000” 和 “10,000”</span><br><span class="line">    Regex reg = new Regex(@&quot;^[1-9][0-9]*$&quot;);</span><br><span class="line">    //这表示任意一个不以0开头的数字，但是，这也意味着一个字符”0″不通过，所以我们采用下面的形式</span><br><span class="line">    Regex reg = new Regex(@&quot;^(0|[1-9][0-9]*)$&quot;);</span><br><span class="line">    //一个0或者一个不以0开头的数字.我们还可以允许开头有一个负号</span><br><span class="line">    Regex reg = new Regex(@&quot;^(0|-?[1-9][0-9]*)$&quot;);</span><br><span class="line">    //这表示一个0或者一个可能为负的开头不为0的数字.让用户以0开头好了.把负号的也去掉，因为钱总不能是负的吧.下面我们要加的是说明可能的小数部分</span><br><span class="line">    Regex reg = new Regex(@&quot;^[0-9]+(.[0-9]+)?$&quot;);</span><br><span class="line">    //必须说明的是，小数点后面至少应该有1位数，所以”10.”是不通过的，但是 “10” 和 “10.2” 是通过的</span><br><span class="line">    Regex reg = new Regex(@&quot;^[0-9]+(.[0-9]&#123;2&#125;)?$&quot;);</span><br><span class="line">    //这样我们规定小数点后面必须有两位，如果你认为太苛刻了，可以这样</span><br><span class="line">    Regex reg = new Regex(@&quot;^[0-9]+(.[0-9]&#123;1,2&#125;)?$&quot;);</span><br><span class="line">    //这样就允许用户只写一位小数。下面我们该考虑数字中的逗号了，我们可以这样</span><br><span class="line">    Regex reg = new Regex(@&quot;^[0-9]&#123;1,3&#125;(,[0-9]&#123;3&#125;)*(.[0-9]&#123;1,2&#125;)?$&quot;);</span><br><span class="line">    //1到3个数字，后面跟着任意个 逗号+3个数字，逗号成为可选，而不是必须</span><br><span class="line">    Regex reg = new Regex(@&quot;^([0-9]+|[0-9]&#123;1,3&#125;(,[0-9]&#123;3&#125;)*)(.[0-9]&#123;1,2&#125;)?$&quot;);</span><br><span class="line">    //备注：这就是最终结果了，别忘了”+”可以用”*”替代。如果你觉得空字符串也可以接受的话(奇怪，为什么?)最后，别忘了在用函数时去掉去掉那个反斜杠，一般的错误都在这里</span><br><span class="line">    //xml文件</span><br><span class="line">    Regex reg = new Regex(@&quot;^([a-zA-Z]+-?)+[a-zA-Z0-9]+\\.[x|X][m|M][l|L]$&quot;);</span><br><span class="line">    //中文字符的正则表达式</span><br><span class="line">    Regex reg = new Regex(@&quot;[\u4e00-\u9fa5]&quot;);</span><br><span class="line">    //双字节字符</span><br><span class="line">    Regex reg = new Regex(@&quot;[^\x00-\xff] (包括汉字在内，可以用来计算字符串的长度(一个双字节字符长度计2，ASCII字符计1))&quot;);</span><br><span class="line">    //空白行的正则表达式，可用来删除空白行</span><br><span class="line">    Regex reg = new Regex(@&quot;\n\s*\r&quot;);</span><br><span class="line">    //HTML标记的正则表达式</span><br><span class="line">    Regex reg = new Regex(@&quot;&lt;(\S*?)[^&gt;]*&gt;.*?&lt;/\1&gt;|&lt;.*? /&gt;&quot;);// (网上流传的版本太糟糕，上面这个也仅仅能部分，对于复杂的嵌套标记依旧无能为力)</span><br><span class="line">    //首尾空白字符的正则表达式</span><br><span class="line">    Regex reg = new Regex(@&quot;^\s*|\s*$或(^\s*)|(\s*$)&quot;);// (可以用来删除行首行尾的空白字符(包括空格、制表符、换页符等等)，非常有用的表达式)</span><br><span class="line">    //腾讯QQ号</span><br><span class="line">    Regex reg = new Regex(@&quot;[1-9][0-9]&#123;4,&#125;&quot;); //(腾讯QQ号从10000开始)</span><br><span class="line">    //中国邮政编码</span><br><span class="line">    Regex reg = new Regex(@&quot;[1-9]\d&#123;5&#125;(?!\d)&quot;);// (中国邮政编码为6位数字)</span><br><span class="line">    //IP地址</span><br><span class="line">    Regex reg = new Regex(@&quot;\d+\.\d+\.\d+\.\d+&quot;);// (提取IP地址时有用)</span><br><span class="line">    //IP地址</span><br><span class="line">    Regex reg = new Regex(@&quot;((?:(?:25[0-5]|2[0-4]\\d|[01]?\\d?\\d)\\.)&#123;3&#125;(?:25[0-5]|2[0-4]\\d|[01]?\\d?\\d))&quot;);</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;正则表达式的本质是使用一系列特殊字符模式，来表示某一类字符串。&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="C#" scheme="http://11wy11.github.io/categories/C/"/>
    
    
      <category term="C#" scheme="http://11wy11.github.io/tags/C/"/>
    
      <category term="Regex" scheme="http://11wy11.github.io/tags/Regex/"/>
    
  </entry>
  
  <entry>
    <title>ai组件开发--虚线定义原理及编程实现</title>
    <link href="http://11wy11.github.io/2019/03/25/ai-dash-line-note/"/>
    <id>http://11wy11.github.io/2019/03/25/ai-dash-line-note/</id>
    <published>2019-03-25T07:41:27.000Z</published>
    <updated>2019-03-25T10:57:50.309Z</updated>
    
    <content type="html"><![CDATA[<p>illustrator中定义虚线形式可以最多设置三个虚线长度和三个间隙长度<br><a id="more"></a></p><h1 id="虚线定义"><a href="#虚线定义" class="headerlink" title="虚线定义"></a>虚线定义</h1><p>illustrator中定义虚线形式可以最多设置三个虚线长度和三个间隙长度<br>__需要特别注意如果定义奇数个参数，即没有定义spaceA，spaceB，spaceC时的情况,其中spaceB和spaceC的循环情况原理一致<br>依次标记为dashA,spaceA,dashB,spaceB,dashC,spaceC<br>为更明显的展示，定义：<br>dashA: 3<br>spaceA: 5</p><p>dashB: 4<br>spaceB:6</p><p>dashC: 2<br>spaceC: 1<br>虚线：—表示一个pt<br>间隙：#表示一个pt<br>结果形式：展示两次循环，每次循环间为区分明显添加了一个空格<br>下面简单介绍定义规则</p><ol><li>设置dashA，其他值为空<br>一次循环：此时按照dashA的长度绘制实部，此时，illustrator默认spaceA=dashA，因此间隙也是dashA的长度<br>结果形式:———### ———###  </li><li>设置dashA，spaceA,其他值为空<br>一次循环：此时按照dashA的长度绘制实部，间隙是spaceA的长度<br>结果形式:———##### ———#####</li><li>设置dashA，spaceA,dashB,其他值为空，<strong>需注意</strong><br>一次循环：此时按照dashA的长度绘制第一个实部，间隙是spaceA的长度,按照dashB的长度绘制第二个实部，按照dashA绘制间隙，按照spaceA绘制第三个实部，按照dashB绘制间隙<br>结果形式:———#####————####—————#### ———#####————####—————####</li><li>设置dashA，spaceA,dashB,spaceB,其他值为空<br> 一次循环：此时按照dashA的长度绘制第一个实部，间隙是spaceA的长度,按照dashB的长度绘制第二个实部，间隙是spaceB的长度,<br> 结果形式:———#####————###### ———#####————######</li><li>设置dashA，spaceA,dashB,spaceB,dashC,其他值为空<br> 一次循环：此时按照dashA的长度绘制第一个实部，间隙是spaceA的长度,按照dashB的长度绘制第二个实部，间隙是spaceB的长度,按照dashC的长度绘制第三个实部,间隙是spaceC的长度，按照dashA绘制间隙，按照spaceA绘制第四个实部，按照dashB绘制间隙，按照spaceB绘制第五个实部，按照dashC绘制间隙,按照spaceC绘制第六个实部<br> 结果形式:———#####————######——###—————####——————## ———#####————######——###—————####——————##</li><li>设置dashA，spaceA,dashB,spaceB,dashC,spaceC<br> 原理同4一致，不再赘述</li></ol><p><strong>概括来说，AI本身每次循环使用六个参数定义虚线，如果不足就会重复前面定义的参数</strong></p><h1 id="illustrator-SDK接口实现"><a href="#illustrator-SDK接口实现" class="headerlink" title="illustrator SDK接口实现"></a>illustrator SDK接口实现</h1>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;illustrator中定义虚线形式可以最多设置三个虚线长度和三个间隙长度&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="AI组件开发" scheme="http://11wy11.github.io/categories/AI%E7%BB%84%E4%BB%B6%E5%BC%80%E5%8F%91/"/>
    
    
      <category term="AI" scheme="http://11wy11.github.io/tags/AI/"/>
    
  </entry>
  
  <entry>
    <title>AI组件开发（八）--AIArtStyleSuite</title>
    <link href="http://11wy11.github.io/2019/03/25/ai-eight-style-note/"/>
    <id>http://11wy11.github.io/2019/03/25/ai-eight-style-note/</id>
    <published>2019-03-25T01:46:16.000Z</published>
    <updated>2019-03-25T09:12:22.322Z</updated>
    
    <content type="html"><![CDATA[<p>Art Style套件中的功能用于访问和修改Illustrator文档中图稿的art样式<br><a id="more"></a><br><!-- START doctoc generated TOC please keep comment here to allow auto update --><br><!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE --><br><strong>Table of Contents</strong>  <em>generated with <a href="https://github.com/thlorenz/doctoc" target="_blank" rel="noopener">DocToc</a></em></p><ul><li><a href="#aiartstylesuite">AIArtStyleSuite</a><ul><li><a href="#%E6%96%B9%E6%B3%95">方法</a></li></ul></li><li><a href="#%E7%9B%B8%E5%85%B3%E7%B1%BB%E7%BB%93%E6%9E%84%E4%BD%93%E6%8C%87%E9%92%88">相关类，结构体，指针</a><ul><li><a href="#aiarthandle">AIArtHandle</a></li><li><a href="#aiartstylehandle">AIArtStyleHandle</a></li><li><a href="#aipathstyle">AIPathStyle</a></li><li><a href="#aistrokestyle">AIStrokeStyle</a></li><li><a href="#aifillstyle">AIFillStyle</a></li></ul></li><li><a href="#%E4%BD%BF%E7%94%A8%E5%AE%9E%E4%BE%8B">使用实例</a></li></ul><!-- END doctoc generated TOC please keep comment here to allow auto update --><h1 id="AIArtStyleSuite"><a href="#AIArtStyleSuite" class="headerlink" title="AIArtStyleSuite"></a>AIArtStyleSuite</h1><p>Art Style套件中的功能用于访问和修改Illustrator文档中图稿的art样式<br>在AI8中，Illustrator引入了插件组的概念，其中实际打印的art（结果art）与用户编辑的art（编辑art）分开。随着art风格的引入，这一概念在AI9中得到了扩展。现在，文档中的任何art对象（包括组和文本对象）都可以选择附加“样式art”。正是这种“风格art”得到了印刷，而不是原始的“源art”。</p><p>应用于art的art风格控制着风格art的生成方式。插件不应该直接修改样式art本身，可以随时重新生成，但应该使用art风格。</p><p>导出插件应导出应用于对象的样式化art（如果有），而不是原始源art。</p><p>在UI中，应用于Illustratorart对象的art风格称为对象的外观，并通过“外观”调板进行操作。外观也可以通过“图形样式”调板保存并在其他对象上重复使用。</p><p>使用SPBasicSuite::AcquireSuite()常量kAIArtStyleSuite和使用获取此套件kAIArtStyleVersion。</p><h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2><ul><li>AIAPI AIErr（*     GetStyledArt）（AIArtHandle art，AIArtHandle * styledArt）<br>   获得art对象的样式。<br>   返回 styleArt [out]用于返回样式化art对象的缓冲区，如果没有应用特殊样式，则返回原始art对象。NULL出错时返回; 例如，如果由于内存限制而无法执行动态效果。</li><li>AIAPI AIErr（*     GetArtStyle）（AIArtHandle art，AIArtStyleHandle * artStyle）<br>   获得与art对象关联的art风格。 </li><li>AIAPI AIErr（*     GetCurrentArtStyle）（AIArtStyleHandle * artStyle，AIBoolean * mixedState）<br>   获得“外观”调板中当前显示的art样式。<br>   artStyle     [out]用于返回art风格参考的缓冲区。<br>  mixedState     [out]如果Appearance调色板显示“Mixed”，则返回true的缓冲区。在这种情况下，返回的art风格是一种简单的风格，它试图收集附加到当前文档中当前所选对象的art风格的公共属性。</li><li>AIAPI AIErr（*     GetArtStyleByName）（AIArtStyleHandle * artStyle，const ai :: UnicodeString＆name，AIBoolean searchAllStyles）<br>   从当前文档中按唯一名称获得art样式。 </li><li>AIAPI AIErr（*     CountNamedArtStyles）（ai :: int32 * count）<br>   获取“图形样式”调板中当前列出的art样式的数量。 </li><li>AIAPI AIErr（*     GetNthNamedArtStyle）（ai :: int32 n，AIArtStyleHandle * artStyle）<br>   按索引获得命名的art样式。 </li><li>AIAPI AIErr（*     SetArtStyle）（AIArtHandle art，AIArtStyleHandle artStyle）<br>   将art样式应用于ar品。 </li><li>AIAPI AIErr（*     SetCurrentArtStyle）（AIArtStyleHandle artStyle）<br>   将art样式应用于画板上当前目标对象。 </li><li>AIAPI AIErr（*     GetArtStyleName）（AIArtStyleHandle artStyle，ai :: UnicodeString＆name，AIBoolean * isAnonymous）<br>   获得art样式的唯一名称。 </li><li>AIAPI AIErr（*     SetArtStyleName）（AIArtStyleHandle artStyle，const ai :: UnicodeString＆name）<br>   设置命名art样式的唯一名称; 也就是说，在“图形样式”调板中显示的那个。 </li><li>AIAPI AIErr（*     GetPaintAttributes）（AIArtStyleHandle artStyle，AIPathStyle * aiPathStyle，AIArtStylePaintData * paintData）<br>   获得art样式的绘画信息。 </li><li>AIAPI AIErr（*     NewStyle）（AIPathStyle * aiPathStyle，AIArtStylePaintData * paintData，AIDictionaryRef blendDict，AIArtStyleHandle * newStyle）<br>   创造一种新的art风格。 </li><li>AIAPI AIErr（*     AddNamedStyle）（AIArtStyleHandle artStyle，const ai :: UnicodeString＆name，AIBoolean uniquify，AIArtStyleHandle * namedStyle）<br>   将匿名样式转换为命名样式，该样式显示在“图形样式”调板中。 </li><li>AIAPI AIErr（*     RemoveNamedStyle）（AIArtStyleHandle namedStyle，AIArtStyleHandle * anonStyle）<br>   将命名样式（在“图形样式”调板中显示）转换为匿名样式，</li><li>AIAPI AIErr（*     CreateAnonymousStyle）（AIArtStyleHandle namedStyle，AIArtStyleHandle * anonStyle）<br>   创建命名art样式的匿名副本（显示在“图形样式”调板中）。 </li><li>AIAPI AIErr（*     RedefineNamedStyle）（AIArtStyleHandle namedStyle，AIArtStyleHandle dstStyle）<br>   重新定义命名的art样式以具有与另一样式相同的特征。 </li><li>AIAPI AIErr（*     MoveNamedStyle）（AIArtStyleHandle namedStyle，ai :: int32 index）<br>   将命名的art样式移动到“图形样式”调板中的位置。 </li><li>AIAPI AIErr（*     GetArtStyleByNameFromDocument）（AIArtStyleHandle * artStyle，const ai :: UnicodeString＆name，AIDocumentHandle document）<br>   通过指定文档中的唯一名称获得命名的art样式。 </li><li>AIAPI AIErr（*     CountNamedArtStylesFromDocument）（ai :: int32 * count，AIDocumentHandle document）<br>   获取指定文档中命名的art样式的数量（当该文档是最新的时，在“图形样式”调板中显示的样式）。 </li><li>AIAPI AIErr（*     GetNthNamedArtStyleFromDocument）（ai :: int32 n，AIArtStyleHandle * artStyle，AIDocumentHandle document）<br>   按索引获得指定文档的命名art样式。 </li><li>AIAPI AIErr（*     当量）（AIArtStyleHandle artStyle1，AIArtStyleHandle artStyle2，AIBoolean *结果）<br>   测试两种art风格之间的等价性。 </li><li>AIAPI AIErr（*     SortNamedStyles）（void）<br>   按名称按字母顺序对当前文档中的命名art样式进行排序。 </li><li>AIAPI AIErr（*     GetDefaultArtStyle）（AIArtStyleHandle * artStyle）<br>   获得当前文档的默认art样式，该样式始终首先列在“图形样式”调板中。 </li><li>AIAPI AIErr（*     GetDefaultArtStyleName）（ai :: UnicodeString＆name）<br>   获得当前文档的默认art样式的名称，该名称始终首先列在“图形样式”调板中。 </li><li>AIAPI AIBoolean（*     ValidateArtStyle）（AIArtStyleHandle artStyle）<br>   报告当前文档中是否存在artstyle。 </li><li>AIAPI AIErr（*     FlattenStyle）（AIArtHandle art）<br>   扩展art的风格，将art品替换为可返回的GetStyledArt()。 </li><li>AIAPI AIErr（*     GetArtStyleType）（AIArtStyleHandle artStyle，ai :: int16 * type）<br>   获得art风格的类型。 </li><li>AIAPI AIBoolean（*     CanExecute）（AIArtStyleHandle artStyle）<br>   报告art风格是否包含执行所需的所有部分。 </li><li><p>AIAPI AIReal（*     GetArtStyleScaleFactor）（AIArtHandle art）<br>   返回art对象样式的比例因子。<br>   “缩放笔触和效果”选项允许缩放笔画粗细和附加到art对象的效果。缩放因子与art对象一起存储，并且在应用样式后应用。例如，如果附加到对象的样式具有权重为2 pt的笔划，并且对象的比例因子为2.5，则视觉笔触权重为5 pt。<br> 注意：<br> GetPaintAttributes()获取未缩放的参数值，以及来自的函数AIArtStyleParserSuite。<br> 但是，AIPathStyleSuite调用返回附加到对象的缩放笔画粗细。<br> 参数：art<br> 返回：<br> 比例因子。  </p></li><li><p>AIAPI AIErr（*     SetArtStyleScaleFactor）（AIArtHandle art，AIReal scaleFactor）<br>   设置art对象样式的比例因子。 </p></li><li>AIAPI AIErr（*     ResetArtStyleScaleFactor）（AIArtHandle art）<br>   将新样式应用于按对象的当前比例因子缩放的art对象，并将对象的比例因子重置为1。 </li><li>AIAPI AIErr（*     TransformObjectArtStyle）（AIArtHandle art，AIRealMatrix * matrix，AIReal lineScale，ai :: int32 flags）<br>   改变对象的art风格。<br>   参数：<br>   art 需要变换的art对象<br>  matrix     指向转换矩阵的指针。<br>  lineScale     要应用于art对象当前样式中指定的线条绘制样式值的比例因子。<br>  flags     控制转换执行方式的位标志。AITransformArtOptions值的逻辑OR 。如果kTransformObjects标志打开，则假设art对象本身也已经被相同的矩阵变换，并且已经执行了点，后代art等的任何变换。这允许立即调整梯度向量和依赖于对象边界的其他样式属性，而不是延迟到art同步。</li><li>AIAPI AIArtStyleHasAttrs（*     ExamineStyle）（AIArtStyleHandle artStyle，AIArtStyleHasAttrs checkFor）<br>   检查特定属性的art风格，并返回找到的属性。 </li><li>AIAPI AIErr（*     GetToolArtStyle）（AIArtStyleHandle * artStyle）<br>   根据应用程序首选项获得将用于工具创建的新art的artstyle。 </li><li>AIAPI AIErr（*     GetFlattenedArt）（AIArtHandle art，AIArtHandle * flattenedArt）<br>   扩展ar的风格，将art替换为可返回的art GetStyledArt()。 </li><li>AIAPI AIBoolean（*     HasEffectiveNullStyle）（AIArtHandle art）<br>   报告art对象是否具有等效于null样式的样式。 </li><li>AIAPI AIErr（*     GetPaintMap）（AIArtStyleHandle artStyle，AIPathStyleMap * aiPathStyleMap）<br>   获得art样式的路径样式的地图，如下所示GetPaintAttributes()。 </li></ul><h1 id="相关类，结构体，指针"><a href="#相关类，结构体，指针" class="headerlink" title="相关类，结构体，指针"></a>相关类，结构体，指针</h1><h2 id="AIArtHandle"><a href="#AIArtHandle" class="headerlink" title="AIArtHandle"></a>AIArtHandle</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">typedef struct ArtObject* AIArtHandle</span><br><span class="line">Opaque reference to an art object.</span><br><span class="line">Access using AIArtSuite.</span><br></pre></td></tr></table></figure><h2 id="AIArtStyleHandle"><a href="#AIArtStyleHandle" class="headerlink" title="AIArtStyleHandle"></a>AIArtStyleHandle</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">typedef struct _t_AIArtStyle* AIArtStyleHandle</span><br><span class="line">A reference to an art style.</span><br><span class="line">See also:</span><br><span class="line">AIArtStyleSuite.</span><br></pre></td></tr></table></figure><h2 id="AIPathStyle"><a href="#AIPathStyle" class="headerlink" title="AIPathStyle"></a>AIPathStyle</h2><p>描述如何绘制路径的填充和描边。</p><p>完整样式完全指定绘画信息。<br>一个部分款式可以指定的绘画信息的子集。例如，它可用于表示选择的常见绘制属性，或修改属性的子集而不影响其他属性。在这种情况下，路径样式与样式映射配对，AIPathStyleMap指定具有有效值的属性子集。<br>注意不要将部分样式传递给需要完整样式的函数; 未指定的字段可以包含无效值。  </p><ul><li>AIBoolean     fillPaint<br>   Whether or not to fill the path.   </li><li>AIBoolean     strokePaint<br>   Whether or not to stroke the path.   </li><li>struct AIFillStyle     fill<br>   Fill style, if fillPaint is true.   </li><li>struct AIStrokeStyle     stroke<br>   Stroke style, if strokePaint is true.    </li><li>AIBoolean     clip  </li><li>AIBoolean     lockClip  </li><li>AIBoolean     evenodd<br>   When true, use the even-odd rule to determine path insideness.   </li><li>AIReal     resolution<br>   Path’s resolution.   <h2 id="AIStrokeStyle"><a href="#AIStrokeStyle" class="headerlink" title="AIStrokeStyle"></a>AIStrokeStyle</h2></li><li>AIColor     color<br>   Stroke color.   </li><li>AIBoolean     overprint<br>   Overprint - not meaningful if the color is a pattern.   </li><li>AIReal     width<br>   Line width in points.   </li><li>struct AIDashStyle     dash<br>   Stroke dash.   </li><li><p>enum AILineCap     cap<br>   Line cap.</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Types of line caps for strokes.</span><br><span class="line">    Enumerator:</span><br><span class="line">    kAIButtCap </span><br><span class="line">    Butt line caps.//平头</span><br><span class="line">    </span><br><span class="line">    kAIRoundCap </span><br><span class="line">    Round line caps.//圆头</span><br><span class="line">    </span><br><span class="line">    kAIProjectingCap </span><br><span class="line">    Projecting line caps.//方头</span><br></pre></td></tr></table></figure></li><li><p>enum AILineJoin     join<br>   Line join</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Types of line joins for strokes.</span><br><span class="line"></span><br><span class="line">Enumerator:</span><br><span class="line">kAIMiterJoin </span><br><span class="line">Miter line joins.//斜接连接</span><br><span class="line"></span><br><span class="line">kAIRoundJoin </span><br><span class="line">Round line joins.//圆角连接</span><br></pre></td></tr></table></figure></li><li><p>AIReal     miterLimit<br>   Line miter limit. </p><h2 id="AIFillStyle"><a href="#AIFillStyle" class="headerlink" title="AIFillStyle"></a>AIFillStyle</h2></li><li>AIColor     color<br>   Fill color. </li><li>AIBoolean overprint<br>   When true, print any art beneath this, then print the fill of this object over it. </li></ul><h1 id="使用实例"><a href="#使用实例" class="headerlink" title="使用实例"></a>使用实例</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">bool isArtStyle=true;//是否使用图形样式库设置样式</span><br><span class="line">if (isArtStyle)&#123;</span><br><span class="line">    AIArtStyleHandle artStyle=NULL;</span><br><span class="line">    sAIArtStyle-&gt;GetArtStyleByName(&amp;artStyle, ai::UnicodeString(artStyleName), 1);</span><br><span class="line">    if (!artStyle)&#123;</span><br><span class="line">        sAIArt-&gt;DisposeArt(art);</span><br><span class="line">        return -1;</span><br><span class="line">    &#125;</span><br><span class="line">    sAIArtStyle-&gt;SetArtStyle(art, artStyle);</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">     AIColor color;</span><br><span class="line">AIColor colorFill;</span><br><span class="line">float CMYK[4] = &#123;23,211,22,56&#125;;</span><br><span class="line">float CMYKFill[4] = &#123;23,223,12,53&#125;;</span><br><span class="line">   // 描边颜色</span><br><span class="line">color.kind = kFourColor;</span><br><span class="line">color.c.f.cyan = CMYK[0];</span><br><span class="line">color.c.f.magenta = CMYK[1];</span><br><span class="line">color.c.f.yellow = CMYK[2];</span><br><span class="line">color.c.f.black = CMYK[3];</span><br><span class="line"></span><br><span class="line">//内部填充颜色</span><br><span class="line">colorFill.kind = kFourColor;</span><br><span class="line">colorFill.c.f.cyan = CMYKFill[0];</span><br><span class="line">colorFill.c.f.magenta = CMYKFill[1];</span><br><span class="line">colorFill.c.f.yellow = CMYKFill[2];</span><br><span class="line">colorFill.c.f.black = CMYKFill[3];</span><br><span class="line"></span><br><span class="line">AIPathStyle PathStyle;</span><br><span class="line">PathStyle.fillPaint = true; // 面内颜色填充 设置为true 否则无法在面内填充颜色</span><br><span class="line">PathStyle.strokePaint = true;</span><br><span class="line">PathStyle.stroke.width = 0.5;</span><br><span class="line">PathStyle.stroke.color = color;</span><br><span class="line">PathStyle.fill.color = colorFill; // 内部填充</span><br><span class="line">    sAIPathStyle-&gt;SetPathStyle(art, &amp;PathStyle);</span><br><span class="line">    //设置透明度</span><br><span class="line">    sAIBlendStyle-&gt;SetOpacity(art, 0.4);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="相关文章"><a href="#相关文章" class="headerlink" title="相关文章"></a>相关文章</h1><p><a href="/2019/03/14/ai-first-note">AI组件开发（一）–注记旋转矩阵</a><br><a href="/2019/03/18/ai-second-note">AI组件开发（二）–AIRealMathSuite</a><br><a href="/2019/03/24/ai-third-note">AI组件开发（三）–AIArtboardSuite</a><br><a href="/2019/03/24/ai-forth-document-note">AI组件开发（四）–AIDocumentSuite</a><br><a href="/2019/03/24/ai-fifth-ailayer-note">AI组件开发（五）–AILayerSuite</a><br><a href="/2019/03/24/ai-six-aiart-note">AI组件开发（六）–AIArtSuite</a><br><a href="/2019/03/25/ai-seven-path-note">AI组件开发（七）–AIPathSuite&amp;&amp;AIPathfinderSuite</a><br><a href="/2019/03/25/ai-eight-style-note">AI组件开发（八）–AIArtStyleSuite</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Art Style套件中的功能用于访问和修改Illustrator文档中图稿的art样式&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>AI组件开发（七）--AIPathSuite&amp;&amp;AIPathfinderSuite</title>
    <link href="http://11wy11.github.io/2019/03/25/ai-seven-path-note/"/>
    <id>http://11wy11.github.io/2019/03/25/ai-seven-path-note/</id>
    <published>2019-03-25T01:11:13.000Z</published>
    <updated>2019-03-25T06:08:15.685Z</updated>
    
    <content type="html"><![CDATA[<p>AIPathSuite提供的功能允许检查和操作路径,AIPathfinderSuite提供了对路径执行操作的功能，这些功能将各种效果应用于选定的路径图<br><a id="more"></a><br><!-- START doctoc generated TOC please keep comment here to allow auto update --><br><!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE --><br><strong>Table of Contents</strong>  <em>generated with <a href="https://github.com/thlorenz/doctoc" target="_blank" rel="noopener">DocToc</a></em></p><ul><li><a href="#aipathsuite">AIPathSuite</a><ul><li><a href="#%E6%B3%A8%E5%86%8C%E5%A3%B0%E6%98%8E">注册声明</a></li><li><a href="#%E6%96%B9%E6%B3%95">方法</a></li><li><a href="#aipathsegment">AIPathSegment</a></li><li><a href="#%E4%BD%BF%E7%94%A8%E5%AE%9E%E4%BE%8B">使用实例</a></li></ul></li><li><a href="#aipathfindersuite">AIPathfinderSuite</a><ul><li><a href="#%E6%B3%A8%E5%86%8C%E5%A3%B0%E6%98%8E-1">注册声明</a></li><li><a href="#%E6%96%B9%E6%B3%95-1">方法</a></li><li><a href="#%E7%9B%B8%E5%85%B3%E7%B1%BB%E7%BB%93%E6%9E%84%E4%BD%93%E6%8C%87%E9%92%88">相关类，结构体，指针</a><ul><li><a href="#aipathfinderdata">AIPathfinderData</a><ul><li><a href="#aioptions">AIOptions</a></li><li><a href="#aiparameters">AIParameters</a><ul><li><a href="#aimixparameters">AIMixParameters</a></li><li><a href="#aitrapparameters">AITrapParameters</a></li></ul></li></ul></li><li><a href="#aifiltermessage">AIFilterMessage</a><ul><li><a href="#spmessagedata">SPMessageData</a></li><li><a href="#aifilterhandle">AIFilterHandle</a></li><li><a href="#platformfilterparameters">PlatformFilterParameters</a></li></ul></li></ul></li></ul></li></ul><!-- END doctoc generated TOC please keep comment here to allow auto update --><h1 id="AIPathSuite"><a href="#AIPathSuite" class="headerlink" title="AIPathSuite"></a>AIPathSuite</h1><p>此套件提供的功能允许您检查和操作路径，这些路径是art类型的对象kPathArt。</p><p>路径的形状由一个或多个路径段定义。路径的每一个段对应于一个锚点，它是在选择路径时显示的手柄。路径上的锚点数或段 数包括每端的两个。段由AIPathSegment结构定义。段索引号从零开始。路径可以有一个锚点。</p><p>段的入点和出点定义点p处的曲线的切线。中间点不用于开放路径的初始段和最终段。段可以是角点或平滑点。对于一个角落，进出点可以在任何地方。要形成一条直线，请将每个端点的入点和出点放在它们的p点上。</p><p>路径可以是关闭的或打开的。如果路径是打开的，则仅由其段定义。如果它已关闭，Illustrator将在第一个和最后一个锚点之间绘制一个段，该段使用最后一个段的out切线和第一个段的切线。</p><p>一些路径也用作指南。在所有其他方面，它们是具有相同内容和属性的路径。绘制属性与通过路径 样式的路径相关联。见AIPathStyleSuite。</p><p>使用SPBasicSuite::AcquireSuite()常量kAIPathSuite和使用获取此套件kAIPathVersion。</p><h2 id="注册声明"><a href="#注册声明" class="headerlink" title="注册声明"></a>注册声明</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">//xxxSuites.h</span><br><span class="line">#include &quot;Suites.hpp&quot;</span><br><span class="line">#include &quot;AIArtConverter.h&quot;</span><br><span class="line">extern&quot;C&quot; AIPathSuite* sAIPath;</span><br><span class="line"></span><br><span class="line">//xxxSuites.cpp</span><br><span class="line">extern &quot;C&quot;&#123;</span><br><span class="line"> AIPathSuite* sAIPath=NULL;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ImportSuite gImportSuites[] = &#123;</span><br><span class="line">    IMPORT_TEXT_SUITES</span><br><span class="line">    kAIPathSuite,kAIPathSuiteVersion,&amp;sAIPath,</span><br><span class="line">        nil, 0, nil</span><br><span class="line">      &#125;;</span><br></pre></td></tr></table></figure><h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2><ul><li>AIAPI AIErr（*     GetPathSegmentCount）（AIArtHandle path，ai :: int16 * count）<br>   获取路径上的锚点数，包括每端的两个锚点。 </li><li>AIAPI AIErr（*     SetPathSegmentCount）（AIArtHandle path，ai :: int16 count）<br>   从段中删除段或将段附加到路径末尾。 </li><li>AIAPI AIErr（*     GetPathSegments）（AIArtHandle path，ai :: int16 segNumber，ai :: int16 count，AIPathSegment segments []）<br>   从路径中检索一组段。 </li><li>AIAPI AIErr（*     SetPathSegments）（AIArtHandle path，ai :: int16 segNumber，ai :: int16 count，const AIPathSegment segments []）<br>   添加或更新路径中的段。 </li><li>AIAPI AIErr（*     InsertPathSegments）（AIArtHandle path，ai :: int16 segNumber，ai :: int16 count，const AIPathSegment segments []）<br>   将段插入路径。 </li><li>AIAPI AIErr（*     DeletePathSegments）（AIArtHandle path，ai :: int16 segNumber，ai :: int16 count）<br>   从路径中删除段。 </li><li>AIAPI AIErr（*     GetPathClosed）（AIArtHandle path，AIBoolean *closed）<br>   报告路径是否已关闭。 </li><li>AIAPI AIErr（*     SetPathClosed）（AIArtHandle path，AIBoolean closed）<br>   打开或关闭路径。 </li><li>AIAPI AIErr（*     GetPathGuide）（AIArtHandle path，AIBoolean * isGuide）<br>   报告路径是否用作指南。 </li><li>AIAPI AIErr（*     SetPathGuide）（AIArtHandle path，AIBoolean isGuide）<br>   设置是否将路径用作指南。 </li><li>AIAPI AIErr（*     GetPathSegmentSelected）（AIArtHandle path，ai :: int16 segNumber，ai :: int16 *selected）<br>   报告是否选择了路径段的任何部分。 </li><li>AIAPI AIErr（*     SetPathSegmentSelected）（选择AIArtHandle path，ai :: int16 segNumber，ai :: int16 selected）<br>   设置段的选择状态。 </li><li>AIAPI AIErr（*     ReversePathSegments）（AIArtHandle path）<br>   反转路径中段的顺序。 </li><li>AIAPI AIErr（*     GetPathArea）（AIArtHandle path，AIReal *area）<br>   计算路径的面积。 </li><li>AIAPI AIErr（*     GetPathLength）（AIArtHandle path，AIReal *length，AIReal flatness）<br>   计算以点为单位测量的路径周长。 </li><li>AIAPI AIErr（*     GetPathBezier）（AIArtHandle path，ai :: int16 segNumber，AIRealBezier * bezier）<br>   计算路径段的贝塞尔曲线值。 </li><li>AIAPI AIErr（*     PathHasLength）（AIArtHandle path，AIBoolean * hasLength）<br>   报告路径是否有长度。 </li><li>AIAPI AIErr（*     GetPathIsClip）（AIArtHandle path，AIBoolean * isClip）<br>   报告路径是否为剪切路径。 </li><li>AIAPI AIErr（*     GetPathAllSegmentsSelected）（AIArtHandle path，选择AIBoolean *）<br>   报告是否选择了路径的所有段。 </li><li>AIAPI AIErr（*     GetKeySegment）（AIArtHandle * path，ai :: int16 * segmentNumber）<br>   检索关键锚点的路径对象和段号（即，其他锚点对齐的那个）。 </li><li>AIAPI AIErr（*     CancelKeySegment）（void）</li><li>AIAPI AIBoolean（*     IsPath9SliceSplitter）（AIArtHandle path）<br>   报告路径是否为9切片分割器; 也就是说，该指南定义了将艺术板分成9个区域的线。 </li><li>AIAPI AIErr（*     SetKeySegment）（AIArtHandle path，ai :: int16 segmentNumber）<br>   设置艺术对象的关键锚点。 </li><li>AIAPI AIErr（*     MeasureSegments）（AIArtHandle path，ai :: int16 startSeg，ai :: int16 count，AIReal pieceLengths []，AIReal accumulationLengths []）<br>   测量路径段的长度。 </li><li>AIAPI AIErr（*     LengthFractionToBezierPos）（AIArtHandle path，AIReal lengthFraction，ai :: int16＆segIndex，AIReal＆bezierT，const AIReal pieceLengths []，const AIReal accumulationLengths []）<br>   计算作为沿路径的路径长度的给定分数的点的段索引和参数贝塞尔t值。 </li><li>AIAPI AIErr（*     BezierPosToLengthFraction）（AIArtHandle path，ai :: int16 segIndex，AIReal bezierT，AIReal＆lengthFraction，const AIReal pieceLengths []，const AIReal accumulationLengths []）<br>   计算对应于沿路径的位置的总路径长度的分数，该路径表示为段索引，并且将参数贝塞尔t值表示到该段中。 </li><li>AIAPI AIErr（*     BezierPosToAnchoredPos）（AIArtHandle path，ai :: int16 segIndex，AIReal t，AIReal * segLength，AIReal * segLengthFraction）<br>   从参数贝塞尔曲线t值转换为线段长度的一部分。 </li><li>AIAPI AIErr（*     PerpendicularsAtBezierT）（AIArtHandle path，ai :: int16 segIndex，AIReal t，AIReal leftDistance，AIReal rightDistance，AIRealPoint＆pointOnPath，AIRealPoint * leftPoint，AIRealPoint * rightPoint）<br>   计算与表示为段索引和参数贝塞尔t值的位置处的路径垂直（正常）的线段的端点</li></ul><h2 id="AIPathSegment"><a href="#AIPathSegment" class="headerlink" title="AIPathSegment"></a>AIPathSegment</h2><p>Contents    Suites    Classes    Class Index    Member Index<br>AIPathSegment Struct Reference<br>Defines a path segment. More…</p><p>#include &lt;AIPath.h&gt;</p><p>List of all members.</p><p>Public Attributes<br>AIRealPoint     p<br>AIRealPoint     in<br>AIRealPoint     out<br>AIBoolean     corner  </p><h2 id="使用实例"><a href="#使用实例" class="headerlink" title="使用实例"></a>使用实例</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">//SetPathSegmentCount</span><br><span class="line">long curCount=10;//定义环面点数</span><br><span class="line">AIArtHandle artGroup = NULL;</span><br><span class="line">sAIArt-&gt;GetFirstArtOfLayer(PolygonLayer, &amp;artGroup);</span><br><span class="line">AIArtHandle art = NULL;</span><br><span class="line">sAIArt-&gt;NewArt(kPathArt, kPlaceInsideOnTop, artGroup, &amp;art);</span><br><span class="line">sAIPath-&gt;SetPathSegmentCount(art, (short)curCount);</span><br><span class="line">AIPathSegment *segment = new AIPathSegment[curCount];</span><br><span class="line">AIRealPoint *AIPoint = new AIRealPoint[curCount];</span><br><span class="line">...</span><br><span class="line">//赋值操作</span><br><span class="line">for (int i = 0; i &lt; curCount; i++)</span><br><span class="line">&#123;</span><br><span class="line">    segment[i].p.h = AIPoint[i].h;</span><br><span class="line">    segment[i].p.v = AIPoint[i].v;</span><br><span class="line">    segment[i].in = segment[i].out = segment[i].p;</span><br><span class="line">    segment[i].corner = true;</span><br><span class="line">&#125;</span><br><span class="line">//SetPathSegments</span><br><span class="line">sAIPath-&gt;SetPathSegments(art, 0, curCount, segment);</span><br><span class="line">delete[] segment;</span><br><span class="line">delete[] AIPoint;</span><br><span class="line">//SetPathClosed</span><br><span class="line">sAIPath-&gt;SetPathClosed(art, 1);</span><br><span class="line">arts.push_back(art);</span><br></pre></td></tr></table></figure><h1 id="AIPathfinderSuite"><a href="#AIPathfinderSuite" class="headerlink" title="AIPathfinderSuite"></a>AIPathfinderSuite</h1><p>该套件提供了对路径（类型的艺术对象kPathArt）执行操作的功能，这些功能将各种效果应用于选定的路径图。<br><strong>这些操作与“路径查找器”调板和“效果”菜单中的操作相对应。</strong><br>附加功能允许操作复合 形状，可以应用效果的插件组。见AIPluginGroupSuite。在复合形状组中，绘制组中的底部对象，然后根据交互模式（AIShapeMode）由其上方的下一个对象进行修改。可以将每个后续对象添加到图形中，从图形中减去，相交或从图形中排除。</p><p>使用SPBasicSuite::AcquireSuite()常量kAIPathfinderSuite和使用获取此套件kAIPathfinderVersion。</p><h2 id="注册声明-1"><a href="#注册声明-1" class="headerlink" title="注册声明"></a>注册声明</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">//xxxSuites.h</span><br><span class="line">#include &quot;Suites.hpp&quot;</span><br><span class="line">#include &quot;AIPathfinder.h&quot;</span><br><span class="line">extern  &quot;C&quot; AIPathfinderSuite*          sAIPathfinder;</span><br><span class="line"></span><br><span class="line">//xxxSuites.cpp</span><br><span class="line">extern &quot;C&quot;&#123;</span><br><span class="line"> AIPathfinderSuite*  sAIPathfinder=NULL;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ImportSuite gImportSuites[] = &#123;</span><br><span class="line">    IMPORT_TEXT_SUITES</span><br><span class="line">    kAIPathfinderSuite,kAIPathfinderSuiteVersion,&amp;sAIPathfinder,</span><br><span class="line">        nil, 0, nil</span><br><span class="line">      &#125;;</span><br></pre></td></tr></table></figure><h2 id="方法-1"><a href="#方法-1" class="headerlink" title="方法"></a>方法</h2><ul><li>AIAPI AIErr（*     DoUniteEffect）（AIPathfinderData *data，AIFilterMessage *message）<br>   对选定的艺术应用Unite效果。 </li><li>AIAPI AIErr（*     DoIntersectEffect）（AIPathfinderData * data，AIFilterMessage * message）<br>   将相交效果应用于选定的art。 </li><li>AIAPI AIErr（*     DoExcludeEffect）（AIPathfinderData *data，AIFilterMessage *message）<br>   对所选art应用排除效果。 </li><li>AIAPI AIErr（*     DoBackMinusFrontEffect）（AIPathfinderData * data，AIFilterMessage * message）<br>   对选定的art应用前后减去效果。 </li><li>AIAPI AIErr（*     DoFrontMinusBackEffect）（AIPathfinderData *data，AIFilterMessage *message）<br>   对选定的art应用前后减去效果。 </li><li>AIAPI AIErr（*     DoDivideEffect）（AIPathfinderData *data，AIFilterMessage *message）<br>   对所选art应用分割效果。 </li><li>AIAPI AIErr（*     DoOutlineEffect）（AIPathfinderData * data，AIFilterMessage * message）<br>   将轮廓效果应用于选定的art。 </li><li>AIAPI AIErr（*     DoTrimEffect）（AIPathfinderData *data，AIFilterMessage *message）<br>   对所选art应用修剪效果。 </li><li>AIAPI AIErr（*     DoMergeEffect）（AIPathfinderData *data，AIFilterMessage *message）<br>   对选定的art应用合并效果。 </li><li>AIAPI AIErr（*     DoCropEffect）（AIPathfinderData *data，AIFilterMessage *message）<br>   将裁剪效果应用于选定的art。 </li><li>AIAPI AIErr（*     DoHardEffect）（AIPathfinderData *data，AIFilterMessage *message）<br>   对选定的art应用硬效果。 </li><li>AIAPI AIErr（*     DoSoftEffect）（AIPathfinderData *data，AIFilterMessage *message）<br>   对选定的art应用柔和效果。 </li><li>AIAPI AIErr（*     DoTrapEffect）（AIPathfinderData *data，AIFilterMessage *message）<br>   对选定的art应用陷印效果。 </li><li>AIAPI AIErr（*     GetHardEffectParameters）（AIPathfinderData *data，AIFilterMessage *message）<br>   获得硬效果路径查找器操作的参数。 </li><li>AIAPI AIErr（*     GetSoftEffectParameters）（AIPathfinderData *data，AIFilterMessage *message）<br>   获得Soft效果路径查找器操作的参数。 </li><li>AIAPI AIErr（*     GetTrapEffectParameters）（AIPathfinderData * data，AIFilterMessage * message）<br>   获得陷阱效果路径查找器操作的参数。 </li><li>AIAPI AIErr（*     GetGlobalOptions）（AIPathfinderData *data，AIFilterMessage *message）<br>   获得“路径查找器”和“效果”操作的全局选项。<br>AIAPI AIShapeMode（*     GetShapeMode）（AIArtHandle art）<br>   获得art插件组对象的复合形状模式。 </li><li>AIAPI AIErr（*     SetShapeMode）（AIArtHandle art，AIShapeMode mode）<br>   设置art插件组对象的复合形状模式。 </li><li>AIAPI AIErr（*     NewCompoundShape）（ai :: int16 paintOrder，AIArtHandle prep，AIArtHandle * newArt）<br>   在当前文档的art树的绘制顺序中的指定位置创建新的空复合形状。 </li><li>AIAPI AIErr（*     IsCompoundShape）（AIArtHandle art，AIBoolean * isCompoundShape）<br>   报告art品是否为复合形状。 </li><li>AIAPI AIErr（*     FlattenArt）（AIArtHandle * inOutArt）<br>   通过将Unite效果应用于每个组件art对象，将形状扩展为单个路径或复合路径。</li></ul><h2 id="相关类，结构体，指针"><a href="#相关类，结构体，指针" class="headerlink" title="相关类，结构体，指针"></a>相关类，结构体，指针</h2><h3 id="AIPathfinderData"><a href="#AIPathfinderData" class="headerlink" title="AIPathfinderData"></a>AIPathfinderData</h3><p>AIOptions     options<br>     Options that control how pathfinder operations are performed.<br>AIParameters     parameters<br>     Parameters for mixing and trapping operations.<br>AIArtHandle *     fSelectedArt<br>     A pointer to an array of selected art objects on which to perform the operation.<br>ai::int32     fSelectedArtCount<br>     The number of members of the fSelectedArt array.<br>ai::int32     fAlertInfoID<br>     Not used.   </p><h4 id="AIOptions"><a href="#AIOptions" class="headerlink" title="AIOptions"></a>AIOptions</h4><p>控制路径查找器操作执行方式的选项。<br>double     ipmPrecision<br>     Pathfinding precision, in microns.<br>ai::int32     removeRedundantPoints<br>     Nonzero to remove redundant points.<br>ai::int32     flags<br>     Option flags, a logical OR of AIOptionsFlagValues.</p><ul><li>AIOptionsFlagValues<ul><li>kExtractUnpaintedArtwork<br>设置后，从处理结果中删除未配色的图稿。  </li><li>kAllowEmptyOutput<br>当设置时，这些功能可以产生空的输出：<br>AIPathfinderSuite::DoBackMinusFrontEffect()，AIPathfinderSuite::DoFrontMinusBackEffect()，AIPathfinderSuite::DoIntersectEffect()，AIPathfinderSuite::DoExcludeEffect()。  </li><li>kIgnoreEvenOddFillRule<br>设置时，假设所有路径都使用非零填充规则而不是偶数填充规则。    </li><li>kSuppressProgressDialog<br>设置后，在路径查找器操作期间禁止进度报告。<br>适用于AI 13及更高版本。    </li><li>kDeselectResultArts<br>设置后，将取消选择结果对象。<br>适用于AI 13及更高版本。</li></ul></li></ul><h4 id="AIParameters"><a href="#AIParameters" class="headerlink" title="AIParameters"></a>AIParameters</h4><p>混合和捕获参数<br>AIMixParameters     mixParameters<br>     Parameters for mixing operations.<br>AITrapParameters     trapParameters<br>     Parameters for trapping operations.   </p><h5 id="AIMixParameters"><a href="#AIMixParameters" class="headerlink" title="AIMixParameters"></a>AIMixParameters</h5><p>double     softRate<br>     The percentage of visibility in overlapping colors.<br>ai::int32     convertCustomColors<br>     Nonzero to convert custom colors when mixing.   </p><h5 id="AITrapParameters"><a href="#AITrapParameters" class="headerlink" title="AITrapParameters"></a>AITrapParameters</h5><p>这些对应于Pathfinder调色板的Trap对话框中提供的UI值; 有关说明，请参阅用户文档<br>double     trapThickness<br>     Trap thickness, in points.<br>double     heightWidthAspectRatio<br>     Height to width aspect ratio.<br>double     trapTint<br>     Tint.<br>double     maximumTint<br>     Maximum tint (default is recommended).<br>double     tintTolerance<br>     Tint tolerance (default is recommended).<br>ai::int32     reverseTrap<br>     Nonzero to reverse trap.<br>ai::int32     convertCustomColors<br>     Nonzero to convert custom colors.   </p><h3 id="AIFilterMessage"><a href="#AIFilterMessage" class="headerlink" title="AIFilterMessage"></a>AIFilterMessage</h3><p>过滤器获取参数或Go选择器的消息。<br>SPMessageData     d<br>     The message data.<br>AIFilterHandle     filter<br>     The filter object.<br>PlatformFilterParameters     parameters<br>     The parameter values, in a developer-defined parameter structure.   </p><h4 id="SPMessageData"><a href="#SPMessageData" class="headerlink" title="SPMessageData"></a>SPMessageData</h4><p>ai::int32     SPCheck<br>     kSPValidSPMessageData if this is a valid PICA message.<br>struct SPPlugin *     self<br>     This plug-in, an SPPluginRef.<br>void *     globals<br>     An array of application-wide global variables.<br>struct SPBasicSuite *     basic<br>     A pointer to the basic PICA suite, which you use to obtain all other suites.   </p><h4 id="AIFilterHandle"><a href="#AIFilterHandle" class="headerlink" title="AIFilterHandle"></a>AIFilterHandle</h4><p>typedef struct _t_AIFilterOpaque *     AIFilterHandle<br>     Opaque reference to a filter. </p><h4 id="PlatformFilterParameters"><a href="#PlatformFilterParameters" class="headerlink" title="PlatformFilterParameters"></a>PlatformFilterParameters</h4><h2 id="使用实例-1"><a href="#使用实例-1" class="headerlink" title="使用实例"></a>使用实例</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">//arts已定义好的art对象数组</span><br><span class="line">list&lt;AIArtHandle&gt;::iterator artIT = arts.begin();</span><br><span class="line">if (artCount &gt; 1)&#123;</span><br><span class="line">AIArtHandle* artArr = (AIArtHandle *)(malloc(sizeof(AIArtHandle)*artCount));</span><br><span class="line">for (int i = 0; i &lt; artCount; i++)&#123;</span><br><span class="line">artArr[i] = *artIT;</span><br><span class="line">artIT++;</span><br><span class="line">&#125;</span><br><span class="line">AIFilterMessage message;</span><br><span class="line">AIPathfinderData findData;</span><br><span class="line">findData.fSelectedArt = artArr;</span><br><span class="line">findData.fSelectedArtCount = artCount;</span><br><span class="line">AIOptions option;</span><br><span class="line">option.ipmPrecision = 100;</span><br><span class="line">option.flags = kExtractUnpaintedArtwork;</span><br><span class="line">option.removeRedundantPoints = 1;</span><br><span class="line">findData.options = option;</span><br><span class="line">//应用排除效果</span><br><span class="line">sAIPathfinder-&gt;DoExcludeEffect(&amp;findData, &amp;message);</span><br><span class="line">delete[] artArr;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="相关文章"><a href="#相关文章" class="headerlink" title="相关文章"></a>相关文章</h1><p><a href="/2019/03/14/ai-first-note">AI组件开发（一）–注记旋转矩阵</a><br><a href="/2019/03/18/ai-second-note">AI组件开发（二）–AIRealMathSuite</a><br><a href="/2019/03/24/ai-third-note">AI组件开发（三）–AIArtboardSuite</a><br><a href="/2019/03/24/ai-forth-document-note">AI组件开发（四）–AIDocumentSuite</a><br><a href="/2019/03/24/ai-fifth-ailayer-note">AI组件开发（五）–AILayerSuite</a><br><a href="/2019/03/24/ai-six-aiart-note">AI组件开发（六）–AIArtSuite</a><br><a href="/2019/03/25/ai-seven-path-note">AI组件开发（七）–AIPathSuite&amp;&amp;AIPathfinderSuite</a><br><a href="/2019/03/25/ai-eight-style-note">AI组件开发（八）–AIArtStyleSuite</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;AIPathSuite提供的功能允许检查和操作路径,AIPathfinderSuite提供了对路径执行操作的功能，这些功能将各种效果应用于选定的路径图&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="AI组件开发" scheme="http://11wy11.github.io/categories/AI%E7%BB%84%E4%BB%B6%E5%BC%80%E5%8F%91/"/>
    
    
      <category term="AI" scheme="http://11wy11.github.io/tags/AI/"/>
    
  </entry>
  
  <entry>
    <title>AI组件开发（六）--AIArtSuite</title>
    <link href="http://11wy11.github.io/2019/03/24/ai-six-aiart-note/"/>
    <id>http://11wy11.github.io/2019/03/24/ai-six-aiart-note/</id>
    <published>2019-03-24T13:43:22.000Z</published>
    <updated>2019-03-25T06:08:15.341Z</updated>
    
    <content type="html"><![CDATA[<p>Adobe Illustrator 文档中绘制的所有图形均为Art，相关操作函数在AIArtSuite中定义<br><a id="more"></a></p><h1 id="AIArtSuite"><a href="#AIArtSuite" class="headerlink" title="AIArtSuite"></a>AIArtSuite</h1><p>此套件允许您访问和修改Illustrator文档中的图稿。</p><p>它提供了创建和删除对象，重新排列对象以及获取和设置对象信息的功能。您可以使用这些函数来导航图形对象树，以及获得或修改有关图形对象的一般信息，例如它们的边界或锁定状态。</p><p>Art套件是实现大多数插件的基础。Illustrator文档由一个由a引用的图形对象的集合组成AIArtHandle。这是指向文档图稿数据库中图形对象的不透明指针。通过Art suite的访问器功能访问这些字段。</p><p>艺术对象可以表示单个实体，诸如路径，文本块或放置的图像，或一组对象，诸如路径的集合。艺术类型标识符（AIArtType）表示艺术品的类型。</p><p>使用SPBasicSuite::AcquireSuite()常量kAIArtSuite和使用获取此套件kAIArtVersion。</p><h2 id="注册声明"><a href="#注册声明" class="headerlink" title="注册声明"></a>注册声明</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">//xxxSuites.h</span><br><span class="line">#include &quot;Suites.hpp&quot;</span><br><span class="line">#include &quot;AIArtConverter.h&quot;</span><br><span class="line">extern  &quot;C&quot; AAIArtSuite*sAIArt ;</span><br><span class="line"></span><br><span class="line">//xxxSuites.cpp</span><br><span class="line">extern &quot;C&quot;&#123;</span><br><span class="line">AIArtSuite*sAIArt = NULL;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ImportSuite gImportSuites[] = &#123;</span><br><span class="line">    IMPORT_TEXT_SUITES</span><br><span class="line">    kAIArtSuite, kAIArtSuiteVersion, &amp;sAIArt,</span><br><span class="line">        nil, 0, nil</span><br><span class="line">      &#125;;</span><br></pre></td></tr></table></figure><h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2><ul><li>AIAPI AIErr（*     NewArt）（ai :: int16类型，ai :: int16 paintOrder，AIArtHandle prep，AIArtHandle * newArt）<br>   创建一个新的Art对象。 </li><li>AIAPI AIErr（*     DisposeArt）（AIArtHandle Art）<br>   从文档中删除Art对象。 </li><li>AIAPI AIErr（*     ReorderArt）（AIArtHandle thisArt，ai :: int16 paintOrder，AIArtHandle prep）<br>   更改Art对象的绘制顺序，或将路径移入或移出复合路径或组。 </li><li>AIAPI AIErr（*     DuplicateArt）（AIArtHandle thisArt，ai :: int16 paintOrder，AIArtHandle prep，AIArtHandle * newArt）<br>   使用深层复制复制Art对象（组和复合路径的子项也是重复的）。 </li><li>AIAPI AIErr（*     GetFirstArtOfLayer）（AILayerHandle图层，AIArtHandle *Art）<br>   获得图层中的第一个Art对象，该图层包含该图层中的所有Art。 </li><li>AIAPI AIErr（*     GetLayerOfArt）（AIArtHandle art，AILayerHandle *layer）<br>   获得Art对象的父图层（如果有）。 </li><li>AIAPI AIErr（*     GetArtType）（AIArtHandle art，short * type）<br>   获得Art对象的类型。 </li><li>AIAPI AIErr（*     GetArtUserAttr）（AIArtHandle art，ai :: int32 whichAttr，ai :: int32 * attr）<br>   获得Art对象的用户属性; 也就是说，标志显示它是被选中，隐藏还是被锁定。 </li><li>AIAPI AIErr（*     SetArtUserAttr）（AIArtHandle art，ai :: int32 whichAttr，ai :: int32 attr）<br>   设置对象的用户属性; 也就是说，标志显示它是被选中，隐藏还是被锁定。 </li><li>AIAPI AIErr（*     GetArtParent）（AIArtHandle art，AIArtHandle *parent）<br>   获得Art对象的父组。 </li><li>AIAPI AIErr（*     GetArtFirstChild）（AIArtHandle art，AIArtHandle *child）<br>   获得组对象的第一个子对象。 </li><li>AIAPI AIErr（*     GetArtSibling）（AIArtHandle art，AIArtHandle *sibling）<br>   获得同一组中的下一个对象。 </li><li>AIAPI AIErr（*     GetArtPriorSibling）（AIArtHandle art，AIArtHandle *sibling）<br>   获得同一组中的上一个对象。 </li><li>AIAPI AIErr（*     GetArtBounds）（AIArtHandle art，AIRealRect * bounds）<br>   获得Art对象的包围矩形。 </li><li>AIAPI AIErr（*     SetArtBounds）（AIArtHandle art）<br>   更新Art对象的封闭矩形（边界框）的缓存信息。 </li><li>AIAPI AIErr（*     GetArtCenterPointVisible）（AIArtHandle art，AIBoolean *visible）<br>   检查Art品的中心点是否可见。 </li><li>AIAPI AIErr（*     SetArtCenterPointVisible）（AIArtHandle art，AIBoolean visible）<br>   选择对象时，可以使Art品的中心点可见或不可见。 </li><li>AIAPI AIErr（*     GetArtTransformBounds）（AIArtHandle art，AIRealMatrix * transform，ai :: int32 flags，AIRealRect * bounds）<br>   应用变换矩阵后，获得Art对象的几何边界。 </li><li>AIAPI AIErr（*     UpdateArtworkLink）（AIArtHandle art，AIBoolean force，AIBoolean *updated）<br>   检查给定容器的子树中包含的任何链接对象（链接图像或放置对象）是否需要更新，并在需要时更新它们。 </li><li>AIAPI AIBoolean（*     ValidArt）（AIArtHandle art，AIBoolean searchAllLayerLists）<br>   如果Art对象引用有效，则返回true。 </li><li>AIAPI AIErr（*     GetArtOrder）（AIArtHandle art1，AIArtHandle art2，short * order）<br>   获取两个Art品的绘画顺序或遏制关系。 </li><li>AIAPI AIErr（*     SelectNamedArtOfLayer）（AILayerHandle图层，const ai :: UnicodeString＆name，AIBoolean matchWholeWord，AIBoolean caseSensitive）<br>   通过将字符串与Art对象注释的内容进行匹配来选择图层的指定图稿。 </li><li>AIAPI AIErr（*     GetArtRotatedBounds）（AIArtHandle art，AIReal angle，ai :: int32 flags，AIRealRect * bounds）<br>   旋转后获得Art对象的包围矩形。 </li><li>AIAPI AIBoolean（*     ArtHasFill）（AIArtHandle art）<br>   如果Art对象或后代对象绘制应被视为填充的内容，则返回true。 </li><li>AIAPI AIBoolean（*     ArtHasStroke）（AIArtHandle art）<br>   如果Art对象或后代对象绘制应被视为笔划的内容，则返回true。 </li><li>AIAPI AIBoolean（*     ArtsHaveEqualPaths）（AIArtHandle art1，AIArtHandle art2）<br>   如果两个Art对象除了组，路径和复合路径之外只包含其他内容，并且它们具有相同的几何（控制点），则返回true。 </li><li>AIAPI AIErr（*     ArtCopyFillStyleIfEqualPaths）（AIArtHandle dstArt，AIArtHandle srcArt）<br>   未在AI11及更高版本中实施; 回报kNotImplementedErr。 </li><li>AIAPI AIErr（*     ArtCopyStrokeStyleIfEqualPaths）（AIArtHandle dstArt，AIArtHandle srcArt）<br>   未在AI11及更高版本中实施; 回报kNotImplementedErr。 </li><li>AIAPI AIErr（*     GetInsertionPoint）（AIArtHandle * art，short * paintorder，AIBoolean * editable）<br>   获得文档的插入点。 </li><li>AIAPI AIErr（*     SetInsertionPoint）（AIArtHandle art）<br>   设置文档的插入点。 </li><li>AIAPI AIErr（*     GetKeyArt）（AIArtHandle *Art）<br>   获得对象对齐的关键对象。 </li><li>AIAPI AIErr（*     CancelKeyArt）（无效）<br>   清除对象对齐的关键对象。 </li><li>AIAPI AIErr（*     GetDictionary）（AIArtHandle art，struct _AIDictionary ** dictionary）<br>   获得与Art对象关联的字典。 </li><li>AIAPI AIErr（*     SetArtName）（AIArtHandle art，const ai :: UnicodeString＆name）<br>   设置Art对象的名称。 </li><li>AIAPI AIErr（*     GetArtName）（AIArtHandle art，ai :: UnicodeString＆name，ASBoolean * isDefaultName）<br>   获得Art对象的名称。 </li><li>AIAPI AIErr（*     IsArtLayerGroup）（AIArtHandle art，ASBoolean * isLayerGroup）<br>   报告Art对象是否是与图层或子图层对应的组。 </li><li>AIAPI AIErr（*     ReleaseToLayers）（常量AIArtHandle技术中，ASBoolean版本）<br>   将图层，组或插件组的元素释放到单独的图层。 </li><li>AIAPI AIErr（*     ModifyTargetedArtSet）（AIArtHandle * list，ai :: int32 count，ai :: int32 action）<br>   使用指定的操作修改文档中的目标对象集。 </li><li>AIAPI AIBoolean（*     IsArtStyledArt）（AIArtHandle art）<br>   如果art是另一个对象的样式Art的一部分，则返回true。 </li><li>AIAPI AIBoolean（*     IsArtClipping）（AIArtHandle art）<br>   如果art添加到剪辑，则返回true 。 </li><li>AIAPI AIErr（*     TransferAttributes）（AIArtHandle srcart，AIArtHandle dstart，ai :: uint32 which）<br>   将源Art对象的属性传输到目标Art对象。 </li><li>AIAPI AIErr（*     GetArtLastChild）（AIArtHandle art，AIArtHandle *child）<br>   获得容器Art对象的最后一个子项。 </li><li>AIAPI AIErr（*     SetArtTextWrapProperty）（AIArtHandle art，AIReal offset，AIBoolean invert）<br>   设置影响文本环绕文本换行对象的方式的属性; 也就是说，kArtIsTextWrap设置属性的那个。 </li><li>AIAPI AIErr（*     GetArtTextWrapProperty）（AIArtHandle art，AIReal * offset，AIBoolean * invert）<br>   获得影响文本环绕文本换行对象的方式的属性; 也就是说，kArtIsTextWrap设置属性的那个。 </li><li>AIAPI AIErr（*     CreateCopyScope）（枚举AICopyScopeKind类，AICopyScopeHandle *范围）<br>   创建并设置复制范围。 </li><li>AIAPI AIErr（*     DestroyCopyScope）（AICopyScopeHandle范围）<br>   取消并销毁复制范围。 </li><li>AIAPI AIErr（*     InsertionPointBadForArtType）（ai :: int16 paintOrder，AIArtHandle prep，ai :: int16 artType）<br>   检查在给定插入点处创建或插入给定类型的Art对象是否可以。 </li><li>AIAPI AIErr（*     PreinsertionFlightCheck）（AIArtHandle candidateArt，ai :: int16 paintOrder，AIArtHandle prep）<br>   根据插入上下文和候选Art的属性，检查是否可以在指定的插入点处插入Art对象或其副本，而无需实际尝试插入。 </li><li>AIAPI AIErr（*     SetNote）（AIArtHandle art，const ai :: UnicodeString＆inNote）<br>   设置Art对象的音符属性，该属性通常包含用户输入的文本。 </li><li>AIAPI AIErr（*     GetNote）（AIArtHandle art，ai :: UnicodeString＆outNote）<br>   获得Art对象的注释属性文本，该文本通常包含用户输入的文本。 </li><li>AIAPI AIBoolean（*     HasNote）（AIArtHandle art）<br>   检查Art品是否附有说明。 </li><li>AIAPI无效（*     删除注意）（AIArtHandle art）<br>   删除附加到Art对象的注释（如果有）。 </li><li>AIAPI AIErr（*     GetArtXMPSize）（AIArtHandle art，size_t * size）<br>   获取与Art对象关联的XMP元数据的大小。 </li><li>AIAPI AIErr（*     GetArtXMP）（AIArtHandle art，char * xmp，size_t size）<br>   获得与Art对象的XMP元数据关联的XML数据包。 </li><li>AIAPI AIErr（*     SetArtXMP）（AIArtHandle art，const char * xmp）<br>   设置Art对象的XMP元数据，替换任何现有数据。 </li><li>AIAPI AIErr（*     GetPreciseArtTransformBounds）（AIArtHandle art，AIRealMatrix * transform，ai :: int32 flags，AIDoubleRect * bounds）<br>   应用变换矩阵后，获得Art对象的几何边界。 </li><li>AIAPI AIErr（*     UncheckedDisposeArt）（AIArtHandle art）<br>   从Art树中删除Art对象，对输入的有效性进行最低限度检查，以便最大限度地提高性能。 </li><li>AIAPI AIErr（*     ArtIsGraph）（AIArtHandle art，AIBoolean * artisgraph）<br>   报告Art对象是否为图形对象类型。 </li><li>AIAPI AIErr（*     SetKeyArt）（AIArtHandle art）<br>   将Art设置为对象对齐的KeyArt。关键对象是其他对象对齐的对象。 </li><li>AIAPI AIErr（*     GetDrawingMode）（ai :: int32 * mode）<br>   获得当前文档的绘图模式。 </li><li>AIAPI AIErr（*     SetDrawingMode）（ai :: int32模式）<br>   设置当前文档的绘图模式。 </li><li>AIAPI AIErr（*     GetInsertionPointForDrawingMode）（ai :: int32模式，AIArtHandle * art，short * paintorder，AIBoolean * editable）<br>   根据绘图模式获得当前文档的插入点。 </li><li>AIAPI AIErr（*     GetInsertionPointForCurrentDrawingMode）（AIArtHandle * art，short * paintorder，AIBoolean * editable）<br>   根据当前绘图模式获得当前文档的插入点。 </li><li>AIAPI AIErr（*     GetPathPolarity）（AIArtHandle art，ai :: int32 * polarity）<br>   获得Art对象的路径极性。 </li><li>AIAPI AIBoolean（*     IsPixelPerfect）（AIArtHandle art）<br>   报告Art品是否处于像素完美模式。 </li><li>AIAPI AIErr（*     SetPixelPerfect）（AIArtHandle art，AIBoolean isPixelPerfect）<br>   为Art品打开或关闭像素完美模式。 </li><li>AIAPI AIBoolean（*     ObjectsAreEquivalent）（AIArtHandle art1，AIArtHandle art2）<br>   比较两个Art对象以确定它们在几何，外观属性和字典内容中是否等效。通常，一个对象在当前文档中，另一个在另一个文档中。 </li><li>AIAPI AIErr（*     IsArtALayerInSymbol）（AIArtHandle art，AIBoolean * isLayerInSymbol）<br>   报告Art对象是否充当符号模式中的图层。 </li><li>AIAPI AIErr（*     GetArtTimeStamp）（AIArtHandle art，size_t * timeStamp）<br>   获得Art对象的修改时间戳。 <h2 id="paintOrder-枚举常量"><a href="#paintOrder-枚举常量" class="headerlink" title="paintOrder 枚举常量"></a>paintOrder 枚举常量</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">typedef enum AIPaintOrder &#123;</span><br><span class="line">/* Default value */</span><br><span class="line">kPlaceDefault = 0,</span><br><span class="line">/** Place above the prepositional object */</span><br><span class="line">kPlaceAbove = 1,</span><br><span class="line">/** Place below the prepositional object */</span><br><span class="line">kPlaceBelow,</span><br><span class="line">/** Place within and at the top of the prepositional container */</span><br><span class="line">kPlaceInsideOnTop,</span><br><span class="line">/** Place within and at the bottom of the prepositional container */</span><br><span class="line">kPlaceInsideOnBottom,</span><br><span class="line">/** Place at the top of the paint order, ignoring prepositional object */</span><br><span class="line">kPlaceAboveAll,</span><br><span class="line">/** Place at the bottom of the paint order, ignoring prepositional object */</span><br><span class="line">kPlaceBelowAll</span><br><span class="line">&#125; AIPaintOrder;</span><br></pre></td></tr></table></figure></li></ul><h2 id="AIArtHandle"><a href="#AIArtHandle" class="headerlink" title="AIArtHandle"></a>AIArtHandle</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">typedef struct ArtObject* AIArtHandle</span><br><span class="line">Opaque reference to an art object.</span><br><span class="line"></span><br><span class="line">Access using AIArtSuite.</span><br></pre></td></tr></table></figure><h2 id="使用实例"><a href="#使用实例" class="headerlink" title="使用实例"></a>使用实例</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line">AIArtHandle artGroup = NULL;</span><br><span class="line">sAIArt-&gt;GetFirstArtOfLayer(PolygonLayer, &amp;artGroup);</span><br><span class="line">AIArtHandle art = NULL;</span><br><span class="line">sAIArt-&gt;NewArt(kPathArt, kPlaceInsideOnTop, artGroup, &amp;art);</span><br><span class="line">//setNote</span><br><span class="line">sAIArt-&gt;SetNote(&quot;该属性通常包含用户输入的文本。需要记录保存的信息，一般，号分割的字符串，不过插件一般使用Dictionary&quot;);</span><br><span class="line">//HasNote,GetNote</span><br><span class="line">if (sAIArt-&gt;HasNote(artGroup))&#123;</span><br><span class="line">ai::UnicodeString infoNote;</span><br><span class="line">sAIArt-&gt;GetNote(artGroup, infoNote);</span><br><span class="line">&#125;</span><br><span class="line">//DisposeArt</span><br><span class="line">sAIArt-&gt;DisposeArt(artGroup);</span><br><span class="line"></span><br><span class="line">//设置隐藏图层内容不可见</span><br><span class="line">AILayerHandle FirstLayer;</span><br><span class="line">AILayerHandle NextLayer = NULL;</span><br><span class="line"></span><br><span class="line">sAILayer-&gt;GetLayerFirstChild(m_hideLayer,&amp;FirstLayer);</span><br><span class="line">while(FirstLayer)</span><br><span class="line">&#123;</span><br><span class="line">AIArtHandle ArtGroup;</span><br><span class="line">AIArtHandle Art;</span><br><span class="line">sAIArt-&gt;GetFirstArtOfLayer(FirstLayer,&amp;ArtGroup);</span><br><span class="line">sAIArt-&gt;GetArtFirstChild(ArtGroup,&amp;Art);</span><br><span class="line"></span><br><span class="line">AILayerHandle LayerTemp;</span><br><span class="line">LayerTemp =  FirstLayer;</span><br><span class="line">sAILayer-&gt;GetNextLayer(FirstLayer,&amp;FirstLayer);</span><br><span class="line">if(!Art)</span><br><span class="line">sAILayer-&gt;DeleteLayer(LayerTemp);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sAILayer-&gt;SetLayerVisible(m_hideLayer, false);</span><br><span class="line"></span><br><span class="line">AIRealRect artRect;</span><br><span class="line">   sAIArt-&gt;GetArtBounds(m_pointArt, &amp;artRect);</span><br><span class="line">   sAIMathSuite-&gt;AIRealMatrixSetTranslate(&amp;maxtrix, ListIter-&gt;h - (artRect.right + artRect.left) / 2, ListIter-&gt;v - (artRect.top + artRect.bottom) / 2);</span><br><span class="line">   sAITransformArt-&gt;TransformArt(m_pointArt, &amp;maxtrix, 1, kTransformObjects);</span><br><span class="line">   sAIArt-&gt;SetArtName(m_pointArt, ai::UnicodeString(&quot;XXXX&quot;));</span><br><span class="line">   </span><br><span class="line">   AIArtHandle textPathPoly = NULL;</span><br><span class="line">   AIArtHandle textFrame;//已存在变量</span><br><span class="line">   sAIArt-&gt;DuplicateArt(textFrame, kPlaceBelow,textFrame, &amp;textPathPoly);</span><br><span class="line">   AIArtHandle textFrameBackgroud;//已存在变量</span><br><span class="line">   sAIArt-&gt;ReorderArt(textFrameBackgroud, kPlaceInsideOnTop, ArtGroup);</span><br><span class="line">   </span><br><span class="line">   AIArtHandle outlines=NULL;</span><br><span class="line">   sAITextFrame-&gt;CreateOutline(textFrame, &amp;outlines);</span><br><span class="line">   </span><br><span class="line">   AIArtHandle outlinef=NULL,outlinen=NULL;</span><br><span class="line">   sAIArt-&gt;GetArtFirstChild(outlines, &amp;outlinef);</span><br><span class="line">   </span><br><span class="line">   //描边属性</span><br><span class="line">   AIPathStyle pathstyle;</span><br><span class="line">   pathstyle.fillPaint = false;</span><br><span class="line">   pathstyle.strokePaint = true;</span><br><span class="line">   AIStrokeStyle strokestyle;</span><br><span class="line">   strokestyle.width = this-&gt;borderWidth;</span><br><span class="line">   strokestyle.cap = kAIRoundCap;</span><br><span class="line">   strokestyle.join = kAIRoundJoin;</span><br><span class="line">   strokestyle.color = borderColor;</span><br><span class="line">   pathstyle.stroke = strokestyle;</span><br><span class="line">   </span><br><span class="line">   sAIPathStyle-&gt;SetPathStyle(outlinef, &amp;pathstyle);</span><br><span class="line">   </span><br><span class="line">   sAIArt-&gt;GetArtSibling(outlinef, &amp;outlinen); </span><br><span class="line">   </span><br><span class="line">   while (outlinen)</span><br><span class="line">   &#123;</span><br><span class="line">   sAIPathStyle-&gt;SetPathStyle(outlinen, &amp;pathstyle);</span><br><span class="line">   sAIArt-&gt;GetArtSibling(outlinen, &amp;outlinen);</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   sAIArt-&gt;DisposeArt(textFrame);</span><br><span class="line">   //使用GetArtPriorSibling</span><br><span class="line">   // get the previous art</span><br><span class="line">    error = sArt-&gt;GetArtPriorSibling(art, &amp;art);</span><br><span class="line">    if (error) return error;</span><br><span class="line">    if (!art)&#123;</span><br><span class="line">            // art was first in group</span><br><span class="line">            // see if parent has previous art</span><br><span class="line">            error = sArt-&gt;GetArtParent(art, &amp;art);</span><br><span class="line">            if (error) return error;</span><br><span class="line">            ...</span><br><span class="line">   //使用GetArtParent  ,GetArtSibling</span><br><span class="line">     ...</span><br><span class="line">     // see if parent has sibling</span><br><span class="line">     error = sArt-&gt;GetArtParent(nextart, &amp;nextart);</span><br><span class="line">     if (error) return error;</span><br><span class="line">     error = sArt-&gt;GetArtSibling(nextart, &amp;nextart);</span><br><span class="line">     if (error) return error;</span><br><span class="line">     if (nextart) &#123;    // parent has sibling</span><br><span class="line">     ...</span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure><h1 id="相关文章"><a href="#相关文章" class="headerlink" title="相关文章"></a>相关文章</h1><p><a href="/2019/03/14/ai-first-note">AI组件开发（一）–注记旋转矩阵</a><br><a href="/2019/03/18/ai-second-note">AI组件开发（二）–AIRealMathSuite</a><br><a href="/2019/03/24/ai-third-note">AI组件开发（三）–AIArtboardSuite</a><br><a href="/2019/03/24/ai-forth-document-note">AI组件开发（四）–AIDocumentSuite</a><br><a href="/2019/03/24/ai-fifth-ailayer-note">AI组件开发（五）–AILayerSuite</a><br><a href="/2019/03/24/ai-six-aiart-note">AI组件开发（六）–AIArtSuite</a><br><a href="/2019/03/25/ai-seven-path-note">AI组件开发（七）–AIPathSuite&amp;&amp;AIPathfinderSuite</a><br><a href="/2019/03/25/ai-eight-style-note">AI组件开发（八）–AIArtStyleSuite</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Adobe Illustrator 文档中绘制的所有图形均为Art，相关操作函数在AIArtSuite中定义&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="AI组件开发" scheme="http://11wy11.github.io/categories/AI%E7%BB%84%E4%BB%B6%E5%BC%80%E5%8F%91/"/>
    
    
      <category term="AI" scheme="http://11wy11.github.io/tags/AI/"/>
    
  </entry>
  
  <entry>
    <title>AI组件开发（五）--AILayerSuite</title>
    <link href="http://11wy11.github.io/2019/03/24/ai-fifth-ailayer-note/"/>
    <id>http://11wy11.github.io/2019/03/24/ai-fifth-ailayer-note/</id>
    <published>2019-03-24T13:09:15.000Z</published>
    <updated>2019-03-25T06:08:15.517Z</updated>
    
    <content type="html"><![CDATA[<p>文档中的图稿包含在图层中。AILayerSuite有一堆图层列表。堆栈中最顶层的层是当前正在编辑的层<br><a id="more"></a></p><h1 id="AILayerSuite"><a href="#AILayerSuite" class="headerlink" title="AILayerSuite"></a>AILayerSuite</h1><p>每个图层都包含一组对象，可以包含子图层。所有文档都至少以一个图层开头，用户或插件可以向其添加任意数量的新图层。图层是图稿树的容器; 用于AIArtSuite::GetFirstArtOfLayer()获取属于图层的Art对象组。</p><p>除了包含图稿之外，图层还有一个名称，一种颜色（用于表示选定的art），以及指示其是可见，可编辑还是已锁定，可打印以及是否将放置的Art显示为灰色的状态标志。图层引用是不透明的; 使用此套件中的函数来获取和设置图层属性。</p><p>多个图层属性会影响图层上的图稿是否可编辑。通常，不能选择不可编辑图层上的对象，因此无需检查对当前选择进行操作的插件。但是，在迭代图层或图稿时，请GetLayerEditable()在尝试对图稿进行任何更改之前调用每个图层。</p><p>可以将图层指定为模板图层，其中包含用于指导文档图稿构造的模板图稿。例如，模板可能包含正在跟踪的图像。永远不会打印模板图层或将其导出为最终格式的文件格式。</p><p>有四个与图层关联的通知程序：<br>kAICurrentLayerNotifier<br>kAILayerDeletionNotifier<br>kAILayerSetNotifier<br>kAILayerOptionsNotifier</p><p>使用SPBasicSuite::AcquireSuite()常量kAILayerSuite和使用获取此套件kAILayerVersion。</p><h2 id="注册声明"><a href="#注册声明" class="headerlink" title="注册声明"></a>注册声明</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">//xxxSuites.h</span><br><span class="line">#include &lt;AILayer.h&gt;</span><br><span class="line">extern  &quot;C&quot; AILayerSuite\*                sAILayer;</span><br><span class="line"></span><br><span class="line">//xxxSuites.cpp</span><br><span class="line">extern &quot;C&quot;&#123;</span><br><span class="line">AILayerSuite\*               sAILayer = NULL;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ImportSuite gImportSuites[] = &#123;</span><br><span class="line">    IMPORT_TEXT_SUITES</span><br><span class="line">    kAILayerSuite, kAILayerSuiteVersion, &amp;sAILayer,</span><br><span class="line">        nil, 0, nil</span><br><span class="line">      &#125;;</span><br></pre></td></tr></table></figure><h2 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h2><ul><li>AIAPI AIErr（*     CountLayers）（ai :: int32 * count）<br>   获取当前文档图层列表中的顶级图层数。 </li><li>AIAPI AIErr（*     GetNthLayer）（ai :: int32 n，AILayerHandle *layer）<br>   从当前文档中按索引获得顶级图层。 </li><li>AIAPI AIErr（*     GetCurrentLayer）（AILayerHandle *layer）<br>   获得当前文档中当前图层的引用。 </li><li>AIAPI AIErr（*     SetCurrentLayer）（AILayerHandle layer）<br>   使图层最新。 </li><li>AIAPI AIErr（*     GetFirstLayer）（AILayerHandle * first）<br>   获得当前文档图层列表的最顶层。 </li><li>AIAPI AIErr（*     GetNextLayer）（AILayerHandle prev，AILayerHandle * next）<br>   在堆叠顺序中获得给定图层下方的下一层，位于图层列表堆栈的同一级别。 </li><li>AIAPI AIErr（*     InsertLayer）（AILayerHandle layer，ai :: int16 paintOrder，AILayerHandle * newLayer）<br>   向文档添加新图层，将其插入到相对于现有图层的绘制顺序的图层列表中。 </li><li>AIAPI AIErr（*     DeleteLayer）（AILayerHandle layer）<br>   从当前文档中删除图层及其包含的所有图稿。 </li><li>AIAPI AIErr（*     GetLayerTitle）（AILayerHandle layer，ai :: UnicodeString＆title）<br>   获得图层的名称。 </li><li>AIAPI AIErr（*     SetLayerTitle）（AILayerHandle layer，const ai :: UnicodeString＆newTitle）<br>   设置图层的名称。 </li><li>AIAPI AIErr（*     GetLayerColor）（AILayerHandle layer，AIRGBColor *color）<br>   获得在图层中勾画选定图稿时使用的颜色。 </li><li>AIAPI AIErr（*     SetLayerColor）（AILayerHandle layer，AIRGBColor color）<br>   设置在图层中勾画选定图稿时使用的颜色。 </li><li>AIAPI AIErr（*     GetLayerVisible）（AILayerHandle layer，AIBoolean *visible）<br>   报告图层的可见性状态，这会影响是否绘制图稿。 </li><li>AIAPI AIErr（*     SetLayerVisible）（AILayerHandle layer，AIBoolean visible）<br>   设置图层的可见性状态，这会影响是否绘制图稿。 </li><li>AIAPI AIErr（*     GetLayerPreview）（AILayerHandle layer，AIBoolean *preview）<br>   报告图层是指定预览模式还是轮廓模式。 </li><li>AIAPI AIErr（*     SetLayerPreview）（AILayerHandle layer，AIBoolean preview）<br>   将图层设置为预览模式或轮廓模式。 </li><li>AIAPI AIErr（*     GetLayerEditable）（AILayerHandle layer，AIBoolean *editable）<br>   报告图层是可编辑还是已锁定。 </li><li>AIAPI AIErr（*     SetLayerEditable）（AILayerHandle layer，AIBoolean editable）<br>   设置图层是可编辑还是锁定。 </li><li>AIAPI AIErr（*     GetLayerPrinted）（AILayerHandle layer，AIBoolean *printed）<br>   报告在打印文档时是否将此图层视为可打印。 </li><li>AIAPI AIErr（*     SetLayerPrinted）（AILayerHandle layer，AIBoolean printed）<br>   设置打印文档时是否将此图层视为可打印。 </li><li>AIAPI AIErr（*     GetLayerDimPlacedImages）（AILayerHandle layer，AIBoolean * dimmed）<br>   报告渲染时图层中的图像是否变暗（颜色向白色移动）。 </li><li>AIAPI AIErr（*     SetLayerDimPlacedImages）（AILayerHandle layer，AIBoolean dimmed）<br>   设置渲染时图层中的图像是否变暗（颜色向白色移动）。 </li><li>AIAPI AIErr（*     GetLayerSelected）（AILayerHandle layer，AIBoolean *selected）<br>   报告是否选择了图层。 </li><li>AIAPI AIErr（*     SetLayerSelected）（AILayerHandle layer，AIBoolean selected）<br>   设置是否选择图层。 </li><li>AIAPI AIErr（*     GetLayerByTitle）（AILayerHandle *layer，const ai :: UnicodeString＆title）<br>   按标题获得图层。 </li><li>AIAPI AIErr（*     LayerHasArt）（AILayerHandle layer，AIBoolean * hasArt）<br>   报告图层是否包含子图层以外的对象。 </li><li>AIAPI AIErr（*     LayerHasSelectedArt）（AILayerHandle layer，AIBoolean * hasSel）<br>   报告图层是否包含任何选定的图稿。 </li><li>AIAPI AIErr（*     取消选择ArtOnLayer）（AILayerHandle layer）<br>   取消选择图层上的所有对象。 </li><li>AIAPI AIErr（*     SelectArtOnLayer）（AILayerHandle layer）<br>   选择可以选择的图层上的所有对象。 </li><li>AIAPI AIErr（*     GetLayerIsTemplate）（AILayerHandle layer，AIBoolean * isTemplate）<br>   报告图层是否为模板图层。 </li><li>AIAPI AIErr（*     SetLayerIsTemplate）（AILayerHandle layer，AIBoolean isTemplate）<br>   设置图层是否为模板图层。 </li><li>AIAPI AIErr（*     GetPrevLayer）（AILayerHandle接下来，AILayerHandle *prev）<br>   在堆叠顺序中获得给定图层上方的图层。 </li><li>AIAPI AIErr（*     GetLayerDimmedPercent）（AILayerHandle layer，ai :: int32 *percent）<br>   当图层设置为灰色时，获得用于绘制图像的调光因子。 </li><li>AIAPI AIErr（*     SetLayerDimmedPercent）（AILayerHandle layer，ai :: int32 percent）<br>   设置图层设置为灰色时用于绘制图像的调光系数。 </li><li>AIAPI AIErr（*     GetLayerFirstChild）（const AILayerHandle layer，AILayerHandle *child）<br>   获得图层的第一个子子图层。 </li><li>AIAPI AIErr（*     GetLayerParent）（const AILayerHandle layer，AILayerHandle * parent）<br>   获得图层的父级。 </li><li>AIAPI AIErr（*     InsertLayerAtArt）（const AIArtHandle art，AIPaintOrder paintOrder，AILayerHandle * newLayer）<br>   在相对于艺术对象的绘制顺序位置处将新图层插入到文档中。 </li><li>AIAPI AIErr（*     ChangeLayerToGroup）（const AILayerHandle layer，const AIArtHandle group）<br>   将此图层的子图层转换为简单组。 </li><li>AIAPI AIErr（*     GetNextPreorderLayer）（AILayerHandle prev，AILayerHandle * next）<br>   在前序遍历中获得下一层，首先查找后代，然后是兄弟姐妹。 </li><li>AIAPI AIErr（*     GetNextNonChildPreorderLayer）（AILayerHandle prev，AILayerHandle * next）<br>   在前序遍历中获得下一层，跳过后代并仅返回兄弟层。 <h2 id="paintOrder-枚举常量"><a href="#paintOrder-枚举常量" class="headerlink" title="paintOrder 枚举常量"></a>paintOrder 枚举常量</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">typedef enum AIPaintOrder &#123;</span><br><span class="line">/** Default value */</span><br><span class="line">kPlaceDefault = 0,</span><br><span class="line">/** Place above the prepositional object */</span><br><span class="line">kPlaceAbove = 1,</span><br><span class="line">/** Place below the prepositional object */</span><br><span class="line">kPlaceBelow,</span><br><span class="line">/** Place within and at the top of the prepositional container */</span><br><span class="line">kPlaceInsideOnTop,</span><br><span class="line">/** Place within and at the bottom of the prepositional container */</span><br><span class="line">kPlaceInsideOnBottom,</span><br><span class="line">/** Place at the top of the paint order, ignoring prepositional object */</span><br><span class="line">kPlaceAboveAll,</span><br><span class="line">/** Place at the bottom of the paint order, ignoring prepositional object */</span><br><span class="line">kPlaceBelowAll</span><br><span class="line">&#125; AIPaintOrder;</span><br></pre></td></tr></table></figure></li></ul><h2 id="AILayerHandle"><a href="#AILayerHandle" class="headerlink" title="AILayerHandle"></a>AILayerHandle</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">typedef struct _t_AILayerOpaque* AILayerHandle</span><br><span class="line">Opaque reference to a layer.</span><br></pre></td></tr></table></figure><h2 id="使用实例"><a href="#使用实例" class="headerlink" title="使用实例"></a>使用实例</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">//使用InsertLayer，SetLayerTitle，GetLayerByTitle，DeleteLayer</span><br><span class="line">AILayerHandle m_pointLinePolyLayer;</span><br><span class="line">AILayerHandle m_borderMarkLayer;</span><br><span class="line">sAILayer-&gt;InsertLayer(m_pointLinePolyLayer, kPlaceInsideOnTop, &amp;m_borderMarkLayer);//在点线面图层上添加色带图层</span><br><span class="line">sAILayer-&gt;SetLayerTitle(m_borderMarkLayer, ai::UnicodeString(&quot;色带图层&quot;));//设置新添加图层名称</span><br><span class="line">AILayerHandle polyAnnoLayers;</span><br><span class="line">sAILayer-&gt;GetLayerByTitle(&amp;polyAnnoLayers, ai::UnicodeString(L&quot;面注记图层&quot;));//找到名为面注记图层的layer</span><br><span class="line">sAILayer-&gt;DeleteLayer(polyAnnoLayers);//删除面注记图层layer</span><br><span class="line"></span><br><span class="line">//使用GetLayerFirstChild，GetNextLayer</span><br><span class="line">AILayerHandle m_hideLayer;</span><br><span class="line">AILayerHandle FirstLayer;</span><br><span class="line">AILayerHandle NextLayer = NULL;</span><br><span class="line">sAILayer-&gt;GetLayerFirstChild(m_hideLayer,&amp;FirstLayer);</span><br><span class="line">//遍历如果存在图稿，则删除该图层</span><br><span class="line">while(FirstLayer)</span><br><span class="line">&#123;</span><br><span class="line">AIArtHandle ArtGroup;</span><br><span class="line">AIArtHandle Art;</span><br><span class="line">sAIArt-&gt;GetFirstArtOfLayer(FirstLayer,&amp;ArtGroup);</span><br><span class="line">sAIArt-&gt;GetArtFirstChild(ArtGroup,&amp;Art);</span><br><span class="line"></span><br><span class="line">AILayerHandle LayerTemp;</span><br><span class="line">LayerTemp =  FirstLayer;</span><br><span class="line">sAILayer-&gt;GetNextLayer(FirstLayer,&amp;FirstLayer);</span><br><span class="line">if(!Art)</span><br><span class="line">sAILayer-&gt;DeleteLayer(LayerTemp);</span><br><span class="line">&#125;</span><br><span class="line">sAILayer-&gt;SetLayerVisible(m_hideLayer, false);</span><br><span class="line"></span><br><span class="line">//使用GetNthLayer获得最上面的图层</span><br><span class="line">AILayerHandle hideLayer = NULL;</span><br><span class="line">    sAILayer-&gt;GetNthLayer(0, &amp;hideLayer);</span><br><span class="line">    AILayerHandle childHideLayer = NULL;</span><br></pre></td></tr></table></figure><h1 id="相关文章"><a href="#相关文章" class="headerlink" title="相关文章"></a>相关文章</h1><p><a href="/2019/03/14/ai-first-note">AI组件开发（一）–注记旋转矩阵</a><br><a href="/2019/03/18/ai-second-note">AI组件开发（二）–AIRealMathSuite</a><br><a href="/2019/03/24/ai-third-note">AI组件开发（三）–AIArtboardSuite</a><br><a href="/2019/03/24/ai-forth-document-note">AI组件开发（四）–AIDocumentSuite</a><br><a href="/2019/03/24/ai-fifth-ailayer-note">AI组件开发（五）–AILayerSuite</a><br><a href="/2019/03/24/ai-six-aiart-note">AI组件开发（六）–AIArtSuite</a><br><a href="/2019/03/25/ai-seven-path-note">AI组件开发（七）–AIPathSuite&amp;&amp;AIPathfinderSuite</a><br><a href="/2019/03/25/ai-eight-style-note">AI组件开发（八）–AIArtStyleSuite</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;文档中的图稿包含在图层中。AILayerSuite有一堆图层列表。堆栈中最顶层的层是当前正在编辑的层&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="AI组件开发" scheme="http://11wy11.github.io/categories/AI%E7%BB%84%E4%BB%B6%E5%BC%80%E5%8F%91/"/>
    
    
      <category term="AI" scheme="http://11wy11.github.io/tags/AI/"/>
    
  </entry>
  
  <entry>
    <title>AI组件开发（四）--AIDocumentSuite</title>
    <link href="http://11wy11.github.io/2019/03/24/ai-forth-document-note/"/>
    <id>http://11wy11.github.io/2019/03/24/ai-forth-document-note/</id>
    <published>2019-03-24T12:19:52.000Z</published>
    <updated>2019-03-25T06:08:15.405Z</updated>
    
    <content type="html"><![CDATA[<p>获取和设置有关当前文档的信息。<br><a id="more"></a></p><h1 id="AIDocumentSuite"><a href="#AIDocumentSuite" class="headerlink" title="AIDocumentSuite"></a>AIDocumentSuite</h1><p>使用这些函数可以获取和设置有关当前文档的信息。<br>某些功能仅在读取文件格式时适用。有些是在文件格式写入期间使用，但可以随时使用。</p><h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><ul><li>AIAPI AIErr（*     GetDocumentFileSpecification）（ai :: FilePath＆file）<br>   获得当前文档的文件规范。 </li><li>AIAPI AIErr（*     GetDocumentPageOrigin）（AIRealPoint * origin）<br>   获得相对于标尺原点指定的可成像页面左下角的坐标。 </li><li>AIAPI AIErr（*     SetDocumentPageOrigin）（AIRealPoint * origin）<br>   设置可成像页面左下角的坐标。 </li><li>AIAPI AIErr（*     SetDocumentRulerOrigin）（AIRealPoint * origin）<br>   设置当前文档的标尺原点。 </li><li>AIAPI AIErr（*     GetDocumentRulerUnits）（ai :: int16 *units）<br>   获得当前测量单位，显示在标尺中并显示在对话框中。 </li><li>AIAPI AIErr（*     SetDocumentRulerUnits）（ai :: int16 units）<br>   设置当前测量单位，显示在标尺中并显示在对话框中。 </li><li>AIAPI AIErr（*     GetDocumentCropStyle）（AICropMarkStyle * cropStyle）<br>   获得由“创建裁剪标记”命令和过滤器创建的裁剪标记的样式。 </li><li>AIAPI AIErr（*     SetDocumentCropStyle）（AICropMarkStyle cropStyle）<br>   设置“创建裁剪标记”命令和过滤器创建的裁剪标记的样式。 </li><li>AIAPI AIErr（*     GetDocumentSetup）（AIDocumentSetup * setup）<br>   获得有关通过文档“设置”对话框设置的当前文档的信息。 </li><li>AIAPI AIErr（*     SetDocumentSetup）（AIDocumentSetup * setup）<br>   设置文档设置信息，通过文档设置对话框设置。 </li><li>AIAPI AIErr（*     GetDocumentModified）（AIBoolean * modified）<br>   获得文档自上次保存以来是否已被编辑。 </li><li>AIAPI AIErr（*     SetDocumentModified）（AIBoolean修改）<br>   设置当前文档的修改状态。 </li><li>AIAPI AIErr（*     GetDocumentFileFormat）（AIFileFormatHandle * fileFormat）<br>   获得保存当前文档时要使用的文件格式。 </li><li>AIAPI AIErr（*     SetDocumentFileFormat）（AIFileFormatHandle fileFormat）<br>   设置保存当前文档时要使用的文件格式。 </li><li>AIAPI AIErr（*     GetDocumentFileFormatParameters）（AIDocumentFileFormatParameters *参数）<br>   获得与当前文档的关联文件格式关联的用户参数块。 </li><li>AIAPI AIErr（*     SetDocumentFileFormatParameters）（AIDocumentFileFormatParameters参数）<br>   设置与当前文档的关联文件格式关联的用户参数块。 </li><li>AIAPI AIErr（*     GetDocument）（AIDocumentHandle *文件）<br>   获得当前文档的不透明引用，以便与可以对当前文档以外的文档进行操作的函数一起使用。 </li><li>AIAPI AIErr（*     WriteDocument）（const ai :: FilePath＆file，const char * fileFormatName，AIBoolean askForParms）<br>   将当前文档写入文件而不修改文档或更改其修改状态。 </li><li>AIAPI AIErr（*     GetDocumentMiPrintRecord）（AIDocumentMiPrintRecordPtr打印）<br>   获得当前文档的打印记录。 </li><li>AIAPI AIErr（*     GetDocumentRulerOrigin）（AIRealPoint * origin）<br>   获得当前文档的标尺原点。 </li><li>AIAPI AIErr（*     UpdateLinks）（AIBoolean * updatedSomething）<br>   如果需要，更新当前文档中的链接对象。 </li><li>AIAPI AIErr（*     GetDocumentZoomLimit）（AIReal * min，AIReal * max）<br>   获得缩放的限制作为比例因子。 </li><li>AIAPI AIErr（*     GetDocumentMaxArtboardBounds）（AIRealRect * bounds）<br>   获得任何画板的最大有效范围，相对于当前文档的标尺原点表示，而不管文档画板的当前大小。 </li><li>AIAPI AIErr（*     DocumentExists）（AIDocumentHandle文档，AIBoolean *exists）<br>   报告文件是否存在; 也就是说，是一个打开的文档或剪贴板文档。 </li><li>AIAPI AIErr（*     GetDictionary）（struct _AIDictionary **Dictionary）<br>   获得与当前文档关联的录制Dictionary。 </li><li>AIAPI AIErr（*     GetDocumentColorModel）（ai :: int16 * colorModel）<br>   获得文档颜色模型。 </li><li>AIAPI AIErr（*     SetDocumentColorModel）（ai :: int16 colorModel）<br>   在加载时设置文档的预期颜色模型。 </li><li>AIAPI AIErr（*     GetDocumentProfiles）（AIColorProfile * rgbProfile，AIColorProfile * cmykProfile，AIColorProfile * grayProfile）<br>   获得当前文档的颜色校准配置文件。 </li><li>AIAPI AIErr（*     SetDocumentProfiles）（AIColorProfile rgbProfile，AIColorProfile cmykProfile，AIColorProfile grayProfile）<br>   设置当前文档的颜色校准配置文件。 </li><li>AIAPI AIErr（*     Copy）（）<br>   将当前选定的对象复制到剪贴板。 </li><li>AIAPI AIErr（*     Cut）（）<br>   将当前选定的对象剪切到剪贴板。 </li><li>AIAPI AIErr（*     Paste）（）<br>   将剪贴板的内容粘贴到文档中。 </li><li>AIAPI AIErr（* AIDocumentSuite :: SyncDocument）<br>更新缓存的图稿属性。<br>例如，组的选择状态被缓存，并根据其子项的状态确定。您通常不需要调用此函数。Illustrator会根据需要重新计算缓存的属性。</li><li>AIAPI AIErr（*     GetNonRecordedDictionary）（struct _AIDictionary **Dictionary）<br>   获得与当前文档关联的未记录Dictionary。 </li><li>AIAPI int（*     GetAIVersion）（）<br>   获得上次保存当前文档的Illustrator文件格式的版本。 </li><li>AIAPI AIErr（*     DocumentHasTransparency）（AIBoolean * hasTransparency，AIBoolean detectOverprint）<br>   报告是否根据当前视图设置渲染当前文档需要任何非不透明的绘制操作。 </li><li>AIAPI AIErr（*     DocumentHasSpotColorArt）（AIBoolean * hasSpotColorArt）<br>   报告是否根据当前视图设置渲染当前文档需要绘制任何专色。 </li><li>AIAPI AIErr（*     GetDocumentAssetMgmtInfo）（AIBoolean * managed，ai :: int32 * pNAlternates，AIBoolean * checkedOut，const char ** URL，AIBoolean * canEdit，char * fileType）<br>   获得资产管理信息。 </li><li>AIAPI AIErr（*     SetDocumentAssetMgmtInfo）（AIBoolean * managed，AIBoolean * checkedOut，const char * URL，AIBoolean * canEdit）<br>   设置资产管理信息。 </li><li>AIAPI AIErr（*     GetDocumentURL）（AIDocumentHandle文档，const char ** URL）<br>   获得与文档关联的URL。 </li><li>AIAPI AIErr（*     GetDocumentXAP）（const char ** xap）<br>   获得当前文档的XMP元数据。 </li><li>AIAPI AIErr（*     SetDocumentXAP）（const char * xap）<br>   设置当前文档的XMP元数据。 </li><li>AIAPI AIErr（*     SuspendTextReflow）（）<br>   暂停当前​​文档中所有文本对象的任何文本重排。 </li><li>AIAPI AIErr（*     ResumeTextReflow）（）<br>   恢复文本重排。 </li><li>AIAPI AIErr（*     GetTextSelection）（TextRangesRef * pTextSelection）<br>   获得当前文档的文本选择对象。 </li><li>AIAPI AIErr（*     HasTextFocus）（AIBoolean * focus）<br>   报告当前文档是否处于文本编辑模式。 </li><li>AIAPI AIErr（*     HasTextCaret）（AIBoolean * caret）<br>   报告当前文档是处于文本编辑模式还是插入符号闪烁（与选择的文本范围相反）。 </li><li>AIAPI AIErr（*     GetTextFocus）（StoryRef * pStory）<br>   获得处于编辑模式的当前故事。 </li><li>AIAPI AIErr（*     SetTextFocus）（StoryRef故事）<br>   将故事设置为处于编辑模式。 </li><li>AIAPI AIErr（*     LoseTextFocus）（）<br>   退出文本编辑模式。 </li><li>AIAPI AIErr（*     GetDocumentTextResources）（DocumentTextResourcesRef * pDocResources）<br>   获得当前文档的文本资源对象。 </li><li>AIAPI AIErr（*     WriteDocumentMacInformationResource）（const ai :: FilePath＆file）</li><li>AIAPI AIErr（*     WriteDocumentWithOptions）（const ai :: FilePath＆file，const char * fileFormatName，ai :: int32 options，AIBoolean askForParms）<br>   将当前文档写入具有指定写入选项的文件，而不修改文档或更改其修改状态。 </li><li>AIAPI AIErr（*     DocumentHasOverprint）（AIBoolean * hasOverprint）<br>   报告是否根据当前视图设置呈现当前文档需要绘制任何叠印对象。 </li><li>AIAPI AIErr（*     DocumentHasManagedLinks）（AIDocumentHandle文档，AIBoolean * hasManagedLinks）<br>   报告文档是否包含任何托管链接。 </li><li>AIAPI AIErr（*     GetDocumentSpotColorMode）（AIDocumentHandle文档，AISpotColorMode *模式）<br>   获得文档的专色模式，该模式控制添加到文档的新专色的外观定义。 </li><li>AIAPI AIErr（*     SetDocumentSpotColorMode）（AIDocumentHandle文档，AISpotColorMode模式，AIBoolean转换，AIBoolean *转换）<br>   设置文档的专色模式，该模式控制添加到文档的新专色的外观定义。 </li><li>AIAPI AIErr（*     撤消）（）<br>   撤消最近的可撤消事务。 </li><li>AIAPI AIErr（*     重做）（）<br>   重做最近的可重做事务。 </li><li>AIAPI AIErr（*     DocumentRasterAttributes）（AIBoolean * hasDeviceNRasters，AIBoolean * hasOverprint）<br>   报告当前文档是否包含任何DeviceN或叠印栅格。 </li><li>AIAPI AIErr（*     GetDocumentStartupProfile）（AIDocumentHandle文档，AIDocumentStartupProfile * startupProfile）<br>   获得文档启动配置文件。 </li><li>AIAPI AIErr（*     GetDocumentBleeds）（AIRealRect * bleedOffset）<br>   获得文档的bleedOffset。 </li><li>AIAPI AIErr（*     SetDocumentBleeds）（const AIRealRect＆bleedOffset）<br>   设置文档的bleedOffset。 </li><li>AIAPI AIErr（*     SetDocumentPixelPerfectStatus）（AIBoolean isPixelPerfect）<br>   打开或关闭文档的Pixel Perfect模式。 </li><li>AIAPI AIBoolean（*     GetDocumentPixelPerfectStatus）（）<br>   报告文档当前是否处于Pixel Perfect模式。 <h2 id="使用实例"><a href="#使用实例" class="headerlink" title="使用实例"></a>使用实例</h2></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">//xxxSuites.h</span><br><span class="line">#include &lt;AIDocument.h&gt;</span><br><span class="line">extern&quot;C&quot; AIDocumentSuite*sAIDocument;</span><br><span class="line"></span><br><span class="line">//xxxSuites.cpp</span><br><span class="line">extern &quot;C&quot;&#123;</span><br><span class="line">AIDocumentSuite*sAIDocument = NULL;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ImportSuite gImportSuites[] = &#123;</span><br><span class="line">    IMPORT_TEXT_SUITES</span><br><span class="line">    kAIDocumentSuite, kAIDocumentSuiteVersion, &amp;sAIDocument,</span><br><span class="line">        nil, 0, nil</span><br><span class="line">      &#125;;</span><br><span class="line">//XXXPlugin.cpp</span><br><span class="line">//绘制操作</span><br><span class="line">sAIDocument-&gt;SyncDocument();//更新图稿属性</span><br><span class="line">TextRangesRef rangesRef = NULL;</span><br><span class="line">sAIDocument-&gt;GetTextSelection(&amp;rangesRef);//获得当前文档的文本选择对象</span><br></pre></td></tr></table></figure><h1 id="相关文章"><a href="#相关文章" class="headerlink" title="相关文章"></a>相关文章</h1><p><a href="/2019/03/14/ai-first-note">AI组件开发（一）–注记旋转矩阵</a><br><a href="/2019/03/18/ai-second-note">AI组件开发（二）–AIRealMathSuite</a><br><a href="/2019/03/24/ai-third-note">AI组件开发（三）–AIArtboardSuite</a><br><a href="/2019/03/24/ai-forth-document-note">AI组件开发（四）–AIDocumentSuite</a><br><a href="/2019/03/24/ai-fifth-ailayer-note">AI组件开发（五）–AILayerSuite</a><br><a href="/2019/03/24/ai-six-aiart-note">AI组件开发（六）–AIArtSuite</a><br><a href="/2019/03/25/ai-seven-path-note">AI组件开发（七）–AIPathSuite&amp;&amp;AIPathfinderSuite</a><br><a href="/2019/03/25/ai-eight-style-note">AI组件开发（八）–AIArtStyleSuite</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;获取和设置有关当前文档的信息。&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="AI组件开发" scheme="http://11wy11.github.io/categories/AI%E7%BB%84%E4%BB%B6%E5%BC%80%E5%8F%91/"/>
    
    
      <category term="AI" scheme="http://11wy11.github.io/tags/AI/"/>
    
  </entry>
  
  <entry>
    <title>AI组件开发（三）--AIArtboardSuite</title>
    <link href="http://11wy11.github.io/2019/03/24/ai-third-note/"/>
    <id>http://11wy11.github.io/2019/03/24/ai-third-note/</id>
    <published>2019-03-24T08:53:24.000Z</published>
    <updated>2019-03-25T06:08:15.567Z</updated>
    
    <content type="html"><![CDATA[<p>AIArtboardSuite此套件提供的实用程序允许在文档中创建和操作Artboards。相关类ArtboardProperties和ArtboardList<br><a id="more"></a></p><h1 id="AIArtboardSuite"><a href="#AIArtboardSuite" class="headerlink" title="AIArtboardSuite"></a>AIArtboardSuite</h1><p>此套件提供的实用程序允许您在文档中创建和操作画板Artboards。文档与ArtboardList包含多个Artboard对象的对象相关联，每个ArtboardProperties对象与对象相关联。</p><p>建议您使用的包装类，ai::ArtboardProperties和ai::ArtboardList而不是直接调用这些功能。</p><p>使用SPBasicSuite::AcquireSuite()常量kAIArtboardSuite和使用获取此套件kAIArtboardSuiteVersion。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">//xxxSuites.h</span><br><span class="line">#include &quot;AIArtboard.h&quot;</span><br><span class="line">extern&quot;C&quot; AIArtboardSuite*sAIArtboard;</span><br><span class="line"></span><br><span class="line">//xxxSuites.cpp</span><br><span class="line">extern &quot;C&quot;&#123;</span><br><span class="line">AIArtboardSuite*sAIArtboard = NULL;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">ImportSuite gImportSuites[] = &#123;</span><br><span class="line">    IMPORT_TEXT_SUITES</span><br><span class="line">    kAIArtboardSuite, kAIArtboardSuiteVersion, &amp;sAIArtboard,</span><br><span class="line">        nil, 0, nil</span><br><span class="line">      &#125;;</span><br></pre></td></tr></table></figure></p><!-- START doctoc generated TOC please keep comment here to allow auto update --><!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE --><p><strong>目录</strong>  <em>generated with <a href="https://github.com/thlorenz/doctoc" target="_blank" rel="noopener">DocToc</a></em></p><ul><li><a href="#addnew">AddNew</a></li><li><a href="#cloneartboard">CLoneArtboard</a></li><li><a href="#3delete">3.Delete</a></li><li><a href="#4dispose">4.Dispose</a></li><li><a href="#5getactive">5.GetActive</a></li><li><a href="#6getartboardproperties">6.GetArtboardProperties</a></li><li><a href="#7getcount">7.GetCount</a></li><li><a href="#8getname">8.GetName</a></li><li><a href="#9getpar">9.GetPAR</a></li><li><a href="#10getposition">10.GetPosition</a></li><li><a href="#11getrulerorigin">11.GetRulerOrigin</a></li><li><a href="#12getshowdisplaymark">12.GetShowDisplayMark</a></li><li><a href="#13init">13.Init</a></li><li><a href="#14insert">14.Insert</a></li><li><a href="#15isdefaultname">15.IsDefaultName</a></li><li><a href="#16releaseartboardlist">16.ReleaseArtboardList</a></li><li><a href="#17-setactive">17. SetActive</a></li><li><a href="#18setisdefaultname">18.SetIsDefaultName</a></li><li><a href="#19setname">19.SetName</a></li><li><a href="#20setpar">20.SetPAR</a></li><li><a href="#21setposition">21.SetPosition</a></li><li><a href="#22setrulerorigin">22.SetRulerOrigin</a></li><li><a href="#23setshowdisplaymark">23.SetShowDisplayMark</a></li><li><a href="#24update">24.Update</a></li></ul><!-- END doctoc generated TOC please keep comment here to allow auto update --><h2 id="AddNew"><a href="#AddNew" class="headerlink" title="AddNew"></a>AddNew</h2><p>AIAPI AIErr（* AIArtboardSuite :: AddNew）（ai :: ArtboardList＆artboardList，ai :: ArtboardProperties＆newArtboard，ai :: ArtboardID ＆index）<br>将新画板添加到当前文档并在画板列表中报告其索引位置。</p><ul><li>参数：<br>  artboardList     画板列表对象。<br>  newArtboard     新画板的属性对象。<br>  index     <strong>[out]</strong>一个缓冲区，用于返回新画板的从0开始的索引位置。  </li><li>返回：<br>  kAIExceededMaxArtboardLimitErr列表大小超过应用程序定义的限制时的错误。  </li></ul><p>参考ai :: ArtboardList :: AddNew（）</p><h2 id="CLoneArtboard"><a href="#CLoneArtboard" class="headerlink" title="CLoneArtboard"></a>CLoneArtboard</h2><p>AIAPI AIErr（* AIArtboardSuite :: CloneArtboard）（ai :: ArtboardProperties &amp;artboard，const ai :: ArtboardProperties &amp;newArtboard）<br>复制画板对象。</p><ul><li>参数：<br>  artboard     artboard属性要克隆。<br>  newArtboard     <strong>[out]</strong>用于返回新画图属性对象。 </li></ul><p>参考ai :: ArtboardProperties :: ArtboardProperties()</p><h2 id="3-Delete"><a href="#3-Delete" class="headerlink" title="3.Delete"></a>3.Delete</h2><p>AIAPI AIErr（* AIArtboardSuite ::Delete）（ai :: ArtboardList &amp;artboardList，ai :: ArtboardID &amp;index）<br>从画板列表中删除画板，并使列表中的下一个画板处于活动状态。</p><p>无法删除最后一个画板。</p><ul><li>参数：<br>  artboardList     画板列表对象。<br>  index     要从列表中删除的画板的从0开始的索引位置。  </li><li>返回：<br>  kAICantDeleteLastArtboardErr如果您尝试删除最后一个画板时出现错误。  </li></ul><p>参考ai::ArtboardList::Delete()。</p><h2 id="4-Dispose"><a href="#4-Dispose" class="headerlink" title="4.Dispose"></a>4.Dispose</h2><p>AIAPI AIErr(* AIArtboardSuite::Dispose)(ai::ArtboardProperties &amp;properties)<br>释放画板属性对象。</p><ul><li>参数：<br>properties     画板属性对象。    </li></ul><p>参考ai :: ArtboardProperties :: ~ArtboardProperties（）</p><h2 id="5-GetActive"><a href="#5-GetActive" class="headerlink" title="5.GetActive"></a>5.GetActive</h2><p>AIAPI AIErr（* AIArtboardSuite :: GetArtboardList）（ai :: ArtboardList ＆artboardList）<br>获得当前文档的画板列表。</p><ul><li>参数：<br> artboardList     <strong>[out]</strong>用于返回画板列表对象的引用。   </li></ul><p>参考ai :: ArtboardList :: ArtboardList（）。</p><h2 id="6-GetArtboardProperties"><a href="#6-GetArtboardProperties" class="headerlink" title="6.GetArtboardProperties"></a>6.GetArtboardProperties</h2><p>AIAPI AIErr（* AIArtboardSuite :: GetArtboardProperties）（ai :: ArtboardList &amp;artboardList，ai :: ArtboardID index，ai :: ArtboardProperties &amp;properties）<br>从画板列表中获得画板的属性。</p><p>使用GetCount()和Update()修改画板而不更改文档中哪个画板处于活动状态。</p><ul><li>参数：<br>  artboardList     画板列表对象。<br>  index     列表中画板的从0开始的索引位置。<br>  properties     <strong>[out]</strong>用于返回画板属性对象。出错时，返回无效对象</li><li>使用：    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ai::ArtboardProperties tempArtboardProperties;</span><br><span class="line">ai::ArtboardList tempoartboardList;</span><br><span class="line">sAIArtboard-&gt;GetArtboardList(tempoartboardList);</span><br><span class="line">sAIArtboard-&gt;GetArtboardProperties(tempoartboardList, 0, tempArtboardProperties);</span><br></pre></td></tr></table></figure></li></ul><h2 id="7-GetCount"><a href="#7-GetCount" class="headerlink" title="7.GetCount"></a>7.GetCount</h2><p>AIAPI AIErr（* AIArtboardSuite :: GetCount）（const ai :: ArtboardList &amp;artboardList，ai :: ArtboardID &amp;count）<br>获得画板列表中定义的画板数量。</p><ul><li>参数：<br>  artboardList     画板列表对象。<br>  count     <strong>[out]</strong>用于返回画板数量。</li></ul><p>参考ai :: ArtboardList :: GetCount（）。</p><h2 id="8-GetName"><a href="#8-GetName" class="headerlink" title="8.GetName"></a>8.GetName</h2><p>AIAPI AIErr(* AIArtboardSuite::GetName)(const ai::ArtboardProperties &amp; properties, ai::UnicodeString &amp;name)</p><h2 id="9-GetPAR"><a href="#9-GetPAR" class="headerlink" title="9.GetPAR"></a>9.GetPAR</h2><p>AIAPI AIErr(* AIArtboardSuite::GetPAR)(const ai::ArtboardProperties &amp;properties, AIReal &amp;par)<br>获得画板标尺的像素长宽比。</p><ul><li>参数：<br>  properties     画板属性对象。<br>  par     <strong>[out]</strong>用于返回像素宽高比。</li><li>实例：  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ai::ArtboardProperties tempArtboardProperties;</span><br><span class="line">ai::ArtboardList tempoartboardList;</span><br><span class="line">sAIArtboard-&gt;GetArtboardList(tempoartboardList);</span><br><span class="line">sAIArtboard-&gt;GetArtboardProperties(tempoartboardList, 0, tempArtboardProperties);</span><br><span class="line">AIReal artPar;</span><br><span class="line">sAIArtboard-&gt;GetPAR(tempArtboardProperties,artPar)</span><br></pre></td></tr></table></figure></li></ul><h2 id="10-GetPosition"><a href="#10-GetPosition" class="headerlink" title="10.GetPosition"></a>10.GetPosition</h2><p>AIAPI AIErr（* AIArtboardSuite :: GetPosition）（const ai :: ArtboardProperties＆properties，AIRealRect＆bounds）<br>获得画板的位置和边界。</p><ul><li>参数：<br>  properties     画板属性对象。<br>  bounds     <strong>[out]</strong>一个矩形对象，用于返回画板的位置和边界。</li><li>实例：  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ai::ArtboardProperties tempArtboardProperties;</span><br><span class="line">ai::ArtboardList tempoartboardList;</span><br><span class="line">sAIArtboard-&gt;GetArtboardList(tempoartboardList);</span><br><span class="line">sAIArtboard-&gt;GetArtboardProperties(tempoartboardList, 0, tempArtboardProperties);</span><br><span class="line">AIRealRect Bound;</span><br><span class="line">sAIArtboard-&gt;GetPosition(tempArtboardProperties, Bound);      </span><br><span class="line">ASReal bottom = Bound.bottom;</span><br><span class="line">ASReal top = Bound.top;</span><br><span class="line">ASReal right = Bound.right;</span><br><span class="line">ASReal left = Bound.left;</span><br></pre></td></tr></table></figure></li></ul><h2 id="11-GetRulerOrigin"><a href="#11-GetRulerOrigin" class="headerlink" title="11.GetRulerOrigin"></a>11.GetRulerOrigin</h2><p>AIAPI AIErr（* AIArtboardSuite :: GetRulerOrigin）（const ai :: ArtboardProperties＆properties，AIRealPoint＆rulerOrigin）<br>获得相对于左下角的画板的标尺原点。</p><ul><li>参数：<br>  properties     画板属性对象。<br>  rulerOrigin     <strong>[out]</strong>用于返回标尺原点。</li></ul><h2 id="12-GetShowDisplayMark"><a href="#12-GetShowDisplayMark" class="headerlink" title="12.GetShowDisplayMark"></a>12.GetShowDisplayMark</h2><p>AIAPI AIErr（* AIArtboardSuite :: GetShowDisplayMark）（const ai :: ArtboardProperties＆properties，ai :: ArtboardProperties :: DisplayMarkType type，AIBoolean＆show）<br>报告当前是否显示特定类型的画板注释。</p><ul><li>参数：<br>  properties     画板属性对象。<br>  type     注释类型。<br>  show     如果显示类型则返回true，如果隐藏则返回false。</li></ul><h2 id="13-Init"><a href="#13-Init" class="headerlink" title="13.Init"></a>13.Init</h2><p>AIAPI AIErr（* AIArtboardSuite :: Init）（ai :: ArtboardProperties＆artboard）<br>使用默认值初始化画板属性对象。</p><ul><li>参数：<br>artboard     画板属性对象。</li></ul><h2 id="14-Insert"><a href="#14-Insert" class="headerlink" title="14.Insert"></a>14.Insert</h2><p>AIAPI AIErr（* AIArtboardSuite :: Insert）（ai :: ArtboardList＆artboardList，ai :: ArtboardProperties＆artboard，ai :: ArtboardID＆index）<br>在指定位置插入新画板。</p><ul><li>参数：<br>  artboardList     ArtboardList对象。<br>  artboard     新画板的属性。<br>  index     基于0的新画板的索引位置。</li><li>返回：<br>  kAIExceededMaxArtboardLimitErr如果超出允许的最大画板数，则会出错。</li></ul><h2 id="15-IsDefaultName"><a href="#15-IsDefaultName" class="headerlink" title="15.IsDefaultName"></a>15.IsDefaultName</h2><p>AIAPI AIErr（* AIArtboardSuite :: IsDefaultName）（const ai :: ArtboardProperties＆properties，AIBoolean＆isDefault）<br>报告画板的当前名称是否是应用程序生成的。</p><p>在这种情况下，用户选择将画板内容导出为JPEG，并将画板保存为单独的文件时，文件只能通过编号来区分，而不是完整生成的名称; 例如，myArt-01.jpg。如果已明确设置画板名称，则会在导出的JPEG文件名中使用该名称。</p><ul><li>参数：<br>  properties     画板属性对象。<br>  isDefault     如果生成名称则返回true的缓冲区，如果已显式设置，则返回false。</li></ul><h2 id="16-ReleaseArtboardList"><a href="#16-ReleaseArtboardList" class="headerlink" title="16.ReleaseArtboardList"></a>16.ReleaseArtboardList</h2><p>AIAPI AIErr(* AIArtboardSuite::ReleaseArtboardList)(ai::ArtboardList &amp;artboardList)<br>释放画板列表对象。</p><ul><li>参数：<br>  artboardList     画板列表对象。</li></ul><h2 id="17-SetActive"><a href="#17-SetActive" class="headerlink" title="17. SetActive"></a>17. SetActive</h2><p>AIAPI AIErr（* AIArtboardSuite :: SetActive）（ai :: ArtboardList＆artboardList，ai :: ArtboardID index）<br>使特定画板处于活动状态，并使其按迭代顺序显示。</p><ul><li>参数：<br>  artboardList     画板列表对象。<br>  index     列表中画板的从0开始的索引位置。  </li></ul><h2 id="18-SetIsDefaultName"><a href="#18-SetIsDefaultName" class="headerlink" title="18.SetIsDefaultName"></a>18.SetIsDefaultName</h2><p>AIAPI AIErr（* AIArtboardSuite :: SetIsDefaultName）（ai :: ArtboardProperties＆properties，const AIBoolean＆isDefault）</p><h2 id="19-SetName"><a href="#19-SetName" class="headerlink" title="19.SetName"></a>19.SetName</h2><p>AIAPI AIErr(* AIArtboardSuite::SetName)(ai::ArtboardProperties &amp;properties, const ai::UnicodeString &amp;name)</p><h2 id="20-SetPAR"><a href="#20-SetPAR" class="headerlink" title="20.SetPAR"></a>20.SetPAR</h2><p>AIAPI AIErr（* AIArtboardSuite :: SetPAR）（ai :: ArtboardProperties＆properties，AIReal par）<br>修改画板标尺的像素长宽比。</p><p>AIArtboardSuite::Update()使用此对象调用进行更改。</p><ul><li>参数：<br>  properties     画板属性对象。<br>  par     新的像素长宽比。  </li></ul><h2 id="21-SetPosition"><a href="#21-SetPosition" class="headerlink" title="21.SetPosition"></a>21.SetPosition</h2><p>AIAPI AIErr（* AIArtboardSuite :: SetPosition）（ai :: ArtboardProperties＆properties，const AIRealRect＆bounds）<br>修改画板的位置和边界。</p><p>AIArtboardSuite::Update()使用此对象调用进行更改。</p><ul><li>参数：<br>  properties     画板属性对象<br>  bounds     新的位置和边界  </li></ul><h2 id="22-SetRulerOrigin"><a href="#22-SetRulerOrigin" class="headerlink" title="22.SetRulerOrigin"></a>22.SetRulerOrigin</h2><p>AIAPI AIErr（* AIArtboardSuite :: SetRulerOrigin）（ai :: ArtboardProperties＆properties，const AIRealPoint＆rulerOrigin）<br>设置画板的标尺原点，相对于左下角。</p><ul><li>参数：<br>properties     画板属性对象<br>rulerOrigin     标尺原点</li></ul><h2 id="23-SetShowDisplayMark"><a href="#23-SetShowDisplayMark" class="headerlink" title="23.SetShowDisplayMark"></a>23.SetShowDisplayMark</h2><p>AIAPI AIErr（* AIArtboardSuite :: SetShowDisplayMark）（ai :: ArtboardProperties＆properties，ai :: ArtboardProperties :: DisplayMarkType type，AIBoolean show）<br>设置当前是否显示特定类型的画板注释。</p><h2 id="24-Update"><a href="#24-Update" class="headerlink" title="24.Update"></a>24.Update</h2><p>AIAPI AIErr（* AIArtboardSuite :: Update）（ai :: ArtboardList＆artboardList，ai :: ArtboardID index，const ai :: ArtboardProperties＆properties）<br>更新画板的属性。</p><p>使用GetCount()和GetArtboardProperties()修改画板而不更改文档中哪个画板处于活动状态。</p><ul><li>参数：<br>  artboardList     画板列表对象。<br>  index     文档列表中画板的从0开始的索引位置。<br>  properties     包含新画板属性的对象。</li><li>实例： <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">AIRealRect DateBound;</span><br><span class="line">AIRealPoint CenterPt;</span><br><span class="line">double m_scale=2000</span><br><span class="line">DateBound.top = (this-&gt;DateBound.top - this-&gt;m_center.v) * 1000 / m_scale * (72 / 25.4) - AIcenter.v;</span><br><span class="line">DateBound.bottom = (this-&gt;DateBound.bottom - this-&gt;m_center.v) * 1000 / m_scale * (72 / 25.4) - AIcenter.v;</span><br><span class="line">DateBound.left = (this-&gt;DateBound.left - this-&gt;m_center.h) * 1000 / m_scale * (72 / 25.4) - AIcenter.h;</span><br><span class="line">DateBound.right = (this-&gt;DateBound.right - this-&gt;m_center.h) * 1000 / m_scale * (72 / 25.4) - AIcenter.h;</span><br><span class="line">   </span><br><span class="line">CenterPt.h = (DateBound.left - DateBound.right) / 2;</span><br><span class="line">CenterPt.v = (DateBound.top - DateBound.bottom) / 2;</span><br><span class="line">   </span><br><span class="line">sAIArtboard-&gt;SetPosition(tempArtboardProperties, DateBound);//*******</span><br><span class="line">sAIArtboard-&gt;Update(tempoartboardList, 0, tempArtboardProperties);//*******</span><br></pre></td></tr></table></figure></li></ul><h1 id="相关文章"><a href="#相关文章" class="headerlink" title="相关文章"></a>相关文章</h1><p><a href="/2019/03/14/ai-first-note">AI组件开发（一）–注记旋转矩阵</a><br><a href="/2019/03/18/ai-second-note">AI组件开发（二）–AIRealMathSuite</a><br><a href="/2019/03/24/ai-third-note">AI组件开发（三）–AIArtboardSuite</a><br><a href="/2019/03/24/ai-forth-document-note">AI组件开发（四）–AIDocumentSuite</a><br><a href="/2019/03/24/ai-fifth-ailayer-note">AI组件开发（五）–AILayerSuite</a><br><a href="/2019/03/24/ai-six-aiart-note">AI组件开发（六）–AIArtSuite</a><br><a href="/2019/03/25/ai-seven-path-note">AI组件开发（七）–AIPathSuite&amp;&amp;AIPathfinderSuite</a><br><a href="/2019/03/25/ai-eight-style-note">AI组件开发（八）–AIArtStyleSuite</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;AIArtboardSuite此套件提供的实用程序允许在文档中创建和操作Artboards。相关类ArtboardProperties和ArtboardList&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="AI组件开发" scheme="http://11wy11.github.io/categories/AI%E7%BB%84%E4%BB%B6%E5%BC%80%E5%8F%91/"/>
    
    
      <category term="AI" scheme="http://11wy11.github.io/tags/AI/"/>
    
  </entry>
  
  <entry>
    <title>GDAL相关类及函数</title>
    <link href="http://11wy11.github.io/2019/03/24/cpp-gdal-function/"/>
    <id>http://11wy11.github.io/2019/03/24/cpp-gdal-function/</id>
    <published>2019-03-24T06:27:22.000Z</published>
    <updated>2019-03-24T06:38:53.288Z</updated>
    
    <content type="html"><![CDATA[<p>主要介绍GDAL基本类及OGR相关类<br><a id="more"></a></p><h1 id="GDAL-基本使用函数"><a href="#GDAL-基本使用函数" class="headerlink" title="GDAL 基本使用函数"></a>GDAL 基本使用函数</h1><h2 id="CPLSetConfigOption"><a href="#CPLSetConfigOption" class="headerlink" title="CPLSetConfigOption"></a>CPLSetConfigOption</h2><p>void CPLSetConfigOption    （    const char <em>     pszKey，<br>const char </em>     pszValue<br>）<br>为GDAL / OGR使用设置配置选项。</p><p>这些选项被定义为（键，值）对。稍后可以使用CPLGetConfigOption（）方法获取与密钥对应的值。</p><p>此机制类似于环境变量，但使用CPLSetConfigOption（）设置的选项会覆盖CPLGetConfigOption（）的观点，即环境中定义的值。</p><p>如果使用相同的密钥多次调用CPLSetConfigOption（），则将使用上次调用期间提供的值。</p><p>也可以使用带有’-config KEY VALUE’的大多数GDAL实用程序的命令行传递选项。例如，ogrinfo -config CPL_DEBUG ON~ / data / test / point.shp</p><p>此函数也可用于通过传递NULL作为值来清除设置（注意：传递NULL不会取消设置现有环境变量;它将取消设置先前由CPLSetConfigOption（）设置的值）。</p><p>例如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CPLSetConfigOption(&quot;MDB_DRIVER_TEMPLATE&quot;, &quot;DRIVER=Microsoft Access Driver (*.mdb, *.accdb);DBQ=%s&quot;);</span><br><span class="line">CPLSetConfigOption(&quot;PGEO_DRIVER_TEMPLATE&quot;, &quot;DRIVER=Microsoft Access Driver (*.mdb, *.accdb);DBQ=%s&quot;);</span><br></pre></td></tr></table></figure></p><h2 id="GDALAllRegister"><a href="#GDALAllRegister" class="headerlink" title="GDALAllRegister"></a>GDALAllRegister</h2><p>   最初需要注册所需的所有格式驱动程序。这通常通过调用GDALAllRegister（）来完成，该寄存器注册GDAL / OGR中内置的所有格式驱动程序。<br>    原型：<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">void GDALAllRegister(void)</span><br><span class="line">//Register all known configured GDAL drivers.</span><br><span class="line">//注册所有已知配置的GDAL驱动程序。</span><br><span class="line"> //This function will drive any of the following that are configured into GDAL. See raster list and vector full list       </span><br><span class="line">//此功能将驱动配置为GDAL的以下任何内容。请参阅栅格列表和矢量完整列表    </span><br><span class="line">//This function should generally be called once at the beginning of the application.</span><br><span class="line">//通常应在应用程序开始时调用此函数一次。 </span><br><span class="line">  </span><br><span class="line">//使用</span><br><span class="line">#include“ ogrsf_frmts.h ”</span><br><span class="line">    int main（）</span><br><span class="line">    &#123;</span><br><span class="line">        GDALAllRegister（）;</span><br></pre></td></tr></table></figure></p><h2 id="GDALOpenEx"><a href="#GDALOpenEx" class="headerlink" title="GDALOpenEx"></a>GDALOpenEx</h2><p>以GDALDataset打开栅格或矢量文件。</p><p>此函数将尝试依次调用每个已注册的GDALDriver的Open方法来打开传递的文件或虚拟数据集名称。第一次成功打开将导致返回的数据集。如果所有驱动程序都失败，则返回NULL并发出错误。</p><p>几条建议：</p><ul><li>如果打开具有GDAL_OF_UPDATE访问权限的数据集对象，则不建议在同一基础文件上打开新数据集。</li><li>返回的数据集一次只能由一个线程访问。如果要从不同的线程中使用它，则必须添加所有必需的代码（互斥锁等）以避免并发使用该对象。（某些驱动程序，如GeoTIFF，维护每次读取新块时更新的内部状态变量，从而防止并发使用。）</li></ul><p>原型：<br>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">GDALDatasetH GDALOpenEx（const char * pszFilename，</span><br><span class="line">unsigned int nOpenFlags，</span><br><span class="line">const char * const * papszAllowedDrivers，</span><br><span class="line">const char * const * papszOpenOptions，</span><br><span class="line">const char * const * papszSiblingFiles </span><br><span class="line">）</span><br></pre></td></tr></table></figure></p><ul><li><p>参数  </p><ul><li><p><strong>pszFilename</strong>    要访问的文件的名称。在外来驱动程序的情况下，这可能不是指物理文件，而是包含驱动程序有关如何访问数据集的信息。它应该是UTF-8编码。</p></li><li><p><strong>nOpenFlags</strong> GDAL_OF_标志的组合，可以通过逻辑或运算符组合。  </p><ul><li>驱动程序类型：用于光栅驱动程序的GDAL_OF_RASTER，用于矢量驱动程序的GDAL_OF_VECTOR，用于地理网络模型驱动程序的GDAL_OF_GNM。如果未指定任何值，则隐含所有类型。</li><li>访问模式：GDAL_OF_READONLY（独占）或GDAL_OF_UPDATE。</li><li>共享模式：GDAL_OF_SHARED。如果设置，它允许与已设置GDAL_OF_SHARED的其他调用者共享数据集的GDALDataset句柄。特别是，GDALOpenEx（）将首先查询其当前打开和共享GDALDataset的列表，如果一个GetDescription（）名称与传递给GDALOpenEx（）的pszFilename完全匹配，则将引用并返回它，如果GDALOpenEx（）是从同一个线程调用。</li><li>详细错误：GDAL_OF_VERBOSE_ERROR。如果设置，则尝试打开文件失败将导致报告错误消息。</li></ul></li><li><p><strong>papszAllowedDrivers</strong>    NULL考虑所有候选驱动程序，或NULL终止的字符串列表，其中包含必须考虑的驱动程序短名称。</p></li><li><p><strong>papszOpenOptions</strong>    NULL或NULL终止的字符串列表，其中打开选项传递给候选驱动程序。所有驱动程序OVERVIEW_LEVEL = level都存在一个选项，用于选择数据集的特定概述级别。级别索引从0开始。级别编号可以以“仅”为后缀，以指定只有此概述级别必须可见，而不是子级别。默认情况下会验证打开选项，如果无法识别选项，则会发出警告。在某些情况下，可能不需要（例如，当不知道哪个驱动程序将打开文件时），因此可以将特殊打开选项VALIDATE_OPEN_OPTIONS设置为NO以避免此类警告。或者，从GDAL 2.1开始，选项名称前面可以加上@字符，表示如果驱动程序没有声明此选项，它可能不会引发警告。</p></li><li><p><strong>papszSiblingFiles</strong>    NULL或NULL终止的字符串列表，这些字符串是主文件名的辅助文件名。如果传递NULL，则将完成对文件系统的探测。</p></li></ul></li><li><p>返回<br>一个GDALDatasetH句柄或失败时为NULL。对于C ++应用程序，此句柄可以转换为GDALDataset *。</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GDALDataset       *poDS;</span><br><span class="line">poDS = (GDALDataset*) GDALOpenEx( &quot;point.shp&quot;, GDAL_OF_VECTOR, NULL, NULL, NULL );</span><br><span class="line">if( poDS == NULL )</span><br><span class="line">&#123;</span><br><span class="line">    printf( &quot;Open failed.\n&quot; );</span><br><span class="line">    exit( 1 );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>使用实例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GDALDataset       *poDS;</span><br><span class="line">poDS = (GDALDataset*) GDALOpenEx( &quot;point.shp&quot;, GDAL_OF_VECTOR, NULL, NULL, NULL );</span><br><span class="line">if( poDS == NULL )</span><br><span class="line">&#123;</span><br><span class="line">    printf( &quot;Open failed.\n&quot; );</span><br><span class="line">    exit( 1 );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="GDALDataSet"><a href="#GDALDataSet" class="headerlink" title="GDALDataSet"></a>GDALDataSet</h2><p>帮助文档<a href="https://www.gdal.org/classGDALDataset.html" target="_blank" rel="noopener">https://www.gdal.org/classGDALDataset.html</a><br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2019/03/24/cpp-gdal-function/pic2.png" alt="类图" title>                </div>                <div class="image-caption">类图</div>            </figure><br>部分函数介绍</p><ul><li><p>GetLayerByName<br>  Fetch a layer by name.</p><p>  The returned layer remains owned by the GDALDataset and should not be deleted by the application.</p><p>  This method is the same as the C function GDALDatasetGetLayerByName() and the deprecated OGR_DS_GetLayerByName().</p><p>  In GDAL 1.X, this method used to be in the OGRDataSource class.</p><p>  Parameters<br>  pszName    the layer name of the layer to fetch.<br>  Returns<br>  the layer, or NULL if Layer is not found or an error occurs.</p></li><li>GetLayerCount</li></ul><h1 id="OGR类或函数"><a href="#OGR类或函数" class="headerlink" title="OGR类或函数"></a>OGR类或函数</h1><h2 id="OGRLayer"><a href="#OGRLayer" class="headerlink" title="OGRLayer"></a>OGRLayer</h2><p>帮助文档<a href="https://www.gdal.org/classOGRLayer.html" target="_blank" rel="noopener">https://www.gdal.org/classOGRLayer.html</a><br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2019/03/24/cpp-gdal-function/pic1.png" alt="类图" title>                </div>                <div class="image-caption">类图</div>            </figure>  </p><ul><li>GetLayerDefn</li><li>GetExtent</li><li>ResetReading</li><li>GetNextFeature</li><li>GetName                                                <h2 id="OGRFeature"><a href="#OGRFeature" class="headerlink" title="OGRFeature"></a>OGRFeature</h2> 包括geometry和attributes</li><li>GetDefRef</li><li>GetGeometryRef<br> 返回指向内部要素几何的指针。不应修改此对象</li><li>GetFieldAsString 将字段值作为字符串获取</li><li>OGRFeature::DestroyFeature<br><code>void OGRFeature :: DestroyFeature    （    OGRFeature *     poFeature    ）</code><br> poFeatur要删除的Feature。<h2 id="OGRGeometry"><a href="#OGRGeometry" class="headerlink" title="OGRGeometry"></a>OGRGeometry</h2>所有几何类的抽象基类。</li></ul><p>一些空间分析方法要求在GEOS库上构建OGR才能正常工作。描述几何之间空间关系的方法的精确含义在SFCOM或其他简单特征接口规范中描述，例如“OpenGIS®地理信息实现规范 - 简单特征访问 - 第1部分：通用体系结构”：&lt;a href =“ <a href="http://www.opengeospatial.org/standards/sfa" target="_blank" rel="noopener">http://www.opengeospatial.org/standards/sfa</a> “&gt; OGC 06-103r4</p><p>在GDAL 2.0中，类的层次结构已经扩展为（工作草案）ISO SQL / MM第3部分（ISO / IEC 13249-3）曲线几何：CIRCULARSTRING（OGRCircularString），COMPOUNDCURVE（OGRCompoundCurve），CURVEPOLYGON（OGRCurvePolygon），MULTICURVE（OGRMultiCurve）和MULTISURFACE（OGRMultiSurface）。</p><h3 id="OGRPoint"><a href="#OGRPoint" class="headerlink" title="OGRPoint"></a>OGRPoint</h3><h3 id="OGRLineString"><a href="#OGRLineString" class="headerlink" title="OGRLineString"></a>OGRLineString</h3><p>多顶点线的具体表示。继承OGRSimpleCurve</p><ul><li>getPoints<br><code>void OGRSimpleCurve::getPoints    (    OGRRawPoint *     paoPointsOut,double *     padfZOut = nullptr )</code></li><li>getPoint<br><code>void OGRSimpleCurve::getPoint    (    int     i,OGRPoint *     poPoint )</code><br>获取行字符串中的一个点。<br>i:要获取的顶点，从0到getNumPoints（） - 1<br>poPoint    用获取的点初始化的点。</li><li>getNumPoints<br>获得线上点的个数<h3 id="OGRMultiLineString"><a href="#OGRMultiLineString" class="headerlink" title="OGRMultiLineString"></a>OGRMultiLineString</h3></li><li>getNumGeometries<br>获得几何要素格个数<h3 id="OGRPolygon"><a href="#OGRPolygon" class="headerlink" title="OGRPolygon"></a>OGRPolygon</h3></li><li>getExteriorRing<br> 获取对外部多边形环的引用   </li><li>getNumInteriorRings<br>获取指示内部环的数量</li><li>getInteriorRing<br>获取指示内部环的引用<h2 id="OGRFeatureDefn"><a href="#OGRFeatureDefn" class="headerlink" title="OGRFeatureDefn"></a>OGRFeatureDefn</h2> 要素类或要素图层的定义。<ul><li>GetFieldCount 获取字段数</li><li>GetFieldDefn 获得字段 参数：字段索引<h2 id="OGRFieldDefn"><a href="#OGRFieldDefn" class="headerlink" title="OGRFieldDefn"></a>OGRFieldDefn</h2></li><li>GetNameRef 字段名称</li></ul></li></ul><h2 id="OGREnvelope"><a href="#OGREnvelope" class="headerlink" title="OGREnvelope"></a>OGREnvelope</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">class CPL_DLL OGREnvelope</span><br><span class="line">&#123;</span><br><span class="line">  public:</span><br><span class="line">        OGREnvelope() : MinX(std::numeric_limits&lt;double&gt;::infinity()),</span><br><span class="line">                        MaxX(-std::numeric_limits&lt;double&gt;::infinity()),</span><br><span class="line">                        MinY(std::numeric_limits&lt;double&gt;::infinity()),</span><br><span class="line">                        MaxY(-std::numeric_limits&lt;double&gt;::infinity())</span><br><span class="line">        &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        OGREnvelope(const OGREnvelope&amp; oOther) :</span><br><span class="line">            MinX(oOther.MinX),MaxX(oOther.MaxX), MinY(oOther.MinY), MaxY(oOther.MaxY)</span><br><span class="line">        &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    double      MinX;</span><br><span class="line">    double      MaxX;</span><br><span class="line">    double      MinY;</span><br><span class="line">    double      MaxY;</span><br><span class="line"></span><br><span class="line">#ifdef HAVE_GCC_DIAGNOSTIC_PUSH</span><br><span class="line">#pragma GCC diagnostic push</span><br><span class="line">#pragma GCC diagnostic ignored &quot;-Wfloat-equal&quot;</span><br><span class="line">#endif</span><br><span class="line">    int  IsInit() const &#123; return MinX != std::numeric_limits&lt;double&gt;::infinity(); &#125;</span><br><span class="line"></span><br><span class="line">#ifdef HAVE_GCC_DIAGNOSTIC_PUSH</span><br><span class="line">#pragma GCC diagnostic pop</span><br><span class="line">#endif</span><br><span class="line"></span><br><span class="line">    void Merge( OGREnvelope const&amp; sOther ) &#123;</span><br><span class="line">        MinX = MIN(MinX,sOther.MinX);</span><br><span class="line">        MaxX = MAX(MaxX,sOther.MaxX);</span><br><span class="line">        MinY = MIN(MinY,sOther.MinY);</span><br><span class="line">        MaxY = MAX(MaxY,sOther.MaxY);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void Merge( double dfX, double dfY ) &#123;</span><br><span class="line">        MinX = MIN(MinX,dfX);</span><br><span class="line">        MaxX = MAX(MaxX,dfX);</span><br><span class="line">        MinY = MIN(MinY,dfY);</span><br><span class="line">        MaxY = MAX(MaxY,dfY);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    void Intersect( OGREnvelope const&amp; sOther ) &#123;</span><br><span class="line">        if(Intersects(sOther))</span><br><span class="line">        &#123;</span><br><span class="line">            if( IsInit() )</span><br><span class="line">            &#123;</span><br><span class="line">                MinX = MAX(MinX,sOther.MinX);</span><br><span class="line">                MaxX = MIN(MaxX,sOther.MaxX);</span><br><span class="line">                MinY = MAX(MinY,sOther.MinY);</span><br><span class="line">                MaxY = MIN(MaxY,sOther.MaxY);</span><br><span class="line">            &#125;</span><br><span class="line">            else</span><br><span class="line">            &#123;</span><br><span class="line">                MinX = sOther.MinX;</span><br><span class="line">                MaxX = sOther.MaxX;</span><br><span class="line">                MinY = sOther.MinY;</span><br><span class="line">                MaxY = sOther.MaxY;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        &#123;</span><br><span class="line">            *this = OGREnvelope();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    int Intersects(OGREnvelope const&amp; other) const</span><br><span class="line">    &#123;</span><br><span class="line">        return MinX &lt;= other.MaxX &amp;&amp; MaxX &gt;= other.MinX &amp;&amp;</span><br><span class="line">               MinY &lt;= other.MaxY &amp;&amp; MaxY &gt;= other.MinY;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    int Contains(OGREnvelope const&amp; other) const</span><br><span class="line">    &#123;</span><br><span class="line">        return MinX &lt;= other.MinX &amp;&amp; MinY &lt;= other.MinY &amp;&amp;</span><br><span class="line">               MaxX &gt;= other.MaxX &amp;&amp; MaxY &gt;= other.MaxY;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="OGRwkbGeometryType"><a href="#OGRwkbGeometryType" class="headerlink" title="OGRwkbGeometryType"></a>OGRwkbGeometryType</h2><p>几何类型代码。<br>在下面这类中实现：<br> OGRMultiLineString, OGRMultiCurve, OGRMultiPoint, OGRTriangulatedSurface, OGRPolyhedralSurface, OGRMultiPolygon, OGRMultiSurface, OGRGeometryCollection, OGRTriangle, OGRPolygon, OGRCurvePolygon, OGRCompoundCurve, OGRCircularString, OGRLineString, and OGRPoint.  </p><p> 常亮值如：wkbPoint，wkbMultiPoint，wkbLineString,wkbMultiLineString，wkbPolygon，wkbCurvePolygon，wkbMultiPolygon</p><h1 id="参考资料："><a href="#参考资料：" class="headerlink" title="参考资料："></a>参考资料：</h1><ol><li>百度百科：<a href="https://baike.baidu.com/item/GDAL/4004525?fr=aladdin" target="_blank" rel="noopener">https://baike.baidu.com/item/GDAL/4004525?fr=aladdin</a></li><li>官方网站：<a href="https://www.gdal.org/" target="_blank" rel="noopener">https://www.gdal.org/</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;主要介绍GDAL基本类及OGR相关类&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="C++" scheme="http://11wy11.github.io/categories/C/"/>
    
    
      <category term="GDAL" scheme="http://11wy11.github.io/tags/GDAL/"/>
    
  </entry>
  
  <entry>
    <title>krpano快速初级教程（一）之javascript api</title>
    <link href="http://11wy11.github.io/2019/03/23/krpano-primary-first-note/"/>
    <id>http://11wy11.github.io/2019/03/23/krpano-primary-first-note/</id>
    <published>2019-03-23T02:37:05.000Z</published>
    <updated>2019-04-01T03:12:37.903Z</updated>
    
    <summary type="html">
    
    </summary>
    
      <category term="全景" scheme="http://11wy11.github.io/categories/%E5%85%A8%E6%99%AF/"/>
    
    
      <category term="krpano" scheme="http://11wy11.github.io/tags/krpano/"/>
    
  </entry>
  
  <entry>
    <title>VS2013打包C#项目</title>
    <link href="http://11wy11.github.io/2019/03/22/winform-release/"/>
    <id>http://11wy11.github.io/2019/03/22/winform-release/</id>
    <published>2019-03-22T13:54:22.000Z</published>
    <updated>2019-04-09T14:13:31.035Z</updated>
    
    <content type="html"><![CDATA[<p>在VS2013中安装InstallShield打包程序，<br><a id="more"></a></p><h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>vs2010打包时，在其他项目类型中找到安装和部署的模板，即可新建安装项目，而在vs2013中需要先在线搜索InstallShield，然后按照网页提示一步步下载，之后添加安装项目，配置打包设置完成打包<br> 在vs2010 选择“新建项目”→“ 其他项目类型”→“ Visual Studio Installer→“安装项目”：</p><h1 id="1-打包前的准备"><a href="#1-打包前的准备" class="headerlink" title="1. 打包前的准备"></a>1. 打包前的准备</h1><h2 id="InstallShield安装"><a href="#InstallShield安装" class="headerlink" title="InstallShield安装"></a>InstallShield安装</h2><p>在我们准备好的项目中右击“解决方案”，在弹出的菜单中选择添加 - 新建项目：</p><p>在弹出的新建对话框中依次选择 其他项目 - 安装和部署 - 安装项目，你可以改名字，也可以使用默认的名字setup1</p><p>新建一个打包部署项目，点OK，如果是第一次使用的话，会打开一个网页，按照提示的步骤来做，</p><p>点击<strong>Go to the download web site</strong>,进入下载网站，填写完信息，点击“download ”即会收到一封邮件，里面有下载地址和激活码。</p><p>之后会下载一个<strong>InstallShield2015LimitedEdition.exe</strong>的安装包,用管理员权限运行安装完后。重新启动VS2013</p><p>重新新建一个这样的项目：</p><p>点OK，这时候不再是打开网页，这时打开会提示激活或者是试用，选第一项，下一步</p><p>输入收到的邮件里的激活码，激活,待激活完成</p><p>卸载功能：找到C:\Windows\System32目录下的msiexec.exe文件，右击 选择 “msiexec.exe 的快捷方式”，然后改名为：你想叫名称（卸载、uninstall都可以），移动到你需要打包的程序菜单的文件夹下面。</p><h2 id="winform设置项目图标"><a href="#winform设置项目图标" class="headerlink" title="winform设置项目图标"></a>winform设置项目图标</h2><ul><li>首先可以在你的窗体属性中找到icon选择你准备好的图标；</li><li>右键项目点击属性，找到应用程序中的<strong>图标和清单</strong></li></ul><h1 id="2-开始部署"><a href="#2-开始部署" class="headerlink" title="2. 开始部署"></a>2. 开始部署</h1><h2 id="2-1-基本配置Application-Information"><a href="#2-1-基本配置Application-Information" class="headerlink" title="2.1 基本配置Application Information"></a>2.1 基本配置Application Information</h2><p>   可以设置公司名称，点击右侧General Information 可以设置语言为中文，可以设置应用名称</p><h2 id="2-2-Installation-Requirements"><a href="#2-2-Installation-Requirements" class="headerlink" title="2.2 Installation Requirements"></a>2.2 Installation Requirements</h2><p>   一般可以默认设置，如果需要,选择安装如.NET Framework 4.5等依赖同时打包，勾选所需依赖</p><h2 id="2-3-Installation-Architecture"><a href="#2-3-Installation-Architecture" class="headerlink" title="2.3 Installation Architecture"></a>2.3 Installation Architecture</h2><p>   默认即可</p><h2 id="2-4-Application-Files"><a href="#2-4-Application-Files" class="headerlink" title="2.4 Application Files"></a>2.4 Application Files</h2><p>   添加程序所需文件，这里有两种方式经过测试均可实现</p><h3 id="2-4-1方式一"><a href="#2-4-1方式一" class="headerlink" title="2.4.1方式一"></a>2.4.1方式一</h3><p>   点击到ProgramFilesFolder&gt;Microsoft&gt; &lt;你的工程名&gt;[INSRALLDIR]，点击<strong>Add Folders</strong>，选择工程bin目录下的Debug或Release文件夹，一般选择Release</p><h3 id="2-4-2-方式二"><a href="#2-4-2-方式二" class="headerlink" title="2.4.2 方式二"></a>2.4.2 方式二</h3><p>   点击到ProgramFilesFolder&gt;Microsoft&gt; &lt;你的工程名&gt;[INSRALLDIR]，点击<strong>Add Project Outputs</strong>,选择主输出</p><p>   点击Ok后，选中主输出，右键Resolve Project OutPut</p><p>   点击OK后，在左边菜单CatcheScreen下新建目录source，然后同上步骤添加源文件，然后选中资源，右键Resolve Project OutPut</p><p>   在创建一个文件命名“uninstall”，然后同上步骤添加源文件，然后选中资源，右键Resolve Project OutPut</p><h2 id="2-5-Application-Shortcuts"><a href="#2-5-Application-Shortcuts" class="headerlink" title="2.5 Application Shortcuts"></a>2.5 Application Shortcuts</h2><ul><li>2.4如果选择方式一，这是默认后有两个Launch xxx.exe,Launch xxx.vshost.exe,可以将第二个删掉，然后重命名第一个<br> 勾选use alternate shortcut icon可以选择自定义的程序图标<br> 然后创建卸载程序的快捷方式<br> 点击Create an unistallation shortcut，选择uninstall</li><li><p>2.4如果选择方式二，<br>  点击左侧的new,弹出对话框后点击最后一项，一直点到最后,点击Open，重命名Built（这里的重命名实际上就是你的程序在桌面上的名称) 选择在桌面上创建快捷方式：<br> 勾选use alternate shortcut icon可以选择自定义的程序图标</p><pre><code>然后创建卸载程序的快捷方式</code></pre><h2 id="2-6-Application-Registry"><a href="#2-6-Application-Registry" class="headerlink" title="2.6  Application Registry"></a>2.6  Application Registry</h2><p>配置是否允许用户修改安装地址等</p><h2 id="2-7-在右侧找到第六步Prepare-for-Release，双击下面的Releases"><a href="#2-7-在右侧找到第六步Prepare-for-Release，双击下面的Releases" class="headerlink" title="2.7 在右侧找到第六步Prepare for Release，双击下面的Releases"></a>2.7 在右侧找到第六步Prepare for Release，双击下面的Releases</h2><p>点击选中“SingleImage”–选项卡点击“Setup.exe”–找到 “InstallShield PrerequisitesLocation”，把它设置为“Extract From Setup.exe”   </p><h1 id="发布"><a href="#发布" class="headerlink" title="发布"></a>发布</h1><p>生成解决方案后会在安装程序集下面生成一个名为Setup（当时添加安装部署项目的项目名）的文件夹，安装文件就保存在下面的目录中。Install在生成安装文件后会有Setup.exe和.msi两中安装文件，exe文件是安装的引导文件，核心文件是msi文件，里面封存了程序的组件。在里面找到Setup.exe文件及msi文件即可进行安装。</p><p>点击Setup.exe，进行安装，如果想卸载，点击Uninstall卸载</p><h1 id="更换用installshield打包生成exe文件的图标"><a href="#更换用installshield打包生成exe文件的图标" class="headerlink" title="更换用installshield打包生成exe文件的图标"></a>更换用installshield打包生成exe文件的图标</h1><ul><li>打开Visio studio,选择文件方式打开你生成的exe文件</li><li>在Icon下右键添加资源》点击导入选择准备好的项目图标等</li><li>删除原来的100资源</li><li>设置你导入的资源ID为100</li><li>保存<h1 id="常见问题"><a href="#常见问题" class="headerlink" title="常见问题"></a>常见问题</h1></li></ul><ol><li>有时打包之后，项目更新之后，重新再生成解决方案来打包,遇到exe文件找不到时<br>【解决方案】<ul><li>清理，重新生成解决方案</li><li>如果还是不行，运行一次，然后点击生成解决方案</li></ul></li><li>重新打包遇到DVD5无法覆盖<br>【解决方案】原因是通过打开了相关文件夹，关闭文件资源管理器即可</li><li>设置了应用的ico图标后，生成解决方案提示 error : -3204: Cannot extract icon with index 0 from file…<br>【解决方案】把图标添加进工程。</li><li>重新打包遇到错误-1014：<br>错误    29    -1014: Cannot rename directory XXX\Express\SingleImage to XXX\Express\SingleImage.Bak.<br>Windows Explorer or a DOS prompt may be pointing to a subfolder of the release output folder (Disk1) or to the Interm folder, locking it. Change the current directory. Close any open files in the Disk1 folder. Close Msidb.exe if it is open.<br>【解决方案】将工程文件夹下的当时创建的SetUp应用程序中SetUp（当初新建的工程名）的文件夹删除，保留,isl，isproj文件，点击 生成解决方案即可，在XXX\Express\SingleImage\DiskImages\DISK1下生成可执行文件</li></ol></li></ul><p>参考：<a href="https://blog.csdn.net/qq_38122230/article/details/80470699" target="_blank" rel="noopener">https://blog.csdn.net/qq_38122230/article/details/80470699</a><br><a href="https://blog.csdn.net/u010872301/article/details/80509405" target="_blank" rel="noopener">https://blog.csdn.net/u010872301/article/details/80509405</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;在VS2013中安装InstallShield打包程序，&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="应用" scheme="http://11wy11.github.io/categories/%E5%BA%94%E7%94%A8/"/>
    
    
      <category term="VS" scheme="http://11wy11.github.io/tags/VS/"/>
    
      <category term="打包" scheme="http://11wy11.github.io/tags/%E6%89%93%E5%8C%85/"/>
    
  </entry>
  
  <entry>
    <title>krpano快速入门教程（四）之菜单栏</title>
    <link href="http://11wy11.github.io/2019/03/21/krpano-forth-note/"/>
    <id>http://11wy11.github.io/2019/03/21/krpano-forth-note/</id>
    <published>2019-03-21T15:37:50.000Z</published>
    <updated>2019-03-24T01:30:49.265Z</updated>
    
    <content type="html"><![CDATA[<p>主要通过自定义plugin插件实现krpano下拉框<br><a id="more"></a></p><h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>有时当有多个场景，用户想要直观的查看和定位指定的菜单栏，因此，最简单的方式是在页面中添加下拉框，能够支持用户选择场景进行跳转 </p><h1 id="下拉式菜单栏"><a href="#下拉式菜单栏" class="headerlink" title="下拉式菜单栏"></a>下拉式菜单栏</h1><p>主要通过自定义plugin插件实现下拉框<br>tour.xml代码如下：</p><ul><li>plugin<br>  plugin定义插件，其中使用了krpano中提供的combox插件，align属性可以设置下拉框相对对齐位置，onloaded定义在加载时调用的函数或动作action    </li><li>action fill_with_scenes<br>  主要读取当前所有的场景，依次设置添加到combox的item中，可以看到采用了部分krpano的语法，首先定义了item点击事件itemcall，调用loadscene加载场景，然后将场景名称和场景title作为项的属性添加</li><li>action select_box_item<br>  下拉框选中动作，如果该插件加载，则调用选中函数，否则，延时执行选中<br>combox.js<a href="/krpano-forth-note/combobox.js">下载</a><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">krpano</span> <span class="attr">version</span>=<span class="string">"1.19"</span> <span class="attr">title</span>=<span class="string">"Virtual Tour"</span> <span class="attr">onstart</span>=<span class="string">"startup();"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- combobox plugin --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">plugin</span> <span class="attr">name</span>=<span class="string">"box"</span> <span class="attr">keep</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">url</span>=<span class="string">"%SWFPATH%/plugins/combobox.swf"</span> <span class="attr">width</span>=<span class="string">"230"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">alturl</span>=<span class="string">"%SWFPATH%/plugins/combobox.js"</span> <span class="attr">native</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">align</span>=<span class="string">"righttop"</span> <span class="attr">x</span>=<span class="string">"10"</span> <span class="attr">y</span>=<span class="string">"10"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">onloaded</span>=<span class="string">"fill_with_scenes();"</span></span></span><br><span class="line"><span class="tag">        /&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- an action for automatically fill the combobox with all scenes --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"fill_with_scenes"</span>&gt;</span></span><br><span class="line">for(set(i,0), i LT scene.count, inc(i),</span><br><span class="line">txtadd(itemcall, 'loadscene(',get(scene[get(i)].name),',null,MERGE,BLEND(1));');</span><br><span class="line">addIdItem(get(scene[get(i)].name), get(scene[get(i)].title), get(itemcall));</span><br><span class="line">);</span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- an action for updating the combobox when the scene was changed --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"select_box_item"</span>&gt;</span></span><br><span class="line">if(plugin[box].loaded,</span><br><span class="line">plugin[box].selectIdItem(%1);</span><br><span class="line">  ,</span><br><span class="line">delayedcall(0.1, select_box_item(%1));</span><br><span class="line">  );</span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"floorvisible"</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> set(layer[map_container_mask].oy,5);</span><br><span class="line">set(layer[map_container_mask].height,100%);</span><br><span class="line">  for(set(i,1);txtadd(floorname, 'floor', '_', get(i)),  layer[get(floorname)],  inc(i); txtadd(floorname, 'floor', '_', get(i)),</span><br><span class="line">  set(layer[get(floorname)].visible, false);</span><br><span class="line">  </span><br><span class="line">    );  </span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- set skin settings: bingmaps? gyro? thumbnail controlling? tooltips? --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">skin_settings</span> <span class="attr">bingmaps</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">bingmaps_key</span>=<span class="string">""</span></span></span><br><span class="line"><span class="tag">               <span class="attr">bingmaps_zoombuttons</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">gyro</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">thumbs_width</span>=<span class="string">"120"</span> <span class="attr">thumbs_height</span>=<span class="string">"80"</span> <span class="attr">thumbs_padding</span>=<span class="string">"10"</span> <span class="attr">thumbs_crop</span>=<span class="string">"0|40|240|160"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">thumbs_opened</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">thumbs_text</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">thumbs_dragging</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">thumbs_onhoverscrolling</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">thumbs_scrollbuttons</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">thumbs_scrollindicator</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">tooltips_thumbs</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">tooltips_hotspots</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">tooltips_mapspots</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">               <span class="attr">controlbar_offset</span>=<span class="string">"20"</span></span></span><br><span class="line"><span class="tag">               /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- set optional skin logo url --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">layer</span> <span class="attr">name</span>=<span class="string">"skin_logo"</span> <span class="attr">url</span>=<span class="string">""</span> <span class="attr">scale</span>=<span class="string">"0.25"</span> <span class="attr">opened_onclick</span>=<span class="string">"openurl('...',_blank);"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"startup"</span>&gt;</span></span><br><span class="line">if(startscene === null, copy(startscene,scene[0].name));</span><br><span class="line">loadscene(get(startscene), null, MERGE);</span><br><span class="line"><span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">scene</span> <span class="attr">name</span>=<span class="string">"scene_1"</span> <span class="attr">title</span>=<span class="string">"场景1"</span> <span class="attr">onstart</span>=<span class="string">""</span> <span class="attr">thumburl</span>=<span class="string">"panos/3.tiles/thumb.jpg"</span> <span class="attr">lat</span>=<span class="string">""</span> <span class="attr">lng</span>=<span class="string">""</span> <span class="attr">heading</span>=<span class="string">""</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">hlookat</span>=<span class="string">"0"</span> <span class="attr">vlookat</span>=<span class="string">"0"</span> <span class="attr">fovtype</span>=<span class="string">"MFOV"</span> <span class="attr">fov</span>=<span class="string">"120"</span> <span class="attr">maxpixelzoom</span>=<span class="string">"2.0"</span> <span class="attr">fovmin</span>=<span class="string">"70"</span> <span class="attr">fovmax</span>=<span class="string">"140"</span> <span class="attr">limitview</span>=<span class="string">"auto"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">preview</span> <span class="attr">url</span>=<span class="string">"panos/3.tiles/preview.jpg"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">image</span> <span class="attr">type</span>=<span class="string">"CUBE"</span> <span class="attr">multires</span>=<span class="string">"true"</span> <span class="attr">tilesize</span>=<span class="string">"512"</span> <span class="attr">progressive</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">level</span> <span class="attr">tiledimagewidth</span>=<span class="string">"1910"</span> <span class="attr">tiledimageheight</span>=<span class="string">"1910"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">cube</span> <span class="attr">url</span>=<span class="string">"panos/3.tiles/%s/l3/%v/l3_%s_%v_%h.jpg"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">level</span> <span class="attr">tiledimagewidth</span>=<span class="string">"955"</span> <span class="attr">tiledimageheight</span>=<span class="string">"955"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">cube</span> <span class="attr">url</span>=<span class="string">"panos/3.tiles/%s/l2/%v/l2_%s_%v_%h.jpg"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">level</span> <span class="attr">tiledimagewidth</span>=<span class="string">"512"</span> <span class="attr">tiledimageheight</span>=<span class="string">"512"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">cube</span> <span class="attr">url</span>=<span class="string">"panos/3.tiles/%s/l1/%v/l1_%s_%v_%h.jpg"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mobile</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">cube</span> <span class="attr">url</span>=<span class="string">"panos/3.tiles/mobile_%s.jpg"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mobile</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- place your scene hotspots here --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">scene</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">scene</span> <span class="attr">name</span>=<span class="string">"scene_2"</span> <span class="attr">title</span>=<span class="string">"场景2"</span> <span class="attr">onstart</span>=<span class="string">""</span> <span class="attr">thumburl</span>=<span class="string">"panos/1.tiles/thumb.jpg"</span> <span class="attr">lat</span>=<span class="string">""</span> <span class="attr">lng</span>=<span class="string">""</span> <span class="attr">heading</span>=<span class="string">""</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">hlookat</span>=<span class="string">"0"</span> <span class="attr">vlookat</span>=<span class="string">"0"</span> <span class="attr">fovtype</span>=<span class="string">"MFOV"</span> <span class="attr">fov</span>=<span class="string">"120"</span> <span class="attr">maxpixelzoom</span>=<span class="string">"2.0"</span> <span class="attr">fovmin</span>=<span class="string">"70"</span> <span class="attr">fovmax</span>=<span class="string">"140"</span> <span class="attr">limitview</span>=<span class="string">"auto"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">preview</span> <span class="attr">url</span>=<span class="string">"panos/1.tiles/preview.jpg"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">image</span> <span class="attr">type</span>=<span class="string">"CUBE"</span> <span class="attr">multires</span>=<span class="string">"true"</span> <span class="attr">tilesize</span>=<span class="string">"512"</span> <span class="attr">progressive</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">level</span> <span class="attr">tiledimagewidth</span>=<span class="string">"955"</span> <span class="attr">tiledimageheight</span>=<span class="string">"955"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">cube</span> <span class="attr">url</span>=<span class="string">"panos/1.tiles/%s/l2/%v/l2_%s_%v_%h.jpg"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">level</span> <span class="attr">tiledimagewidth</span>=<span class="string">"512"</span> <span class="attr">tiledimageheight</span>=<span class="string">"512"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">cube</span> <span class="attr">url</span>=<span class="string">"panos/1.tiles/%s/l1/%v/l1_%s_%v_%h.jpg"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mobile</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">cube</span> <span class="attr">url</span>=<span class="string">"panos/1.tiles/mobile_%s.jpg"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mobile</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- place your scene hotspots here --&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">scene</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">krpano</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h3 id="历史文章"><a href="#历史文章" class="headerlink" title="历史文章"></a>历史文章</h3><p><a href="/2019/03/14/krpano-first-note">krpano快速入门教程（一) 使用krpano工具构建即用型panos</a><br><a href="/2019/03/15/krpano-second-note">krpano快速入门教程（二) vtour全景漫游及vtour文件夹介绍</a><br><a href="/2019/03/16/krpano-third-note">krpano快速入门教程（三）之热点Hotspot</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;主要通过自定义plugin插件实现krpano下拉框&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="全景" scheme="http://11wy11.github.io/categories/%E5%85%A8%E6%99%AF/"/>
    
    
      <category term="krpano" scheme="http://11wy11.github.io/tags/krpano/"/>
    
  </entry>
  
  <entry>
    <title>AE开发问题总结(一)</title>
    <link href="http://11wy11.github.io/2019/03/20/arcengine-second/"/>
    <id>http://11wy11.github.io/2019/03/20/arcengine-second/</id>
    <published>2019-03-20T04:55:36.000Z</published>
    <updated>2019-03-24T01:26:35.880Z</updated>
    
    <content type="html"><![CDATA[<p>今天本地运行项目，莫名其妙地报了个 尝试读取或写入受保护的内存，这通常指示其他内存已损坏！提供解决方案<br><a id="more"></a></p><h1 id="AE-读Shp文件及查属性表等"><a href="#AE-读Shp文件及查属性表等" class="headerlink" title="AE 读Shp文件及查属性表等"></a>AE 读Shp文件及查属性表等</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"> try</span><br><span class="line">&#123;</span><br><span class="line">    bool flag = true;</span><br><span class="line">     IWorkspaceFactory pWsFactory = new ShapefileWorkspaceFactoryClass();</span><br><span class="line">     IFeatureWorkspace pWorkSpace = pWsFactory.OpenFromFile(path, 0) as IFeatureWorkspace;//path为shp文件所在目录路径</span><br><span class="line">     IFeatureClass pFeatureClass = pWorkSpace.OpenFeatureClass(System.IO.Path.GetFileNameWithoutExtension(path));//OpenFeatureClass的参数为不带后缀的shp文件名</span><br><span class="line">     //检查属性                               </span><br><span class="line">     IFeatureLayer pFeatureLayer = new FeatureLayerClass();</span><br><span class="line">     pFeatureLayer.Name = pFeatureClass.AliasName;</span><br><span class="line">     pFeatureLayer.FeatureClass = pFeatureClass;</span><br><span class="line">    </span><br><span class="line">     //查询 ,search的参数第一个为过滤条件，第二个为是否重复执行</span><br><span class="line">     IFeatureCursor pFeatureCursor = pFeatureLayer.Search(null, false);</span><br><span class="line">     //获取查询到的要素 </span><br><span class="line">     IFeature pFeature = pFeatureCursor.NextFeature();</span><br><span class="line">     string strFeatureClassName = (pFeatureClass as IDataset).Name;</span><br><span class="line">     int fieldCount = pFeatureClass.Fields.FieldCount;</span><br><span class="line">     </span><br><span class="line">     else</span><br><span class="line">     &#123;</span><br><span class="line">         for (int i = 0; i &lt; fieldCount; ++i)</span><br><span class="line">         &#123;</span><br><span class="line">             //这段当时的需求是判断shp文件中是否有规定要求的字段，</span><br><span class="line">             string fieldName = ConstantInfo.shpFields[i];</span><br><span class="line">             if (pFeatureClass.Fields.FindField(fieldName) == -1)</span><br><span class="line">             &#123;</span><br><span class="line">                 //自定义函数，按照需要修改</span><br><span class="line">                 flag = false;</span><br><span class="line">             &#125;</span><br><span class="line">    </span><br><span class="line">         &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     IFeature pTempFeature = pFeatureCursor.NextFeature();</span><br><span class="line">     int rowid = 0;</span><br><span class="line">     while (null != pTempFeature)</span><br><span class="line">     &#123;</span><br><span class="line">         rowid++;</span><br><span class="line">         for (int i = 0; i &lt; fieldCount; ++i)</span><br><span class="line">         &#123;</span><br><span class="line">             string str = Convert.ToString(pTempFeature.get_Value(i));</span><br><span class="line">             //空值检查</span><br><span class="line">             if (str == &quot;&quot;)</span><br><span class="line">             &#123;</span><br><span class="line">                 /自定义函数，按照需要修改</span><br><span class="line">                 flag = false;</span><br><span class="line">             &#125;</span><br><span class="line">    </span><br><span class="line">         &#125;</span><br><span class="line">         pTempFeature = pFeatureCursor.NextFeature();</span><br><span class="line">     &#125;</span><br><span class="line">     Marshal.ReleaseComObject(pFeatureCursor);</span><br><span class="line">     if (!flag)</span><br><span class="line">     &#123;</span><br><span class="line">         MainForm.isPassed = false;</span><br><span class="line">         logger.Error(&quot;Error:&quot; + childNode.InnerText.Replace(&quot;%%&quot;, this.strPac) + &quot;shp文件属性等检查未通过\n&quot;);</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">catch (Exception e)</span><br><span class="line">&#123;</span><br><span class="line"> //自定义函数，按照需要修改</span><br><span class="line">&#125;</span><br><span class="line">break;</span><br></pre></td></tr></table></figure><h1 id="尝试读取或写入受保护的内存，这通常指示其他内存已损坏【解决方法】"><a href="#尝试读取或写入受保护的内存，这通常指示其他内存已损坏【解决方法】" class="headerlink" title="尝试读取或写入受保护的内存，这通常指示其他内存已损坏【解决方法】"></a>尝试读取或写入受保护的内存，这通常指示其他内存已损坏【解决方法】</h1><p>以<strong>管理员的身份</strong>运行CMD   执行netsh winsock reset    然后提示你重新启动计算机   重启后错误就没有了</p><p>但这样太过复杂，没有从程序自身角度解决这个问题，继续查阅资料，最终找到了有效的方法，释放程序锁</p><h1 id="最佳解决方法"><a href="#最佳解决方法" class="headerlink" title="最佳解决方法"></a>最佳解决方法</h1><p>使用IWorkspaceFactoryLockControl接口的SchemaLockingEnabled和DisableSchemaLocking，分别获得工作空间锁状态，并关闭，具体代码如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">IWorkspaceFactory pWsFactory = new ShapefileWorkspaceFactory();</span><br><span class="line">//关闭资源锁定   </span><br><span class="line">IWorkspaceFactoryLockControl ipWsFactoryLock = (IWorkspaceFactoryLockControl)pWsFactory;</span><br><span class="line">if (ipWsFactoryLock.SchemaLockingEnabled)</span><br><span class="line">&#123;</span><br><span class="line">  ipWsFactoryLock.DisableSchemaLocking();</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure></p><h1 id="错误原因分析"><a href="#错误原因分析" class="headerlink" title="错误原因分析"></a>错误原因分析</h1><p>   AE中非托管变量未释放，这些有Icursor，IFeatureCursor，IEnumStyleGalleryItem，IEnumBSTR，IStyleGallery；AGS里面有IServerContext等，释放方法System.Runtime.InteropServices.Marshal.ReleaseComObject(o);或者使用ESRI.ArcGIS.ADF.COMSupport.AOUninitialize.Shutdown()  </p><p>参考：[1] <a href="https://blog.csdn.net/mattran/article/details/47149077" target="_blank" rel="noopener">https://blog.csdn.net/mattran/article/details/47149077</a><br>      [2] <a href="https://blog.csdn.net/u011116642/article/details/17960135" target="_blank" rel="noopener">https://blog.csdn.net/u011116642/article/details/17960135</a>  </p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;今天本地运行项目，莫名其妙地报了个 尝试读取或写入受保护的内存，这通常指示其他内存已损坏！提供解决方案&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="ArcGIS" scheme="http://11wy11.github.io/categories/ArcGIS/"/>
    
    
      <category term="ArcEngine" scheme="http://11wy11.github.io/tags/ArcEngine/"/>
    
      <category term="VS" scheme="http://11wy11.github.io/tags/VS/"/>
    
  </entry>
  
  <entry>
    <title>krpano学习笔记--干货</title>
    <link href="http://11wy11.github.io/2019/03/20/krpano-learn-note/"/>
    <id>http://11wy11.github.io/2019/03/20/krpano-learn-note/</id>
    <published>2019-03-19T16:46:27.000Z</published>
    <updated>2019-03-24T01:32:04.334Z</updated>
    
    <content type="html"><![CDATA[<p>介绍krpano开发中的一些注意事项和重要属性等<br><a id="more"></a></p><h1 id="1-Krpano-xml"><a href="#1-Krpano-xml" class="headerlink" title="1.Krpano xml"></a>1.Krpano xml</h1><ol><li>Onstart<br>onstart事件将在xml加载和解析之后直接调用。</li><li>Basedir<br>basedir设置为所有下面的loadpano（）动作调用定义了基本目录。这可以是相对路径或绝对路径，也可以在这里使用 url占位符。默认值是％FIRSTXML％，这意味着所有下面的loadpano（）动作调用的所有相对xml路径都是相对于第一个加载的xml文件。</li><li>关于vars和initvars区别<br>vars在加载xml后加载图像前赋值，而initvars在加载xml前赋值，一般用于构建url。由于get:variable或calc:variable中的变量值需要在加载xml中定义，所以使用vars不能在开始加载时控制krpano的某些设置，但是可以在之后动态的修改其显示状态。</li><li>Action: 参数/参数传递/解析<br>当调用一个动作时，可以将参数/参数传递给它。<br>为了访问参数/参数，有两种可能性：</li></ol><ul><li>通过占位符替换：（ 旧版本的方法）<br>  可以使用从％0到％99形式的操作代码中的数字占位符来获取给定的参数。<br>  其中％0是操作本身的名称， ％1表示第一个参数， ％2表示第二个参数，依此类推。<br>  这些占位符可以在代码中的任何地方使用。<br>  在实际的操作代码将被解析并执行之前，所有的占位符将被其参数值替换。<br>  当给定的占位符不会有参数时，将使用值’null’。<br>  要在动作中使用％字符，需要使用%%</li><li>通过参数到变量映射:( 推荐，新的）<br>  对于具有本地作用域的操作，可以将args属性添加到&lt;action>元素。例如：<br>  <code>&lt;action ... args =“var1，var2，var3”&gt;</code><br>  在那里可以定义给定动作参数/参数的args属性变量名称（用逗号分隔）。<br>  每个动作参数将被映射到本地作用域中的一个新变量，其名称是在args属性中设置的。<br>  这些变量可以像操作代码中的任何其他变量一样正常使用（例如，通过get / calc / copy读取）。<br>  当给定变量没有动作参数时，将使用值’null’。<br>  处理包含引号或逗号字符的值时，使用变量映射非常有用。在这种情况下，正常的占位符替换可能会产生问题<br>  注意 - 建议尽可能使用参数变量映射。没有％N占位符的动作可以在内部进行缓存，这使得进一步调用的执行速度更快。</li></ul><h1 id="值得注意的属性"><a href="#值得注意的属性" class="headerlink" title="值得注意的属性"></a>值得注意的属性</h1><ol><li>Name属性：每个名字都需要以字母字符开头！这意味着不允许使用数字作为名字！当名称仍然以数字字符开头时，名称将被解释为数组索引。这对于动作内部基于动态索引的访问没有问题，但不能用于定义元素！所有名称将自动转换为小写字母，以便直接区分大小写访问！</li><li>URL属性：<br>当一个相对路径被用作url值时，路径将被自动调整为相对于定义了url属性的xml文件。这意味着xml中的相对路径总是相对于xml本身，但是请注意 - 当动态设置/更改url属性时，则不再有与xml的自动关系！要使路径相对于某些特定的预定义路径，可以 在url路径中使用这些占位符中的一些：<br>％FIRSTXML％ - 第一个加载的xml文件的路径。<br>％CURRENTXML％ - 当前加载的主要xml文件的路径（不是包含的）。<br>％SWFPATH％ - krpano查看器文件的路径。<br>％HTMLPATH％ - html文件的路径。<br>％BASEDIR％ - 使用basedir路径。<br>％$ VARIABLE％ - 使用给定’VARIABLE’的值 - 这可以是任何krpano变量，但必须在加载当前xml或场景之前定义它，例如，在嵌入过程中（通过initvars）或在loadpano（），loadscene（）调用之前。</li><li>Style属性<br>&lt;style>元素是任何类型属性的集合/存储元素。<br>每个其他具有name属性的xml元素也可以有一个style属性。当xml元素首次被创建时，在&lt;style>元素处定义的所有属性将被复制到元素本身。这将在xml元素本身定义的属性被应用之前完成。<br>这意味着可以在&lt;style>元素中预先定义一些设置，然后使用直接在元素上定义的属性稍后覆盖它们。</li><li>Get:|Calc方法<br>当xml属性的值以get：或calc：开头时：<br>在这种情况下，xml属性的值将从其他变量获取或使用表达式计算。<br>在get：或calc：中使用的变量需要在当前xml元素之前（=上方）定义。此外，这里有一个特殊情况 - 在&lt;include>元素上使用它时，那么在那里使用的变量需要在当前xml加载之前定义。这可以在嵌入期间通过使用initvars设置或在xml中进行loadpano（）调用之前在html文件中完成。</li></ol><h1 id="Javascript-krpano操作-（仅限HTML5）"><a href="#Javascript-krpano操作-（仅限HTML5）" class="headerlink" title="Javascript krpano操作 （仅限HTML5）"></a>Javascript krpano操作 （仅限HTML5）</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;action name =“...” type =“ Javascript ” &gt; &lt;！[CDATA [     ... autorun =“”</span><br><span class="line"></span><br><span class="line">    Javascript代码</span><br><span class="line">    ... </span><br><span class="line">]]&gt; &lt;/ action&gt;</span><br></pre></td></tr></table></figure><p>Action type krpano操作的类型：<br>type =“”（默认） - 正常krpano操作 - 适用于Flash和HTML5<br>type =“Javascript” - JavaScript krpano操作 - 仅限HTML5</p><p>Action scope<br>在操作中为新生成的变量定义范围：<br>全局或未设置（默认）<br>新变量将被添加到全局变量作用域中。<br>其他任何行为或代码也可以使用它们。<br>这在再使用变量名称时可能会有问题，特别是当变量类型在用法之间会有所不同时。<br>本地<br>新变量将被添加到仅存在于当前操作调用中的局部变量作用域中。<br>当动作完成或调用其他动作时，局部作用域和其中定义的所有变量将不再可用。<br>动作越复杂，它使用的临时变量越多，使用本地作用域进行此操作越有意义，以避免干扰其他动作的问题。<br>设置LocalOnly<br>有些作为scope = local，但区别在于，默认情况下，所有访问仅引用本地作用域本身。<br>全局范围的访问只能由全局对象来实现。<br>亲<br>使用调用者的范围。<br>当调用当前动作的动作具有局部范围时，则可以在当前动作中使用/访问该动作。<br>私人：NAME<br>为该操作定义一个私有本地范围。<br>范围将由自定义的唯一名称进行参考。<br>该范围在多个操作调用之间保持活动状态，并可以在多个操作中共享。<br>有些作为范围= localonly所有访问只涉及本地范围本身。</p><h1 id="笔记"><a href="#笔记" class="headerlink" title="笔记"></a>笔记</h1><p>全局范围访问 - 搜索变量时，首先搜索本地范围，然后搜索全局范围。为了能够将变量添加到全局范围，即使在使用本地范围或直接访问全局范围内的变量时，也存在全局对象。<br>本地范围访问 - 为了能够确保访问本地范围（例如，当可能已经存在具有相同名称的全局变量时定义本地变量），当前本地范围也可用作 操作代码中的本地对象。例如使用def（local.i，integer，0）; 定义一个名为’i’的局部整型变量。为了稍后访问动作代码，只需使用’i’来解决该变量就足够了。<br>延期代码 - 稍后调用其他代码的操作（例如delayedcall，tween，asyncloop等）将使用与该代码中当前操作相同的范围。<br>调用者范围 - 从插件/图层/热点事件调用的代码<br>对于非localscope动作：<br>当一个动作（或任何代码）将从plugin / layer / hotspot事件中被调用时，plugin / layer / hotspot对象本身也将作为搜索变量的范围。但仅限于访问现有的变量！新生成的变量将始终添加到全局范围中。<br>对于localscope动作：<br>在localscope动作中总是有预定义的局部变量调用者。当动作将从插件/图层/热点事件（或通过使用callwith）被调用时，那么该 调用者变量将引用该元素。否则，调用者变量将为空。</p><p>本地作用域操作中的 预定义变量：<br>actionname - 当前操作的名称。<br>args - 参数的值数组。<br>访问者：args [index]。<br>通过以下方式获取数字或参数：args.length。<br>调用者 - 从那里调用插件/图层/热点对象，否则为null。<br>全球 - 参考全球范围。<br>本地 - 对当前本地范围本身的引用。<br>parentscope - 父行为的范围引用，当没有父范围时，这指的是全局范围。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;介绍krpano开发中的一些注意事项和重要属性等&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="全景" scheme="http://11wy11.github.io/categories/%E5%85%A8%E6%99%AF/"/>
    
    
      <category term="krpano" scheme="http://11wy11.github.io/tags/krpano/"/>
    
  </entry>
  
  <entry>
    <title>VS2013/VS2015/VS2017下使用ArcEngine10.1/10.2（一）</title>
    <link href="http://11wy11.github.io/2019/03/19/arcengine-first/"/>
    <id>http://11wy11.github.io/2019/03/19/arcengine-first/</id>
    <published>2019-03-19T07:51:40.000Z</published>
    <updated>2019-03-20T02:32:42.182Z</updated>
    
    <content type="html"><![CDATA[<p>ArcObjects SDK for Microsoft .Net Framework 10.1或10.2在安装时，会检测VS2010或VS2012的安装路径，而有时因为其他项目使用限制而且不愿同时安装多个版本的VS,通过修改注册表方式实现安装<br><a id="more"></a></p><h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>ArcObjects SDK for Microsoft .Net Framework 10.1或10.2在安装时，会检测VS2010或VS2012的安装路径，而有时因为其他项目使用限制而且不愿同时安装多个版本的VS,通过修改注册表方式实现安装</p><h1 id="具体步骤"><a href="#具体步骤" class="headerlink" title="具体步骤"></a>具体步骤</h1><h2 id="1-修改注册表"><a href="#1-修改注册表" class="headerlink" title="1.修改注册表"></a>1.修改注册表</h2><p>首先打开注册表，window系统可以通过win+R，输入regedit后，回车打开注册表</p><p>找到<strong>计算机\HKEY_LOCAL_MACHINE\SOFTWARE\WOW6432Node\Microsoft\VisualStudio\10.0</strong>，点击10.0文件夹，此时是没有InstallDir和ShellFolder两个字符串值</p><p>找到<strong>计算机\HKEY_LOCAL_MACHINE\SOFTWARE\WOW6432Node\Microsoft\VisualStudio\12.0</strong>,点击12.0文件夹，查看InstallDir值，并复制</p><p>回到10.0目录，右键新建->字符串值，新建InstallDir值，双击编辑值，将刚复制的粘贴</p><p>同样的处理，添加ShellFolder</p><h2 id="2-安装ArcObjects-SDK-for-Microsoft-Net-Framework"><a href="#2-安装ArcObjects-SDK-for-Microsoft-Net-Framework" class="headerlink" title="2.安装ArcObjects SDK for Microsoft .Net Framework"></a>2.安装ArcObjects SDK for Microsoft .Net Framework</h2><p>打开ArcGIS Desktop 或ArcEngine安装程序，找到ArcObjects SDK for Microsoft .Net Framework，点击安装，此时就不会提示要求VS2010或VS2012安装环境了，下面以ArcGIS Desktop 为例：<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2019/03/19/arcengine-first/pic1.png" alt="图1-安装" title>                </div>                <div class="image-caption">图1-安装</div>            </figure></p><h2 id="3-在工具箱中添加ArcGIS相关组件"><a href="#3-在工具箱中添加ArcGIS相关组件" class="headerlink" title="3. 在工具箱中添加ArcGIS相关组件"></a>3. 在工具箱中添加ArcGIS相关组件</h2><p>由于通过修改注册表的方式安装的ArcObjects SDK for Microsoft .Net Framework，因此，可能会导致VS中没有ArcGIS相关工具，需要手动添加</p><p>打开VS2013,任意打开一个窗体，打开工具箱，会发现没有ArcGIS选项卡，因此，首先右键<strong>新建选项卡</strong>，然后右键，点击<strong>选择项</strong>,在.NET Framework组件下，找到下图所示的ArcGIS组件<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2019/03/19/arcengine-first/pic2.png" alt="图2-添加ArcGIS组件" title>                </div>                <div class="image-caption">图2-添加ArcGIS组件</div>            </figure></p><h3 id="方案1"><a href="#方案1" class="headerlink" title="方案1"></a>方案1</h3><p>注意，如果在.NET Framework下找不到相关组件，可以点击<strong>浏览</strong>,找到ArcObjects SDK for Microsoft .Net Framework的安装目录下的DotNet，一般路径为<code>D:\Program Files (x86)\ArcGIS\DeveloperKit10.2\DotNet</code>如下图所示，可以按需添加，或者按住<strong>Shift</strong>全选添加。<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2019/03/19/arcengine-first/pic3.png" alt="图3-浏览组件dll" title>                </div>                <div class="image-caption">图3-浏览组件dll</div>            </figure></p><p>勾选需要的组件，点击确定后，在新建的选项卡下出现组件<br>    <center><br>    <img src="/2019/03/19/arcengine-first/pic4.png" alt="图4-组件"><br>    </center><br>红色框为新添加的.NET组件，上面两个是COM组件，暂时不需要使用，下节介绍.NET组件和COM组件的区别  </p><h3 id="方案2"><a href="#方案2" class="headerlink" title="方案2"></a>方案2</h3><p>在Desktop安装目录的bin下找到需要的控件，以.ocx为后缀，选中后拖入工具箱</p><h2 id="添加引用"><a href="#添加引用" class="headerlink" title="添加引用"></a>添加引用</h2><p>在不做任何手动操作时，安装了ArcGIS Desktop之后，可以在COM下的类型库中找到ArcGIS 相关的COM组件，如下图所示<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2019/03/19/arcengine-first/pic5.png" alt="图5-COM类型库中的ArcGIS相关组件" title>                </div>                <div class="image-caption">图5-COM类型库中的ArcGIS相关组件</div>            </figure></p><p>注意点击引用这些组件时，引用呈现下图所示结果：</p><center><br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2019/03/19/arcengine-first/pic6.png" alt="图6-添加COM组件引用后" title>                </div>                <div class="image-caption">图6-添加COM组件引用后</div>            </figure><br></center><p>但会发现找不到Esri.ArcGIS.Version的库，而这个库必须在主函数入口处使用获得授权许可，之后才能使用ArcEngine中相关的类或接口。</p><p>因此，<strong>这里在添加引用是选择.NET组件</strong>，点击<strong>浏览</strong>找到ArcObjects SDK for Microsoft .Net Framework的安装目录下的DotNet，一般路径为<code>D:\Program Files (x86)\ArcGIS\DeveloperKit10.2\DotNet</code>如下图所示，选择Esri.ArcGIS.Version.dll，其他库VS会根据需要自动引用。如上图图3所示.<br>注意点击引用这些组件时，引用呈现下图所示结果：</p><center><br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2019/03/19/arcengine-first/pic7.png" alt="图7-添加NET组件引用后" title>                </div>                <div class="image-caption">图7-添加NET组件引用后</div>            </figure><br></center><h1 id="Program-cs中授权"><a href="#Program-cs中授权" class="headerlink" title="Program.cs中授权"></a>Program.cs中授权</h1><p>在Main函数中添加 <code>ESRI.ArcGIS.RuntimeManager.Bind(ESRI.ArcGIS.ProductCode.EngineOrDesktop);</code>,如下图所示<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2019/03/19/arcengine-first/pic8.png" alt="图8-添加授权" title>                </div>                <div class="image-caption">图8-添加授权</div>            </figure></p><p>直至就可以在一个应用程序中使用ArcEngine的功能了。</p><p>当然如果你想使用VS创建ArcGIS模板应用程序，此时你会发现Visual C#下没有ArcGIS选项，这时又需要我们手动添加了<br><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2019/03/19/arcengine-first/pic9.png" alt="图9-手动安装之前" title>                </div>                <div class="image-caption">图9-手动安装之前</div>            </figure></p><h1 id="手动添加ArcGIS项目模板"><a href="#手动添加ArcGIS项目模板" class="headerlink" title="手动添加ArcGIS项目模板"></a>手动添加ArcGIS项目模板</h1><p>由于我们最开始安装SDK时，采用了修改注册表的方式骗过ArcObject检测，因此，模板默认安装在了但是设置的VS2013安装路径Microsoft Visio Studio 12.0下了</p><ol><li>将模板拷贝至vs模板库中<br>找到D:\Program Files (x86)\Microsoft Visual Studio 12.0\Microsoft Visual Studio 10.0，在Common7/IDE下有两个文件夹<strong>ItemTemplates/CSharp/ArcGIS</strong>,<strong>ProjectTemplates/CSharp/ArcGIS</strong>,<br>分别拷贝在vs2013模板文件位置，如：<br>D:\Program Files (x86)\Microsoft Visual Studio 12.0\Common7\IDE\<strong>ItemTemplates</strong>\CSharp和<br>I:\Program Files (x86)\Microsoft Visual Studio 12.0\Common7\IDE\<strong>ProjectTemplates</strong>\CSharp</li><li>右键，以管理员权限运行vs2013,也就是启动vs2013</li><li><p>重新安装一次模板</p><ul><li>打开vs2013/2015的命令行工具<br> 2013：<br>  开始–&gt; 所有应用 –&gt; Microsoft Visual Studio 2013 –&gt; Visual Studio Tools,打开后 vs2013开发人员命令提示<br>  <img src="/2019/03/19/arcengine-first/pic10.png" alt="图10-vs2013开发人员命令提示"><br> 2015或更高：<br> 开始–&gt; 所有应用 –&gt; Microsoft Visual Studio 2015 –&gt; vs2015开发人员命令提示（可能会叫Visual Studio 2015 Command Prompt ）</li><li><p>执行如下命令<br><code>devenv.exe/InstallVSTemplates</code><br>需要注意的事情是，这个命令执行后，不会马上出现项目或项模板，需要重新打开vs2017，新建时会重新初始化模板。 </p><p>如果第三步有问题，换成用管理员权限运行。</p></li></ul></li><li>效果<br>C#下出现ArcGIS相关模板<br> <img src="/2019/03/19/arcengine-first/pic11.png" alt="图11-成功添加ArcGIS模板"></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;ArcObjects SDK for Microsoft .Net Framework 10.1或10.2在安装时，会检测VS2010或VS2012的安装路径，而有时因为其他项目使用限制而且不愿同时安装多个版本的VS,通过修改注册表方式实现安装&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="ArcGIS" scheme="http://11wy11.github.io/categories/ArcGIS/"/>
    
    
      <category term="ArcEngine" scheme="http://11wy11.github.io/tags/ArcEngine/"/>
    
      <category term="VS" scheme="http://11wy11.github.io/tags/VS/"/>
    
  </entry>
  
  <entry>
    <title>GDAL简介</title>
    <link href="http://11wy11.github.io/2019/03/18/cpp-gdal/"/>
    <id>http://11wy11.github.io/2019/03/18/cpp-gdal/</id>
    <published>2019-03-18T07:26:26.000Z</published>
    <updated>2019-03-24T06:30:30.855Z</updated>
    
    <content type="html"><![CDATA[<p>GDAL(Geospatial Data Abstraction Library)是一个在X/MIT许可协议下的开源栅格空间数据转换库<br><strong>持续更新中</strong><br><a id="more"></a><br><!-- START doctoc generated TOC please keep comment here to allow auto update --><br><!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE --><br><strong>Table of Contents</strong>  <em>generated with <a href="https://github.com/thlorenz/doctoc" target="_blank" rel="noopener">DocToc</a></em></p><ul><li><a href="#%E7%AE%80%E4%BB%8B">简介</a></li><li><a href="#%E5%8A%9F%E8%83%BD%E7%89%B9%E5%BE%81">功能特征</a></li><li><a href="#ogr%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E7%BC%96%E8%BE%91">OGR体系结构编辑</a></li><li><a href="#gdal%E4%B8%ADogr%E7%9A%84%E4%BD%BF%E7%94%A8">GDAL中OGR的使用</a><ul><li><a href="#%E8%AF%BB%E6%95%B0%E6%8D%AE">读数据</a></li><li><a href="#%E5%86%99%E6%95%B0%E6%8D%AE">写数据</a></li></ul></li><li><a href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99">参考资料：</a></li></ul><!-- END doctoc generated TOC please keep comment here to allow auto update --><h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>它利用抽象数据模型来表达所支持的各种文件格式。它还有一系列命令行工具来进行数据转换和处理。</p><p>OGR是GDAL项目的一个分支，功能与GDAL类似，只不过它提供对矢量数据的支持。</p><p>有很多著名的GIS类产品都使用了GDAL/OGR库，包括ESRI的ARCGIS 9.3，Google Earth和跨平台的GRASS GIS系统。利用GDAL/OGR库，可以使基于Linux的地理空间数据管理系统提供对矢量和栅格文件数据的支持。</p><h1 id="功能特征"><a href="#功能特征" class="headerlink" title="功能特征"></a>功能特征</h1><p>GDAL提供对多种栅格数据的支持，包括Arc/Info ASCII Grid(asc)，GeoTiff (tiff)，Erdas Imagine Images(img)，ASCII DEM(dem) 等格式。</p><p>GDAL使用抽象数据模型(abstract data model)来解析它所支持的数据格式，抽象数据模型包括数据集(dataset)，坐标系统，仿射地理坐标转换(Affine Geo Transform)， 大地控制点(GCPs)， 元数据(Metadata)，栅格波段(Raster Band)，颜色表(Color Table)，子数据集域(Subdatasets Domain)，图像结构域(Image_Structure Domain)，XML域(XML:Domains)。</p><p>GDALMajorObject类：带有元数据的对象。</p><p>GDALDdataset类：通常是从一个栅格文件中提取的相关联的栅格波段集合和这些波段的元数据;GDALDdataset也负责所有栅格波段的地理坐标转换(georeferencing transform)和坐标系定义。</p><p>GDALDriver类：文件格式驱动类，GDAL会为每一个所支持的文件格式创建一个该类的实体，来管理该文件格式。</p><p>GDALDriverManager类：文件格式驱动管理类，用来管理GDALDriver类。</p><h1 id="OGR体系结构编辑"><a href="#OGR体系结构编辑" class="headerlink" title="OGR体系结构编辑"></a>OGR体系结构编辑</h1><p>Geometry类：Geometry (包括OGRGeometry等类)封装了OpenGIS的矢量数据模型，并提供了一些几何操作，WKB(Well Knows Binary)和WKT(Well Known Text)格式之间的相互转换，以及空间参考系统(投影)。</p><p>Spatial Reference类：OGRSpatialReference封装了投影和基准面的定义。</p><p>Feature类：OGRFeature封装了一个完整feature的定义，一个完整的feature包括一个geometry和geometry的一系列属性。</p><p>Feature Definition类：OGRFeatureDefn里面封装了feature的属性，类型、名称及其默认的空间参考系统等。一个OGRFeatureDefn对象通常与一个层(layer)对应。</p><p>Layer类：OGRLayer是一个抽象基类，表示数据源类OGRDataSource里面的一层要素(feature)。</p><p>Data Source类：OGRDataSource是一个抽象基类，表示含有OGRLayer对象的一个文件或一个数据库。</p><p>Drivers类：OGRSFDriver对应于每一个所支持的矢量文件格式。类OGRSFDriver由类OGRSFDriverRegistrar来注册和管理。</p><h1 id="GDAL中OGR的使用"><a href="#GDAL中OGR的使用" class="headerlink" title="GDAL中OGR的使用"></a>GDAL中OGR的使用</h1><h2 id="读数据"><a href="#读数据" class="headerlink" title="读数据"></a>读数据</h2><ol><li><p>在工程的Library files中和Include files中分别添加GDAL的LIB文件目录和头文件目录</p></li><li><p>最初需要注册所需的所有格式驱动程序。这通常通过调用GDALAllRegister（）来完成，该寄存器注册GDAL / OGR中内置的所有格式驱动程序。 </p></li><li><p>接下来我们需要打开输入OGR数据源。数据源可以是文件，RDBMS，充满文件的目录，甚至是远程Web服务，具体取决于所使用的驱动程序。但是，数据源名称始终是单个字符串。在这种情况下，我们硬编码打开一个特定的shapefile。第二个参数（GDAL_OF_VECTOR）告诉OGROpen（）方法我们想要使用向量驱动程序并且不需要更新访问。失败时返回NULL，我们报告错误。</p></li><li><p>GDALDataset可以潜在地具有与它相关联的许多层。可以使用GDALDataset :: GetLayerCount（）查询可用的图层数，并使用GDALDataset :: GetLayer（）通过索引获取各个图层。但是，我们只是按名称获取图层。<br> OGRLayer   * poLayer;<br> poLayer = poDS-&gt; GetLayerByName（“point”）;  </p></li><li><p>现在我们要开始从图层中读取要素。在我们开始之前，我们可以为图层指定属性或空间过滤器以限制我们获取的功能集，但是现在我们有兴趣获取所有功能。</p></li><li><p>我们使用OGRLayer :: GetNextFeature（）遍历图层中的所有要素。当我们用完功能时它会返回NULL。</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">OGRFeature *poFeature;</span><br><span class="line">poLayer-&gt;ResetReading();</span><br><span class="line">while( (poFeature = poLayer-&gt;GetNextFeature()) != NULL )</span><br><span class="line">&#123;</span><br></pre></td></tr></table></figure></li><li><p>为了转储该功能的所有属性字段，获取OGRFeatureDefn会很有帮助。这是与图层关联的对象，包含所有字段的定义。我们遍历所有字段，并根据其类型获取和报告属性。</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">for( auto&amp;&amp; oField: *poFeature )</span><br><span class="line">&#123;</span><br><span class="line">    switch( oField.GetType() )</span><br><span class="line">    &#123;</span><br><span class="line">        case OFTInteger:</span><br><span class="line">            printf( &quot;%d,&quot;, oField.GetInteger() );</span><br><span class="line">            break;</span><br><span class="line">        case OFTInteger64:</span><br><span class="line">            printf( CPL_FRMT_GIB &quot;,&quot;, oField.GetInteger64() );</span><br><span class="line">            break;</span><br><span class="line">        case OFTReal:</span><br><span class="line">            printf( &quot;%.3f,&quot;, oField.GetDouble() );</span><br><span class="line">            break;</span><br><span class="line">        case OFTString:</span><br><span class="line">            printf( &quot;%s,&quot;, oField.GetString() );</span><br><span class="line">            break;</span><br><span class="line">        default:</span><br><span class="line">            printf( &quot;%s,&quot;, oField.GetAsString() );</span><br><span class="line">            break;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> 除了上面显式处理的字段类型之外，还有一些字段类型，但可以使用OGRFeature :: GetFieldAsString（）方法获取它们的合理表示。事实上，我们可以通过对所有类型使用OGRFeature :: GetFieldAsString（）来缩短上述内容。   </p></li><li><p>接下来，我们要从要素中提取几何体，并写出点几何体x和y。几何图形作为通用OGRGeometry指针返回。然后我们确定特定的几何类型，如果它是一个点，我们将其转换为点并对其进行操作。如果它是别的东西我们写占位符。</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">    OGRGeometry *poGeometry;</span><br><span class="line">    poGeometry = poFeature-&gt;GetGeometryRef();</span><br><span class="line">    if( poGeometry != NULL</span><br><span class="line">            &amp;&amp; wkbFlatten(poGeometry-&gt;getGeometryType()) == wkbPoint )</span><br><span class="line">    &#123;</span><br><span class="line">#if GDAL_VERSION_NUM &gt;= GDAL_COMPUTE_VERSION(2,3,0)</span><br><span class="line">        OGRPoint *poPoint = poGeometry-&gt;toPoint();</span><br><span class="line">#else</span><br><span class="line">        OGRPoint *poPoint = (OGRPoint *) poGeometry;</span><br><span class="line">#endif</span><br><span class="line">        printf( &quot;%.3f,%3.f\n&quot;, poPoint-&gt;getX(), poPoint-&gt;getY() );</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">        printf( &quot;no point geometry\n&quot; );</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p> 所述wkbFlatten（）宏上述用于将类型转换为一个wkbPoint25D（带z坐标的点）到2D的类型代码（wkbPoint）。对于每个2D几何类型，都有相应的2.5D类型代码。2D和2.5D几何案例由相同的C ++类处理，因此我们的代码将正确处理2D或3D案例。</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">OGRGeometry *poGeometry;</span><br><span class="line">   int iGeomField;</span><br><span class="line">   int nGeomFieldCount;</span><br><span class="line">   nGeomFieldCount = poFeature-&gt;GetGeomFieldCount();</span><br><span class="line">   for(iGeomField = 0; iGeomField &lt; nGeomFieldCount; iGeomField ++ )</span><br><span class="line">   &#123;</span><br><span class="line">       poGeometry = poFeature-&gt;GetGeomFieldRef(iGeomField);</span><br><span class="line">       if( poGeometry != NULL</span><br><span class="line">               &amp;&amp; wkbFlatten(poGeometry-&gt;getGeometryType()) == wkbPoint )</span><br><span class="line">       &#123;</span><br><span class="line">       #if GDAL_VERSION_NUM &gt;= GDAL_COMPUTE_VERSION(2,3,0)</span><br><span class="line">                   OGRPoint *poPoint = poGeometry-&gt;toPoint();</span><br><span class="line">       #else</span><br><span class="line">                   OGRPoint *poPoint = (OGRPoint *) poGeometry;</span><br><span class="line">       #endif</span><br><span class="line">                   printf( &quot;%.3f,%3.f\n&quot;, poPoint-&gt;getX(), poPoint-&gt;getY() );</span><br><span class="line">               &#125;</span><br><span class="line">       else</span><br><span class="line">       &#123;</span><br><span class="line">           printf( &quot;no point geometry\n&quot; );</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p> 请注意，OGRFeature :: GetGeometryRef（）和OGRFeature :: GetGeomFieldRef（）返回指向OGRFeature所拥有的内部几何的指针。实际上没有删除返回几何。  </p></li><li>对于GDAL &lt;2.3，因为OGRLayer :: GetNextFeature（）方法返回现在由我们拥有的功能的副本。因此，在使用结束时，我们必须释放该功能。我们可以“删除”它，但这可能会导致Windows版本中的问题，其中GDAL DLL与主程序具有不同的“堆”。为了安全起见，我们使用GDAL功能删除该功能。<br> <code>OGRFeature :: DestroyFeature（poFeature）;}</code></li><li>该OGRLayer通过返回的GDALDataset :: GetLayerByName（）也是由拥有一个内部层参考的GDALDataset所以我们并不需要将其删除。但我们确实需要删除数据源才能关闭输入文件。我们再一次使用自定义删除方法来避免特殊的win32堆问题。<br> <code>GDALClose（poDS）; }</code></li><li>完整模板 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;ogrsf_frmts.h&quot;</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    GDALAllRegister();</span><br><span class="line">    GDALDataset *poDS = static_cast&lt;GDALDataset*&gt;(</span><br><span class="line">        GDALOpenEx( &quot;point.shp&quot;, GDAL_OF_VECTOR, NULL, NULL, NULL ));</span><br><span class="line">    if( poDS == NULL )</span><br><span class="line">    &#123;</span><br><span class="line">        printf( &quot;Open failed.\n&quot; );</span><br><span class="line">        exit( 1 );</span><br><span class="line">    &#125;</span><br><span class="line">    OGRLayer  *poLayer = poDS-&gt;GetLayerByName( &quot;point&quot; );</span><br><span class="line">    OGRFeatureDefn *poFDefn = poLayer-&gt;GetLayerDefn();</span><br><span class="line">    poLayer-&gt;ResetReading();</span><br><span class="line">    OGRFeature *poFeature;</span><br><span class="line">    while( (poFeature = poLayer-&gt;GetNextFeature()) != NULL )</span><br><span class="line">    &#123;</span><br><span class="line">        for( int iField = 0; iField &lt; poFDefn-&gt;GetFieldCount(); iField++ )</span><br><span class="line">        &#123;</span><br><span class="line">            OGRFieldDefn *poFieldDefn = poFDefn-&gt;GetFieldDefn( iField );</span><br><span class="line">            switch( poFieldDefn-&gt;GetType() )</span><br><span class="line">            &#123;</span><br><span class="line">                case OFTInteger:</span><br><span class="line">                    printf( &quot;%d,&quot;, poFeature-&gt;GetFieldAsInteger( iField ) );</span><br><span class="line">                    break;</span><br><span class="line">                case OFTInteger64:</span><br><span class="line">                    printf( CPL_FRMT_GIB &quot;,&quot;, poFeature-&gt;GetFieldAsInteger64( iField ) );</span><br><span class="line">                    break;</span><br><span class="line">                case OFTReal:</span><br><span class="line">                    printf( &quot;%.3f,&quot;, poFeature-&gt;GetFieldAsDouble(iField) );</span><br><span class="line">                    break;</span><br><span class="line">                case OFTString:</span><br><span class="line">                    printf( &quot;%s,&quot;, poFeature-&gt;GetFieldAsString(iField) );</span><br><span class="line">                    break;</span><br><span class="line">                default:</span><br><span class="line">                    printf( &quot;%s,&quot;, poFeature-&gt;GetFieldAsString(iField) );</span><br><span class="line">                    break;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        OGRGeometry *poGeometry = poFeature-&gt;GetGeometryRef();</span><br><span class="line">        if( poGeometry != NULL</span><br><span class="line">                &amp;&amp; wkbFlatten(poGeometry-&gt;getGeometryType()) == wkbPoint )</span><br><span class="line">        &#123;</span><br><span class="line">            OGRPoint *poPoint = (OGRPoint *) poGeometry;</span><br><span class="line">            printf( &quot;%.3f,%3.f\n&quot;, poPoint-&gt;getX(), poPoint-&gt;getY() );</span><br><span class="line">        &#125;</span><br><span class="line">        else</span><br><span class="line">        &#123;</span><br><span class="line">            printf( &quot;no point geometry\n&quot; );</span><br><span class="line">        &#125;</span><br><span class="line">        OGRFeature::DestroyFeature( poFeature );</span><br><span class="line">    &#125;</span><br><span class="line">    GDALClose( poDS );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h2 id="写数据"><a href="#写数据" class="headerlink" title="写数据"></a>写数据</h2><p> 作为通过OGR写作的一个例子，我们将大致与上述相反。从输入文本中读取逗号分隔值的短程序将通过OGR写入点shapefile。  </p><pre><code>1. 像往常一样，我们首先注册所有驱动程序，然后获取Shapefile驱动程序，因为我们需要它来创建输出文件。    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;ogrsf_frmts.h&quot;</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    const char *pszDriverName = &quot;ESRI Shapefile&quot;;</span><br><span class="line">    GDALDriver *poDriver;</span><br><span class="line">    GDALAllRegister();</span><br><span class="line">    poDriver = GetGDALDriverManager()-&gt;GetDriverByName(pszDriverName );</span><br><span class="line">    if( poDriver == NULL )</span><br><span class="line">    &#123;</span><br><span class="line">        printf( &quot;%s driver not available.\n&quot;, pszDriverName );</span><br><span class="line">        exit( 1 );</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>2. 接下来我们创建数据源。ESRI Shapefile驱动程序允许我们创建一个完整的shapefile目录，或一个shapefile作为数据源。在这种情况下，我们将通过在名称中包含扩展名来显式创建单个文件。其他驱动程序表现不同。第二个，第三个，第四个和第五个参数与栅格尺寸相关（如果驱动程序具有栅格功能）。调用的最后一个参数是选项值列表，但在这种情况下我们将只使用默认值。支持的选项的详细信息也是特定于格式的。    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">GDALDataset *poDS;</span><br><span class="line">poDS = poDriver-&gt;Create( &quot;point_out.shp&quot;, 0, 0, 0, GDT_Unknown, NULL );</span><br><span class="line">if( poDS == NULL )</span><br><span class="line">&#123;</span><br><span class="line">    printf( &quot;Creation of output file failed.\n&quot; );</span><br><span class="line">    exit( 1 );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>3. 现在我们创建输出层。在这种情况下，由于数据源是单个文件，因此我们只能有一个图层。我们传递wkbPoint来指定该层支持的几何类型。在这种情况下，我们不传递任何坐标系信息或其他特殊图层创建选项。    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">OGRLayer *poLayer;</span><br><span class="line">poLayer = poDS-&gt;CreateLayer( &quot;point_out&quot;, NULL, wkbPoint, NULL );</span><br><span class="line">if( poLayer == NULL )</span><br><span class="line">&#123;</span><br><span class="line">    printf( &quot;Layer creation failed.\n&quot; );</span><br><span class="line">    exit( 1 );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>4. 现在该图层已存在，我们需要创建应出现在图层上的任何属性字段。必须在写入任何要素之前将字段添加到图层。要创建字段，我们使用有关字段的信息初始化OGRField对象。在Shapefiles的情况下，字段宽度和精度在创建输出.dbf文件时很重要，所以我们专门设置它，尽管通常默认值是OK。对于此示例，我们将只有一个属性，一个与x，y点关联的名称字符串。   请注意，我们传递给CreateField（）的模板OGRField是在内部复制的。我们保留对象的所有权。   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">OGRFieldDefn oField（“Name”，OFTString）;</span><br><span class="line">oField.SetWidth（32）;</span><br><span class="line">if（poLayer-&gt; CreateField（＆oField）！= OGRERR_NONE）</span><br><span class="line">&#123;</span><br><span class="line">    printf（“创建名称字段失败。\ n”）;</span><br><span class="line">    退出（1）;</span><br><span class="line">&#125;</span><br><span class="line">//通过读数据中的x,y,name，写入</span><br><span class="line">double x, y;</span><br><span class="line"> char szName[33];</span><br><span class="line"> while( !feof(stdin)</span><br><span class="line">        &amp;&amp; fscanf( stdin, &quot;%lf,%lf,%32s&quot;, &amp;x, &amp;y, szName ) == 3 )</span><br><span class="line"> &#123;</span><br></pre></td></tr></table></figure>5. 要将功能写入磁盘，我们必须创建本地OGRFeature，设置属性并附加几何体，然后再尝试将其写入图层。必须从与要写入的层关联的OGRFeatureDefn实例化此功能。    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">OGRFeature * poFeature;</span><br><span class="line">poFeature = OGRFeature :: CreateFeature（poLayer-&gt; GetLayerDefn（））;</span><br><span class="line">poFeature-&gt; SetField（“Name”，szName）;</span><br></pre></td></tr></table></figure>6. 我们创建一个本地几何对象，并将其副本（间接）分配给该功能。的和OGRFeature :: SetGeometryDirectly（）不同于和OGRFeature :: SetGeometry（）在该直接方法给出了几何形状的特征的所有权。这通常更有效，因为它避免了几何体的额外深层对象副本。    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">OGRPoint pt;</span><br><span class="line">pt.setX( x );</span><br><span class="line">pt.setY( y );</span><br><span class="line">poFeature-&gt;SetGeometry( &amp;pt );</span><br></pre></td></tr></table></figure>7. 现在我们在文件中创建一个功能。该OGRLayer :: CreateFeature（）不走我们的特点的所有权，所以我们在用它做清理。    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> if( poLayer-&gt;CreateFeature( poFeature ) != OGRERR_NONE )</span><br><span class="line">     &#123;</span><br><span class="line">         printf( &quot;Failed to create feature in shapefile.\n&quot; );</span><br><span class="line">        exit( 1 );</span><br><span class="line">     &#125;</span><br><span class="line">     OGRFeature::DestroyFeature( poFeature );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>8. 最后，我们需要关闭数据源，以确保以有序的方式写出标头，并恢复所有资源。`GDALClose（poDS）;}`9. 模板    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;ogrsf_frmts.h&quot;</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    const char *pszDriverName = &quot;ESRI Shapefile&quot;;</span><br><span class="line">    GDALDriver *poDriver;</span><br><span class="line">    GDALAllRegister();</span><br><span class="line">    poDriver = GetGDALDriverManager()-&gt;GetDriverByName(pszDriverName );</span><br><span class="line">    if( poDriver == NULL )</span><br><span class="line">    &#123;</span><br><span class="line">        printf( &quot;%s driver not available.\n&quot;, pszDriverName );</span><br><span class="line">        exit( 1 );</span><br><span class="line">    &#125;</span><br><span class="line">    GDALDataset *poDS;</span><br><span class="line">    poDS = poDriver-&gt;Create( &quot;point_out.shp&quot;, 0, 0, 0, GDT_Unknown, NULL );</span><br><span class="line">    if( poDS == NULL )</span><br><span class="line">    &#123;</span><br><span class="line">        printf( &quot;Creation of output file failed.\n&quot; );</span><br><span class="line">        exit( 1 );</span><br><span class="line">    &#125;</span><br><span class="line">    OGRLayer *poLayer;</span><br><span class="line">    poLayer = poDS-&gt;CreateLayer( &quot;point_out&quot;, NULL, wkbPoint, NULL );</span><br><span class="line">    if( poLayer == NULL )</span><br><span class="line">    &#123;</span><br><span class="line">        printf( &quot;Layer creation failed.\n&quot; );</span><br><span class="line">        exit( 1 );</span><br><span class="line">    &#125;</span><br><span class="line">    OGRFieldDefn oField( &quot;Name&quot;, OFTString );</span><br><span class="line">    oField.SetWidth(32);</span><br><span class="line">    if( poLayer-&gt;CreateField( &amp;oField ) != OGRERR_NONE )</span><br><span class="line">    &#123;</span><br><span class="line">        printf( &quot;Creating Name field failed.\n&quot; );</span><br><span class="line">        exit( 1 );</span><br><span class="line">    &#125;</span><br><span class="line">    double x, y;</span><br><span class="line">    char szName[33];</span><br><span class="line">    while( !feof(stdin)</span><br><span class="line">           &amp;&amp; fscanf( stdin, &quot;%lf,%lf,%32s&quot;, &amp;x, &amp;y, szName ) == 3 )</span><br><span class="line">    &#123;</span><br><span class="line">        OGRFeature *poFeature;</span><br><span class="line">        poFeature = OGRFeature::CreateFeature( poLayer-&gt;GetLayerDefn() );</span><br><span class="line">        poFeature-&gt;SetField( &quot;Name&quot;, szName );</span><br><span class="line">        OGRPoint pt;</span><br><span class="line">        pt.setX( x );</span><br><span class="line">        pt.setY( y );</span><br><span class="line">        poFeature-&gt;SetGeometry( &amp;pt );</span><br><span class="line">        if( poLayer-&gt;CreateFeature( poFeature ) != OGRERR_NONE )</span><br><span class="line">        &#123;</span><br><span class="line">            printf( &quot;Failed to create feature in shapefile.\n&quot; );</span><br><span class="line">            exit( 1 );</span><br><span class="line">        &#125;</span><br><span class="line">        OGRFeature::DestroyFeature( poFeature );</span><br><span class="line">    &#125;</span><br><span class="line">    GDALClose( poDS );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></code></pre><h1 id="参考资料："><a href="#参考资料：" class="headerlink" title="参考资料："></a>参考资料：</h1><ol><li>百度百科：<a href="https://baike.baidu.com/item/GDAL/4004525?fr=aladdin" target="_blank" rel="noopener">https://baike.baidu.com/item/GDAL/4004525?fr=aladdin</a></li><li>官方网站：<a href="https://www.gdal.org/" target="_blank" rel="noopener">https://www.gdal.org/</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;GDAL(Geospatial Data Abstraction Library)是一个在X/MIT许可协议下的开源栅格空间数据转换库&lt;br&gt;&lt;strong&gt;持续更新中&lt;/strong&gt;&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="C++" scheme="http://11wy11.github.io/categories/C/"/>
    
    
      <category term="GDAL" scheme="http://11wy11.github.io/tags/GDAL/"/>
    
  </entry>
  
  <entry>
    <title>常用工具</title>
    <link href="http://11wy11.github.io/2019/03/18/tools/"/>
    <id>http://11wy11.github.io/2019/03/18/tools/</id>
    <published>2019-03-18T04:46:05.000Z</published>
    <updated>2019-03-24T01:35:38.507Z</updated>
    
    <content type="html"><![CDATA[<p>主要介绍doctoc插件自动生成文章目录<br><a id="more"></a></p><h1 id="markdown相关"><a href="#markdown相关" class="headerlink" title="markdown相关"></a>markdown相关</h1><h2 id="doctoc-markdown目录自动生成"><a href="#doctoc-markdown目录自动生成" class="headerlink" title="doctoc(markdown目录自动生成)"></a>doctoc(markdown目录自动生成)</h2><p>GitHub中的markdown文件直接写[TOC]是无法生成目录的，可以使用工具doctoc<br>npm install -g doctoc<br>使用方式</p><ul><li><p>对当前文件夹中所有文件生成目录<br>e.g.</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">    cd D:\Develop\Documents\Notes\CSDN笔记\temp</span><br><span class="line">    doctoc .</span><br><span class="line">    ``` </span><br><span class="line"></span><br><span class="line">+ 对文件夹中单个文件生成目录（文件名中间不能有空格）  </span><br><span class="line">`doctoc /path/to/file [...]`  </span><br><span class="line">  如：</span><br></pre></td></tr></table></figure><p>  doctoc README.md<br>  doctoc CONTRIBUTING.md LICENSE.md<br>  doctoc D:\Develop\Documents\Notes\CSDN笔记\JAVARxJava.md<br> <code>`</code></p></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;主要介绍doctoc插件自动生成文章目录&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="工具" scheme="http://11wy11.github.io/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="tools" scheme="http://11wy11.github.io/tags/tools/"/>
    
  </entry>
  
  <entry>
    <title>AI组件开发（二）--AIRealMathSuite</title>
    <link href="http://11wy11.github.io/2019/03/18/ai-second-note/"/>
    <id>http://11wy11.github.io/2019/03/18/ai-second-note/</id>
    <published>2019-03-18T02:50:27.000Z</published>
    <updated>2019-03-25T08:38:49.151Z</updated>
    
    <content type="html"><![CDATA[<p>主要介绍AIRealMathSuite中使用到的函数，以及部分应用场景，持续更新中<br><a id="more"></a></p><h1 id="AIRealRectOverlap"><a href="#AIRealRectOverlap" class="headerlink" title="AIRealRectOverlap"></a>AIRealRectOverlap</h1><p>AIAPI AIBoolean(* AIRealMathSuite::AIRealRectOverlap)(const AIRealRect *a, const AIRealRect *b)<br>Tests whether two rectangles overlap (have any points in common).<br>测试两个矩形是否重叠（有任何共同点）  </p><ul><li>参数:<ul><li>a<br>The first rectangle.</li><li>b<br>The second rectangle.  </li></ul></li><li>返回值：<br>如果矩形重叠，则为真。</li></ul><h1 id="AIRealRectInAIRealRect"><a href="#AIRealRectInAIRealRect" class="headerlink" title="AIRealRectInAIRealRect"></a>AIRealRectInAIRealRect</h1><p>AIAPI AIBoolean(* AIRealMathSuite::AIRealRectInAIRealRect)(const AIRealRect *a, const AIRealRect *b)<br>Tests whether one rectangle is inside (entirely contained in) another rectangle.<br>测试一个矩形是否在另一个矩形内（完全包含在内）。  </p><p>Both must be open or both closed.<br>两者都必须是开放的或都是封闭的。</p><ul><li>参数:<ul><li>a<br>The first rectangle.  </li><li>b<br>The second rectangle.</li></ul></li><li>返回值：<br>True if the set of points contained by a is also contained by b.<br>如果a包含的点集也包含在b内，则为真。</li></ul><h1 id="AIRealRectSet"><a href="#AIRealRectSet" class="headerlink" title="AIRealRectSet"></a>AIRealRectSet</h1><p>AIAPI void(* AIRealMathSuite::AIRealRectSet)(AIRealRect *a, AIReal left, AIReal top, AIReal right, AIReal bottom)<br>Sets the coordinate values in a rectangle. 设置矩形中的坐标值<br>(In the Illustrator art coordinate system, the origin, (0, 0), is at the bottom left corner of a page. X and Y values increase upward and to the right.) </p><ul><li>参数:<ul><li>a<br>The rectangle object. ///AI的矩形对象指针</li><li>left<br>The left side location.///xmin</li><li>top<br>The top side location. ///ymax</li><li>right<br>The right side location.///xmax</li><li>bottom<br>The bottom side location.///ymin</li></ul></li></ul><p>注意：Illustrator的坐标系原点位于页面左下角，X和Y值向上和向右增加。</p><h1 id="AIRealPointInterpolate"><a href="#AIRealPointInterpolate" class="headerlink" title="AIRealPointInterpolate"></a>AIRealPointInterpolate</h1><p>AIAPI void（* AIRealMathSuite :: AIRealPointInterpolate）（const AIRealPoint * a，const AIRealPoint * b，AIReal t，AIRealPoint * result）<br>通过在点的相应坐标之间插入新坐标值来计算两点之间的点的位置。<br>原理就是向量<br>结果是 a <em> t + b </em> (1-t)</p><p>参数：<br>a 第一点。<br>b 第二点。<br>t（b-a）的百分比，表示为0到1之间的数字。<br>result     [out]用于返回结果的缓冲区。</p><h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><p>  Adobe Illustrator SDK，下载地址：<a href="https://www.adobe.com/devnet/illustrator/sdk.html" target="_blank" rel="noopener">https://www.adobe.com/devnet/illustrator/sdk.html</a></p><h1 id="相关文章"><a href="#相关文章" class="headerlink" title="相关文章"></a>相关文章</h1><p><a href="/2019/03/14/ai-first-note">AI组件开发（一）–注记旋转矩阵</a><br><a href="/2019/03/18/ai-second-note">AI组件开发（二）–AIRealMathSuite</a><br><a href="/2019/03/24/ai-third-note">AI组件开发（三）–AIArtboardSuite</a><br><a href="/2019/03/24/ai-forth-document-note">AI组件开发（四）–AIDocumentSuite</a><br><a href="/2019/03/24/ai-fifth-ailayer-note">AI组件开发（五）–AILayerSuite</a><br><a href="/2019/03/24/ai-six-aiart-note">AI组件开发（六）–AIArtSuite</a><br><a href="/2019/03/25/ai-seven-path-note">AI组件开发（七）–AIPathSuite&amp;&amp;AIPathfinderSuite</a><br><a href="/2019/03/25/ai-eight-style-note">AI组件开发（八）–AIArtStyleSuite</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;主要介绍AIRealMathSuite中使用到的函数，以及部分应用场景，持续更新中&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="AI组件开发" scheme="http://11wy11.github.io/categories/AI%E7%BB%84%E4%BB%B6%E5%BC%80%E5%8F%91/"/>
    
    
      <category term="AI" scheme="http://11wy11.github.io/tags/AI/"/>
    
  </entry>
  
  <entry>
    <title>markdown编写技巧</title>
    <link href="http://11wy11.github.io/2019/03/17/markdown-first-skill/"/>
    <id>http://11wy11.github.io/2019/03/17/markdown-first-skill/</id>
    <published>2019-03-17T13:33:53.000Z</published>
    <updated>2019-03-24T01:33:15.202Z</updated>
    
    <content type="html"><![CDATA[<p>markdown编写技巧,转义字符及部分基本语法<br><a id="more"></a></p><h1 id="常用转义字符"><a href="#常用转义字符" class="headerlink" title="常用转义字符"></a>常用转义字符</h1><ul><li>\\ 反斜杠  </li><li>\` 反引号  </li><li>\* 星号  </li><li>\_ 下划线  </li><li>\{\} 大括号  </li><li>\[\] 中括号  </li><li>\(\) 小括号  </li><li>\# 井号  </li><li>\+ 加号  </li><li>\- 减号  </li><li>\. 英文句号  </li><li>\! 感叹号<br>也可以用ASCII码代替<figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2019/03/17/markdown-first-skill/pic1.png" alt="1" title>                </div>                <div class="image-caption">1</div>            </figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2019/03/17/markdown-first-skill/pic2.png" alt="2" title>                </div>                <div class="image-caption">2</div>            </figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2019/03/17/markdown-first-skill/pic3.png" alt="3" title>                </div>                <div class="image-caption">3</div>            </figure><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2019/03/17/markdown-first-skill/pic4.png" alt="4" title>                </div>                <div class="image-caption">4</div>            </figure><h1 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h1></li></ul><ol><li><p>标题设置（让字体变大，和word的标题意思一样）<br>在Markdown当中设置标题，有两种方式：<br>第一种：通过在文字下方添加“=”和“-”，他们分别表示一级标题和二级标题。<br>第二种：在文字开头加上 “#”，通过“#”数量表示几级标题。（一共只有1~6级标题，1级标题字体最大）</p></li><li><p>块注释（blockquote）<br>通过在文字开头添加“&gt;”表示块注释。（当&gt;和文字之间添加五个blank时，块注释的文字会有变化。）</p></li><li><p>斜体<br>将需要设置为斜体的文字两端使用1个“*”或者“_”夹起来</p></li><li><p>粗体<br>将需要设置为斜体的文字两端使用2个“*”或者“_”夹起来</p></li><li><p>无序列表<br>在文字开头添加(*, +, and -)实现无序列表。但是要注意在(*, +, and -)和文字之间需要添加空格。（建议：一个文档中只是用一种无序列表的表示方式）</p></li><li><p>有序列表<br>使用数字后面跟上句号。（还要有空格）</p></li><li><p>链接（Links）<br>Markdown中有两种方式，实现链接，分别为内联方式和引用方式。<br>内联方式：This is an [example link](<a href="http://example.com/)" target="_blank" rel="noopener">http://example.com/)</a>.<br>引用方式：<br>I get 10 times more traffic from [Google][1] than from [Yahoo][2] or [MSN][3].  </p><p>[1]: <a href="http://google.com/" target="_blank" rel="noopener">http://google.com/</a>        “Google”<br>[2]: <a href="http://search.yahoo.com/" target="_blank" rel="noopener">http://search.yahoo.com/</a>  “Yahoo Search”<br>[3]: <a href="http://search.msn.com/" target="_blank" rel="noopener">http://search.msn.com/</a>    “MSN Search”</p></li></ol><ol start="8"><li>图片（Images）<br>图片的处理方式和链接的处理方式，非常的类似。<br>内联方式：![alt text](/path/to/img.jpg “Title”)<br>引用方式：<br>![alt text][id] </li></ol><p>[id]: /path/to/img.jpg “Title”</p><ol start="9"><li><p>代码（HTML中所谓的Code）<br>实现方式有两种：<br>第一种：简单文字出现一个代码框。使用<code>&lt;blockquote&gt;</code>。（<code>不是单引号而是左上角的ESC下面~中的</code>）<br>第二种：大片文字需要实现代码框。使用Tab和四个空格。</p></li><li><p>脚注（footnote）<br>实现方式如下：<br>hello[^hello]</p></li></ol><ol start="11"><li>下划线<br>在空白行下方添加三条“-”横线。（前面讲过在文字下方添加“-”，实现的2级标题）<br>参考<br>官方文档<a href="http://daringfireball.net/projects/markdown/basics" target="_blank" rel="noopener">http://daringfireball.net/projects/markdown/basics</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;markdown编写技巧,转义字符及部分基本语法&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="语言" scheme="http://11wy11.github.io/categories/%E8%AF%AD%E8%A8%80/"/>
    
    
      <category term="markdown" scheme="http://11wy11.github.io/tags/markdown/"/>
    
  </entry>
  
  <entry>
    <title>sqlite数据库查询 C++函数</title>
    <link href="http://11wy11.github.io/2019/03/17/sqlite-first-note/"/>
    <id>http://11wy11.github.io/2019/03/17/sqlite-first-note/</id>
    <published>2019-03-17T13:17:22.000Z</published>
    <updated>2019-03-17T13:36:37.631Z</updated>
    
    <content type="html"><![CDATA[<h2 id="sqlite部分函数简介"><a href="#sqlite部分函数简介" class="headerlink" title="sqlite部分函数简介"></a>sqlite部分函数简介</h2><p>主要有打开数据库连接，执行数据库查询语句，关闭连接等函数<br><a id="more"></a></p><h3 id="sqlite3-open用法"><a href="#sqlite3-open用法" class="headerlink" title="sqlite3_open用法"></a>sqlite3_open用法</h3><p>打开数据库链接<br>sqlite3_open用法<br>原型：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">int sqlite3_open(</span><br><span class="line">  const char *filename,   /* Database filename (UTF-8) */</span><br><span class="line">  sqlite3 **ppDb          /* OUT: SQLite db handle */</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p><p>用这个函数开始数据库操作。需要传入两个参数，一是数据库文件名，比如：E:/test.db。文件名不需要一定存在，如果此文件不存在，sqlite会自动建立它。如果它存在，就尝试把它当数据库文件来打开。<br>二是sqlite3**，即前面提到的关键数据结构。<br>函数返回值表示操作是否正确，如果是SQLITE_OK则表示操作正常。相关的返回值sqlite定义了一些宏。具体这些宏的含义可以参考sqlite3.h 文件。里面有详细定义。</p><h3 id="sqlite3-close用法"><a href="#sqlite3-close用法" class="headerlink" title="sqlite3_close用法"></a>sqlite3_close用法</h3><p>关闭数据库链接<br>原型：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">int sqlite3_close(sqlite3 *ppDb);</span><br></pre></td></tr></table></figure></p><p>ppDb为刚才使用sqlite3_open打开的数据库链接  </p><h3 id="sqlite3-exec用法"><a href="#sqlite3-exec用法" class="headerlink" title="sqlite3_exec用法"></a>sqlite3_exec用法</h3><p>执行sql操作<br>原型：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">int sqlite3_exec(</span><br><span class="line">  sqlite3* ppDb,                             /* An open database */</span><br><span class="line">  const char *sql,                           /* SQL to be evaluated */</span><br><span class="line">  int (*callback)(void*,int,char**,char**),  /* Callback function */</span><br><span class="line">  void *,                                    /* 1st argument to callback */</span><br><span class="line">  char **errmsg                              /* Error msg written here */</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p><p>这就是执行一条sql 语句的函数。<br>第1个参数不再说了，是前面open函数得到的指针。<br>第2个参数constchar*sql是一条sql 语句，以\0结尾。<br>第3个参数sqlite3_callback 是回调，当这条语句执行之后，sqlite3会去调用你提供的这个函数。<br>第4个参数void*是你所提供的指针，你可以传递任何一个指针参数到这里，这个参数最终会传到回调函数里面，如果不需要传递指针给回调函数，可以填NULL。回调函数的写法，以及这个参数的使用在之后介绍。<br>第5个参数char** errmsg 是错误信息。注意是指针的指针。sqlite3里面有很多固定的错误信息。执行sqlite3_exec 之后，执行失败时可以查阅这个指针（直接cout&lt;&lt;errmsg得到一串字符串信息，这串信息告诉你错在什么地方。sqlite3_exec函数通过修改你传入的指针的指针，把你提供的指针指向错误提示信息，这样sqlite3_exec函数外面就可以通过这个char*得到具体错误提示。<br>说明：通常，sqlite3_callback 和它后面的void*这两个位置都可以填NULL。填NULL表示你不需要回调。比如你做insert 操作，做delete操作，就没有必要使用回调。而当你做select 时，就要使用回调，因为sqlite3 把数据查出来，得通过回调告诉你查出了什么数据。<br>exec 的回调<br><code>typedef int(*sqlite3_callback)(void*,int,char**,char**);</code><br>你的回调函数必须定义成上面这个函数的类型。下面给个简单的例子：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//sqlite3的回调函数</span><br><span class="line">//sqlite 每查到一条记录，就调用一次这个回调</span><br><span class="line">int LoadMyInfo(void* para,intn_column,char** column_value,char** column_name);</span><br><span class="line">//para是你在sqlite3_exec 里传入的void*参数通过para参数，你可以传入一些特殊的指针（比如类指针、结构指针），</span><br><span class="line">//然后在这里面强制转换成对应的类型（这里面是void*类型，必须强制转换成你的类型才可用）。然后操作这些数据</span><br><span class="line">//n_column是这一条记录有多少个字段(即这条记录有多少列)</span><br><span class="line">//char** column_value 是个关键值，查出来的数据都保存在这里，它实际上是个1维数组（不要以为是2维数组），</span><br><span class="line">//每一个元素都是一个char*值，是一个字段内容（用字符串来表示，以\0结尾）</span><br><span class="line">//char** column_name 跟column_value是对应的，表示这个字段的字段名称</span><br></pre></td></tr></table></figure></p><p>实例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;iostream&gt;</span><br><span class="line">using namespace std;</span><br><span class="line">#include &quot;sqlite/sqlite3.h&quot;</span><br><span class="line">int callback(void*,int,char**,char**);</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    sqlite3* db;</span><br><span class="line">    int nResult = sqlite3_open(&quot;test.db&quot;,&amp;db);</span><br><span class="line">    if (nResult != SQLITE_OK)</span><br><span class="line">    &#123;</span><br><span class="line">        cout&lt;&lt;&quot;打开数据库失败：&quot;&lt;&lt;sqlite3_errmsg(db)&lt;&lt;endl;</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line">    else</span><br><span class="line">    &#123;</span><br><span class="line">        cout&lt;&lt;&quot;数据库打开成功&quot;&lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    char* errmsg;</span><br><span class="line"></span><br><span class="line">    nResult = sqlite3_exec(db,&quot;create table fuck(id integer primary key autoincrement,name varchar(100))&quot;,NULL,NULL,&amp;errmsg);</span><br><span class="line">     if (nResult != SQLITE_OK)</span><br><span class="line">     &#123;</span><br><span class="line">         sqlite3_close(db);</span><br><span class="line">         cout&lt;&lt;errmsg;</span><br><span class="line">         sqlite3_free(errmsg);</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line">    string strSql;</span><br><span class="line">    strSql+=&quot;begin;\n&quot;;</span><br><span class="line">    for (int i=0;i&lt;100;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        strSql+=&quot;insert into fuck values(null,&apos;heh&apos;);\n&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    strSql+=&quot;commit;&quot;;</span><br><span class="line">    //cout&lt;&lt;strSql&lt;&lt;endl;</span><br><span class="line"></span><br><span class="line">    nResult = sqlite3_exec(db,strSql.c_str(),NULL,NULL,&amp;errmsg);</span><br><span class="line"></span><br><span class="line">    if (nResult != SQLITE_OK)</span><br><span class="line">    &#123;</span><br><span class="line">        sqlite3_close(db);</span><br><span class="line">        cout&lt;&lt;errmsg&lt;&lt;endl;</span><br><span class="line">        sqlite3_free(errmsg);</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    strSql = &quot;select * from fuck&quot;;</span><br><span class="line">    nResult = sqlite3_exec(db,strSql.c_str(),callback,NULL,&amp;errmsg);</span><br><span class="line">      if (nResult != SQLITE_OK)</span><br><span class="line">    &#123;</span><br><span class="line">        sqlite3_close(db);</span><br><span class="line">        cout&lt;&lt;errmsg&lt;&lt;endl;</span><br><span class="line">        sqlite3_free(errmsg);</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    sqlite3_close(db);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int callback(void* ,int nCount,char** pValue,char** pName)</span><br><span class="line">&#123;</span><br><span class="line">    string s;</span><br><span class="line">    for(int i=0;i&lt;nCount;i++)</span><br><span class="line">    &#123;</span><br><span class="line">        s+=pName[i];</span><br><span class="line">        s+=&quot;:&quot;;</span><br><span class="line">        s+=pValue[i];</span><br><span class="line">        s+=&quot;\n&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    cout&lt;&lt;s&lt;&lt;endl;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;sqlite部分函数简介&quot;&gt;&lt;a href=&quot;#sqlite部分函数简介&quot; class=&quot;headerlink&quot; title=&quot;sqlite部分函数简介&quot;&gt;&lt;/a&gt;sqlite部分函数简介&lt;/h2&gt;&lt;p&gt;主要有打开数据库连接，执行数据库查询语句，关闭连接等函数&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="其他" scheme="http://11wy11.github.io/categories/%E5%85%B6%E4%BB%96/"/>
    
    
      <category term="C++" scheme="http://11wy11.github.io/tags/C/"/>
    
      <category term="sqlite" scheme="http://11wy11.github.io/tags/sqlite/"/>
    
  </entry>
  
  <entry>
    <title>C++部分基础知识</title>
    <link href="http://11wy11.github.io/2019/03/17/cpp-function/"/>
    <id>http://11wy11.github.io/2019/03/17/cpp-function/</id>
    <published>2019-03-17T06:09:53.000Z</published>
    <updated>2019-04-19T12:05:56.382Z</updated>
    
    <content type="html"><![CDATA[<p>介绍项目中用到的一些常用函数和关键字的使用<br><a id="more"></a><br><!-- START doctoc generated TOC please keep comment here to allow auto update --><br><!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE --><br><strong>Table of Contents</strong>  <em>generated with <a href="https://github.com/thlorenz/doctoc" target="_blank" rel="noopener">DocToc</a></em></p><ul><li><a href="#%E5%B8%B8%E7%94%A8%E5%87%BD%E6%95%B0">常用函数</a><ul><li><a href="#1-strtok">1. strtok</a></li><li><a href="#2strcmp">2.strcmp</a></li><li><a href="#3-erase">3. Erase</a></li><li><a href="#4-list">4. List</a></li><li><a href="#5-strcpy">5. strcpy</a></li><li><a href="#6%E8%BD%AC%E6%8D%A2%E5%87%BD%E6%95%B0">6.转换函数</a><ul><li><a href="#61-atoi">6.1 Atoi</a></li></ul></li></ul></li><li><a href="#%E5%85%B3%E9%94%AE%E5%AD%97">关键字</a><ul><li><a href="#extern">extern</a><ul><li><a href="#%E5%8F%98%E9%87%8F">变量</a></li><li><a href="#%E5%87%BD%E6%95%B0">函数</a></li><li><a href="#%E7%BC%96%E8%AF%91%E9%93%BE%E6%8E%A5">编译链接</a><ul><li><a href="#%E5%A3%B0%E6%98%8E%E5%A4%96%E9%83%A8%E5%8F%98%E9%87%8F">声明外部变量</a></li></ul></li><li><a href="#c%E4%B8%ADextern-c%E7%9A%84%E6%B7%B1%E5%B1%82%E6%8E%A2%E7%B4%A2">C++中extern c的深层探索</a></li></ul></li></ul></li></ul><!-- END doctoc generated TOC please keep comment here to allow auto update --><hr><h1 id="常用函数"><a href="#常用函数" class="headerlink" title="常用函数"></a>常用函数</h1><h2 id="1-strtok"><a href="#1-strtok" class="headerlink" title="1. strtok"></a>1. strtok</h2><p>  分解字符串为一组字符串。s为要分解的字符，delim为分隔符字符（如果传入字符串，则传入的字符串中每个字符均为分割符）。首次调用时，s指向要分解的字符串，之后再次调用要把s设成NULL。<br>  例如：strtok(“abc,def,ghi”,”,”)，最后可以分割成为abc def ghi.尤其在点分十进制的IP中提取应用较多。<br>strtok的函数原型为char <em>strtok(char </em>s, char *delim)，功能为“Parse S into tokens separated by characters in DELIM.If S is NULL, the saved pointer in SAVE_PTR is used as the next starting point. ” 翻译成汉语就是：作用于字符串s，以包含在delim中的字符为分界符，将s切分成一个个子串；如果，s为空值NULL，则函数保存的指针SAVE_PTR在下一次调用中将作为起始位置。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#include&lt;iostream&gt;</span><br><span class="line">#include&lt;cstring&gt;</span><br><span class="line">using namespace std;</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    char sentence[]=&quot;This is a sentence with 7 tokens&quot;;</span><br><span class="line">    cout &lt;&lt; &quot;The string to be tokenized is:\n&quot; &lt;&lt; sentence &lt;&lt; &quot;\n\nThe tokens are:\n\n&quot;;</span><br><span class="line">    char *tokenPtr=strtok(sentence,&quot; &quot;);</span><br><span class="line">    while(tokenPtr!=NULL)　&#123;</span><br><span class="line">        cout&lt;&lt;tokenPtr&lt;&lt;endl;</span><br><span class="line">        tokenPtr=strtok(NULL,&quot; &quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    //cout &lt;&lt; &quot;After strtok,sentence=&quot; &lt;&lt; tokenPtr&lt;&lt;endl;</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>函数第一次调用需设置两个参数。第一次分割的结果，返回串中第一个 ‘,’ 之前的字符串,也就是上面的程序第一次输出abc。<br>第二次调用该函数strtok(NULL,”,”),第一个参数设置为NULL。结果返回分割依据后面的字串，即第二次输出d。<br>strtok是一个线程不安全的函数，因为它使用了静态分配的空间来存储被分割的字符串位置<br>线程安全的函数叫strtok_r,ca<br>运用strtok来判断ip或者mac的时候务必要先用其他的方法判断’.’或’:’的个数，因为用strtok截断的话，比</p><h2 id="2-strcmp"><a href="#2-strcmp" class="headerlink" title="2.strcmp"></a>2.strcmp</h2><p>C/C++函数，比较两个字符串<br>设这两个字符串为str1，str2，<br>若str1=str2，则返回零；<br>若str1&lt;str2，则返回负数；<br>若str1&gt;str2，则返回正数。<br>matlab中函数，strcmp(s1，s2) 判断两个字符串s1和s2是否相同，相同返回true ,不同返回false<br>源码：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">strcmp</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *str1,<span class="keyword">const</span> <span class="keyword">char</span> *str2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">/*不可用while(*str1++==*str2++)来比较，当不相等时仍会执行一次++，</span></span><br><span class="line"><span class="comment">    return返回的比较值实际上是下一个字符。应将++放到循环体中进行。*/</span></span><br><span class="line">    <span class="keyword">while</span>(*str1 == *str2)</span><br><span class="line">    &#123;</span><br><span class="line">                assert((str1 != <span class="literal">NULL</span>) &amp;&amp; (str2 != <span class="literal">NULL</span>));</span><br><span class="line">                 </span><br><span class="line">        <span class="keyword">if</span>(*str1 == <span class="string">'\0'</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">         </span><br><span class="line">        str1++;</span><br><span class="line">        str2++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> *str1 - *str2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="3-Erase"><a href="#3-Erase" class="headerlink" title="3. Erase"></a>3. Erase</h2><ul><li>c.erase(k)<br>从c中删除元素k，返回一个size_type值，指出删除的元素的数量</li><li>c.erase(p)<br>从c中删除迭代器p指定的元素，p必须指向c中的一个真实元素，不能等于c.end()</li><li>c.erase(b,e)<br>从c中删除迭代器对b和e所表示的范围中的元素，返回e<h2 id="4-List"><a href="#4-List" class="headerlink" title="4. List"></a>4. List</h2>List 反向迭代器<br>begin和end成员<br>begin和end操作产生指向容器内第一个元素和最后一个元素的下一个位置的迭代器，如下所示。这两个迭代器通常用于标记包含容器中所有元素的迭代范围。<br>c.begin() 返回一个迭代器，它指向容器c的第一个元素<br>c.end() 返回一个迭代器，它指向容器c的最后一个元素的下一个位置<br>c.rbegin() 返回一个逆序迭代器，它指向容器c的最后一个元素<br>c.rend() 返回一个逆序迭代器，它指向容器c的第一个元素前面的位置<br>上述每个操作都有两个不同的版本：一个是const成员，另一个是非const成员。这些操作返回什么类型取决于容器是否为const。如果容器不是const，则这些操作返回iterator或reverse_iterator类型。如果容器是const，则其返回类型要加上const_前缀，也就是const_iterator和const_reverse_iterator类型。  <h2 id="5-strcpy"><a href="#5-strcpy" class="headerlink" title="5. strcpy"></a>5. strcpy</h2>描述<br>C 库函数 char <em>strcpy(char </em>dest, const char *src) 把 src 所指向的字符串复制到 dest。</li></ul><p>声明<br>下面是 strcpy() 函数的声明。<br><code>char *strcpy(char *dest, const char *src)</code><br>参数<br>dest – 指向用于存储复制内容的目标数组。<br>src – 要复制的字符串。<br>返回值<br>该函数返回一个指向最终的目标字符串 dest 的指针。<br>实例<br>下面的实例演示了 strcpy() 函数的用法。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;string.h&gt;</span><br><span class="line"></span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">   char src[40];</span><br><span class="line">   char dest[100];</span><br><span class="line">  </span><br><span class="line">   memset(dest, &apos;\0&apos;, sizeof(dest));</span><br><span class="line">   strcpy(src, &quot;This is runoob.com&quot;);</span><br><span class="line">   strcpy(dest, src);</span><br><span class="line"></span><br><span class="line">   printf(&quot;最终的目标字符串： %s\n&quot;, dest);</span><br><span class="line">   </span><br><span class="line">   return(0);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h2 id="6-转换函数"><a href="#6-转换函数" class="headerlink" title="6.转换函数"></a>6.转换函数</h2><h3 id="6-1-Atoi"><a href="#6-1-Atoi" class="headerlink" title="6.1 Atoi"></a>6.1 Atoi</h3><p>字符串转整型</p><h3 id="6-2-Atof"><a href="#6-2-Atof" class="headerlink" title="6.2 Atof"></a>6.2 Atof</h3><p>字符串转浮点型</p><h2 id="7-malloc动态内存分配"><a href="#7-malloc动态内存分配" class="headerlink" title="7. malloc动态内存分配"></a>7. malloc动态内存分配</h2><p>用于申请一块连续的指定大小的内存块区域以void<em>类型返回分配的内存区域地址，当无法知道内存具体位置的时候，想要绑定真正的内存空间，就需要用到动态的分配内存。<br>void \</em>malloc(size_t size);<br>如果分配成功则返回指向被分配内存的指针(此存储区中的初始值不确定)，否则返回空指针NULL。当内存不再使用时，应使用free()函数将内存块释放。函数返回的指针一定要适当对齐，使其可以用于任何数据对象。<br>例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">int *p;</span><br><span class="line">p = (int*)malloc(sizeof(int) * 128);</span><br><span class="line">//分配128个（可根据实际需要替换该数值）整型存储单元，</span><br><span class="line">//并将这128个连续的整型存储单元的首地址存储到指针变量p中</span><br><span class="line">double *pd = (double*)malloc(sizeof(double) * 12);</span><br><span class="line">//分配12个double型存储单元，</span><br><span class="line">//并将首地址存储到指针变量pd中</span><br></pre></td></tr></table></figure></p><h2 id="math库中的函数"><a href="#math库中的函数" class="headerlink" title="math库中的函数"></a>math库中的函数</h2><h3 id="hypot"><a href="#hypot" class="headerlink" title="hypot"></a>hypot</h3><p> 计算直角三角形的斜边长</p><h1 id="关键字"><a href="#关键字" class="headerlink" title="关键字"></a>关键字</h1><h2 id="extern"><a href="#extern" class="headerlink" title="extern"></a>extern</h2><p>extern是计算机语言中的一个关键字，可置于变量或者函数前，以表示变量或者函数的定义在别的文件中。提示编译器遇到此变量或函数时，在其它模块中寻找其定义，另外，extern也可用来进行链接指定。  </p><h3 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h3><p>在一个源文件里定义了一个数组：char a[6];<br>在另外一个文件里用下列语句进行了声明：extern char *a；<br>    请问，这样可以吗？<br>    答案与分析：<br>    1)、不可以，程序运行时会告诉你非法访问。原因在于，指向类型T的指针并不等价于类型T的数组。extern char *a声明的是一个指针变量而不是字符数组，因此与实际的定义不同，从而造成运行时非法访问。应该将声明改为extern char a[ ]。<br>    2)、例子分析如下，如果a[] = “abcd”,则外部变量a=0x12345678 (数组的起始地址)，而*a是重新定义了一个指针变量，a指向的地址可能是0x87654321,直接使用*a是错误的.<br>    3)、这提示我们，在使用extern时候要严格对应声明时的格式，在实际编程中，这样的错误屡见不鲜。<br>    4)、extern用在变量声明中常常有这样一个作用：你要在*.c文件中引用另一个文件中的一个全局的变量，那就应该放在*.h中用extern来声明这个全局变量。<br>    extern用于变量的用法：<br>    extern int a;//声明一个全局变量a<br>    int a; //定义一个全局变量a<br>    extern int a =0 ;//定义一个全局变量a 并给初值。一旦给予赋值，一定是定义，定义才会分配存储空间。（注意：经过测试在GCC中，这样定义变量是不能通过编译的，而在VS2013可以）<br>    int a =0;//定义一个全局变量a,并给初值，<br>    声明之后你不能直接使用这个变量，需要定义之后才能使用。<br>    第四个等于第三个，都是定义一个可以被外部使用的全局变量，并给初值。<br>    糊涂了吧，他们看上去可真像。但是定义只能出现在一处。也就是说，不管是int a;还是int a=0;都只能出现一次，而那个extern int a可以出现很多次。<br>    当你要引用一个全局变量的时候，你就要声明extern int a;这时候extern不能省略，因为省略了，就变成int a;这是一个定义，不是声明。  </p><h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><p>实际上函数的声明和定义都不需要添加extern关键字，在实际使用的时候也最好不要添加关键字。<br>如果一个函数是不会被其它文件调用的，那么这个函数应该被声明成static的。<br>如：<code>extern int func(void){return 0;}</code>跟<code>int func(void){return 0;}</code>    是等价的<br>另外  <code>extern int func(void);</code> 跟<code>int func(void);</code>是等价的。  </p><h3 id="编译链接"><a href="#编译链接" class="headerlink" title="编译链接"></a>编译链接</h3><h4 id="声明外部变量"><a href="#声明外部变量" class="headerlink" title="声明外部变量"></a>声明外部变量</h4><p>现代编译器一般采用按文件编译的方式，因此在编译时，各个文件中定义的全局变量是互相不透明的。也就是说，在编译时，全局变量的可见域限制在文件内部。  </p><p>下面举一个简单的例子：</p><p>创建一个工程，里面含有A.cpp和B.cpp两个简单的C++源文件：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//A.cpp</span><br><span class="line">int i;</span><br><span class="line">int main()&#123;</span><br><span class="line">&#125;</span><br><span class="line">//B.cpp</span><br><span class="line">int i;</span><br></pre></td></tr></table></figure></p><p>这两个文件极为简单，在A.cpp中我们定义了一个全局变量i，在B中我们也定义了一个全局变量i。 </p><p>我们对A和B分别编译，都可以正常通过编译，但是进行链接的时候，却出现了错误，错误提示如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Linking...</span><br><span class="line">B.obj:error LNK2005:&quot;inti&quot;(?i@@3HA)already defined in A.obj</span><br><span class="line">Debug/A.exe:fatal error LNK1169:one or more multiply defined symbols found</span><br><span class="line">Error executing link.exe.</span><br><span class="line">A.exe-2 error(s),0 warning(s)</span><br></pre></td></tr></table></figure></p><p>这就是说，在编译阶段，各个文件中定义的全局变量相互是不透明的，编译A时觉察不到B中也定义了i，同样，编译B时觉察不到A中也定义了i。  </p><p>但是到了链接阶段，要将各个文件的内容“合为一体”，因此，如果某些文件中定义的全局变量名相同的话，在这个时候就会出现错误，也就是上面提示的重复定义的错误。 </p><p>因此，各个文件中定义的全局变量名不可相同。 </p><p>在链接阶段，各个文件的内容（实际是编译产生的obj文件）是被合并到一起的，因而，定义于某文件内的全局变量，在链接完成后，它的可见范围被扩大到了整个程序。  </p><p>这样一来，按道理说，一个文件中定义的全局变量，可以在整个程序的任何地方被使用，举例说，如果A文件中定义了某全局变量，那么B文件中应可以使用该变量。修改我们的程序，加以验证：  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//A.cpp</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    i = 100;//试图使用B中定义的全局变量</span><br><span class="line">&#125;</span><br><span class="line">//B.cpp</span><br><span class="line">int i;</span><br></pre></td></tr></table></figure><p>编译结果如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Compiling...</span><br><span class="line">A.cpp</span><br><span class="line">C:\Documents and Settings\桌面\try extern\A.cpp(5):error C2065:&apos;i&apos;:undeclared identifier</span><br><span class="line">Error executing cl.exe.</span><br><span class="line">A.obj-1 error(s),0 warning(s)</span><br></pre></td></tr></table></figure></p><p>编译错误。 </p><p>其实出现这个错误是意料之中的，因为文件中定义的全局变量的可见性扩展到整个程序是在链接完成之后，而在编译阶段，他们的可见性仍局限于各自的文件。  </p><p>编译器的目光不够长远，编译器没有能够意识到，某个变量符号虽然不是本文件定义的，但是它可能是在其它的文件中定义的。  </p><p>虽然编译器不够有远见，但是我们可以给它提示，帮助它来解决上面出现的问题。这就是extern的作用了。</p><p>extern的原理很简单，就是告诉编译器：“你现在编译的文件中，有一个标识符虽然没有在本文件中定义，但是它是在别的文件中定义的全局变量，你要放行！” </p><p>我们为上面的错误程序加上extern关键字：<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//A.cpp</span><br><span class="line">extern int i;</span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">    i=100;//试图使用B中定义的全局变量</span><br><span class="line">&#125;</span><br><span class="line">//B.cpp</span><br><span class="line">int i;</span><br></pre></td></tr></table></figure></p><p>顺利通过编译，链接。</p><h3 id="C-中extern-c的深层探索"><a href="#C-中extern-c的深层探索" class="headerlink" title="C++中extern c的深层探索"></a>C++中extern c的深层探索</h3><ol><li>简介<br>C++语言的创建初衷是“a better C”，但是这并不意味着C++中类似C语言的全局变量和函数所采用的编译和连接方式与C语言完全相同。作为一种欲与C兼容的语言，C++保留了一部分过程式语言的特点（被世人称为“不彻底地面向对象”），因而它可以定义不属于任何类的全局变量和函数。但是，C++毕竟是一种面向对象的程序设计语言，为了支持函数的重载，C++对全局函数的处理方式与C有明显的不同。 </li><li><p>从标准头文件说起<br>某企业曾经给出如下的一道面试题：<br>为什么标准头文件都有类似以下的结构？</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">#ifndef __INCvxWorksh</span><br><span class="line">#define __INCvxWorksh</span><br><span class="line">#ifdef __cplusplus</span><br><span class="line">extern &quot;C&quot; &#123;</span><br><span class="line">#endif</span><br><span class="line">/*...*/</span><br><span class="line">#ifdef __cplusplus</span><br><span class="line">&#125;</span><br><span class="line">#endif</span><br><span class="line">#endif /* __INCvxWorksh */</span><br></pre></td></tr></table></figure><p> 分析<br> 显然，头文件中的编译宏“#ifndef <strong>INCvxWorksh、#define </strong>INCvxWorksh、#endif” 的作用是防止该头文件被重复引用。<br> 那么    </p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#ifdef __cplusplus</span><br><span class="line">extern &quot;C&quot; &#123;</span><br><span class="line">#endif</span><br><span class="line">#ifdef __cplusplus</span><br><span class="line">&#125;</span><br><span class="line">#endif</span><br></pre></td></tr></table></figure><p> 的作用又是什么呢？我们将在下文一一道</p></li><li><p>深层揭密extern “C”<br> extern “C” 包含双重含义，从字面上即可得到：首先，被它修饰的目标是“extern”的；其次，被它修饰的目标是“C”的。让我们来详细解读这两重含义。  </p><p> 被extern “C”限定的函数或变量是extern类型的；</p><p> extern是C/C++语言中表明函数和全局变量作用范围（可见性）的关键字，该关键字告诉编译器，其声明的函数和变量可以在本模块或其它模块中使用，记住，下列语句：<br> extern int a;<br> 仅仅是一个变量的声明，其并不是在定义变量a，并未为a分配内存空间。变量a在所有模块中作为一种全局变量只能被定义一次，否则会出现连接错误。</p><p> 引用一个定义在其它模块的全局变量或函数（如，全局函数或变量定义在A模块，B欲引用）有两种方法，<br> 一、B模块中include模块A的头文件。<br> 二、模块B中对欲引用的模块A的变量或函数重新声明一遍，并前加extern关键字。  </p><p> 通常，在模块的头文件中对本模块提供给其它模块引用的函数和全局变量以关键字extern声明。<br> 例如，如果模块B欲引用该模块A中定义的全局变量和函数时只需包含模块A的头文件即可。这样，模块B中调用模块A中的函数时，在编译阶段，模块B虽然找不到该函数，但是并不会报错；它会在连接阶段中从模块A编译生成的目标代码中找到此函数。</p><p> 与extern对应的关键字是static，被它修饰的全局变量和函数只能在本模块中使用。因此，一个函数或变量只可能被本模块使用时，其不可能被extern “C”修饰。</p><p> 被extern “C”修饰的变量和函数是按照C语言方式编译和连接的；<br> 未加extern “C”声明时的编译方式 </p><p> 首先看看C++中对类似C的函数是怎样编译的。  </p><p> 作为一种面向对象的语言，C++支持函数重载，而过程式语言C则不支持。函数被C++编译后在符号库中的名字与C语言的不同。例如，假设某个函数的原型为：<br> <code>void foo( int x, int y );</code><br> 该函数被C编译器编译后在符号库中的名字为_foo，而C++编译器则会产生像_foo_int_int之类的名字（不同的编译器可能生成的名字不同，但是都采用了相同的机制，生成的新名字称为“mangled name”）。<br> _foo_int_int这样的名字包含了函数名、函数参数数量及类型信息，C++就是靠这种机制来实现函数重载的。例如，在C++中，函数<code>void foo( int x, int y )</code>与<code>void foo( int x, float y )</code>编译生成的符号是不相同的，后者为_foo_int_float。  </p><p> 同样地，C++中的变量除支持局部变量外，还支持类成员变量和全局变量。用户所编写程序的类成员变量可能与全局变量同名，我们以”.”来区分。而本质上，编译器在进行编译时，与函数的处理相似，也为类中的变量取了一个独一无二的名字，这个名字与用户程序中同名的全局变量名字不同。</p><p> 未加extern “C”声明时的连接方式</p><p> 假设在C++中，模块A的头文件如下：</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// 模块A头文件　moduleA.h</span><br><span class="line">#ifndef MODULE_A_H</span><br><span class="line">#define MODULE_A_H</span><br><span class="line">int foo( int x, int y );</span><br><span class="line">#endif</span><br><span class="line">在模块B中引用该函数：</span><br><span class="line">// 模块B实现文件　moduleB.cpp</span><br><span class="line">#include &quot;moduleA.h&quot;</span><br><span class="line">foo(2,3);</span><br></pre></td></tr></table></figure><p> 实际上，在连接阶段，连接器会从模块A生成的目标文件moduleA.obj中寻找_foo_int_int这样的符号！</p><p> 加extern “C”声明后的编译和连接方式<br> 加extern “C”声明后，模块A的头文件变为：</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 模块A头文件　moduleA.h</span><br><span class="line">#ifndef MODULE_A_H</span><br><span class="line">#define MODULE_A_H</span><br><span class="line">extern &quot;C&quot; int foo( int x, int y );</span><br><span class="line">#endif</span><br></pre></td></tr></table></figure><p> 在模块B的实现文件中仍然调用foo( 2,3 )，其结果是：<br> （1）模块A编译生成foo的目标代码时，没有对其名字进行特殊处理，采用了C语言的方式；<br> （2）连接器在为模块B的目标代码寻找foo(2,3)调用时，寻找的是未经修改的符号名_foo。<br> 如果在模块A中函数声明了foo为extern “C”类型，而模块B中包含的是extern int foo( int x, int y ) ，则模块B找不到模块A中的函数；反之亦然。<br> 所以，可以用一句话概括extern “C”这个声明的真实目的（任何语言中的任何语法特性的诞生都不是随意而为的，来源于真实世界的需求驱动。我们在思考问题时，不能只停留在这个语言是怎么做的，还要问一问它为什么要这么做，动机是什么，这样我们可以更深入地理解许多问题）：<br> 实现C++与C及其它语言的混合编程。<br> 明白了C++中extern “C”的设立动机，我们下面来具体分析extern “C”通常的使用技巧。<br> extern “C”的惯用法<br> （1）在C++中引用C语言中的函数和变量，在包含C语言头文件（假设为cExample.h）时，需进行下列处理：   </p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">extern &quot;C&quot;</span><br><span class="line">&#123;</span><br><span class="line">#include &quot;cExample.h&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> 而在C语言的头文件中，对其外部函数只能指定为extern类型，C语言中不支持extern “C”声明，在.c文件中包含了extern “C”时会出现编译语法错误。<br> 笔者编写的C++引用C函数例子工程中包含的三个文件的源代码如下：</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">/*c语言头文件：cExample.h */</span><br><span class="line">#ifndef C_EXAMPLE_H</span><br><span class="line">#define C_EXAMPLE_H</span><br><span class="line">extern int add(int x,int y);</span><br><span class="line">#endif</span><br><span class="line">/*c语言实现文件：cExample.c */</span><br><span class="line">#include &quot;cExample.h&quot;</span><br><span class="line">int add( int x, int y )</span><br><span class="line">&#123;</span><br><span class="line">return x + y;</span><br><span class="line">&#125;</span><br><span class="line">//c++实现文件，调用add：cppFile.cpp</span><br><span class="line">extern &quot;C&quot;</span><br><span class="line">&#123;</span><br><span class="line">#include &quot;cExample.h&quot;</span><br><span class="line">&#125;</span><br><span class="line">int main(int argc, char* argv[])</span><br><span class="line">&#123;</span><br><span class="line">add(2,3);</span><br><span class="line">return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> 如果C++调用一个C语言编写的.DLL时，当包括.DLL的头文件或声明接口函数时，应加extern “C” {　}。<br> （2）在C++引用C语言中的函数和变量时，C++的头文件需添加extern “C”，但是在C语言中不能直接引用声明了extern “C”的该头文件，应该仅将C文件中将C++中定义的extern “C”函数声明为extern类型。<br> 笔者编写的C引用C++函数例子工程中包含的三个文件的源代码如下：</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">//C++头文件 cppExample.h</span><br><span class="line">#ifndef CPP_EXAMPLE_H</span><br><span class="line">#define CPP_EXAMPLE_H</span><br><span class="line">extern &quot;C&quot; int add( int x, int y );</span><br><span class="line">#endif</span><br><span class="line">//C++实现文件 cppExample.cpp</span><br><span class="line">#include &quot;cppExample.h&quot;</span><br><span class="line">int add( int x, int y )</span><br><span class="line">&#123;</span><br><span class="line">return x + y;</span><br><span class="line">&#125;</span><br><span class="line">/* C实现文件 cFile.c</span><br><span class="line">/* 这样会编译出错：#include &quot;cppExample.h&quot; */</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">extern int add (int x,int y);</span><br><span class="line">int main (int argc,char*argv[])</span><br><span class="line">&#123;</span><br><span class="line">  add(2,3);</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p>参考：百度百科<a href="https://baike.baidu.com/item/extern/4443005?fr=aladdin" target="_blank" rel="noopener">https://baike.baidu.com/item/extern/4443005?fr=aladdin</a></p><h1 id="内存操作函数"><a href="#内存操作函数" class="headerlink" title="内存操作函数"></a>内存操作函数</h1><h2 id="menset"><a href="#menset" class="headerlink" title="menset"></a>menset</h2><p>   函数原型是：void <em>memset(void </em>s, int ch, size_t n);<br>   函数功能是：将s所指向的某一块内存中的前n个字节的内容全部设置为ch指定的ASCII值， 第一个值为指定的内存地址，块的大小由第三个参数指定，这个函数通常为新申请的内存做初始化工作， 其返回值为指向s的指针，它是对较大的结构体或数组进行清零操作的一种最快方法。  </p><p>   memset函数通常用来对一块已经分配地址的内存进行初始化，并且通常初始化为0或者字符’\0’（实际上是一样的）。下面是一些常见例子。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;介绍项目中用到的一些常用函数和关键字的使用&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="C++" scheme="http://11wy11.github.io/categories/C/"/>
    
    
      <category term="C++" scheme="http://11wy11.github.io/tags/C/"/>
    
  </entry>
  
  <entry>
    <title>krpano快速入门教程（三）之热点Hotspot</title>
    <link href="http://11wy11.github.io/2019/03/16/krpano-third-note/"/>
    <id>http://11wy11.github.io/2019/03/16/krpano-third-note/</id>
    <published>2019-03-16T14:54:57.000Z</published>
    <updated>2019-04-01T03:12:38.648Z</updated>
    
    <content type="html"><![CDATA[<p>使用编辑器热点，添加自定义热点，动态热点等<br><a id="more"></a></p><h2 id="添加热点及相关内容"><a href="#添加热点及相关内容" class="headerlink" title="添加热点及相关内容"></a>添加热点及相关内容</h2><p>使用编辑器热点，添加自定义热点，动态热点等<br><!--more--></p><h3 id="使用tour-editor添加热点及设定起始角度"><a href="#使用tour-editor添加热点及设定起始角度" class="headerlink" title="使用tour_editor添加热点及设定起始角度"></a>使用tour_editor添加热点及设定起始角度</h3><p>通过<strong>Load tour.xml</strong>导入要编辑的配置文件<br>点击<strong>set as startup view</strong>设置初始角度，可以旋转到合适的角度，点击按钮设置全景图默认展示角度。<br>点击<strong>Add hotspot</strong>按钮，画面中出现一个箭头，将其拖放置你想放置的地方，点击<strong>save</strong>按钮保存热点编辑。也可以通过编辑按钮设置热点链接场景。<br>点击<strong>Save tour.xml</strong>按钮保存文件。</p><h3 id="编辑-tour-xml添加热点"><a href="#编辑-tour-xml添加热点" class="headerlink" title="编辑 tour.xml添加热点"></a>编辑 tour.xml添加热点</h3><p>在实际生产中，通常直接编辑xml文件，在相应的场景中添加热点<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">&lt;hotspot name=&quot;...&quot;              定义热点名称    </span><br><span class="line">         type=&quot;image&quot;            定义热点类型，只能是image    </span><br><span class="line">         url=&quot;...&quot;               热点图像路径，支持SWF, JPG, PNG, GIF    </span><br><span class="line">         alturl=&quot;...&quot;            html5状态下显示的图像路径    </span><br><span class="line">         keep=&quot;false&quot;            是否在下一场景跳转后保持显示    </span><br><span class="line">         devices=&quot;all&quot;           支持设备类型    </span><br><span class="line">         visible=&quot;true&quot;          是否可见    </span><br><span class="line">         enabled=&quot;true&quot;          设置热点是否接收鼠标事件    </span><br><span class="line">         handcursor=&quot;true&quot;       设置是否鼠标移到上面显示小手    </span><br><span class="line">         maskchildren=&quot;false&quot;    设置是否将子控件变成蒙板    </span><br><span class="line">         zorder=&quot;&quot;               插入元素的次序索引，可以是字符也可以是数字，html5输出必须是0-100整数    </span><br><span class="line">         zorder2=&quot;0.0&quot;           设置为0.0和1.0，分别对应当前热点在扭曲控件之下和之上    </span><br><span class="line">         capture=&quot;true&quot;          与enabled配合使用，都为true只对热点传递动作，capture=&quot;false&quot;可对子控件传递动作 </span><br><span class="line">         children=&quot;true&quot;         设置子控件是否接收热点鼠标事件    </span><br><span class="line">         blendmode=&quot;normal&quot;      设置混合模式，可选：normal, layer, screen, add, subtract, difference, multiply, overlay, lighten, darken, hardlight, invert.    </span><br><span class="line">    </span><br><span class="line">         style=&quot;&quot;                读入已设置好的style名称    </span><br><span class="line">         ath=&quot;0.0&quot; atv=&quot;0.0&quot;     设定将场景缩略图为球形热点    </span><br><span class="line">         edge=&quot;center&quot;           热点的边界对齐点    </span><br><span class="line">         ox=&quot;0&quot;                  边界到对齐点的偏移量    </span><br><span class="line">         oy=&quot;0&quot;                      </span><br><span class="line">         zoom=&quot;false&quot;            设置是否场景缩放时，热点跟随缩放    </span><br><span class="line">         distorted=&quot;false&quot; rx=&quot;0.0&quot; ry=&quot;0.0&quot; rz=&quot;0.0&quot;    设置热点是否跟随场景进行3D扭曲    </span><br><span class="line">         details=&quot;8&quot;              热点显示的细节数量，默认为8    </span><br><span class="line">         inverserotation=&quot;false&quot;  设置是否逆向旋转3D扭曲    </span><br><span class="line">         flying=&quot;0.0&quot;             设置ath/atv/scale的插值     </span><br><span class="line">         width=&quot;&quot; height=&quot;&quot;       设置热点宽高    </span><br><span class="line">         scale=&quot;1.0&quot;              设置热点缩放    </span><br><span class="line">         rotate=&quot;0.0&quot;             设置热点旋转角度    </span><br><span class="line">         pixelhittest=&quot;false&quot;     是否启动精确像素测试    </span><br><span class="line">         smoothing=&quot;true&quot;         设置缩放时，是否平滑化处理    </span><br><span class="line">         accuracy=&quot;0&quot;             设置像素渲染值（flash下）    </span><br><span class="line">         accuracy2=&quot;1&quot;            设置精度控制（html5下）    </span><br><span class="line">         alpha=&quot;1.0&quot;              设置透明度    </span><br><span class="line">         autoalpha=&quot;false&quot;        设置是否自动变更透明度    </span><br><span class="line">         usecontentsize=&quot;false&quot;   是否使用用户指定flash大小，默认false原始大小    </span><br><span class="line">         scale9grid=&quot;&quot;            定义是否支持矢量缩放，scale9grid=&quot;x-position|y-position|width|height|prescale*&quot;    </span><br><span class="line">         crop=&quot;&quot;                  定义元素坐标及宽高  crop=&quot;x-position|y-position|width|height&quot;    </span><br><span class="line">         onovercrop=&quot;&quot;          设置元素鼠标移到上方后的坐标及宽高    </span><br><span class="line">         ondowncrop=&quot;&quot;          设置元素鼠标按下状态后的坐标及宽高    </span><br><span class="line">         scalechildren=&quot;false&quot;   子元素是否跟随缩放    </span><br><span class="line">         mask=&quot;&quot;                 mask=&quot;name&quot;  mask=&quot;layer[name]&quot;  mask=&quot;hotspot[name]&quot;    </span><br><span class="line">         effect=&quot;&quot;                热点位图效果3种：glow(color,alpha,range,strength);    </span><br><span class="line">                                  dropshadow(depth,angle,color,range,strength);    </span><br><span class="line">                                  blur(radius);        </span><br><span class="line">         onover=&quot;&quot;               鼠标在经过上方时执行动作    </span><br><span class="line">         onhover=&quot;&quot;              鼠标停在上方时执行动作    </span><br><span class="line">         onout=&quot;&quot;                鼠标停移出范围时时执行动作    </span><br><span class="line">         onclick=&quot;&quot;              鼠标停点击时执行动作    </span><br><span class="line">         ondown=&quot;&quot;               鼠标按下时执行动作    </span><br><span class="line">         onup=&quot;&quot;                 鼠标按键松开时执行动作    </span><br><span class="line">         onloaded=&quot;&quot;             加载元素完成后执行动作    </span><br><span class="line">         /&gt;    </span><br><span class="line">           </span><br><span class="line">多边形热点    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">&lt;hotspot name=&quot;...&quot;    </span><br><span class="line">         keep=&quot;false&quot;    </span><br><span class="line">         visible=&quot;true&quot;    </span><br><span class="line">         enabled=&quot;true&quot;    </span><br><span class="line">         handcursor=&quot;true&quot;    </span><br><span class="line">         zorder=&quot;&quot;    </span><br><span class="line">         capture=&quot;true&quot;    </span><br><span class="line">         blendmode=&quot;normal&quot;    </span><br><span class="line">         style=&quot;&quot;    </span><br><span class="line">         alpha=&quot;1.0&quot;    </span><br><span class="line">         autoalpha=&quot;false&quot;    </span><br><span class="line">         fillcolor=&quot;0xFFFFFF&quot; fillcolorhover=&quot;0xFFFFFF&quot;   填充颜色及鼠标移上后颜色    </span><br><span class="line">         fillalpha=&quot;0.0&quot; fillalphahover=&quot;0.1&quot;             填充颜色透明度及鼠标移上后颜色透明度    </span><br><span class="line">         borderwidth=&quot;0.0&quot; borderwidthhover=&quot;4.0&quot;         边界宽度及鼠标移上后边界宽度    </span><br><span class="line">         bordercolor=&quot;0xFFFFFF&quot; bordercolorhover=&quot;0xFFFFFF&quot;  边界颜色及边界鼠标移上后颜色    </span><br><span class="line">         borderalpha=&quot;0.0&quot; borderalphahover=&quot;0.8&quot;           边界透明度及鼠标移上后边界透明度    </span><br><span class="line">         fadeintime=&quot;0.15&quot; fadeincurve=&quot;1.1&quot;               悬停状态变化时间及形式    </span><br><span class="line">         fadeouttime=&quot;0.3&quot; fadeoutcurve=&quot;0.7&quot;    </span><br><span class="line">         onover=&quot;&quot;    </span><br><span class="line">         onhover=&quot;&quot;    </span><br><span class="line">         onout=&quot;&quot;    </span><br><span class="line">         onclick=&quot;&quot;    </span><br><span class="line">         ondown=&quot;&quot;    </span><br><span class="line">         onup=&quot;&quot;    </span><br><span class="line">&gt;    </span><br><span class="line">    &lt;point ath=&quot;...&quot; atv=&quot;...&quot; /&gt;            多边形热点坐标    </span><br><span class="line">    &lt;point ath=&quot;...&quot; atv=&quot;...&quot; /&gt;    </span><br><span class="line">    &lt;point ath=&quot;...&quot; atv=&quot;...&quot; /&gt;    </span><br><span class="line">    ...    </span><br><span class="line">&lt;/hotspot&gt;</span><br></pre></td></tr></table></figure></p><h3 id="历史文章"><a href="#历史文章" class="headerlink" title="历史文章"></a>历史文章</h3><p><a href="/2019/03/14/krpano-first-note">krpano快速入门教程（一) 使用krpano工具构建即用型panos</a><br><a href="/2019/03/15/krpano-second-note">krpano快速入门教程（二) vtour全景漫游及vtour文件夹介绍</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;使用编辑器热点，添加自定义热点，动态热点等&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="全景" scheme="http://11wy11.github.io/categories/%E5%85%A8%E6%99%AF/"/>
    
    
      <category term="krpano" scheme="http://11wy11.github.io/tags/krpano/"/>
    
  </entry>
  
  <entry>
    <title>C++之QT的信号和槽的详解</title>
    <link href="http://11wy11.github.io/2019/03/16/qt-note/"/>
    <id>http://11wy11.github.io/2019/03/16/qt-note/</id>
    <published>2019-03-16T12:24:56.000Z</published>
    <updated>2019-03-24T01:34:40.382Z</updated>
    
    <content type="html"><![CDATA[<p>QT的信号和槽的详解，包括简介，信号和槽分析以及一个实例<br><a id="more"></a></p><h1 id="1-简介"><a href="#1-简介" class="headerlink" title="1 简介"></a>1 简介</h1><p> 信号和槽是Qt特有的信息传输机制，是Qt设计程序的重要基础，它可以让互不干扰的对象建立一种联系。<br><!--more--><br>  在GUI编程中，当我们改变一个部件时，经常想要其他部件被通知。更一般化，我们希望任何一类的对象可以和其它对象进行通讯。例如，如果我们点击一个关闭按钮，我们可能想要窗口的close()函数被调用。</p><p>  其他工具包通过回调实现了这种通信。回调是一个函数指针，所以如果你希望一个处理函数通知你一些事件，你可以把另一个函数（回调）的指针传递给处理函数。处理函数在适当的时候调用回调。尽管一些成功的框架使用了这个方法，但是回调可能是不直观的，并可能在确保回调参数类型正确性上存在问题。<br>信号槽是 Qt 框架引以为豪的机制之一。所谓信号槽，实际就是观察者模式。当某个事件发生之后，比如，按钮检测到自己被点击了一下，它就会发出一个信号（signal）。这种发出是没有目的的，类似广播。如果有对象对这个信号感兴趣，它就会使用连接（connect）函数，意思是，将想要处理的信号和自己的一个函数（称为槽（slot））绑定来处理这个信号。也就是说，当信号发出时，被连接的槽函数会自动被回调。这就类似观察者模式：当发生了感兴趣的事件，某一个操作就会被自动触发。（这里提一句，Qt 的信号槽使用了额外的处理来实现，并不是 GoF 经典的观察者模式的实现方式。）</p><p>  信号和槽是Qt特有的信息传输机制，是Qt设计程序的重要基础，它可以让互不干扰的对象建立一种联系。</p><p>  槽的本质是类的成员函数，其参数可以是任意类型的。和普通C++成员函数几乎没有区别，它可以是虚函数；也可以被重载；可以是公有的、保护的、私有的、也可以被其他C++成员函数调用。唯一区别的是：槽可以与信号连接在一起，每当和槽连接的信号被发射的时候，就会调用这个槽。<br>  Qt的小部件有很多预定义的信号，但是我们总是可以通过继承来加入我们自己的信号。槽就是一个对应于特定信号的被调用的函数。Qt的部件有很多预定义的槽，但同样可以通过子类化加入自己的槽来处理感兴趣的信号。</p><h2 id="1-1-对象树-子对象动态分配空间不需要释放"><a href="#1-1-对象树-子对象动态分配空间不需要释放" class="headerlink" title="1.1 对象树(子对象动态分配空间不需要释放)"></a>1.1 对象树(子对象动态分配空间不需要释放)</h2><p>  <img src="/2019/03/16/qt-note/pic1.png" alt="对象树"><br>   比如说当应用程序创建了一个具有父窗口部件的对象时，该对象将被加入父窗口部件的孩子列表。当应用程序销毁父窗口部件时，其下的孩子列表中的对象将被一一删除。这让我们在编程时，能够将主要精力放在系统的业务上，提高编程效率，同时也保证了系统的稳健性。</p><h1 id="2-信号和槽"><a href="#2-信号和槽" class="headerlink" title="2 信号和槽"></a>2 信号和槽</h1><p>  在Qt中我们有一种可以替代回调的技术：我们使用信号和槽。当一个特定事件发生的时候，一个信号被发射。Qt的小部件有很多预定义的信号，但是我们总是可以通过继承来加入我们自己的信号。槽就是一个对应于特定信号的被调用的函数。Qt的部件有很多预定义的槽，但同样可以通过子类化加入自己的槽来处理感兴趣的信号。<br>  信号和槽机制是类型安全的：一个信号的签名(参数类型)必须与它的接收槽的签名相匹配。（实际上，一个槽的签名可能比它接收到的信号短，因为它可以忽略额外的参数。）因为签名是兼容的，当使用基于函数指针的语法时，编译器就可以帮助我们检测类型不匹配。基于字符串的信号和槽语法将在运行时检测类型不匹配。信号和插槽是松散耦合的：一个发射信号的类不用知道也不用关心哪个槽要接收这个信号。Qt的信号和槽的机制可以保证如果你把一个信号和一个槽连接起来，槽会在正确的时间使用信号的参数被调用。信号和槽可以使用任何数量、任何类型的参数。它们是完全类型安全的：不会再有回调核心转储(core dump)。</p><p>  从QObject类或者它的子类（如QWidget类）继承的所有类可以包含信号和槽。当改变它们的状态的时候，信号被发送。从某种意义上说，即它们对其他对象感兴趣。这就是所有的对象通讯时所做的一切。它不知道也不关心是否有其他对象接收到了它发射的信号。这就是真正的信息封装，并且确保对象可以用作一个软件组件使用。</p><p>  槽可以用来接收信号，但它们也是普通的成员函数。正如一个对象不知道有其他对象收到它的信号一样，一个槽也不知道它是否被任意信号连接。因此，这种方式保证了Qt创建组件的完全独立。</p><p>  你可以连接多个信号到一个槽，同样一个信号可以被你需要的多个槽连接。甚至可以一个信号连接到另一个信号。（该情况下，只要第一个信 号被发射时，第二个信号立即被发射。）</p><p>  总体来看，信号和槽构成了一个强有力的组件编程机制。</p><h2 id="2-1-信号"><a href="#2-1-信号" class="headerlink" title="2.1 信号"></a>2.1 信号</h2><p>  当一个对象内部状态发生改变时发射信号，信号就被发射，在某些方面对象的客户端和所有者可能感兴趣。信号是一个public访问函数并可以在任何地方发射，但是我们建议仅在定义了信号的类及他们的子类中发射。</p><p>  当一个信号被发射，它所连接的槽会被立即执行，类似于一个普通函数的调用。在该情况下，信号/槽机制在任何GUI事件循环中是完全独立的。一旦所有的槽返回了，emit语句随后的代码将会执行。这与queued connections方式有些许不同，queued connections方式下emit关键字随后的代码会立即继续执行，槽在随后执行（相当于异步，参考信号与槽的连接类型）。</p><p>  如果几个槽被连接到一个信号，当信号被发射时，这些槽就会按它们连接的顺序挨个执行。</p><p>  信号会由moc自动生成并一定不要在.cpp文件中实现。它们也不能有任何返回类型（也就是 只能使用void）。</p><h2 id="2-2-槽"><a href="#2-2-槽" class="headerlink" title="2.2 槽"></a>2.2 槽</h2><p>  当与槽连接的信号被发射时，该槽被调用。槽是普通的C++函数可以正常调用；它们唯一的特点就是可以被信号连接。</p><p>  因为槽是普通成员函数，所以被直接调用时遵循一般的C++规则。然而，作为槽，它们能被任何组件调用，通过信号槽连接，无需考虑访问级别。这意味着从一个任意类的实例发出的一个信号可以在一个不相关的类的实例中调用一个私有槽。</p><p>  同样还可以定义虚拟槽，我们在实践中发现它非常有用。</p><p>  与回调相比，信号和插槽的速度稍慢，因为它们增加了灵活性，尽管在实际应用程序中的差异是微不足道的。</p><p>  信号和槽的机制是非常有效的，但是它不像“真正的”回调那样快。信号和槽稍微有些慢，这是因为它们所提供的灵活性造成，尽管在实际应用中这些性能可以被忽略。通常，发射一个和槽相连的信号，大约比直接调接收器非虚函数的调用慢十倍。这是定位连接对象所需的开销，为了安全地遍历所有连接（e.g检查随后的接收器在发射过程中没有被销毁），并以通用的方式安排任意参数。虽然10个非虚函数调用听起来可能很多，但开销比任意new或delete 操作少得多。当执行一个字符串时，vector或list操作在后面的场景中需要new或delete, 但信号和槽在完成函数调用的开销中只占很小的一部分。在一个槽中进行系统调用或者间接地调用超过10个函数，情况也是相同的;。信号/插槽机制的简单和灵活性对于时间的开销是值得，用户甚至不会注意到这点。</p><p>  注意，与基于qt的应用程序一起编译时，定义变量的其他库调用信号和槽可能会造成编译器警告和错误。要解决这个问题，#undef这些预处理器的冲突符号即可。</p><h2 id="2-3-一个Qt-Creator的例子"><a href="#2-3-一个Qt-Creator的例子" class="headerlink" title="2.3 一个Qt Creator的例子"></a>2.3 一个Qt Creator的例子</h2>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;QApplication&gt;</span><br><span class="line">#include &lt;QPushButton&gt;</span><br><span class="line">   int main(int argc, char *argv[])</span><br><span class="line">   &#123;</span><br><span class="line">       QApplication app(argc, argv);</span><br><span class="line">       QPushButton button(&quot;Quit&quot;);</span><br><span class="line">       QObject::connect(&amp;button, &amp;QPushButton::clicked,</span><br><span class="line">       &amp;app, &amp;QApplication::quit);</span><br><span class="line">       button.show();</span><br><span class="line">       return app.exec();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>  在 Qt Creator 中创建工程的方法创建好工程，然后将main()函数修改为上面的代码。点击运行，我们会看到一个按钮，上面有“Quit”字样。点击按钮，程序退出。<br>  connect()函数最常用的一般形式：<br>  <strong>connect(sender, signal, receiver, slot);</strong><br>  参数：<br>   sender：发出信号的对象<br>   signal：发送对象发出的信号<br>   receiver：接收信号的对象<br>   slot：接收对象在接收到信号之后所需要调用的函数<br>  信号槽要求信号和槽的参数一致，所谓一致，是参数类型一致。如果不一致，允许的情况是，槽函数的参数可以比信号的少，即便如此，槽函数存在的那些参数的顺序也必须和信号的前面几个一致起来。这是因为，你可以在槽函数中选择忽略信号传来的数据（也就是槽函数的参数比信号的少），但是不能说信号根本没有这个数据，你就要在槽函数中使用（就是槽函数的参数比信号的多，这是不允许的）。</p><h2 id="2-4-一个普通C-程序的例子"><a href="#2-4-一个普通C-程序的例子" class="headerlink" title="2.4 一个普通C++程序的例子"></a>2.4 一个普通C++程序的例子</h2><p>  一个小的C++类声明如下：<br>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">class Counter</span><br><span class="line"> &#123;</span><br><span class="line">     public:</span><br><span class="line">         Counter() &#123; m_value = 0; &#125;</span><br><span class="line">   </span><br><span class="line">         int value() const &#123; return m_value; &#125;</span><br><span class="line">         void setValue(int value);</span><br><span class="line">     private:</span><br><span class="line">         int m_value;</span><br><span class="line"> &#125;;</span><br></pre></td></tr></table></figure></p><p>  一个小的基于QObject类如下：<br>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;QObject&gt;</span><br><span class="line"></span><br><span class="line">  class Counter : public QObject</span><br><span class="line">  &#123;</span><br><span class="line">      Q_OBJECT   </span><br><span class="line">      public:</span><br><span class="line">          Counter() &#123; m_value = 0; &#125;       </span><br><span class="line">          int value() const &#123; return m_value; &#125;       </span><br><span class="line">      public slots:</span><br><span class="line">          void setValue(int value);       </span><br><span class="line">      signals:</span><br><span class="line">          void valueChanged(int newValue);      </span><br><span class="line">      private:</span><br><span class="line">          int m_value;</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure></p><p>   这个基于QObject的类有同样的内部状态，并提供公有方法来访问状态。除此之外，这个类可以通过发射一个valueChanged()信号来告诉外部世界关于它的状态改变，并且它有一个槽，其它对象可以发送信号给这个槽。<br>   所有包含信号和/或者槽的类必须在它们的声明中提到Q_OBJECT。它们也必须从QObject继承(直接或间接)。<br>   槽由应用程序的编写者来实现。这里是Counter::setValue()可能的一个槽实现：<br>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">void Counter::setValue(int value)</span><br><span class="line">  &#123;</span><br><span class="line">      if (value != m_value) &#123;</span><br><span class="line">          m_value = value;</span><br><span class="line">          emit valueChanged(value);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p><p>   emit这一行从对象中发射valueChanged()信号，以一个新值作为参数。<br>   在下面的小片断中，我们创建了两个Counter对象，并使用QObject::connect()将第一个对象的valueChanget()信号连接到第二个对象的setValue槽。<br>   下面是把两个对象连接在一起的一种方法：<br>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Counter a, b;</span><br><span class="line">    QObject::connect(&amp;a, &amp;Counter::valueChanged,</span><br><span class="line">                     &amp;b, &amp;Counter::setValue);</span><br><span class="line">   </span><br><span class="line">    a.setValue(12);     // a.value() == 12, b.value() == 12</span><br><span class="line">    b.setValue(48);     // a.value() == 12, b.value() == 48</span><br></pre></td></tr></table></figure></p><p>  调用a.setValue(12)会使a发射一个valueChanged(12) 信号，b将会在它的setValue()槽中接收这个信号，也就是b.setValue(12) 被调用。接下来b会发射同样的valueChanged()信号，但是因为没有槽被连接到b的valueChanged()信号，所以该信号被忽略。</p><p>  注意只有当value!= m_value的时候setValue()函数才会设置这个值并发射信号。这样就避免了存在环connections的情况下无限循环。（比如b.valueChanged() 和a.setValue()连接在一起）。</p><p>  默认情况下，对于你做出的每一个连接，一个信号被发射;重复连接下两个信号被发射。你可以调用disconnect()中断所有连接。如果传递了Qt::UniqueConnection类型，连接只有在不重复的情况下才建立。如果已经存在重复连接（同一个对象上确定的信号到确定的槽），则连接将会失败，connect返回fase。</p><p>  这个例子说明了对象可以协同工作而不需要知道彼此的任何信息。为达到这种效果，对像仅需要相互连接，并用一个简单的QObject::connect()函数调用实现，或者使用uic的自动连接特性。</p><h2 id="2-5-带有默认参数的信号和槽"><a href="#2-5-带有默认参数的信号和槽" class="headerlink" title="2.5 带有默认参数的信号和槽"></a>2.5 带有默认参数的信号和槽</h2><p>   信号和槽的签名可能包含参数，参数可以有默认值。考虑QObject::destroyed()函数。<br>   <code>void destroyed(QObject* = 0);</code><br>   当一个QObject对象被删除，它发射QObject::destroyed()信号。我们想捕获此信号，无论在我们可能有一个悬空的引用指向删除的QObject对象的情况下，因此我们可以把它清理干净。一个合适的槽签名可能是这样的:<br>    <code>void objectDestroyed(QObject* obj = 0);</code><br>   为连接一个信号到此槽，我们使用QObject::connect。这里有几个方式连接。第一种方式是使用函数指针：<br>    <code>connect(sender,&amp;QObject::destroyed,this,&amp;MyObject::objectDestroyed);</code><br>   连接信号到槽的另一种方法是使用QObject::connect()，SIGNAL和SLOT宏。关于是否在SIGNAL()和SLOT()宏中包含参数的规则，如果参数有默认值，传递给SIGNAL()宏的签名必须不能少于传递给SLOT()宏签名的参数。<br>   下述这些都会生效：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">connect(sender,SIGNAL(destroyed(QObject*)),this,</span><br><span class="line">SLOT(objectDestroyed(Qbject*)));</span><br><span class="line"></span><br><span class="line">connect(sender,SIGNAL(destroyed(QObject*)),this,</span><br><span class="line">SLOT(objectDestroyed()));</span><br><span class="line"></span><br><span class="line">connect(sender, SIGNAL(destroyed()),this,</span><br><span class="line">SLOT(objectDestroyed()));</span><br></pre></td></tr></table></figure></p><h2 id="2-6-信号和槽的进一步使用"><a href="#2-6-信号和槽的进一步使用" class="headerlink" title="2.6 信号和槽的进一步使用"></a>2.6 信号和槽的进一步使用</h2><p>   对于可能需要信号发送者信息的情况, Qt提供了QObject::sender()函数，它返回一个指向发送信号的对象的指针。</p><p>   QSignalMapper类为一种情形提供，该情况下多个信号连接到同一个槽，而槽需要以不同的方式处理每个信号。</p><p>   假设有三个按钮来决定将打开哪个文件: “Tax File”, “Accounts File”, “Report File”.</p><p>   为了打开正确的文件,使用QSignalMapper:setMapping()来映射所有QPushButton:clicked()到QSignalMapper对象。然后将文件的QPushButton::clicked()信号连接到QSignalMapper::map()槽。<br>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">signalMapper = new QSignalMapper(this);</span><br><span class="line">       </span><br><span class="line">       signalMapper-&gt;setMapping(taxFileButton,   QString(&quot;taxfile.txt&quot;));</span><br><span class="line">       </span><br><span class="line">       signalMapper-&gt;setMapping(accountFileButton,</span><br><span class="line">                               QString(&quot;accountsfile.txt&quot;));</span><br><span class="line">       </span><br><span class="line">       signalMapper-&gt;setMapping(reportFileButton,</span><br><span class="line">                               QString(&quot;reportfile.txt&quot;));</span><br><span class="line">       </span><br><span class="line">       connect(taxFileButton, &amp;QPushButton::clicked,</span><br><span class="line">                 signalMapper, &amp;QSignalMapper::map);</span><br><span class="line">       </span><br><span class="line">       connect(accountFileButton, &amp;QPushButton::clicked,</span><br><span class="line">                 signalMapper, &amp;QSignalMapper::map);</span><br><span class="line">       </span><br><span class="line">       connect(reportFileButton, &amp;QPushButton::clicked,</span><br><span class="line">                 signalMapper, &amp;QSignalMapper::map);</span><br></pre></td></tr></table></figure></p><p>   然后，将mapped()信号连接到readFile()，根据按下的按钮，readFile()打开不同的文件。<code>connect(signalMapper, SIGNAL(mapped(QString)),this, SLOT(readFile(QString)));</code>  </p><h2 id="2-7-自定义信号槽"><a href="#2-7-自定义信号槽" class="headerlink" title="2.7 自定义信号槽"></a>2.7 自定义信号槽</h2><ul><li>发送者和接收者都需要是QObject的子类（当然，槽函数是全局函数、Lambda 表达式等无需接收者的时候除外）； </li><li>使用 signals 标记信号函数，信号是一个函数声明，返回 void，不需要实现函数代码；</li><li>槽函数是普通的成员函数，作为成员函数，会受到 public、private、protected 的影响；</li><li>使用 emit 在恰当的位置发送信号；</li><li>使用QObject::connect()函数连接信号和槽。</li><li>任何成员函数、static 函数、全局函数和 Lambda 表达式都可以作为槽函数 <h2 id="2-8-信号槽的更多用法"><a href="#2-8-信号槽的更多用法" class="headerlink" title="2.8 信号槽的更多用法"></a>2.8 信号槽的更多用法</h2></li><li>一个信号可以和多个槽相连<br>　　如果是这种情况，这些槽会一个接一个的被调用，但是它们的调用顺序是不确定的。</li><li>多个信号可以连接到一个槽<br>　　只要任意一个信号发出，这个槽就会被调用。</li><li>一个信号可以连接到另外的一个信号<br>　　当第一个信号发出时，第二个信号被发出。除此之外，这种信号-信号的形式和信号-槽的形式没有什么区别。</li><li>槽可以被取消链接<br>　　这种情况并不经常出现，因为当一个对象delete之后，Qt自动取消所有连接到这个对象上面的槽。</li><li>使用Lambda 表达式<br>　　在使用 Qt 5 的时候，能够支持 Qt 5 的编译器都是支持 Lambda 表达式的。<br>　　我们的代码可以写成下面这样：  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">QObject::connect(&amp;newspaper, static_cast&lt;void (Newspaper:: *)</span><br><span class="line">(const QString &amp;)&gt;(&amp;Newspaper::newPaper),</span><br><span class="line">[=](const QString &amp;name) </span><br><span class="line">&#123; /* Your code here. */ &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></figure></li></ul><p>在连接信号和槽的时候，槽函数可以使用Lambda表达式的方式进行处理。</p><h1 id="3-案例"><a href="#3-案例" class="headerlink" title="3 案例"></a>3 案例</h1><p>mainwidget.h<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">#ifndef MAINWIDGET_H</span><br><span class="line">#define MAINWIDGET_H</span><br><span class="line"></span><br><span class="line">#include &lt;QWidget&gt;</span><br><span class="line">#include &lt;QPushButton&gt;</span><br><span class="line">#include &quot;subwidget.h&quot; //子窗口头文件</span><br><span class="line"></span><br><span class="line">class MainWidget : public QWidget</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line"></span><br><span class="line">public:</span><br><span class="line">    MainWidget(QWidget *parent = 0);</span><br><span class="line">    ~MainWidget();</span><br><span class="line"></span><br><span class="line">public slots:</span><br><span class="line">    void mySlot();</span><br><span class="line">    void changeWin();</span><br><span class="line">    void dealSub();</span><br><span class="line">    void dealSlot(int, QString);</span><br><span class="line"></span><br><span class="line">private:</span><br><span class="line">    QPushButton b1;</span><br><span class="line">    QPushButton *b2;</span><br><span class="line">    QPushButton b3;</span><br><span class="line"></span><br><span class="line">    SubWidget subWin;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">#endif // MAINWIDGET_H</span><br></pre></td></tr></table></figure></p><p>subwidget.h<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">#ifndef SUBWIDGET_H</span><br><span class="line">#define SUBWIDGET_H</span><br><span class="line"></span><br><span class="line">#include &lt;QWidget&gt;</span><br><span class="line">#include &lt;QPushButton&gt;</span><br><span class="line"></span><br><span class="line">class SubWidget : public QWidget</span><br><span class="line">&#123;</span><br><span class="line">    Q_OBJECT</span><br><span class="line">public:</span><br><span class="line">    explicit SubWidget(QWidget *parent = 0);</span><br><span class="line"></span><br><span class="line">    void sendSlot();</span><br><span class="line"></span><br><span class="line">signals:</span><br><span class="line">     /* 信号必须有signals关键字来声明</span><br><span class="line">      * 信号没有返回值，但可以有参数</span><br><span class="line">      * 信号就是函数的声明，只需声明，无需定义</span><br><span class="line">      * 使用：emit mySignal();</span><br><span class="line">      * 信号可以重载</span><br><span class="line">     */</span><br><span class="line"></span><br><span class="line">    void mySignal();</span><br><span class="line">    void mySignal(int, QString);</span><br><span class="line"></span><br><span class="line">public slots:</span><br><span class="line"></span><br><span class="line">private:</span><br><span class="line">    QPushButton b;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">#endif // SUBWIDGET_H</span><br></pre></td></tr></table></figure></p><p>main.cpp<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;mainwidget.h&quot;</span><br><span class="line">#include &lt;QApplication&gt;</span><br><span class="line"></span><br><span class="line">int main(int argc, char *argv[])</span><br><span class="line">&#123;</span><br><span class="line">    QApplication a(argc, argv);</span><br><span class="line">    MainWidget w;//执行MainWidget的构造函数</span><br><span class="line">    w.show();</span><br><span class="line"></span><br><span class="line">    return a.exec();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>mainvidget.cpp<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;mainwidget.h&quot;</span><br><span class="line">#include &lt;QPushButton&gt;</span><br><span class="line">#include &lt;QDebug&gt; //打印</span><br><span class="line"></span><br><span class="line">MainWidget::MainWidget(QWidget *parent)</span><br><span class="line">    : QWidget(parent)</span><br><span class="line">&#123;</span><br><span class="line">    b1.setParent(this);</span><br><span class="line">    b1.setText(&quot;close&quot;);</span><br><span class="line">    b1.move(100, 100);</span><br><span class="line"></span><br><span class="line">    b2 = new QPushButton(this);</span><br><span class="line">    b2-&gt;setText(&quot;abc&quot;);</span><br><span class="line"></span><br><span class="line">    connect(&amp;b1, &amp;QPushButton::pressed, this, &amp;MainWidget::close);</span><br><span class="line">    /* &amp;b1: 信号发出者，指针类型</span><br><span class="line">     * &amp;QPushButton::pressed：处理的信号，  &amp;发送者的类名::信号名字</span><br><span class="line">     * this: 信号接收者</span><br><span class="line">     * &amp;MainWidget::close： 槽函数，信号处理函数  &amp;接收的类名::槽函数名字</span><br><span class="line">     * 发送-处理-接收-处理</span><br><span class="line">    */</span><br><span class="line"></span><br><span class="line">    /* 自定义槽，普通函数的用法</span><br><span class="line">     * Qt5：任意的成员函数，普通全局函数，静态函数</span><br><span class="line">     * 槽函数需要和信号一致（参数，返回值）</span><br><span class="line">     * 由于信号都是没有返回值，所以，槽函数一定没有返回值</span><br><span class="line">     */</span><br><span class="line">    connect(b2, &amp;QPushButton::released, this, &amp;MainWidget::mySlot);</span><br><span class="line"></span><br><span class="line">    connect(b2, &amp;QPushButton::released, &amp;b1, &amp;QPushButton::hide);</span><br><span class="line"></span><br><span class="line">    /* 信号：短信</span><br><span class="line">     * 槽函数：接收短信的手机</span><br><span class="line">     */</span><br><span class="line"></span><br><span class="line">    setWindowTitle(&quot;老大&quot;);</span><br><span class="line">    //this-&gt;setWindowTitle(&quot;老大&quot;);//等价同上</span><br><span class="line"></span><br><span class="line">    b3.setParent(this);</span><br><span class="line">    b3.setText(&quot;切换到子窗口&quot;);</span><br><span class="line">    b3.move(50, 50);</span><br><span class="line"></span><br><span class="line">    //显示子窗口</span><br><span class="line">    //subWin.show();</span><br><span class="line"></span><br><span class="line">    connect(&amp;b3, &amp;QPushButton::released, this, &amp;MainWidget::changeWin);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    //处理子窗口的信号</span><br><span class="line">//    void (SubWidget::*funSignal)() = &amp;SubWidget::mySignal;</span><br><span class="line">//    connect(&amp;subWin, funSignal, this, &amp;MainWidget::dealSub);</span><br><span class="line"></span><br><span class="line">//     void (SubWidget::*testSignal)(int, QString) = &amp;SubWidget::mySignal;</span><br><span class="line">//    connect(&amp;subWin, testSignal, this, &amp;MainWidget::dealSlot);</span><br><span class="line"></span><br><span class="line">    //Qt4信号连接</span><br><span class="line">    //Qt4槽函数必须有slots关键字来修饰</span><br><span class="line">    connect(&amp;subWin, SIGNAL(mySignal()), this, SLOT(dealSub()) );</span><br><span class="line"></span><br><span class="line">    connect(&amp;subWin, SIGNAL(mySignal(int,QString)),</span><br><span class="line">            this, SLOT(dealSlot(int,QString)) );</span><br><span class="line">    //缺点： SIGNAL SLOT 将函数名字 -&gt; 字符串  不进行错误检查</span><br><span class="line"></span><br><span class="line">    //Lambda表达式, 匿名函数对象</span><br><span class="line">    //C++11增加的新特性， 项目文件： CONFIG += C++11</span><br><span class="line">    //Qt配合信号一起使用，非常方便</span><br><span class="line"></span><br><span class="line">    QPushButton *b4 = new QPushButton(this);</span><br><span class="line">    b4-&gt;setText(&quot;Lambda表达式&quot;);</span><br><span class="line">    b4-&gt;move(150, 150);</span><br><span class="line">    int a = 10, b = 100;</span><br><span class="line">    connect(b4, &amp;QPushButton::clicked,</span><br><span class="line">            // = :把外部所有局部变量、类中所有成员以值传递方式</span><br><span class="line">            // this: 类中所有成员以值传递方式</span><br><span class="line">            // &amp; : 把外部所有局部变量， 引用符号</span><br><span class="line">            [=](bool isCheck)</span><br><span class="line">            &#123;</span><br><span class="line">                qDebug() &lt;&lt; isCheck;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    resize(400, 300);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void MainWidget::dealSlot(int a, QString str)</span><br><span class="line">&#123;</span><br><span class="line">    // str.toUtf8() -&gt; 字节数组QByteArray</span><br><span class="line">    // ……data()  -&gt; QByteArray -&gt; char *</span><br><span class="line">    qDebug() &lt;&lt; a &lt;&lt; str.toUtf8().data();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void MainWidget::mySlot()</span><br><span class="line">&#123;</span><br><span class="line">    b2-&gt;setText(&quot;123&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void MainWidget::changeWin()</span><br><span class="line">&#123;</span><br><span class="line">    //子窗口显示</span><br><span class="line">    subWin.show();</span><br><span class="line">    //本窗口隐藏</span><br><span class="line">    this-&gt;hide();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">void MainWidget::dealSub()</span><br><span class="line">&#123;</span><br><span class="line">    //子窗口隐藏</span><br><span class="line">    subWin.hide();</span><br><span class="line">    //本窗口显示</span><br><span class="line">    show();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MainWidget::~MainWidget()</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>subwidget.cpp<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;subwidget.h&quot;</span><br><span class="line"></span><br><span class="line">SubWidget::SubWidget(QWidget *parent) : QWidget(parent)</span><br><span class="line">&#123;</span><br><span class="line">    this-&gt;setWindowTitle(&quot;小弟&quot;);</span><br><span class="line">    b.setParent(this);</span><br><span class="line">    b.setText(&quot;切换到主窗口&quot;);</span><br><span class="line"></span><br><span class="line">    connect(&amp;b, &amp;QPushButton::clicked, this, &amp;SubWidget::sendSlot);</span><br><span class="line"></span><br><span class="line">    resize(400, 300);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">void SubWidget::sendSlot()</span><br><span class="line">&#123;</span><br><span class="line">    emit mySignal();</span><br><span class="line">    emit mySignal(250, &quot;我是子窗口&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>SingnalAndSlot.pro<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">QT       += core gui</span><br><span class="line"></span><br><span class="line">greaterThan(QT_MAJOR_VERSION, 4): QT += widgets</span><br><span class="line"></span><br><span class="line">TARGET = 03_SignalAndSlot</span><br><span class="line">TEMPLATE = app</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SOURCES += main.cpp\</span><br><span class="line">        mainwidget.cpp \</span><br><span class="line">    subwidget.cpp</span><br><span class="line"></span><br><span class="line">HEADERS  += mainwidget.h \</span><br><span class="line">    subwidget.h</span><br><span class="line"></span><br><span class="line">CONFIG += C++11</span><br></pre></td></tr></table></figure></p><h1 id="4-总结"><a href="#4-总结" class="headerlink" title="4 总结"></a>4 总结</h1><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2019/03/16/qt-note/pic2.png" alt="结构图" title>                </div>                <div class="image-caption">结构图</div>            </figure><h1 id="5-参考博文"><a href="#5-参考博文" class="headerlink" title="5 参考博文"></a>5 参考博文</h1><ol><li>C++_之Qt的信号和槽的详解 <a href="https://www.cnblogs.com/wanghui1234/p/8964968.html" target="_blank" rel="noopener">https://www.cnblogs.com/wanghui1234/p/8964968.html</a>  </li><li>Qt信号和槽机制 <a href="https://blog.csdn.net/lsfreeing/article/details/78575246" target="_blank" rel="noopener">https://blog.csdn.net/lsfreeing/article/details/78575246</a></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;QT的信号和槽的详解，包括简介，信号和槽分析以及一个实例&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="AI组件开发" scheme="http://11wy11.github.io/categories/AI%E7%BB%84%E4%BB%B6%E5%BC%80%E5%8F%91/"/>
    
      <category term="C++" scheme="http://11wy11.github.io/categories/C/"/>
    
    
      <category term="C++" scheme="http://11wy11.github.io/tags/C/"/>
    
      <category term="QT" scheme="http://11wy11.github.io/tags/QT/"/>
    
  </entry>
  
  <entry>
    <title>krpano快速入门教程（二）之vtour简介</title>
    <link href="http://11wy11.github.io/2019/03/15/krpano-second-note/"/>
    <id>http://11wy11.github.io/2019/03/15/krpano-second-note/</id>
    <published>2019-03-15T15:19:51.000Z</published>
    <updated>2019-04-01T03:12:38.710Z</updated>
    
    <content type="html"><![CDATA[<p>主要介绍全景漫游及vtour文件夹介绍<br><a id="more"></a></p><h3 id="vtour全景漫游及vtour文件夹介绍"><a href="#vtour全景漫游及vtour文件夹介绍" class="headerlink" title="vtour全景漫游及vtour文件夹介绍"></a>vtour全景漫游及vtour文件夹介绍</h3><p>使用MAKE VTOUR (MULTIRES) droplet工具生成全景漫游<br><!--more--></p><h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>在初始学习krpano时，可以借助krpano的工具生成全景漫游文件，之后可以根据需要修改tour.xml,定制skin等；<br>上节简单介绍了krpano使用Make pano的工具创建单场景应用，但大多数应用中场景数量不只一个，彼此之间可以跳转，这就需要借助MAKE VTOUR droplet工具了。而具体选择三种中的哪一种，根据应用场景需要选择，multires支持将全景切片分级，能够达到更好的展示效果，但会使全景文件大小增加，normal生成普通的pano_f.jpg,pano_b.jpg,pano_l.jpg，pano_r.jpg，pano_u.jpg，pano_d.jpg,preview.jpg，分别为全景图的前后左右上下，以及菜单中的预览图。</p><h3 id="生成vtour"><a href="#生成vtour" class="headerlink" title="生成vtour"></a>生成vtour</h3><p>使用MAKE VTOUR (MULTIRES) droplet工具生成的全景漫游场景，场景彼此之间相互连接，能够从一个场景跳转到另一个场景。<br>可以同时选择多张全景图片拖放在该工具上，输入全景图类型，和全景角度，执行切片，等待完成。显示<strong>done</strong>之后，在全景图文件夹中生成vtour文件夹。</p><h3 id="vtour文件夹内容介绍"><a href="#vtour文件夹内容介绍" class="headerlink" title="vtour文件夹内容介绍"></a>vtour文件夹内容介绍</h3><pre><code>1. tour.html文件--嵌入全景的网页2. tour.swf文件--krpano的flash viewer3. tour.js文件--基于swfkrpano.js的一个viewer，即HTML5的viewer及嵌入HTML的js文件的合体4. tour.xml文件--是krpano xml配置文件，定义全景图配置及皮肤配置5. panos文件夹--存放处理后的全景图切片6. plugins文件夹--主要存放使用到的插件</code></pre><h3 id="场景Scene"><a href="#场景Scene" class="headerlink" title="场景Scene"></a>场景Scene</h3><p>它们可用于在当前xml文件中再次定义完整krpano xml文件的内容。它就像一个外部的xml，但只是内联/嵌入到当前的xml中。 在调用具有场景名称的loadscene（）</p><p>典型的用法是在一个xml文件中定义几个panos。</p><p>使用loadpano（）动作加载新的外部xml文件时，将删除所有当前定义的场景元素。</p><p>可以在&lt;scene>元素中存储任何自定义属性 - 查看器本身将忽略它们，但它们可用于自定义操作。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;scene name=&quot;scene_20171106193359&quot; title=&quot;20171106193359&quot; onstart=&quot;&quot; thumburl=&quot;panos/20171106193359.tiles/thumb.jpg&quot; lat=&quot;51.51500000&quot; lng=&quot;-0.08050000&quot; heading=&quot;0.0&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;view hlookat=&quot;0.0&quot; vlookat=&quot;0.0&quot; fovtype=&quot;MFOV&quot; fov=&quot;120&quot; maxpixelzoom=&quot;2.0&quot; fovmin=&quot;70&quot; fovmax=&quot;140&quot; limitview=&quot;range&quot; vlookatmin=&quot;-56.055&quot; vlookatmax=&quot;56.055&quot; /&gt;</span><br><span class="line"></span><br><span class="line">&lt;preview url=&quot;panos/20171106193359.tiles/preview.jpg&quot; /&gt;</span><br><span class="line"></span><br><span class="line">&lt;image prealign=&quot;0|0.0|0&quot;&gt;</span><br><span class="line">&lt;cube url=&quot;panos/20171106193359.tiles/pano_%s.jpg&quot; /&gt;</span><br><span class="line">&lt;/image&gt;</span><br><span class="line"></span><br><span class="line">&lt;/scene&gt;</span><br></pre></td></tr></table></figure></p><p>说明：      </p><ol><li>name<br>场景名称，命名规则：每个名字都需要以字母字符开头！这意味着不允许使用数字作为名字！当名称仍然以数字字符开头时，名称将被解释为数组索引。这对于动作内部基于动态索引的访问没有问题，但不能用于定义元素！所有名称将自动转换为小写字母，以便直接区分大小写访问！也是loadscene时设置的参数</li><li>title<br>主要显示在缩略图上或者菜单栏名称</li><li>onstart<br>此处可以定义将在“开始时”调用全景/场景观看的任何动作/功能。<br>场景启动时调用，可以执行定义好的action</li><li>thumburl<br>默认视角的展示图路径，使用相对路径，以xml所在位置开始计算相对路径</li><li>lat&amp;lon<br>场景所在经纬度，可以用于小地图插件，定位场景</li><li>heading<br>仰角度数</li></ol><h3 id="视图view"><a href="#视图view" class="headerlink" title="视图view"></a>视图view</h3><p>view元素包含有关当前视图的信息。<br>在xml中，它可用于设置启动视图设置。</p><p>查找方向将由hlookat / vlookat属性（=水平/垂直lookat）和fov属性中的当前视野定义。要查看部分全景图的限制，可以使用limitview属性。</p><ol><li>hlookat&amp;vlookat<br>设置初始视角，分别为水平方向和垂直方向<ul><li>hlookat:球面坐标的水平方向，以度为单位。<pre><code>典型范围为-180°至+ 180°。该值不会环绕360°，但视图本身会。值0.0指向全景图像的中心。</code></pre></li><li>vlookat:球面坐标的垂直方向，以度为单位。<pre><code>典型范围为-90°至+90°。但视图本身会。值0.0指向全景图像的中心。</code></pre></li></ul></li><li>fov<br>以度为单位的当前视野 - 从近似0.0到179.0。,默认为90 </li><li>fovmin&amp;fovmax<br>主要设置视角放大和缩小的最大和最小视角</li><li>maxpixelzoom<br>全景图像的最大像素缩放系数。<br>这将根据全景分辨率和当前观察窗口自动限制fov，例如1.0 =限制为100％缩放，不会看到源图像的像素缩放。</li></ol><h3 id="预览preview"><a href="#预览preview" class="headerlink" title="预览preview"></a>预览preview</h3><pre><code>url:设置预览图路径</code></pre><h3 id="全景图image"><a href="#全景图image" class="headerlink" title="全景图image"></a>全景图image</h3><pre><code>使用&lt;image&gt;元素将定义全景图像。</code></pre><p>在此处设置图像/图块的类型，大小和URL路径。</p><ol><li>type<br>定义全景图像的类型。</li></ol><p>可能的值：</p><ul><li>CUBE<br>方全景图像 - 六个图像，每个立方体一个图像。</li><li>CUBESTRIP<br>在一张图像中作为“图像条”的立方体全景图像。支持的多维数据集格式为6x1,1x6,3x2或2x3。立方体侧对齐本身始终需要：L，F，R，B，U，D（默认为krpano）。</li><li>SPHERE<br>球形/ equirectangular全景图像。<br>通过设置自定义hfov， vfov和 voffset设置可以实现部分panos。</li><li>CYLINDER<br>一个圆柱形全景图像。<br>通过设置自定义hfov， vfov和 voffset设置可以实现部分panos。</li><li>…未设置时：<br>如果未设置类型，则查看器会尝试通过&lt;image>标记内的标记自动检测类型（仅适用于非多图像）。</li></ul><ol start="2"><li>hfov<br>以度为单位定义全景图像的水平视野（hfov）。<br>这是在全景图像上捕获的可见范围。<br>默认值为360，表示全方位视图。使用较小的值进行部分全景。对于平坦全景（或普通图像），应使用值“1.0”。</li><li><p>multies<br>启用平铺的多分辨率图像。<br>设置为true时，&lt;image>元素需要包含多个&lt;level>元素，其中包含每个多分辨率级别的图像定义。多分辨切片时定义使用</p></li><li><p>tilesize<br>当全景图为切片时，设置每一级切片大小</p></li><li>level[..].tiledimagewidth level[..].tiledimageheight<br>某一级切片大小</li><li><p>stereo&amp;stereolabels&amp;stereoformat    </p><p> 允许使用立体图像（仅限HTML5和WebGL）。</p><p> 使用立方体图像时，图像URL应包含％t占位符。此占位符将替换为stereolabels设置中的值。对于左图像，将使用第一个值，对于右图像，将使用第二个值。</p><p> 对于球形或圆柱形图像或视频，可以使用“帧封装”立体图像。该stereoformat设置定义的打包顺序：<br> stereoformat =“TB” - 上/下<br> stereoformat =“SBS” - Side-By-Side<br> 示例 - 立体立方体图像：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;image stereo =“true”stereolabels =“1 | 2” &gt; </span><br><span class="line">  &lt;cube url =“pano_％s_ ％t .jpg”/&gt; </span><br><span class="line">&lt;/ image&gt;</span><br><span class="line">示例 - 立体全景视频：</span><br><span class="line">&lt;image stereo =“true”stereoformat =“TB” &gt; </span><br><span class="line">  &lt;sphere url =“ plugin：video ”/&gt; </span><br><span class="line">&lt;/ image&gt;</span><br></pre></td></tr></table></figure><p> 注意 - 根据全景图像或视频的像素大小（和侧面），可能需要手动设置hfov，vfov和voffset设置。</p></li><li><p>fisheye.fov fisheye.align fisheye.crop fisheye.lenscp<br> 鱼眼图像支持（仅限HTML5和WebGL）。</p><p> 通过鱼眼设置，可以在krpano中使用鱼眼照片和视频。</p><p> 为了正确地拉直和对齐鱼眼图像，有必要了解一些有关它的参数。获取这些参数的一个好工具是PTGUI。</p><p> 鱼眼设置：</p><ul><li>fov = “180.0”<ul><li>鱼眼图像的视野（以度为单位）。</li><li>与crop大小有关。</li><li>来源：可以直接从PTGUI fov图像参数中获取。</li></ul></li><li>align = “yaw|pitch|roll”<ul><li>图像的对齐/旋转/调平（以度为单位）。</li><li>来源：可以直接从PTGUI图像参数中获取。<br>（例如，使用垂直线控制点来对齐/调整图像）</li></ul></li><li>crop=“left|right|top|bottom”<ul><li>鱼眼fov裁剪圆的边缘（以像素为单位）。</li><li>圆与fov大小有关。</li><li>来源：可以直接从PTGUI裁剪设置中获取。</li></ul></li><li>lenscp = “a| b | c | d | e” 的<ul><li>镜头校正参数。</li><li>来源：可以直接从PTGUI镜头设置中获取。</li></ul></li></ul></li></ol><h3 id="image中URL占位符等"><a href="#image中URL占位符等" class="headerlink" title="image中URL占位符等"></a>image中URL占位符等</h3><p>根据图像类型和相关设置，图像的URL应包含多个占位符，以允许寻址正确的图像文件。</p><p>这些网址占位符可用：</p><ul><li>对于立方体的各个面：％s⇒cubelabels的占位符</li><li>对于水平图块索引：％h，％x，％u或％c （都相同）</li><li>对于垂直图块索引： ％v，％y或％r （都相同）</li><li>对于立体图像：％t⇒stereolabels的占位符<br>为当前图像帧：％f ⇒ image.frame （仅限Flash）</li><li>每个占位符可以在url中多次使用 - 例如，作为文件名的一部分，也作为foldername的一部分。</li><li>平铺索引填充：<br>通过在％字符和tile-index占位符的字符之间插入一个或多个0个字符，可以为数字定义自定义填充。<br>比如:<br>％H  ⇒  1,2,3，…，9,10,11<br>％0H  ⇒  01,02,03，…，09,10,11<br>％00H  ⇒  001,002,003，……，009010011</li></ul><h3 id="预览效果"><a href="#预览效果" class="headerlink" title="预览效果"></a>预览效果</h3><figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="/2019/03/15/krpano-second-note/pic1.png" alt="效果图" title>                </div>                <div class="image-caption">效果图</div>            </figure><h3 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h3><p>之后的主要工作为：定制skin，定制plugins，定制xml，一些动态操作全景图配置使编辑js文件，能够实现动态配置全景图程序，能够更好的融入到Web应用程序中，作为其中一个子功能模块。后续结合实际案例介绍具体实现方式。历史文章</p><h3 id="历史文章"><a href="#历史文章" class="headerlink" title="历史文章"></a>历史文章</h3><p><a href="/2019/03/14/krpano-first-note">krpano快速入门教程（一) 使用krpano工具构建即用型panos</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;主要介绍全景漫游及vtour文件夹介绍&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="全景" scheme="http://11wy11.github.io/categories/%E5%85%A8%E6%99%AF/"/>
    
    
      <category term="krpano" scheme="http://11wy11.github.io/tags/krpano/"/>
    
  </entry>
  
  <entry>
    <title>krpano快速入门教程（一）之构建panos应用</title>
    <link href="http://11wy11.github.io/2019/03/14/krpano-first-note/"/>
    <id>http://11wy11.github.io/2019/03/14/krpano-first-note/</id>
    <published>2019-03-14T07:54:54.000Z</published>
    <updated>2019-03-24T01:17:55.061Z</updated>
    
    <content type="html"><![CDATA[<h2 id="使用krpano工具构建即用型panos"><a href="#使用krpano工具构建即用型panos" class="headerlink" title="使用krpano工具构建即用型panos"></a>使用krpano工具构建即用型panos</h2><p>简单使用krpano工具快速生成可执行的pano文件，后续介绍如何自定义编写配置文件切图等<br><a id="more"></a></p><h2 id="krpano简介"><a href="#krpano简介" class="headerlink" title="krpano简介"></a>krpano简介</h2><p>Krpano是一款全景漫游制作软件和工具。用krpano所生成的全景，在兼容性、功能性、互动性方面的表现都很不错，而且可以二次开发并拥有自己的编程语言，比如使用专用的krpano xml代码编写全景漫游，可开发出高度定制化的项目。因此，目前主流的全景网站均是在krpano全景的基础上进行开发，并不断进行更新迭代，形成自己独有的全景内容服务。</p><h2 id="具体步骤"><a href="#具体步骤" class="headerlink" title="具体步骤"></a>具体步骤</h2><ol><li>从<a href="https://krpano.com/download/" target="_blank" rel="noopener">krpano下载页面下载</a>适合于自己系统的krpano Tools软件包</li><li>将下载的krpano Tools zip文件解压到一个不含中文路径的文件夹下（为了所有稳定使用，推荐）</li><li>如果您已拥有krpano许可文件 - 则立即将其复制或移动到krpano Tools文件夹中。如果您没有任何一个，那么只需跳过此步骤即可。之后可以通过注册码注册，具体破解方法请自行百度，注册后能够去掉切片中的krpano水印。</li><li>要构建单个全景图 - 打开包含全景图像的文件夹，选择其中一个或全部，拖放到MAKE PANO droplet批处理工具上。<br><img src="/2019/03/14/krpano-first-note/pic1.png" alt="拖动全景图到工具上"><br>等待切片完成，会在全景图像所在文件夹中生成一个以全景图命名的文件夹，里面自动生成一个即用型pano,点击tour_testingsever运行测试服务器，打开index.html查看效果。<br><img src="/2019/03/14/krpano-first-note/pic2.png" alt="生成结果"><br>需要说明的是，这里如果没有注册，运行之后全景图是有krpano水印的。可以运行krpano tools选择 register now 输入序列号完成注册。注册完在按照第4步操作，得到没有水印的全景图<br><img src="/2019/03/14/krpano-first-note/pic3.png" alt="注册前"><center>注册前</center><br><img src="/2019/03/14/krpano-first-note/pic4.png" alt="注册后"><br><center> 注册后</center></li><li>要构建虚拟游览 - 打开包含全景虚拟游览图像的文件夹，选择所有这些图像拖放到MAKE VTOURdroplet批处理工具上。 </li><li>其他工具使用类似，主要功能简介如下：  <ul><li>MAKE PANO (NORMAL) droplet<br>针对标准全景图（360度），最大值。cubeize默认限制为2200像素（可以在’templates / normal.config’文件中更改），没有皮肤 - 只需pano，HTML5 iPhone / iPad就绪</li><li>MAKE PANO（MULTIRES）droplet<br>用于渐进多分辨率的panos，没有尺寸/分辨率限制，快速动态加载，带按钮的默认皮肤，HTML5 iPhone / iPad就绪</li><li>MAKE PANO（FLAT）droplet<br>用于平面/ 2D平移/图像，平铺多分辨率，无尺寸/分辨率限制，平坦全景/图像的皮肤/控制，仅限闪光</li><li>MAKE PANO（SINGLESWF）droplet<br>只生成一个Flash swf文件，对于标准全景图，完整的pano将立即加载，最大值。cubesize限制为2200像素（可在’templates / singleswf.config’文件中更改），默认皮肤带按钮，仅限Flash</li><li>MAKE OBJECT droplet<br>用于平铺多分辨率对象影片，一次删除所有对象图像，没有大小/分辨率限制，快速和动态加载，具有按钮和对象旋转控件的对象外观，仅限Flash</li><li>MAKE VTOUR (NORMAL) droplet / MAKE VTOUR (MULTIRES) droplet<br> 用于自动构建虚拟游览，将所有全景图像放在此工具上，通过自动缩略图生成，准备好HTML5 iPhone / iPad </li></ul></li><li>处理完成后关闭dos / terminal窗口。在源图像的文件夹中会有新文件：典型的.html文件 - 这是嵌入pano的示例网页，.swf文件 - 这是krpano Flash查看器，.js文件 - 这是Javascript Flash到HTML嵌入代码（基于swfkrpano.js）和可选的krpano HTML5 / Javascript iPhone / iPad查看器，一个.xml文件 - 这是krpano xml文件，有pano和皮肤定义，最后有.tiles文件夹 - 有处理过的全景图像。全景图像本身不是观看全景图像所必需的。 6.2。当您使用MAKE VTOUR Droplet时，这些文件将位于’vtour’文件夹中，而pano图像位于其中的’panos’文件夹中。</li><li>编辑全景设置打开并在任何文本编辑器中编辑生成的xml文件（带有xml-syntax-highlighting的文本编辑器可能会有帮助）： 在在线文档中查找krpano xml定义：</li></ol>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;使用krpano工具构建即用型panos&quot;&gt;&lt;a href=&quot;#使用krpano工具构建即用型panos&quot; class=&quot;headerlink&quot; title=&quot;使用krpano工具构建即用型panos&quot;&gt;&lt;/a&gt;使用krpano工具构建即用型panos&lt;/h2&gt;&lt;p&gt;简单使用krpano工具快速生成可执行的pano文件，后续介绍如何自定义编写配置文件切图等&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="全景" scheme="http://11wy11.github.io/categories/%E5%85%A8%E6%99%AF/"/>
    
    
      <category term="krpano" scheme="http://11wy11.github.io/tags/krpano/"/>
    
  </entry>
  
  <entry>
    <title>AI组件开发（一）--注记旋转矩阵</title>
    <link href="http://11wy11.github.io/2019/03/14/ai-first-note/"/>
    <id>http://11wy11.github.io/2019/03/14/ai-first-note/</id>
    <published>2019-03-14T02:56:02.000Z</published>
    <updated>2019-03-25T06:05:00.276Z</updated>
    
    <content type="html"><![CDATA[<p>Adobe Illustrator 组件开发 AIRealMatrixSet介绍及使用方法，参数及原理分析<br><a id="more"></a></p><h2 id="SDK官方帮助文档"><a href="#SDK官方帮助文档" class="headerlink" title="SDK官方帮助文档"></a>SDK官方帮助文档</h2><p>AIAPI void(<em> AIRealMathSuite::AIRealMatrixSet)(AIRealMatrix </em>m, AIReal a, AIReal b, AIReal c, AIReal d, AIReal tx, AIReal ty)<br>Sets the scale, rotation, and translation values of a transformation matrix.<br>Parameters:<br>m The matrix object.<br>a New a value.<br>b New b value.<br>c New c value.<br>d New d value.<br>tx New horizontal translation value.<br>ty New vertical translation value.  </p><h2 id="参数及原理分析"><a href="#参数及原理分析" class="headerlink" title="参数及原理分析"></a>参数及原理分析</h2><p>ad缩放bc旋转tx,ty位移，基础的2D矩阵<br> 公式</p><pre><code>x=ax+cy+txy=bx+dy+ty</code></pre><p>为了把二维图形的变化统一在一个坐标系里，引入了齐次坐标的概念，即把一个图形用一个三维矩阵表示，其中第三列总是(0,0,1)，用来作为坐标系的标准。所以所有的变化都由前两列完成<br>以上参数在矩阵中的表示为：</p><p> |a    b    0|</p><p> |c    d    0|</p><p> |tx   ty   1|</p><p>运算原理：原坐标设为（X,Y,1）;</p><pre><code>                     |a    b    0|[X，Y,  1]           |c    d    0|     =     [aX + cY + tx   bX + dY + ty  1] ;                     |tx    ty  1|</code></pre><p>通过矩阵运算后的坐标[aX + cY + tx   bX + dY + ty  1]，我们对比一下可知：</p><ol><li>第一种：设a=d=1, b=c=0.  平移</li></ol><p>[aX + cY + tx   bX + dY + ty  1] = [X  + tx  Y + ty  1];</p><p>可见，这个时候，坐标是按照向量（tx，ty）进行平移</p><ol start="2"><li>第二种：设b=c=tx=ty=0.  缩放</li></ol><p>[aX + cY + tx   bX + dY + ty  1] = [aX    dY   1];</p><p>可见，这个时候，坐标X按照a进行缩放，Y按照d进行缩放，a，d就是X，Y的比例系数</p><ol start="3"><li>第三种：设tx=ty=0，a=cosɵ，b=sinɵ，c=-sinɵ，d=cosɵ。旋转</li></ol><p>[aX + cY + tx   bX + dY + ty  1] = [Xcosɵ - Ysinɵ    Xsinɵ + Ycosɵ  1] ;</p><pre><code>|cosɵ    -sinɵ   0||sinɵ    cosɵ    0|    | 0       0      1 |</code></pre><p>可见，这个时候，ɵ就是旋转的角度，逆时针为正，顺时针为负</p><ol start="4"><li><p>第四种：设tx=ty=0，a=1，b=0，c=-sinɵ，d=cosɵ。倾斜<br>[aX + cY + tx   bX + dY + ty  1] = [ - Ysinɵ    Ycosɵ  1] ;</p><pre><code>|1        0       0||-sinɵ    cosɵ    0|    | 0       0       1 |</code></pre></li></ol><p>可见，这个时候，ɵ就是倾斜的角度，逆时针为正，顺时针为负</p><h1 id="相关文章"><a href="#相关文章" class="headerlink" title="相关文章"></a>相关文章</h1><p><a href="/2019/03/14/ai-first-note">AI组件开发（一）–注记旋转矩阵</a><br><a href="/2019/03/18/ai-second-note">AI组件开发（二）–AIRealMathSuite</a><br><a href="/2019/03/24/ai-third-note">AI组件开发（三）–AIArtboardSuite</a><br><a href="/2019/03/24/ai-forth-document-note">AI组件开发（四）–AIDocumentSuite</a><br><a href="/2019/03/24/ai-fifth-ailayer-note">AI组件开发（五）–AILayerSuite</a><br><a href="/2019/03/24/ai-six-aiart-note">AI组件开发（六）–AIArtSuite</a><br><a href="/2019/03/25/ai-seven-path-note">AI组件开发（七）–AIPathSuite&amp;&amp;AIPathfinderSuite</a><br><a href="/2019/03/25/ai-eight-style-note">AI组件开发（八）–AIArtStyleSuite</a></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Adobe Illustrator 组件开发 AIRealMatrixSet介绍及使用方法，参数及原理分析&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="AI组件开发" scheme="http://11wy11.github.io/categories/AI%E7%BB%84%E4%BB%B6%E5%BC%80%E5%8F%91/"/>
    
    
      <category term="AI" scheme="http://11wy11.github.io/tags/AI/"/>
    
  </entry>
  
  <entry>
    <title>csdn-markdown编辑器语法</title>
    <link href="http://11wy11.github.io/2019/03/14/csdn-markdown-grammar/"/>
    <id>http://11wy11.github.io/2019/03/14/csdn-markdown-grammar/</id>
    <published>2019-03-13T16:03:21.000Z</published>
    <updated>2019-03-24T01:28:54.796Z</updated>
    
    <content type="html"><![CDATA[<p>记录CSDN 的markdown语法，备查<br><a id="more"></a><br>@<a href="这里写自定义目录标题">TOC</a></p><h1 id="欢迎使用Markdown编辑器"><a href="#欢迎使用Markdown编辑器" class="headerlink" title="欢迎使用Markdown编辑器"></a>欢迎使用Markdown编辑器</h1><p>你好！ 这是你第一次使用 <strong>Markdown编辑器</strong> 所展示的欢迎页。如果你想学习如何使用Markdown编辑器, 可以仔细阅读这篇文章，了解一下Markdown的基本语法知识。</p><h2 id="功能快捷键"><a href="#功能快捷键" class="headerlink" title="功能快捷键"></a>功能快捷键</h2><p>撤销：<kbd>Ctrl/Command</kbd> + <kbd>Z</kbd><br>重做：<kbd>Ctrl/Command</kbd> + <kbd>Y</kbd><br>加粗：<kbd>Ctrl/Command</kbd> + <kbd>B</kbd><br>斜体：<kbd>Ctrl/Command</kbd> + <kbd>I</kbd><br>标题：<kbd>Ctrl/Command</kbd> + <kbd>Shift</kbd> + <kbd>H</kbd><br>无序列表：<kbd>Ctrl/Command</kbd> + <kbd>Shift</kbd> + <kbd>U</kbd><br>有序列表：<kbd>Ctrl/Command</kbd> + <kbd>Shift</kbd> + <kbd>O</kbd><br>检查列表：<kbd>Ctrl/Command</kbd> + <kbd>Shift</kbd> + <kbd>C</kbd><br>插入代码：<kbd>Ctrl/Command</kbd> + <kbd>Shift</kbd> + <kbd>K</kbd><br>插入链接：<kbd>Ctrl/Command</kbd> + <kbd>Shift</kbd> + <kbd>L</kbd><br>插入图片：<kbd>Ctrl/Command</kbd> + <kbd>Shift</kbd> + <kbd>G</kbd></p><h2 id="合理的创建标题，有助于目录的生成"><a href="#合理的创建标题，有助于目录的生成" class="headerlink" title="合理的创建标题，有助于目录的生成"></a>合理的创建标题，有助于目录的生成</h2><p>直接输入1次<kbd>#</kbd>，并按下<kbd>space</kbd>后，将生成1级标题。<br>输入2次<kbd>#</kbd>，并按下<kbd>space</kbd>后，将生成2级标题。<br>以此类推，我们支持6级标题。有助于使用<code>TOC</code>语法后生成一个完美的目录。</p><h2 id="如何改变文本的样式"><a href="#如何改变文本的样式" class="headerlink" title="如何改变文本的样式"></a>如何改变文本的样式</h2><p><em>强调文本</em> <em>强调文本</em></p><p><strong>加粗文本</strong> <strong>加粗文本</strong></p><p>==标记文本==</p><p><del>删除文本</del></p><blockquote><p>引用文本</p></blockquote><p>H~2~O is是液体。</p><p>2^10^ 运算结果是 1024.</p><h2 id="插入链接与图片"><a href="#插入链接与图片" class="headerlink" title="插入链接与图片"></a>插入链接与图片</h2><p>链接: <a href="https://mp.csdn.net" target="_blank" rel="noopener">link</a>.</p><p>图片: <figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://avatar.csdn.net/7/7/B/1_ralf_hx163com.jpg" alt="Alt" title>                </div>                <div class="image-caption">Alt</div>            </figure></p><p>带尺寸的图片: <figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://avatar.csdn.net/7/7/B/1_ralf_hx163com.jpg" alt="Alt" title="=30x30">                </div>                <div class="image-caption">=30x30</div>            </figure></p><p>居中的图片: <figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://avatar.csdn.net/7/7/B/1_ralf_hx163com.jpg#pic_center" alt="Alt" title>                </div>                <div class="image-caption">Alt</div>            </figure></p><p>居中并且带尺寸的图片: <figure class="image-bubble">                <div class="img-lightbox">                    <div class="overlay"></div>                    <img src="https://avatar.csdn.net/7/7/B/1_ralf_hx163com.jpg#pic_center" alt="Alt" title="=30x30">                </div>                <div class="image-caption">=30x30</div>            </figure></p><p>当然，我们为了让用户更加便捷，我们增加了图片拖拽功能。</p><h2 id="如何插入一段漂亮的代码片"><a href="#如何插入一段漂亮的代码片" class="headerlink" title="如何插入一段漂亮的代码片"></a>如何插入一段漂亮的代码片</h2><p>去<a href="https://mp.csdn.net/configure" target="_blank" rel="noopener">博客设置</a>页面，选择一款你喜欢的代码片高亮样式，下面展示同样高亮的 <code>代码片</code>.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// An highlighted block</span></span><br><span class="line"><span class="keyword">var</span> foo = <span class="string">'bar'</span>;</span><br></pre></td></tr></table></figure></p><h2 id="生成一个适合你的列表"><a href="#生成一个适合你的列表" class="headerlink" title="生成一个适合你的列表"></a>生成一个适合你的列表</h2><ul><li>项目<ul><li>项目<ul><li>项目</li></ul></li></ul></li></ul><ol><li>项目1</li><li>项目2</li><li>项目3</li></ol><ul><li style="list-style: none"><input type="checkbox"> 计划任务</li><li style="list-style: none"><input type="checkbox" checked> 完成任务</li></ul><h2 id="创建一个表格"><a href="#创建一个表格" class="headerlink" title="创建一个表格"></a>创建一个表格</h2><p>一个简单的表格是这么创建的：<br>项目     | Value<br>——– | —–<br>电脑  | $1600<br>手机  | $12<br>导管  | $1</p><h3 id="设定内容居中、居左、居右"><a href="#设定内容居中、居左、居右" class="headerlink" title="设定内容居中、居左、居右"></a>设定内容居中、居左、居右</h3><p>使用<code>:---------:</code>居中<br>使用<code>:----------</code>居左<br>使用<code>----------:</code>居右<br>| 第一列       | 第二列         | 第三列        |<br>|:———–:| ————-:|:————-|<br>| 第一列文本居中 | 第二列文本居右  | 第三列文本居左 | </p><h3 id="SmartyPants"><a href="#SmartyPants" class="headerlink" title="SmartyPants"></a>SmartyPants</h3><p>SmartyPants将ASCII标点字符转换为“智能”印刷标点HTML实体。例如：<br>|    TYPE   |ASCII                          |HTML<br>|—————-|——————————-|—————————–|<br>|Single backticks|<code>&#39;Isn&#39;t this fun?&#39;</code>            |’Isn’t this fun?’            |<br>|Quotes          |<code>&quot;Isn&#39;t this fun?&quot;</code>            |”Isn’t this fun?”            |<br>|Dashes          |<code>-- is en-dash, --- is em-dash</code>|– is en-dash, — is em-dash|</p><h2 id="创建一个自定义列表"><a href="#创建一个自定义列表" class="headerlink" title="创建一个自定义列表"></a>创建一个自定义列表</h2><p>Markdown<br>:  Text-to-HTML conversion tool</p><p>Authors<br>:  John<br>:  Luke</p><h2 id="如何创建一个注脚"><a href="#如何创建一个注脚" class="headerlink" title="如何创建一个注脚"></a>如何创建一个注脚</h2><p>一个具有注脚的文本。<a href="注脚的解释">^2</a></p><h2 id="注释也是必不可少的"><a href="#注释也是必不可少的" class="headerlink" title="注释也是必不可少的"></a>注释也是必不可少的</h2><p>Markdown将文本转换为 HTML。</p><p>*[HTML]:   超文本标记语言</p><h2 id="KaTeX数学公式"><a href="#KaTeX数学公式" class="headerlink" title="KaTeX数学公式"></a>KaTeX数学公式</h2><p>您可以使用渲染LaTeX数学表达式 <a href="https://khan.github.io/KaTeX/" target="_blank" rel="noopener">KaTeX</a>:</p><p>Gamma公式展示 $\Gamma(n) = (n-1)!\quad\forall<br>n\in\mathbb N$ 是通过欧拉积分</p><p>$$<br>\Gamma(z) = \int_0^\infty t^{z-1}e^{-t}dt\,.<br>$$</p><blockquote><p>你可以找到更多关于的信息 <strong>LaTeX</strong> 数学表达式<a href="http://meta.math.stackexchange.com/questions/5020/mathjax-basic-tutorial-and-quick-reference" target="_blank" rel="noopener">here</a>.</p></blockquote><h2 id="新的甘特图功能，丰富你的文章"><a href="#新的甘特图功能，丰富你的文章" class="headerlink" title="新的甘特图功能，丰富你的文章"></a>新的甘特图功能，丰富你的文章</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">gantt</span><br><span class="line">        dateFormat  YYYY-MM-DD</span><br><span class="line">        title Adding GANTT diagram functionality to mermaid</span><br><span class="line">        section 现有任务</span><br><span class="line">        已完成               :done,    des1, 2014-01-06,2014-01-08</span><br><span class="line">        进行中               :active,  des2, 2014-01-09, 3d</span><br><span class="line">        计划一               :         des3, after des2, 5d</span><br><span class="line">        计划二               :         des4, after des3, 5d</span><br></pre></td></tr></table></figure><ul><li>关于 <strong>甘特图</strong> 语法，参考 <a href="https://mermaidjs.github.io/" target="_blank" rel="noopener">这儿</a>,</li></ul><h2 id="UML-图表"><a href="#UML-图表" class="headerlink" title="UML 图表"></a>UML 图表</h2><p>可以使用UML图表进行渲染。 <a href="https://mermaidjs.github.io/" target="_blank" rel="noopener">Mermaid</a>. 例如下面产生的一个序列图：:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sequenceDiagram</span><br><span class="line">张三 -&gt;&gt; 李四: 你好！李四, 最近怎么样?</span><br><span class="line">李四--&gt;&gt;王五: 你最近怎么样，王五？</span><br><span class="line">李四--x 张三: 我很好，谢谢!</span><br><span class="line">李四-x 王五: 我很好，谢谢!</span><br><span class="line">Note right of 王五: 李四想了很长时间, 文字太长了&lt;br/&gt;不适合放在一行.</span><br><span class="line"></span><br><span class="line">李四--&gt;&gt;张三: 打量着王五...</span><br><span class="line">张三-&gt;&gt;王五: 很好... 王五, 你怎么样?</span><br></pre></td></tr></table></figure><p>这将产生一个流程图。:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">A[长方形] -- 链接 --&gt; B((圆))</span><br><span class="line">A --&gt; C(圆角长方形)</span><br><span class="line">B --&gt; D&#123;菱形&#125;</span><br><span class="line">C --&gt; D</span><br></pre></td></tr></table></figure><ul><li>关于 <strong>Mermaid</strong> 语法，参考 <a href="https://mermaidjs.github.io/" target="_blank" rel="noopener">这儿</a>,</li></ul><h2 id="FLowchart流程图"><a href="#FLowchart流程图" class="headerlink" title="FLowchart流程图"></a>FLowchart流程图</h2><p>我们依旧会支持flowchart的流程图：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">flowchat</span><br><span class="line">st=&gt;start: 开始</span><br><span class="line">e=&gt;end: 结束</span><br><span class="line">op=&gt;operation: 我的操作</span><br><span class="line">cond=&gt;condition: 确认？</span><br><span class="line"></span><br><span class="line">st-&gt;op-&gt;cond</span><br><span class="line">cond(yes)-&gt;e</span><br><span class="line">cond(no)-&gt;op</span><br></pre></td></tr></table></figure></p><ul><li>关于 <strong>Flowchart流程图</strong> 语法，参考 <a href="http://adrai.github.io/flowchart.js/" target="_blank" rel="noopener">这儿</a>.</li></ul><h2 id="导出与导入"><a href="#导出与导入" class="headerlink" title="导出与导入"></a>导出与导入</h2><h3 id="导出"><a href="#导出" class="headerlink" title="导出"></a>导出</h3><p>如果你想尝试使用此编辑器, 你可以在此篇文章任意编辑。当你完成了一篇文章的写作, 在上方工具栏找到 <strong>文章导出</strong> ，生成一个.md文件或者.html文件进行本地保存。</p><h3 id="导入"><a href="#导入" class="headerlink" title="导入"></a>导入</h3><p>如果你想加载一篇你写过的.md文件或者.html文件，在上方工具栏可以选择导入功能进行对应扩展名的文件导入，<br>继续你的创作。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;记录CSDN 的markdown语法，备查&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="语言" scheme="http://11wy11.github.io/categories/%E8%AF%AD%E8%A8%80/"/>
    
    
      <category term="markdown" scheme="http://11wy11.github.io/tags/markdown/"/>
    
  </entry>
  
  <entry>
    <title>git常用命令</title>
    <link href="http://11wy11.github.io/2019/03/13/git-command/"/>
    <id>http://11wy11.github.io/2019/03/13/git-command/</id>
    <published>2019-03-13T12:41:15.000Z</published>
    <updated>2019-03-24T01:30:11.348Z</updated>
    
    <content type="html"><![CDATA[<p>记录一些常用的git命令，目前理解还不是很深，有点进一步查阅资料<br><a id="more"></a></p><ol><li><p>强制本地覆盖远程分支   </p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">    git push origin *** --force  </span><br><span class="line">    ```  </span><br><span class="line">2. 放弃本地分支，远程分支强制覆盖本地</span><br><span class="line">  </span><br><span class="line">git fetch --all    //只是下载代码到本地，不进行合并操作</span><br><span class="line">git reset --hard origin/分支名如master    //把HEAD指向最新下载的版本</span><br><span class="line">3. 删除远程分支和本地分支</span><br></pre></td></tr></table></figure><p>git branch -a//查看分支<br>git push origin –delete <strong><em>// 删除远程分支<br>git branch -d </em></strong>//删除本地分支</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">4. git diff</span><br><span class="line">    检查文件更改内容</span><br><span class="line">5. 撤销未提交的修改git checkout</span><br></pre></td></tr></table></figure><p>  git checkout app/src/main/../MainActivity </p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">6、git reset</span><br></pre></td></tr></table></figure><p>git log #找到需要退回的commit版本号，可以只复制前几位<br>git reset &lt;刚查找到的版本号&gt;<br><code>`</code><br>7、git log</p></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;记录一些常用的git命令，目前理解还不是很深，有点进一步查阅资料&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="使用技巧" scheme="http://11wy11.github.io/categories/%E4%BD%BF%E7%94%A8%E6%8A%80%E5%B7%A7/"/>
    
    
      <category term="git" scheme="http://11wy11.github.io/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>使用hexo+github创建个人博客并备份源码</title>
    <link href="http://11wy11.github.io/2019/03/09/create-blog-process/"/>
    <id>http://11wy11.github.io/2019/03/09/create-blog-process/</id>
    <published>2019-03-09T13:52:06.000Z</published>
    <updated>2021-01-02T02:31:09.771Z</updated>
    
    <content type="html"><![CDATA[<p>最基础的hexo+github搭建个人博客的教程<br><a id="more"></a></p><h3 id="一、准备"><a href="#一、准备" class="headerlink" title="一、准备"></a>一、准备</h3><ol><li>安装<a href="https://nodejs.org/en/" target="_blank" rel="noopener">node.js</a></li><li>安装<a href="https://gitforwindows.org/" target="_blank" rel="noopener">git-windows</a></li><li><p>安装hexo-cli</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$npm install hexo-cli -g</span><br></pre></td></tr></table></figure></li><li><p>在GitHub上创建&lt;username&gt;.github.io的仓库</p><pre><code>e.g. 11wy11.github.io</code></pre></li><li><p>配置SSH key<br>打开本机的控制台，以windows系统为例，可以执行win+R 输入cmd打开，执行</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -C &apos;D:/id.txt&apos;</span><br></pre></td></tr></table></figure><p>然后连续按3次回车，最终会在用户目录下生成一个文件，找到<strong>目录.ssh/id_rsa.pub</strong>文件，用记事本打开全选复制。<br>在你的github上点击头像&gt;设置进入设置页面，选择SSH and GPG keys, 点击<strong>New SSH key</strong>按钮，名称随意填写，将刚复制的内容粘贴到key,添加<br><img src="/2019/03/09/create-blog-process/res2.png" alt="添加ssh key"></p><h3 id="二、搭建流程"><a href="#二、搭建流程" class="headerlink" title="二、搭建流程"></a>二、搭建流程</h3></li><li>本地创建&lt;username&gt;.github.io</li><li><p>在本地&lt;username&gt;.github.io文件夹下初始化hexo项目并安装依赖</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo init //初始化工程</span><br><span class="line">npm install //安装依赖</span><br><span class="line">hexo server //启动本地调试器在localhost:4000预览</span><br></pre></td></tr></table></figure></li><li><p>修改默认主题，可以在github上clone其他的主题，如<a href="https://github.com/litten/hexo-theme-yilia" target="_blank" rel="noopener">yilia</a>,<a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">icarus</a>,<a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank" rel="noopener">indigo</a>等</p><ul><li><p>以indigo为例，在本地&lt;username&gt;.github.io文件夹下执行以下命令安装主题</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone git@github.com:yscoder/hexo-theme-indigo.git themes/indigo</span><br></pre></td></tr></table></figure></li><li><p>修改工程中的_config.yml配置文件，将themes: landscope改为themes: indigo<br><img src="/2019/03/09/create-blog-process/res1.png" alt="修改配置"></p></li><li><p>依赖安装分别安装Less,Feed,Json-content依赖，执行如下命令</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ npm install hexo-renderer-less --save</span><br><span class="line">$ npm install hexo-generator-feed --save</span><br><span class="line">$ npm install hexo-generator-json-content --save</span><br></pre></td></tr></table></figure></li><li><p>执行<code>hexo s</code>命令启动服务器在localhost:4000查看效果</p></li></ul></li><li>新建文章，使用hexo new  “my-first blog”，会在source/_posts下创建my-first-blog.md的页面文件<br>进行编写</li><li><p>发布博客<br>首先修改工程中的_config.yml配置文件，在最后三行添加以下代码，将username换成自己的git用户名</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line">  type: git</span><br><span class="line">  repo: git@github.com:&lt;username&gt;/&lt;username&gt;.github.io.git</span><br><span class="line">  branch: master</span><br></pre></td></tr></table></figure><p> 其次安装hexo-deployer-git 执行 <code>npm install hexo-deployer-git --save</code><br> 在工程文件夹内右键git bash进入命令行 输入hexo g，编译为静态文件，生成public文件夹，使用 hexo d 部署，此时可以访问https://&lt;username&gt;.github.io查看你的博客</p></li><li><p>备份源码<br> 在工程文件夹内右键git bash进入命令行 输入 touch .gitignore ，生成“.gitignore”文件。<br> 在”.gitignore” 文件里输入你要忽略的文件夹及其文件就可以了。（注意格式）<br> 我的 .gitignore：</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">node_modules/</span><br><span class="line">.deploy_git</span><br><span class="line">public/</span><br><span class="line">.DS_Store </span><br><span class="line">Thumbs.db</span><br><span class="line">db.json  </span><br><span class="line">*.log</span><br><span class="line">.deploy*/</span><br></pre></td></tr></table></figure><p>  执行以下命令</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#git初始化</span><br><span class="line">git init</span><br><span class="line">#创建hexo分支，用来存放源码</span><br><span class="line">git checkout -b hexo</span><br><span class="line">#git 文件添加</span><br><span class="line">git add .</span><br><span class="line">#git 提交</span><br><span class="line">git commit -m &quot;init&quot;</span><br><span class="line">#添加远程仓库</span><br><span class="line">git remote add origin git@github.com:&lt;username&gt;/&lt;username&gt;.github.io.git</span><br><span class="line">#push到hexo分支</span><br><span class="line">git push origin hexo</span><br></pre></td></tr></table></figure><p> 执行hexo g -d生成网站并部署到GitHub上<br> 这样一来，在GitHub上的<a href="mailto:git@github.com" target="_blank" rel="noopener">git@github.com</a>:&lt;username&gt;/&lt;username&gt;.github.io.git仓库就有两个分支，一个hexo分支用来存放网站的原始文件，一个master分支用来存放生成的静态网页。</p></li><li>其他设备更新博客步骤：<br> 1、先安装hexo<br> $ npm install -g hexo-cli<br> 2、存在github上的git clone下来<br> git clone -b hexo <a href="mailto:git@github.com" target="_blank" rel="noopener">git@github.com</a>:&lt;username&gt;/&lt;username&gt;.github.io.git<br> 3、项目文件夹下<br> $ npm install<br> $ npm install hexo-deployer-git<br> 4、重新配置github和coding的公钥<br> 5、编写博客push 到远程分支   <h3 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h3></li><li>有时会出现下载的主题无法上传，首先删除themes/主题文件夹下的<code>.git</code>,使用<code>git rm --cached themes/indigo</code>命令清空后重新上传`</li><li>如果最开始.gitignore文件没有配置正确，可以使用<code>git rm -r --cached .</code>命令清楚缓存文件，重新add,commit,push上传</li><li>当使用node 14以上版本，使用hexo d命令部署时，会提示AGType错误，需要将node的版本退回到12，可以使用nvm管理多个版本的node,具体步骤如下：<ol><li>下载nvm(<a href="https://github.com/coreybutler/nvm-windows/releases" target="_blank" rel="noopener">https://github.com/coreybutler/nvm-windows/releases</a>) setup.zip,安装，<strong>注意不要将nvm安装到默认的c/program files下，换一个盘，不然安装node之后会提示node命令找不到</strong></li><li>在控制台，使用<code>nvm install node@12.4.0</code>命令安装node，可以使用nvm ls 查看当前安装的node版本，使用命令<code>nvm use 12.4.0</code>使用指定版本，使用命令node -v 或 npm -v检查安装是否成功</li></ol></li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;最基础的hexo+github搭建个人博客的教程&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="工具" scheme="http://11wy11.github.io/categories/%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="hexo" scheme="http://11wy11.github.io/tags/hexo/"/>
    
      <category term="git" scheme="http://11wy11.github.io/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>Vue全局添加组件</title>
    <link href="http://11wy11.github.io/2019/03/09/Vue-global-component/"/>
    <id>http://11wy11.github.io/2019/03/09/Vue-global-component/</id>
    <published>2019-03-09T02:39:22.000Z</published>
    <updated>2019-03-24T01:36:27.024Z</updated>
    
    <content type="html"><![CDATA[<p>Vue全局添加组件，方便重复使用的功能一次性定义<br><a id="more"></a></p><h3 id="一-背景"><a href="#一-背景" class="headerlink" title="一. 背景"></a>一. 背景</h3><p>在项目中有时需要反复用到如区域选择器等组件，每次使用时都需要在对应的vue中添加import,并在component中注册，为了避免多次书写引用代码，可以自定义全局组件，只需要在main.js中一次性注册在vue项目中，可以自定义组件像vue-resource一样使用Vue.use（）方法来使用。</p><h3 id="二-具体实现方法"><a href="#二-具体实现方法" class="headerlink" title="二. 具体实现方法"></a>二. 具体实现方法</h3><p>1、首先建一个自定义组件的文件夹，比如叫loading，在该文件夹下新建一个index.js，一个自定义组件loading.vue,在这个loading.vue里面就是这个组件的具体的内容，</p><p>2、在index.js中，规定使用这个组件的名字，以及使用方法，如：</p><pre><code>import loadingComponent from &apos;./loading.vue&apos;const loading={    install:function(Vue){        Vue.component(&apos;Loading&apos;,loadingComponent)    }  //&apos;Loading&apos;这就是后面可以使用的组件的名字，install是默认的一个方法};export default loading;</code></pre><p>3、只要在main.js中规定了install方法，就可以像一些公共的插件一样使用Vue.use()来使用：</p><pre><code>import loading from &apos;./loading&apos;Vue.use(loading）</code></pre>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Vue全局添加组件，方便重复使用的功能一次性定义&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="前端" scheme="http://11wy11.github.io/categories/%E5%89%8D%E7%AB%AF/"/>
    
    
      <category term="Vue" scheme="http://11wy11.github.io/tags/Vue/"/>
    
  </entry>
  
  <entry>
    <title>Oracle配置SDE支持空间查询</title>
    <link href="http://11wy11.github.io/2019/03/09/oracle-st-geometry/"/>
    <id>http://11wy11.github.io/2019/03/09/oracle-st-geometry/</id>
    <published>2019-03-09T01:56:40.000Z</published>
    <updated>2019-03-24T01:33:52.010Z</updated>
    
    <content type="html"><![CDATA[<p> Oracle配置SDE支持空间查询,配置oracle外部链接库<br><a id="more"></a></p><h3 id="配置oracle外部链接库"><a href="#配置oracle外部链接库" class="headerlink" title="配置oracle外部链接库"></a>配置oracle外部链接库</h3><ol><li>将ArcGIS Desktop安装目录下DatabaseSupport文件夹下的st_shapelib.dll拷贝到装有oracle的服务器上，可以放置在任意地方，这里推荐放在Oracle安装目录下的bin文件夹下。<br> 例如：st_shapelib.dll所在文件夹路径：<br> C:\ProgramFiles(x86)\ArcGIS\Desktop10.2\DatabaseSupport\Oracle\Windows64\st_shapelib.dll<br> 拷贝放置位置：E:\app\503\product\11.2.0\dbhome_1\BIN\ st_shapelib.dll</li><li><p>修改oracle安装目录下的network/admin文件夹下的listener.ora,将步骤1中的st_shapelib.dll路径添加到<br>ENVS”EXTPROC_DLLS=ONLY:E:\app\503\product\11.2.0\dbhome_1\bin\oraclr11.dll;后面</p><pre><code>例如：linstener文件，添加红色字部分</code></pre> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># listener.ora Network Configuration File: D:\app\Administrator\product\11.2.0\dbhome_1\NETWORK\ADMIN\listener.ora</span><br><span class="line"># Generated by Oracle configuration tools.</span><br><span class="line">SID_LIST_LISTENER =</span><br><span class="line">  (SID_LIST =</span><br><span class="line">    (SID_DESC =</span><br><span class="line">      (SID_NAME = CLRExtProc)</span><br><span class="line">      (ORACLE_HOME = E:\app\503\product\11.2.0\dbhome_1)</span><br><span class="line">      (PROGRAM = extproc)</span><br><span class="line">      (ENVS= &quot;EXTPROC_DLLS=ONLY:E:\app\503\product\11.2.0\dbhome_1\bin\oraclr11.dll;E:\app\503\product\11.2.0\dbhome_1\bin\st_shapelib.dll&quot;) # interesting</span><br><span class="line">    )</span><br><span class="line">  )   </span><br><span class="line">LISTENER =</span><br><span class="line">  (DESCRIPTION_LIST =</span><br><span class="line">    (DESCRIPTION =</span><br><span class="line">      (ADDRESS = (PROTOCOL = TCP)(HOST = 503-PC)(PORT = 1521))</span><br><span class="line">  (ADDRESS = (PROTOCOL = IPC)(KEY = EXTPROC1521))</span><br><span class="line">    )</span><br><span class="line">    (DESCRIPTION =</span><br><span class="line">      (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.1.164)(PORT = 1521))</span><br><span class="line">    )</span><br><span class="line">  )</span><br><span class="line"> </span><br><span class="line">ADR_BASE_LISTENER = E:\app\503</span><br></pre></td></tr></table></figure></li><li><p>修改oracle安装home目录下的hs/admin文件夹下的extproc.ora，具体路径示例：E:\app\503\product\11.2.0\dbhome_1\hs\admin\extproc.ora，将最后一行的SET EXTPROC_DLLS=  设为ANY<br><img src="/2019/03/09/oracle-st-geometry/res1.png" alt="extproc.ora设置"></p></li><li>通过任何一个数据库管理软件，这里以sql-plus为例，使用sde用户登录首先执行：<code>select * from user_libraries</code><br> 查看是否有ST_SHAPELIB并检查路径是否与步骤1中的一致，通常默认为c盘第一次安装Arcgis时的相关路径。结果如下：<br>  <img src="/2019/03/09/oracle-st-geometry/res2.png" alt="extproc.ora设置"><br>  如果路径与步骤1中st_shapelib的路径不一致，执行以下两条命令：<ul><li>Create or replace library st_SHAPELIB  as &lt;步骤1中的st_shapelib路径&gt;<br><img src="/2019/03/09/oracle-st-geometry/res3.png" alt="extproc.ora设置"></li><li>Alter package sde.st_geometry_shapelib_pkg compile reuse settings<br><img src="/2019/03/09/oracle-st-geometry/res4.png" alt="extproc.ora设置"></li></ul></li><li>重启监听器OracleOraDB11g_home1TNSListener，有时也需要重启服务OracleServiceORCL。</li></ol>]]></content>
    
    <summary type="html">
    
      &lt;p&gt; Oracle配置SDE支持空间查询,配置oracle外部链接库&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="ArcGIS" scheme="http://11wy11.github.io/categories/ArcGIS/"/>
    
    
      <category term="ArcGIS" scheme="http://11wy11.github.io/tags/ArcGIS/"/>
    
      <category term="Oracle" scheme="http://11wy11.github.io/tags/Oracle/"/>
    
  </entry>
  
</feed>
